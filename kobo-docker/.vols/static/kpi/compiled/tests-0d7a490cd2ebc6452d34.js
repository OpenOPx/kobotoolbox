!function(e){function t(t){for(var r,s,a=t[0],u=t[1],l=t[2],p=0,d=[];p<a.length;p++)s=a[p],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&d.push(i[s][0]),i[s]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(c&&c(t);d.length;)d.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,a=1;a<n.length;a++){var u=n[a];0!==i[u]&&(r=!1)}r&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},i={2:0},o=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/static/compiled/";var a=window.webpackJsonp=window.webpackJsonp||[],u=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var c=u;o.push([844,0]),n()}({1:function(e,t,n){"use strict";n.r(t),n.d(t,"LANGUAGE_COOKIE_NAME",(function(){return d})),n.d(t,"assign",(function(){return h})),n.d(t,"notify",(function(){return _})),n.d(t,"formatTime",(function(){return m})),n.d(t,"formatTimeDate",(function(){return g})),n.d(t,"formatDate",(function(){return v})),n.d(t,"getAnonymousUserPermission",(function(){return y})),n.d(t,"surveyToValidJson",(function(){return b})),n.d(t,"unnullifyTranslations",(function(){return w})),n.d(t,"nullifyTranslations",(function(){return k})),n.d(t,"redirectTo",(function(){return O})),n.d(t,"getUsernameFromUrl",(function(){return E})),n.d(t,"buildUserUrl",(function(){return S})),n.d(t,"parsePermissions",(function(){return x})),n.d(t,"log",(function(){return j})),n.d(t,"t",(function(){return A})),n.d(t,"replaceSupportEmail",(function(){return L})),n.d(t,"currentLang",(function(){return C})),n.d(t,"getLangAsObject",(function(){return P})),n.d(t,"getLangString",(function(){return N})),n.d(t,"newId",(function(){return B})),n.d(t,"randString",(function(){return z})),n.d(t,"stringToColor",(function(){return $})),n.d(t,"isAValidUrl",(function(){return U})),n.d(t,"checkLatLng",(function(){return M})),n.d(t,"validFileTypes",(function(){return I})),n.d(t,"koboMatrixParser",(function(){return V})),n.d(t,"escapeHtml",(function(){return H})),n.d(t,"readParameters",(function(){return F})),n.d(t,"writeParameters",(function(){return G})),n.d(t,"renderCheckbox",(function(){return J})),n.d(t,"launchPrinting",(function(){return Q}));var r=n(79),i=n.n(r),o=n(7),s=n.n(o),a=n(11),u=n.n(a),l=n(81),c=n(3);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var d="django_language",h=n(47);u.a.defaults.notifier.delay=10,u.a.defaults.notifier.position="bottom-left",u.a.defaults.notifier.closeButton=!0;var f=new l.a;function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";u.a.notify(e,t)}function m(e){return s()(e).calendar(null,{sameElse:"LL"})}function g(e){return s()(e).format("LLL")}function v(e){return s()(e).format("ll")}function y(e){return e.filter((function(e){return void 0===e.user__username&&(e.user__username=e.user.match(/\/users\/(.*)\//)[1]),e.user__username===c.default.ANON_USERNAME}))[0]}function b(e){return e.toFlatJSON(),JSON.stringify(e.toFlatJSON())}function w(e,t){var n=JSON.parse(e),r=[];t.translated&&(r=t.translated);var i=t.translations_0;return i||(i=null),n.settings[0].default_language||null===i||(n.settings[0].default_language=i),null!==i&&(n.choices&&n.choices.forEach((function(e){r.forEach((function(t){void 0!==e[t]&&(e["".concat(t,"::").concat(i)]=e[t],delete e[t])}))})),n.survey&&n.survey.forEach((function(e){r.forEach((function(t){void 0!==e[t]&&(e["".concat(t,"::").concat(i)]=e[t],delete e[t])}))}))),JSON.stringify(n)}function k(e,t,n,r){var o={survey:i()(n),translations:i()(e)};if(void 0===e)return o.translations=[null],o;if(o.translations.length>1&&-1!==o.translations.indexOf(null))throw new Error('There is an unnamed translation in your form definition.\nPlease give a name to all translations in your form.\nUse "Manage Translations" option from form landing page.');if(r){var s=r._initialParams.translations_0||null;if(o.translations[0]===s);else if(o.translations.includes(s)){var a=o.translations.indexOf(s);o.translations.unshift(o.translations.pop(a)),o.survey.forEach((function(e){t.forEach((function(t){var n=e[t];n&&n.unshift(n.pop(a))}))}))}o.translations.includes(s)||(o.translations.unshift(s),o.survey.forEach((function(e){t.forEach((function(t){if(e[t]){var n=null;e.name?n=e.name:e.$autoname&&(n=e.$autoname),e[t].unshift(n)}}))})))}return null!==o.translations[0]&&(o.translations_0=o.translations[0],o.translations[0]=null),o}function O(e){window.location.href=e}function E(e){return e.match(/\/users\/(.*)\//)[1]}function S(e){return e.startsWith(window.location.protocol)?(console.error("buildUserUrl() called with URL instead of username (incomplete v2 migration)"),e):"".concat(c.default.ROOT_URL,"/api/v2/users/").concat(e,"/")}function x(e,t){var n=[],r={};return t?(t.map((function(e){e.user__username=e.user.match(/\/users\/(.*)\//)[1];var t=e.permission.match(/\/permissions\/(.+)\//);return null!==t&&(console.error("parsePermissions(): converting new-style permission URL to codename (incomplete v2 migration)"),e.permission=t[1]),e})).filter((function(t){return t.user__username!==e&&t.user__username!==c.default.ANON_USERNAME})).forEach((function(e){-1===n.indexOf(e.user__username)&&(n.push(e.user__username),r[e.user__username]=[]),r[e.user__username].push(e)})),n.map((function(e){return{username:e,can:r[e].reduce((function(e,t){return e[t.permission.includes("_submissions")?t.permission:t.permission.split("_")[0]]=t,e}),{})}}))):[]}var R,j=((R=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.log.apply(console,t),t[0]}).profileSeconds=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;console.profile(),window.setTimeout((function(){console.profileEnd()}),1e3*e)},R);window.log=j;var T=[];function A(e){return window.gettext?window.gettext(e):e}var q="help@kobotoolbox.org";function L(e){return"undefined"!=typeof supportDetails?e.replace(q,supportDetails.email):e}function C(){return f.get(d)||"en"}function P(e){var t=e.indexOf("("),n=e.indexOf(")"),r=e.substring(t+1,n),i=e.substring(0,t).trim();return r&&i&&i.length+r.length+3===e.length?{code:r,name:i}:void 0}function N(e){return"object"===p(e)&&e.name&&e.code?"".concat(e.name," (").concat(e.code,")"):void 0}j.t=function(){var e={};T.forEach((function(t){e[t]=t})),console.log(JSON.stringify(e,null,4))};var D=0,B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";return D++,"".concat(e).concat(D)},z=function(){return Math.random().toString(36).match(/\.(\S{6}).*/)[1]};function $(e,t){t="number"==typeof t?t:-15;return function(e,t){var n=parseInt(e,16),r=Math.round(2.55*t),i=(n>>16)+r,o=(n>>8&255)+r,s=(255&n)+r;return(16777216+65536*(i<255?i<1?0:i:255)+256*(o<255?o<1?0:o:255)+(s<255?s<1?0:s:255)).toString(16).slice(1)}(function(e){return(e>>24&255).toString(16)+(e>>16&255).toString(16)+(e>>8&255).toString(16)+(255&e).toString(16)}(function(e){for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t}(e)),t)}function U(e){try{return new URL(e),!0}catch(e){return!1}}function M(e){return!!(e&&e[0]&&e[1])}function I(){return[".xls",".xlsx","application/xls","application/vnd.ms-excel","application/octet-stream","application/vnd.openxmlformats","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",""].join(",")}function V(e){var t={};if(e.content&&(t=JSON.parse(e.content)),e.source&&(t=JSON.parse(e.source)),!t.survey)return e;for(var n=!1,r=t.survey.length,i=0;i<r;i++)"kobomatrix"===t.survey[i].type&&(t.survey[i].type="begin_kobomatrix",t.survey[i].appearance="field-list",r++,t.survey.splice(i+1,0,{type:"end_kobomatrix",$kuid:"/".concat(t.survey[i].$kuid)}));for(i=0;i<r;i++)if("begin_kobomatrix"===t.survey[i].type){n=!0;var o=localStorage.getItem("koboMatrix.".concat(t.survey[i].$kuid));if(null!=o){o=JSON.parse(o);var s=!0,a=!1,u=void 0;try{for(var l,c=o.cols[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var p=l.value;i++,r++,t.survey.splice(i,0,o[p])}}catch(e){a=!0,u=e}finally{try{s||null==c.return||c.return()}finally{if(a)throw u}}for(var d=0,h=Object.keys(o.choices);d<h.length;d++){var f=h[d];t.choices.push(o.choices[f])}}}return n&&(e.content&&(e.content=JSON.stringify(t)),e.source&&(e.source=JSON.stringify(t))),e}function H(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}function F(e){if("string"!=typeof e)return null;var t={},n=" ";e.includes(";")?n=";":e.includes(",")&&(n=",");var r=";, ".replace(n,"");return e.replace(new RegExp(" *= *","g"),"=").split(new RegExp("[".concat(r,"]*").concat(n,"[").concat(r,"]*"),"g")).forEach((function(e){if(e.includes("=")){var n=e.slice(0,e.indexOf("=")),r=e.slice(n.length+1);t[n]=r}})),Object.keys(t).length<1?null:t}function G(e){var t=[];return Object.keys(e).forEach((function(n){if(void 0!==e[n]&&null!==e[n]){var r=e[n];"object"===p(r)&&(r=JSON.stringify(r)),t.push("".concat(n,"=").concat(r))}})),t.join(";")}function J(e,t,n){var r="";return n&&(r+="alertify-toggle-important"),'<div class="alertify-toggle checkbox '.concat(r,'"><label class="checkbox__wrapper"><input type="checkbox" class="checkbox__input" id="').concat(e,'"><span class="checkbox__label">').concat(t,"</span></label></div>")}function Q(){window.print()}"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(d,"LANGUAGE_COOKIE_NAME","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(f,"cookies","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(_,"notify","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(m,"formatTime","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(g,"formatTimeDate","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(v,"formatDate","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(y,"getAnonymousUserPermission","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(b,"surveyToValidJson","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(w,"unnullifyTranslations","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(k,"nullifyTranslations","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(O,"redirectTo","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(E,"getUsernameFromUrl","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(S,"buildUserUrl","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(x,"parsePermissions","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(j,"log","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(T,"__strings","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(A,"t","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(q,"originalSupportEmail","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(L,"replaceSupportEmail","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(C,"currentLang","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(P,"getLangAsObject","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(N,"getLangString","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(D,"lastId","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(B,"newId","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(z,"randString","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register($,"stringToColor","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(U,"isAValidUrl","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(M,"checkLatLng","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(I,"validFileTypes","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(V,"koboMatrixParser","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(H,"escapeHtml","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(F,"readParameters","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(G,"writeParameters","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(J,"renderCheckbox","/srv/src/kpi/jsapp/js/utils.es6"),__REACT_HOT_LOADER__.register(Q,"launchPrinting","/srv/src/kpi/jsapp/js/utils.es6"))},103:function(e,t,n){"use strict";n.d(t,"b",(function(){return o}));var r=n(5),i=n(3);function o(e){var t={},n=[];return e.forEach((function(e){if("begin_group"!==e.type&&"begin_repeat"!==e.type||n.push(e.name||e.$autoname),"end_group"!==e.type&&"end_repeat"!==e.type||n.pop(),i.QUESTION_TYPES.has(e.type)){var r=e.name||e.$autoname,o="";n.length>=1&&(o=n.join("/")+"/"),t[r]="".concat(o).concat(r)}})),t}function s(e,t){r.a.resources.updateAsset(e,{parent:"/api/v2/collections/".concat(t,"/")})}var a={getSurveyFlatPaths:o,moveToCollection:s};t.a=a;"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(o,"getSurveyFlatPaths","/srv/src/kpi/jsapp/js/assetUtils.es6"),__REACT_HOT_LOADER__.register(s,"moveToCollection","/srv/src/kpi/jsapp/js/assetUtils.es6"),__REACT_HOT_LOADER__.register(a,"default","/srv/src/kpi/jsapp/js/assetUtils.es6"))},106:function(e,t,n){var r,i,o,s,a,u,l,c,p,d,h,f,_,m,g,v,y,b,w,k,O,E=function(e,t){for(var n in t)S.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},S={}.hasOwnProperty,x=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},R=[].slice;l=n(15),u=n(20),p=n(11),d=n(43),i=n(35),a=n(19),n(87),n(53),o=n(304),r=n(73),s=n(39),c=n(1).t,h=n(1).readParameters,f=n(1).writeParameters,e.exports=((O={}).BaseRow=function(e){function t(e,n){var r;for(r in null==e&&(e={}),null==n&&(n={}),e)e[r],""===r&&delete e[r];t.__super__.constructor.call(this,e,n)}return E(t,e),t.kls="BaseRow",t.prototype.ensureKuid=function(){if(!("$kuid"in this.attributes))return this.set("$kuid",a.txtid())},t.prototype.initialize=function(){return this.ensureKuid(),this.convertAttributesToRowDetails()},t.prototype.isError=function(){return!1},t.prototype.convertAttributesToRowDetails=function(){var e,t,n,r;for(e in n=[],t=this.attributes)(r=t[e])instanceof o.RowDetail?n.push(void 0):n.push(this.set(e,new o.RowDetail({key:e,value:r},{_parent:this}),{silent:!0}));return n},t.prototype.attributesArray=function(){var e,t,n;return(e=function(){var e,r;for(t in r=[],e=this.attributes)n=e[t],r.push([t,n]);return r}.call(this)).sort((function(e,t){return e[1]._order<t[1]._order?-1:1})),e},t.prototype.isGroup=function(){return"Group"===this.constructor.kls},t.prototype.isInGroup=function(){var e,t;return"Group"===(null!=(e=this._parent)&&null!=(t=e._parent)?t.constructor.kls:void 0)},t.prototype.detach=function(e){this._parent&&(this._parent.remove(this,e),this._parent=null)},t.prototype.selectableRows=function(){var e,t,n,r,i;return n=[],e=!1,t=["datetime","time","note","calculate","group","kobomatrix","repeat","rank","score"],null===(r=this.getSurvey())?null:(r.forEachRow((i=this,function(r){var o;if(!(e=e||r===i)&&(o=r.getValue("type"),x.call(t,o)<0))return n.push(r)}),{includeGroups:!0}),n)},t.prototype.export_relevant_values=function(e,t){return e.push(this.toJSON2())},t.prototype.toJSON2=function(){var e,t,n,r,o,s,a,u,c;for(r={},e=0,n=(o=this.attributesArray()).length;e<n;e++)t=(s=o[e])[0],c=s[1],"type"!==t||"select_one"!==(a=c.get("typeId"))&&"select_multiple"!==a?(u=this.getValue(t),this.hidden||(l.isBoolean(u)?r[t]=i.boolOutputs[u?"true":"false"]:""!==u&&(r[t]=u))):(r.type=c.get("typeId"),r.select_from_list_name=c.get("listName"));return r},t.prototype.toJSON=function(){var e,t,n,r,o,s,a;for(r={},e=0,n=(o=this.attributesArray()).length;e<n;e++)t=(s=o[e])[0],s[1],a=this.getValue(t),this.hidden||(l.isBoolean(a)?r[t]=i.boolOutputs[a?"true":"false"]:r[t]=a);return r},t}(d.BaseModel),k=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.prototype.finalize=function(){},t.prototype.simpleEnsureKuid=function(){if(!("$kuid"in this.attributes))return this.set("$kuid",a.txtid())},t.prototype.getTypeId=function(){return this.get("type")},t.prototype.linkUp=function(){},t.prototype._isSelectQuestion=function(){return!1},t.prototype.get_type=function(){return s.question_types[this.getTypeId()]||s.question_types.default},t.prototype.getValue=function(e){return this.get(e)},t}(u.Model),m=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.prototype.initialize=function(){return this.simpleEnsureKuid(),this.set("type","rank__level")},t.prototype.export_relevant_values=function(e,t){return e.push(this.attributes)},t}(k),y=function(){function e(){}return e.prototype._extendAll=function(e){var t,n,r,i,o,s,u,c;if(i=function(t,n){return l.isFunction(t)?e[n]=function(){var n;return n=1<=arguments.length?R.call(arguments,0):[],t.apply(e,n)}:e[n]=t},l.each(this,i),i(this.forEachRow,"forEachRow"),t=e.getValue("$kuid",!1),n=this.end_json({$kuid:"/"+t}),e._afterIterator=function(e,t){var r;if(r={export_relevant_values:function(e,t){return e.push(l.extend({},n))},toJSON:function(){return l.extend({},n)}},t.includeGroupEnds)return e(r)},r=e.toJSON,e.clone=function(){var t,n,r,i,o,s,u,l,c,p,d,h,f,_,m,g,v,y;if(t=e.toJSON2(),d={_parent:e._parent,add:!1,merge:!1,remove:!1,silent:!0},(h=new O.Row(t,d))._isCloned=!0,e._rankRows){for(n=0,s=(_=e._rankRows.models).length;n<s;n++)f=_[n],h._rankRows.add(f.toJSON());for(h._rankLevels=e.getSurvey().choices.add({name:a.txtid()}),i=0,u=(m=e.getList().options.models).length;i<u;i++)r=m[i],h._rankLevels.options.add(r.toJSON());h.set("kobo--rank-items",h._rankLevels.get("name")),this.convertAttributesToRowDetails(),h.get("type").set("list",h._rankLevels)}else{for(o=0,l=(g=e._scoreRows.models).length;o<l;o++)y=g[o],h._scoreRows.add(y.toJSON());for(h._scoreChoices=e.getSurvey().choices.add({name:a.txtid()}),p=0,c=(v=e.getList().options.models).length;p<c;p++)r=v[p],h._scoreChoices.options.add(r.toJSON());h.set("kobo--score-choices",h._scoreChoices.get("name")),this.convertAttributesToRowDetails(),h.get("type").set("list",h._scoreChoices)}return h},e.toJSON=function(){return l.extend(r.call(e),{type:"begin_"+e._beginEndKey()},"function"==typeof this._additionalJson?this._additionalJson():void 0)},l.each(this.constructor.prototype,i),e.attributes.__rows){for(o=0,s=(u=e.attributes.__rows).length;o<s;o++)c=u[o],this[this._rowAttributeName].add(c);return delete e.attributes.__rows}},e.prototype.getValue=function(e){return this.get(e)},e.prototype.end_json=function(e){return null==e&&(e={}),l.extend({type:"end_"+this._beginEndKey()},e)},e.prototype.forEachRow=function(e,t){if(e(this),this[this._rowAttributeName].each((function(t){return e(t)})),"_afterIterator"in this)return this._afterIterator(e,t)},e}(),g=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.prototype.model=m,t}(u.Collection),_=function(e){function t(e){this._rankRows=new g,this._rowAttributeName="_rankRows",this._extendAll(e),e.get("kobo--rank-constraint-message")||e.set("kobo--rank-constraint-message",c("Items cannot be selected more than once"))}return E(t,e),t.prototype._beginEndKey=function(){return"rank"},t.prototype.linkUp=function(e){var t,n,r;return t=null!=(n=this.get("kobo--rank-items"))?n.get("value"):void 0,this._rankLevels=t?this.getSurvey().choices.get(t):this.getSurvey().choices.create(),this._additionalJson=(r=this,function(){return{"kobo--rank-items":r.getList().get("name")}}),this.getList=function(e){return function(){return e._rankLevels}}(this)},t.prototype.export_relevant_values=function(e,t){var n;this._rankLevels&&t.choices.add(this._rankLevels),(n=l.clone(this.toJSON2())).type="begin_rank",n["kobo--rank-items"]=this.getList().get("name"),e.push(n)},t}(y),function(e){function t(){return t.__super__.constructor.apply(this,arguments)}E(t,Array)}(),b=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.prototype.initialize=function(){return this.set("type","score__row"),this.simpleEnsureKuid()},t.prototype.export_relevant_values=function(e,t){return e.push(this.attributes)},t}(k),w=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.prototype.model=b,t}(u.Collection),v=function(e){function t(e){this._scoreRows=new w,this._rowAttributeName="_scoreRows",this._extendAll(e)}return E(t,e),t.prototype._beginEndKey=function(){return"score"},t.prototype.linkUp=function(e){var t,n,r;this.getList=(r=this,function(){return r._scoreChoices}),this._additionalJson=function(e){return function(){return{"kobo--score-choices":e.getList().get("name")}}}(this),(n=this.get("kobo--score-choices"))?(t=n.get("value"))?this._scoreChoices=this.getSurvey().choices.get(t):(e.warnings.push("Score choices list not found"),this._scoreChoices=this.getSurvey().choices.add({})):(e.warnings.push("Score choices list not set"),this._scoreChoices=this.getSurvey().choices.add({name:a.txtid()}))},t.prototype.export_relevant_values=function(e,t){var n,r;(r=this._scoreChoices)&&t.choices.add(r),(n=l.clone(this.toJSON2())).type="begin_score",n["kobo--score-choices"]=this.getList().get("name"),e.push(n)},t}(y),O.Row=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.kls="Row",t.prototype.initialize=function(){var e,t,n,r,o,s,u,c,p,d,h,f,m,g,y;for(s in this._parent?(o=this._parent.newRowDetails||i.newRowDetails,r=this._parent.defaultsForType||i.defaultsForType):("undefined"!=typeof console&&null!==console&&console.error("Row not linked to parent survey."),o=i.newRowDetails,r=i.defaultsForType),t=this.attributes.type&&this.attributes.type in r?r[this.attributes.type]:{},n=l.extend({},o,t))if(f=n[s],!(s in this.attributes)){for(m in u={},f)g=f[m],u[m]="function"==typeof g?g():g;this.set(s,u)}return"$kuid"in this.attributes||this.set("$kuid",a.txtid()),"score"===(e=this.getValue("type"))?new v(this):"rank"===e&&new _(this),this.convertAttributesToRowDetails(),d=(h=this.get("type")).get("value"),(p=this.get("select_from_list_name"))&&d&&(d=d+" "+p.get("value"),h.set("value",d,{silent:!0})),y=this,(c=function(e,t,n){var r,o,s,a,u,c;if(l.isObject(t)?(c=l.keys(t)[0],o=l.values(t)[0]):(c=(a=t.split(" "))[0],o=a[1],s=a[2]),h.set("typeId",c,{silent:!0}),o&&(h.set("listName",o,{silent:!0}),(r=y.getSurvey().choices.get(o))&&h.set("list",r)),"or_other"!==s&&"select_one_or_other"!==c&&"select_multiple_or_other"!==c||h.set("orOther",s,{silent:!0}),u=i.lookupRowType(c))return h.set("rowType",u,{silent:!0});throw new Error("type `"+c+"` not found")})(h,d,{}),h.on("change:value",c),h.on("change:listName",(function(e,t,n){var r,i;return r=h.get("rowType"),i=""+h.get("typeId"),r.specifyChoice&&t&&(i+=" "+t),r.orOtherOption&&h.get("orOther")&&(i+=" or_other"),h.set({value:i},{silent:!0})})),h.on("change:list",(function(e,t,n){var r;if(h.get("rowType").specifyChoice)return(r=t.get("name"))||(r=a.txtid(),t.set("name",r,{silent:!0})),this.set("value",this.get("typeId")+" "+r)}))},t.prototype.getTypeId=function(){return this.get("type").get("typeId")},t.prototype.clone=function(){var e,t,n,r,i,o;return e={},r={_parent:this._parent,add:!1,merge:!1,remove:!1,silent:!0},l.each(this.attributes,(o=this,function(t,n){return e[n]=o.getValue(n)})),"select_one"!==(i=(n=(t=new O.Row(e,r)).get("type")).get("typeId"))&&"select_multiple"!==i||(n.set("list",this.getList().clone()),n.set("listName",n.get("list").get("name"))),this.getSurvey().trigger("change"),t},t.prototype.finalize=function(){var e,t;return this.getValue("name")||(t=[],this.getSurvey().forEachRow((function(e){var n;if(n=e.getValue("name"))return t.push(n)})),e=this.getValue("label"),this.get("name").set("value",a.sluggifyLabel(e,t))),this},t.prototype.get_type=function(){return s.question_types[this.getTypeId()]||s.question_types.default},t.prototype._isSelectQuestion=function(){var e;return"select_one"===(e=this.get("type").get("typeId"))||"select_multiple"===e},t.prototype.getAcceptedFiles=function(){var e,t;return null!=(e=this.attributes["body::accept"])&&null!=(t=e.attributes)?t.value:void 0},t.prototype.setAcceptedFiles=function(e){this.setDetail("body::accept",e)},t.prototype.getParameters=function(){var e,t;return h(null!=(e=this.attributes.parameters)&&null!=(t=e.attributes)?t.value:void 0)},t.prototype.setParameters=function(e){var t;t=f(e),this.setDetail("parameters",t)},t.prototype.getList=function(){var e,t;return!(e=null!=(t=this.get("type"))?t.get("list"):void 0)&&this._isSelectQuestion()&&(e=new r.ChoiceList({name:a.txtid()}),this.setList(e)),e},t.prototype.setList=function(e){var t;if((t=this.getSurvey().choices.get(e))||(this.getSurvey().choices.add(e),t=this.getSurvey().choices.get(e)),!t)throw new Error("List not found: "+e);return this.get("type").set("list",t)},t.prototype.parse=function(){var e,t,n,r;for(e in n=[],t=this.attributes)r=t[e],n.push(r.parse());return n},t.prototype.linkUp=function(e){var t,n,r,i;for(t in r=[],n=this.attributes)i=n[t],r.push(i.linkUp(e));return r},t}(O.BaseRow),O.RowError=function(e){function t(e,n){this._error=n.error,window.xlfHideWarnings||("undefined"!=typeof console&&null!==console&&console.error("Error creating row: ["+n.error+"]",e),p.error("Error creating row: ["+n.error+"]")),t.__super__.constructor.call(this,e,n)}return E(t,e),t.prototype.isError=function(){return!0},t.prototype.getValue=function(e){return e in this.attributes?this.attributes[e].get("value"):"[error]"},t}(O.BaseRow),O)},121:function(e,t,n){var r,i,o,s;r=n(122),e.exports=(o=/^\${(\w+)}\s*(!=|<=|>=|=|<|>)\s*((?:date\(\'\d{4}-\d{2}-\d{2}\'\))|(?:-?(?:\d+\.\d+|\.\d+|\d+.?))|(?:\'[^']+\'))/,s=/\${(\w+)}\s*((?:=|!=)\s*(?:NULL|''))/i,i=RegExp(" and | or ","gi"),r(o,s,i,/selected\(\$\{(\w+)\},\s*\'(\w+)\'\)/))},122:function(e,t,n){var r=n(15);e.exports=function(e,t,n,i){function o(n){var r=n.match(t);if(null===r&&(r=n.match(e)),!r)return function(e){var t=e.match(i);if(!t)throw new Error('criterion not recognized: "'+e+'"');return{name:t[1],operator:-1==e.indexOf("not(")?"multiplechoice_selected":"multiplechoice_notselected",response_value:t[2]}}(n);r[2]=r[2].replace(/\s+/,"").replace(/null/i,"NULL");var o={name:r[1],operator:{"=":"resp_equals","!=":"resp_notequals",">":"resp_greater","<":"resp_less",">=":"resp_greaterequals","<=":"resp_lessequals","!=''":"ans_notnull","=''":"ans_null"}[r[2]]};if(r[3]){var s=r[3].replace(/^'([^']*)'$/,"$1");s=s.replace(/date\('(\d{4}-\d{2}-\d{2})'\)/,"$1"),o.response_value=s}return o}return function(e){var t=e.split(n),i=t.length,s=e.match(n);if(s&&r.uniq(s).length>1)throw new Error("multiple criteria join operators are not supported at the moment");return 1===i?{criteria:[o(e)]}:{criteria:r.map(t,(function(e){return o(e)})),operator:s[0].replace(/ /g,"").toUpperCase()}}}},123:function(e,t,n){var r,i,o,s;r=n(122),e.exports=(o=/(\.)\s*(!=|<=|>=|=|<|>)\s*((?:date\(\'\d{4}-\d{2}-\d{2}\'\))|(?:-?(?:\d+\.\d+|\.\d+|\d+.?))|(?:\'[^']+\'))/,s=/(\.)\s*((?:=|!=)\s*(?:NULL|''))/i,i=RegExp(" and | or ","gi"),r(o,s,i,/selected\((\.)\s*,\s*\'(\w+)\'\)/))},124:function(e,t,n){var r,i,o,s=function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},a={}.hasOwnProperty,u=function(e,t){return function(){return e.apply(t,arguments)}};i=n(15),r=n(20),e.exports=((o={}).Base=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.attach_to=function(e){return e instanceof o.Base&&(e=e.$el),e.append(this.el)},t.prototype.bind_event=function(e,t){return this.$el.off(e,t),this.$el.on(e,t)},t.prototype.detach=function(){return this.$el.remove()},t.prototype.val=function(e){return e?(this.$el.val(e),null==this.$el.val()?this.$el.prop("selectedIndex",0):void 0):this.$el.val()},t}(r.View),o.Label=function(e){function t(e,n,r){this.text=e,this.className=n,this.input=r,t.__super__.constructor.call(this)}return s(t,e),t.prototype.tagName="label",t.prototype.val=function(){},t.prototype.bind_event=function(){},t.prototype.render=function(){return this.text&&this.$el.text(this.text),this.className&&this.$el.addClass(this.className),this.input&&this.$el.attr("for",this.input.cid),this},t}(o.Base),o.EmptyView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.attach_to=function(){},t.prototype.val=function(){},t.prototype.bind_event=function(){},t.prototype.render=function(){return this},t.prototype.val=function(){return null},t}(o.Base),o.TextArea=function(e){function t(e,n){this.text=e,this.className=n,t.__super__.constructor.call(this)}return s(t,e),t.prototype.tagName="textarea",t.prototype.render=function(){return this.$el.val(this.text),this.$el.addClass(this.className),this.$el.on("paste",(function(e){return e.stopPropagation()})),this},t}(o.Base),o.TextBox=function(e){function t(e,n,r){this.text=e,this.className=n,this.placeholder=r,t.__super__.constructor.call(this)}return s(t,e),t.prototype.tagName="input",t.prototype.render=function(){return this.$el.attr("type","text"),this.$el.val(this.text),this.$el.addClass(this.className),this.$el.attr("placeholder",this.placeholder),this.$el.on("paste",(function(e){return e.stopPropagation()})),this},t}(o.Base),o.Button=function(e){function t(e,n){this.text=e,this.className=n,t.__super__.constructor.call(this)}return s(t,e),t.prototype.tagName="button",t.prototype.render=function(){return this.$el.html(this.text),this.$el.addClass(this.className),this},t}(o.Base),o.DropDownModel=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t}(r.Model),o.DropDown=function(e){function t(e){var n;this.options=e,this.render=u(this.render,this),t.__super__.constructor.apply(this,arguments),n=this.options,this.options instanceof o.DropDownModel||(this.options=new o.DropDownModel,this.options.set("options",n)),this.options.on("change:options",this.render.bind(this))}return s(t,e),t.prototype.tagName="select",t.prototype.render=function(){var e;return e="",i.each(this.options.get("options"),(function(t){return e+='<option value="'+t.value+'">'+t.text+"</option>"})),this.$el.html(e),this},t.prototype.attach_to=function(e){return t.__super__.attach_to.call(this,e),this.$el.select2({minimumResultsForSearch:-1})},t}(o.Base),o)},125:function(e,t,n){var r,i,o,s,a,u,l,c,p,d=[].slice;i=n(15),o=n(74),r=n(53),e.exports=(a=function(e,t){var n;return null==t&&(t={}),n=s(e,t),!t.error&&t.validate&&u(n,t),n},l=function(e){var t,n,r;return t=o.sheeted(e),(n={}).survey=(r=t.sheet("survey"))?r.toObjects():[],n.choices=(r=t.sheet("choices"))?r.toObjects():[],(r=t.sheet("settings"))&&(n.settings=r.toObjects()[0]),n},c=function(e){var t,n,r,o,s,a,u,l,c,p,h,f,_,m;for(m in e)if(_=e[m],i.isArray(_)&&_.length>0&&i.isArray(_[0])){for(p=[],n=_[0],s=0,u=(r=2<=_.length?d.call(_,1):[]).length;s<u;s++)if(f=r[s],i.isArray(f)){for(c={},o=a=0,l=n.length;a<l;o=++a)t=n[o],o<f.length&&void 0!==(h=f[o])&&null!==h&&(c[t]=f[o]);p.push(c)}else p.push(f);e[m]=p}return e},s=function(e,t){return null==t&&(t={}),i.isString(e)?l(e):i.isObject(e)?c(e):void 0},p=r.q.requiredSheetNameList(),a.validateParse=u=function(e,t){var n,r,i,o,s;for(null==t&&(t={}),s=!1,n=0,r=p.length;n<r;n++)e[i=p[n]]&&(t.surveyType=i,s=!0);return e.settings&&(t.settings=!0),e.choices&&(t.choices=!0),s||(o=p.join(", "),t.error="Missing a survey sheet ["+o+"]"),!t.error},a.deserialize=s,a)},126:function(e,t,n){var r,i,o,s,a,u,l,c,p,d,h,f=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};o=n(15),s=n(79),r=n(53),i=n(35),a=n(1),e.exports=(p={},u=function(){function e(e,t){this.type=e,this.atts=null!=t?t:{},this.contents=[]}return e.prototype.push=function(e){this.contents.push(e)},e.prototype.export=function(){var t,n,r,i,s;for(t=[],r=0,i=(s=this.contents).length;r<i;r++)(n=s[r])instanceof e&&(n=n.export()),t.push(n);return o.extend({},this.atts,{type:this.type,__rows:t})},e}(),c=function(e){var t,n,i;for(t=0,n=e.length;t<n;t++){if((i=e[t]).__rows)return!0;if(r.q.testGroupable(i.type))return!1}return!0},p.hasBeenParsed=c,l=function(e,t){var n,r;for(n in e)r=e[n],o.isArray(r)&&"tags"!==n&&(delete e[n],o.map(t,(function(t,i){var o;return o=r[i],e[t?n+"::"+t:n]=o})));return e},h=function(e,t,n){var i,o,s,a,c,p,d,h,f,_;for(null==e&&(e="survey"),null==n&&(n=!1),p={open:{},close:{}},c=function(e,t){var n;null==(n=p[e])[t]&&(n[t]=0),p[e][t]++},d=[new u(e)],a=function(e,t){var n;return null==e&&(e="group"),c("open",e),n=new u(e,t),i().push(n),d.push(n)},s=function(e,t){if(c("close",t),d.pop().type!==e.type)throw new Error("mismatched group/repeat tags")},i=function(){var e;if(0===(e=d.length))throw new Error("unmatched group/repeat");return d[e-1]},f=0,_=t.length;f<_;f++)h=t[f],o=r.q.testGroupable(h.type),n&&n.length>0&&(h=l(h,n)),o?o.begin?a(o.type,h):s(o,h.type):i().push(h);if(1!==d.length)throw new Error(JSON.stringify({message:"unclosed groupable set",counts:p}));return i().export().__rows},d=function(e){var t,n,r,o,a,u,l;for(t=0,n=(r=s(e)).length;t<n;t++)o=(l=r[t]).required,f.call(i.truthyValues,o)>=0?l.required=!0:(a=l.required,(f.call(i.falsyValues,a)>=0||void 0===(u=l.required)||""===u)&&(l.required=!1));return r},p.parseArr=h,p.parse=function(e,t){var n;return e.translations,n=a.nullifyTranslations(e.translations,e.translated,e.survey,t),e.survey=n.survey,e.translations=n.translations,e.translations_0=n.translations_0,e.survey&&(e.survey=d(e.survey)),e.survey&&(e.survey=h("survey",e.survey,e.translations)),e.choices&&(e.choices=h("choices",e.choices,e.translations)),e.settings&&o.isArray(e.settings)&&1===e.settings.length&&(e.settings=e.settings[0]),e},p.loadChoiceLists=function(e,t){var n,r,i,o,s,a,u,l,c,p;for(p={},n=[],o=0,u=e.length;o<u;o++)p[a=(r=e[o])["list name"]||r.list_name]||(p[a]=[],n.push(a)),p[a].push(r);for(c=[],s=0,l=n.length;s<l;s++)i=n[s],c.push(t.add({name:i,options:p[i]}));return c},p)},16:function(e,t,n){"use strict";var r=n(8),i=n.n(r),o=n(5),s=n(1);function a(e,t){var n={},r=!1;return Object.keys(t).forEach((function(i){e[i]!==t[i]&&(n[i]=t[i],r=!0)})),!!r&&n}var u=i.a.createStore({init:function(){this.state={permissions:[]},this.listenTo(o.a.permissions.getConfig.completed,this.onGetConfigCompleted),this.listenTo(o.a.permissions.getConfig.failed,this.onGetConfigFailed)},setState:function(e){var t=a(this.state,e);t&&(Object(s.assign)(this.state,t),this.trigger(t))},onGetConfigCompleted:function(e){this.setState({permissions:e.results})},onGetConfigFailed:function(){Object(s.notify)("Failed to get permissions config!","error")},getPermissionByCodename:function(e){return this.verifyReady(),this.state.permissions.find((function(t){return t.codename===e}))},getPermission:function(e){return this.verifyReady(),this.state.permissions.find((function(t){return t.url===e}))},verifyReady:function(){if(0===this.state.permissions.length)throw new Error(Object(s.t)("Permission config is not ready or failed to initialize!"))}}),l=u;t.a=l;"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(a,"stateChanges","/srv/src/kpi/jsapp/js/components/permissions/permConfig.es6"),__REACT_HOT_LOADER__.register(u,"permConfig","/srv/src/kpi/jsapp/js/components/permissions/permConfig.es6"),__REACT_HOT_LOADER__.register(l,"default","/srv/src/kpi/jsapp/js/components/permissions/permConfig.es6"))},19:function(e,t,n){var r,i,o,s,a,u=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};o=n(15),r=n(121),i=n(123),e.exports=(s=function(e){return e.replace(/^[\s\t\uFEFF\xA0]+|[\s\t\uFEFF\xA0]+$/g,"")},(a={skipLogicParser:r,validationLogicParser:i}).split_paste=function(e){var t,n,r,i,a,u,l,c,p,d,h,f,_,m,g,v;for(p=[],t=0,a=(h=e.split("\n")).length;t<a;t++)m=h[t],(g=s(m)).match(/^\s*$/)||p.push(g.split(/\t/));for(d=[],n=0,u=(f=p.slice(1)).length;n<u;n++){for(c=[],l=r=0,_=(m=f[n]).length;0<=_?r<_:r>_;l=0<=_?++r:--r)i=p[0][l],(v=m[l]).length>0&&c.push([i,v]);d.push(o.object(c))}return d},a.txtid=function(){return"AAnCAnn".replace(/[AaCn]/g,(function(e){var t,n,r;return r=function(){var e;return e=Math.floor(52*Math.random()),e+=e<=25?65:71,String.fromCharCode(e)},n=Math.random(),"a"===e?r():"A"===e?String.fromCharCode(65+(26*n|0)):"C"===e?(t=Math.floor(62*n))>52?t-52:r():"n"===e?Math.floor(10*n):void 0})).toLowerCase()},a.parseHelper={parseSkipLogic:function(e,t,n){var i,o,s,a,u,l;e.meta.set("rawValue",t);try{for(u=r(t),e.reset(),e.parseable=!0,l=u.criteria,o=0,s=l.length;o<s;o++)a={name:(i=l[o]).name,expressionCode:i.operator},"multiplechoice_selected"===i.operator?a.criterionOption=e.getSurvey().findRowByName(i.name).getList().options.get(i.response_value):a.criterion=i.response_value,e.add(a,{silent:!0,_parent:n});return void(u.operator&&e.meta.set("delimSelect",u.operator.toLowerCase()))}catch(t){return e.parseable=!1}}},a.sluggifyLabel=function(e,t){return null==t&&(t=[]),a.sluggify(e,{preventDuplicates:t,lowerCase:!1,preventDuplicateUnderscores:!0,stripSpaces:!0,lrstrip:!0,incrementorPadding:3,validXmlTag:!0})},a.isValidXmlTag=function(e){return 0===e.search(/^[a-zA-Z_:]([a-zA-Z0-9_:.])*$/)},a.sluggify=function(e,t){var n;if(null==t&&(t={}),""===e)return"";if((t=o.defaults(t,{lrstrip:!1,lstrip:!1,rstrip:!1,descriptor:"slug",lowerCase:!0,replaceNonWordCharacters:!0,nonWordCharsExceptions:!1,preventDuplicateUnderscores:!1,validXmlTag:!1,underscores:!0,characterLimit:30,preventDuplicates:!1,incrementorPadding:!1})).lrstrip&&(t.lstrip=!0,t.rstrip=!0),t.lstrip&&(e=e.replace(/^\s+/,"")),t.rstrip&&(e=e.replace(/\s+$/,"")),t.lowerCase&&(e=e.toLowerCase()),t.underscores&&(e=e.replace(/\s/g,"_").replace(/[_]+/g,"_")),t.replaceNonWordCharacters&&(n=t.nonWordCharsExceptions?RegExp("\\W^["+t.nonWordCharsExceptions+"]","g"):/\W+/g,(e=e.replace(n,"_")).match(/._$/)&&(e=e.replace(/_$/,""))),o.isNumber(t.characterLimit)&&(e=e.slice(0,t.characterLimit)),t.validXmlTag&&e[0].match(/^\d/)&&(e="_"+e),t.preventDuplicateUnderscores)for(;-1!==e.search(/__/);)e=e.replace(/__/,"_");return o.isArray(t.preventDuplicates)&&(e=function(){var n,r,i,o,s,a,l;if(a=function(){var e,n,r,i;for(i=[],e=0,n=(r=t.preventDuplicates).length;e<n;e++)(s=r[e])&&i.push(s.toLowerCase());return i}(),0===(r=e).length)throw new Error("Renaming Error: "+t.descriptor+" is empty");for(n=r,i=0;l=n.toLowerCase(),u.call(a,l)>=0;)o=""+ ++i,t.incrementorPadding&&i<Math.pow(10,t.incrementorPadding)&&(o=("000000000000"+i).slice(-1*t.incrementorPadding)),n=r+"_"+o;return n}()),e},a)},265:function(e,t,n){var r,i,o,s,a,u,l;u=n(15),s=n(85),a=n(19),i=n(106),o=n(64),r=n(35),e.exports=(l={},u.extend(l,s,i),l._keys=u.keys(l),l.rowDetailsSkipLogic=o,l.utils=a,l.configs=r,l)},28:function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var r=n(16),i=n(3),o=n(1);function s(e){var t=[];if(e.formView&&t.push(l(e.username,i.PERMISSIONS_CODENAMES.get("view_asset"))),e.formEdit&&t.push(l(e.username,i.PERMISSIONS_CODENAMES.get("change_asset"))),e.submissionsViewPartial){var n=l(e.username,i.PERMISSIONS_CODENAMES.get("partial_submissions"));n.partial_permissions=[{url:r.a.getPermissionByCodename(i.PERMISSIONS_CODENAMES.get("view_submissions")).url,filters:[{_submitted_by:{$in:e.submissionsViewPartialUsers}}]}],t.push(n)}else e.submissionsView&&t.push(l(e.username,i.PERMISSIONS_CODENAMES.get("view_submissions")));return e.submissionsAdd&&t.push(l(e.username,i.PERMISSIONS_CODENAMES.get("add_submissions"))),e.submissionsEdit&&t.push(l(e.username,i.PERMISSIONS_CODENAMES.get("change_submissions"))),e.submissionsValidate&&t.push(l(e.username,i.PERMISSIONS_CODENAMES.get("validate_submissions"))),t=u(t=a(t))}function a(e){var t=new Set;return e.forEach((function(e){r.a.getPermission(e.permission).contradictory.forEach((function(e){t.add(e)}))})),e=e.filter((function(e){return!t.has(e.permission)}))}function u(e){var t=new Set;return e.forEach((function(e){r.a.getPermission(e.permission).implied.forEach((function(e){t.add(e)}))})),e=e.filter((function(e){return!t.has(e.permission)}))}function l(e,t){return{user:Object(o.buildUserUrl)(e),permission:r.a.getPermissionByCodename(t).url}}function c(e){var t={};return e.forEach((function(e){e.permission===r.a.getPermissionByCodename(i.PERMISSIONS_CODENAMES.get("view_asset")).url&&(t.formView=!0),e.permission===r.a.getPermissionByCodename(i.PERMISSIONS_CODENAMES.get("change_asset")).url&&(t.formEdit=!0),e.permission===r.a.getPermissionByCodename(i.PERMISSIONS_CODENAMES.get("partial_submissions")).url&&(t.submissionsView=!0,t.submissionsViewPartial=!0,e.partial_permissions.forEach((function(e){e.filters.forEach((function(e){e._submitted_by&&(t.submissionsViewPartialUsers=e._submitted_by.$in)}))}))),e.permission===r.a.getPermissionByCodename(i.PERMISSIONS_CODENAMES.get("add_submissions")).url&&(t.submissionsAdd=!0),e.permission===r.a.getPermissionByCodename(i.PERMISSIONS_CODENAMES.get("view_submissions")).url&&(t.submissionsView=!0),e.permission===r.a.getPermissionByCodename(i.PERMISSIONS_CODENAMES.get("change_submissions")).url&&(t.submissionsEdit=!0),e.permission===r.a.getPermissionByCodename(i.PERMISSIONS_CODENAMES.get("validate_submissions")).url&&(t.submissionsValidate=!0)})),t}function p(e){var t=[];return e.forEach((function(e){e.permissions.forEach((function(n){var r={user:e.user.url,permission:n.permission};n.partial_permissions&&(r.partial_permissions=n.partial_permissions),t.push(r)}))})),t}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],s={};return e.forEach((function(e){(Object(o.getUsernameFromUrl)(e.user)!==i.ANON_USERNAME||n)&&(s[e.user]||(s[e.user]=[]),s[e.user].push({url:e.url,permission:e.permission,partial_permissions:e.partial_permissions?e.partial_permissions:void 0}))})),Object.keys(s).forEach((function(e){r.push({user:{url:e,name:Object(o.getUsernameFromUrl)(e),isOwner:e===t||Object(o.getUsernameFromUrl)(e)===Object(o.getUsernameFromUrl)(t)},permissions:s[e]})})),f(r)}function h(e,t){var n=[],s={};return e.forEach((function(e){if(e.user__username!==i.ANON_USERNAME){s[e.user]||(s[e.user]=[]);var t=r.a.getPermission(e.permission);s[e.user].push({url:e.url,permission:t.url})}})),Object.keys(s).forEach((function(e){n.push({user:{url:e,name:Object(o.getUsernameFromUrl)(e),isOwner:e===t||Object(o.getUsernameFromUrl)(e)===Object(o.getUsernameFromUrl)(t)},permissions:s[e]})})),f(n)}function f(e){return e.sort((function(e,t){return e.user.isOwner?-1:t.user.isOwner?1:e.user.url<t.user.url?-1:e.user.url>t.user.url?1:0}))}var _={parseFormData:s,buildFormData:c,parseBackendData:d,parseOldBackendData:h,parseUserWithPermsList:p,sortParseBackendOutput:f};"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(s,"parseFormData","/srv/src/kpi/jsapp/js/components/permissions/permParser.es6"),__REACT_HOT_LOADER__.register(a,"removeContradictoryPerms","/srv/src/kpi/jsapp/js/components/permissions/permParser.es6"),__REACT_HOT_LOADER__.register(u,"removeImpliedPerms","/srv/src/kpi/jsapp/js/components/permissions/permParser.es6"),__REACT_HOT_LOADER__.register(l,"buildBackendPerm","/srv/src/kpi/jsapp/js/components/permissions/permParser.es6"),__REACT_HOT_LOADER__.register(c,"buildFormData","/srv/src/kpi/jsapp/js/components/permissions/permParser.es6"),__REACT_HOT_LOADER__.register(p,"parseUserWithPermsList","/srv/src/kpi/jsapp/js/components/permissions/permParser.es6"),__REACT_HOT_LOADER__.register(d,"parseBackendData","/srv/src/kpi/jsapp/js/components/permissions/permParser.es6"),__REACT_HOT_LOADER__.register(h,"parseOldBackendData","/srv/src/kpi/jsapp/js/components/permissions/permParser.es6"),__REACT_HOT_LOADER__.register(f,"sortParseBackendOutput","/srv/src/kpi/jsapp/js/components/permissions/permParser.es6"),__REACT_HOT_LOADER__.register(_,"permParser","/srv/src/kpi/jsapp/js/components/permissions/permParser.es6"))},285:function(e,t,n){var r,i,o,s,a,u,l=[].slice;i=n(15),r=function(){function e(e){this.name=e,this.equivs=[],this.invals=[]}return e.prototype._append=function(e,t){var n,r,i;if(e instanceof Array)for(r=0,i=e.length;r<i;r++)n=e[r],this._append(n,t);else this[t].push(e);return this},e.prototype.equiv=function(){var e;return e=1<=arguments.length?l.call(arguments,0):[],this._append(e,"equivs")},e.prototype.inval=function(){var e;return e=1<=arguments.length?l.call(arguments,0):[],this._append(e,"invals")},e.prototype.main=function(e){return e?(this._main=e,this):this._main},e}(),(o={}).cascading={choices:function(){var e,t,n,r;for(r=[],e=0,t=(n=[["state","texas","Texas",null,null],["state","washington","Washington",null,null],["county","king","King","washington",null],["county","pierce","Pierce","washington",null],["county","king","King","texas",null],["county","cameron","Cameron","texas",null],["city","dumont","Dumont",null,"king"],["city","finney","Finney",null,"king"],["city","brownsville","brownsville",null,"cameron"],["city","harlingen","harlingen",null,"cameron"],["city","seattle","Seattle",null,"king"],["city","redmond","Redmond",null,"king"],["city","tacoma","Tacoma",null,"pierce"],["city","puyallup","Puyallup",null,"pierce"]]).length;e<t;e++)s=n[e],r.push(i.object(["list_name","name","label","state","county"],s));return r}()},o.pizza_survey=(a={survey:[{type:{select_one:"yes_no"},name:"likes_pizza",label:"Do you like pizza?"}],choices:{yes_no:[{name:"yes",label:"Yes"},{name:"no",label:"No"}]}},u={survey:[{type:"select_one yes_no",name:"likes_pizza",label:"Do you like pizza?"}],choices:{yes_no:[{name:"yes",label:"Yes"},{name:"no",label:"No"}]}},new r("pizza_survey").equiv(a,u,"survey,,,\n,type,name,label\n,select_one yes_no,likes_pizza,Do you like pizza?\nchoices,,,\n,list name,name,label\n,yes_no,yes,Yes\n,yes_no,no,No").main(a)),o.groups=function(){var e,t;return"survey,,,\n,type,name,label\n,text,q1,Question1\n,begin group,grp,\n,text,g1q1,Group1Question1\n,text,g1q2,Group1Question2\n,end group,,",e={survey:[{type:"text",name:"q1",label:"Question1"},{type:"begin group",name:"grp"},{type:"text",name:"g1q1",label:"Group1Question1"},{type:"text",name:"g1q2",label:"Group1Question2"},{type:"end group"}]},t={survey:[{type:"text",name:"q1",label:"Question1"},{type:"group",name:"grp",rows:[{type:"text",name:"g1q1",label:"Group1Question1"},{type:"text",name:"g1q2",label:"Group1Question2"}]},{type:"end group"}]},new r("groups").equiv("survey,,,\n,type,name,label\n,text,q1,Question1\n,begin group,grp,\n,text,g1q1,Group1Question1\n,text,g1q2,Group1Question2\n,end group,,",e,t).main(e)}(),e.exports=o},298:function(e,t,n){"use strict";var r,i;e.exports=(r={create:function(e){return new i(e)},__validators:{invalidChars:function(e,t){return!new RegExp("["+t+"]").test(e)},unique:function(e,t){return 0===_.filter(t,(function(t){return t===e})).length}}},(i=function(e){this.options=e}).prototype.validate=function(e){for(var t=this.options.validations.length,n=this.options.validations,i=0;i<t;i++){var o=n[i];if(o.args||(o.args=[]),o.args.unshift(e),!r.__validators[o.name].apply(this,o.args))return o.failureMessage}return!0},r)},299:function(e,t,n){var r,i,o,s,a,u,l;s=n(39),i=n(64),u=n(86),o=n(19),a=n(300),r=n(301),l=n(302),e.exports={relevant:{getValue:function(){var e;return"undefined"===(e=this.serialize())&&("undefined"!=typeof Raven&&null!==Raven&&Raven.captureException("Serialized value is returning a string, undefined"),e=""),e},postInitialize:function(){var e,t,n,r;return n=this.getSurvey(),t=new i.SkipLogicFactory(n),r=new u.SkipLogicViewFactory(n),e=new s.SkipLogicHelperFactory(t,r,n,this._parent,this.get("value")),this.facade=new s.SkipLogicPresentationFacade(t,e,r)},serialize:function(){return this.facade.serialize()},parse:function(){},linkUp:function(e){return this.facade.initialize()}},constraint:{getValue:function(){var e;return"undefined"===(e=this.serialize())&&("undefined"!=typeof Raven&&null!==Raven&&Raven.captureException("Serialized value is returning a string, undefined"),e=""),e},postInitialize:function(){var e,t,n,i;return n=this.getSurvey(),t=new r.ValidationLogicModelFactory(n),i=new l.ValidationLogicViewFactory(n),e=new a.ValidationLogicHelperFactory(t,i,n,this._parent,this.get("value")),this.facade=new s.SkipLogicPresentationFacade(t,e,i)},serialize:function(){return this.facade.serialize()},parse:function(){},linkUp:function(e){return this.facade.initialize()}},label:{postInitialize:function(){}},name:{deduplicate:function(e){var t,n;return t=[],e.forEachRow((n=this,function(e){var r;if(e.get("name")!==n)return r=e.getValue("name"),t.push(r)}),{includeGroups:!0}),o.sluggifyLabel(this.get("value"),t)}}}},3:function(e,t,n){"use strict";n.r(t),n.d(t,"ROOT_URL",(function(){return o})),n.d(t,"ANON_USERNAME",(function(){return s})),n.d(t,"PERMISSIONS_CODENAMES",(function(){return a})),n.d(t,"COLLECTION_PERMISSIONS",(function(){return u})),n.d(t,"HOOK_LOG_STATUSES",(function(){return l})),n.d(t,"KEY_CODES",(function(){return c})),n.d(t,"MODAL_TYPES",(function(){return p})),n.d(t,"PROJECT_SETTINGS_CONTEXTS",(function(){return d})),n.d(t,"update_states",(function(){return h})),n.d(t,"AVAILABLE_FORM_STYLES",(function(){return f})),n.d(t,"VALIDATION_STATUSES",(function(){return _})),n.d(t,"VALIDATION_STATUSES_LIST",(function(){return m})),n.d(t,"ASSET_TYPES",(function(){return g})),n.d(t,"ASSET_KINDS",(function(){return v})),n.d(t,"QUESTION_TYPES",(function(){return y})),n.d(t,"META_QUESTION_TYPES",(function(){return b})),n.d(t,"NAME_MAX_LENGTH",(function(){return w}));var r,i=n(1),o=(null===(r=document.head.querySelector("meta[name=kpi-root-path]"))?(console.error('no kpi-root-path meta tag set. defaulting to ""'),r=""):r=r.content.replace(/\/*$/,""),"".concat(window.location.protocol,"//").concat(window.location.host).concat(r)),s="AnonymousUser",a=new Map;new Set(["view_asset","change_asset","add_submissions","view_submissions","partial_submissions","change_submissions","validate_submissions","view_collection","change_collection"]).forEach((function(e){a.set(e,e)}));var u={};u[a.get("view_collection")]=Object(i.t)("View collection"),u[a.get("change_collection")]=Object(i.t)("Edit collection");var l={SUCCESS:2,PENDING:1,FAILED:0},c=new Map([["TAB",9],["ENTER",13],["ESC",27],["SPACE",32],["NBSP",160]]),p={SHARING:"sharing",UPLOADING_XLS:"uploading-xls",NEW_FORM:"new-form",ENKETO_PREVIEW:"enketo-preview",SUBMISSION:"submission",REPLACE_PROJECT:"replace-project",TABLE_COLUMNS:"table-columns",REST_SERVICES:"rest-services",FORM_LANGUAGES:"form-languages",FORM_TRANSLATIONS_TABLE:"form-translation-table"},d={NEW:"newForm",EXISTING:"existingForm",REPLACE:"replaceProject",BUILDER:"formBuilderAside"},h={UNSAVED_CHANGES:-1,UP_TO_DATE:!0,PENDING_UPDATE:!1,SAVE_FAILED:"SAVE_FAILED"},f=[{value:"",label:Object(i.t)("Default - single page")},{value:"theme-grid no-text-transform",label:Object(i.t)("Grid theme")},{value:"theme-grid",label:Object(i.t)("Grid theme with headings in ALL CAPS")},{value:"pages",label:Object(i.t)("Multiple pages")},{value:"theme-grid pages no-text-transform",label:Object(i.t)("Grid theme + Multiple pages")},{value:"theme-grid pages",label:Object(i.t)("Grid theme + Multiple pages + headings in ALL CAPS")}],_={no_status:{value:null,label:"—"},validation_status_not_approved:{value:"validation_status_not_approved",label:Object(i.t)("Not Approved")},validation_status_approved:{value:"validation_status_approved",label:Object(i.t)("Approved")},validation_status_on_hold:{value:"validation_status_on_hold",label:Object(i.t)("On Hold")}},m=[_.no_status,_.validation_status_not_approved,_.validation_status_approved,_.validation_status_on_hold],g={question:{id:"question",label:Object(i.t)("question")},block:{id:"block",label:Object(i.t)("block")},template:{id:"template",label:Object(i.t)("template")},survey:{id:"survey",label:Object(i.t)("project")}},v=new Map;new Set(["asset","collection"]).forEach((function(e){v.set(e,e)}));var y=new Map([["select_one",{label:Object(i.t)("Select One"),faIcon:"fa-dot-circle-o",id:"select_one"}],["select_multiple",{label:Object(i.t)("Select Many"),faIcon:"fa-list-ul",id:"select_multiple"}],["text",{label:Object(i.t)("Text"),faIcon:"fa-lato-text",id:"text"}],["integer",{label:Object(i.t)("Number"),faIcon:"fa-lato-integer",id:"integer"}],["decimal",{label:Object(i.t)("Decimal"),faIcon:"fa-lato-decimal",id:"decimal"}],["date",{label:Object(i.t)("Date"),faIcon:"fa-calendar",id:"date"}],["time",{label:Object(i.t)("Time"),faIcon:"fa-clock-o",id:"time"}],["datetime",{label:Object(i.t)("Date & time"),faIcon:"fa-calendar clock-over",id:"datetime"}],["geopoint",{label:Object(i.t)("Point"),faIcon:"fa-map-marker",id:"geopoint"}],["image",{label:Object(i.t)("Photo"),faIcon:"fa-picture-o",id:"image"}],["audio",{label:Object(i.t)("Audio"),faIcon:"fa-volume-up",id:"audio"}],["video",{label:Object(i.t)("Video"),faIcon:"fa-video-camera",id:"video"}],["geotrace",{label:Object(i.t)("Line"),faIcon:"fa-share-alt",id:"geotrace"}],["note",{label:Object(i.t)("Note"),faIcon:"fa-bars",id:"note"}],["barcode",{label:Object(i.t)("Barcode / QR Code"),faIcon:"fa-qrcode",id:"barcode"}],["acknowledge",{label:Object(i.t)("Acknowledge"),faIcon:"fa-check-square-o",id:"acknowledge"}],["geoshape",{label:Object(i.t)("Area"),faIcon:"fa-square",id:"geoshape"}],["score",{label:Object(i.t)("Rating"),faIcon:"fa-server",id:"score"}],["kobomatrix",{label:Object(i.t)("Question Matrix"),faIcon:"fa-table",id:"kobomatrix"}],["rank",{label:Object(i.t)("Ranking"),faIcon:"fa-sort-amount-desc",id:"rank"}],["calculate",{label:Object(i.t)("Calculate"),faIcon:"fa-lato-calculate",id:"calculate"}],["file",{label:Object(i.t)("File"),faIcon:"fa-file",id:"file"}],["range",{label:Object(i.t)("Range"),faIcon:"fa-lato-range",id:"range"}]]),b=new Map;new Set(["start","end","today","username","simserial","subscriberid","deviceid","phonenumber","audit"]).forEach((function(e){b.set(e,e)}));var w=255,k={ROOT_URL:o,ANON_USERNAME:s,PERMISSIONS_CODENAMES:a,COLLECTION_PERMISSIONS:u,HOOK_LOG_STATUSES:l,KEY_CODES:c,MODAL_TYPES:p,PROJECT_SETTINGS_CONTEXTS:d,update_states:h,AVAILABLE_FORM_STYLES:f,VALIDATION_STATUSES:_,VALIDATION_STATUSES_LIST:m,ASSET_TYPES:g,ASSET_KINDS:v,QUESTION_TYPES:y,META_QUESTION_TYPES:b,NAME_MAX_LENGTH:w},O=k;t.default=O;"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(o,"ROOT_URL","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(s,"ANON_USERNAME","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(a,"PERMISSIONS_CODENAMES","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(u,"COLLECTION_PERMISSIONS","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(l,"HOOK_LOG_STATUSES","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(c,"KEY_CODES","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(p,"MODAL_TYPES","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(d,"PROJECT_SETTINGS_CONTEXTS","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(h,"update_states","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(f,"AVAILABLE_FORM_STYLES","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(_,"VALIDATION_STATUSES","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(m,"VALIDATION_STATUSES_LIST","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(g,"ASSET_TYPES","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(v,"ASSET_KINDS","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(y,"QUESTION_TYPES","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(b,"META_QUESTION_TYPES","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(w,"NAME_MAX_LENGTH","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(k,"constants","/srv/src/kpi/jsapp/js/constants.es6"),__REACT_HOT_LOADER__.register(O,"default","/srv/src/kpi/jsapp/js/constants.es6"))},300:function(e,t,n){var r,i,o,s,a,u=function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},l={}.hasOwnProperty;r=n(12),o=n(123),i=n(39),s=n(1).t,e.exports=((a={}).ValidationLogicHelperFactory=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.create_presenter=function(e,t){return new a.ValidationLogicPresenter(e,t,this.current_question,this.survey,this.view_factory)},t.prototype.create_builder=function(){return new a.ValidationLogicBuilder(this.model_factory,this.view_factory,this.survey,this.current_question,this)},t.prototype.create_context=function(){return new a.ValidationLogicHelperContext(this.model_factory,this.view_factory,this,this.serialized_criteria)},t}(i.SkipLogicHelperFactory),a.ValidationLogicPresenter=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.change_question=function(){},t}(i.SkipLogicPresenter),a.ValidationLogicBuilder=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype._parse_skip_logic_criteria=function(e){return o(e)},t.prototype._get_question=function(){return this.current_question},t.prototype.build_empty_criterion=function(){var e,t,n;return e=this.view_factory.create_operator_picker(this.current_question.get_type()),n=this.view_factory.create_response_value_view(this.current_question,this.current_question.get_type(),this._operator_type()),(t=this.build_criterion_logic(this.model_factory.create_operator("empty"),e,n)).model.change_question(this.current_question.cid),t},t.prototype.questions=function(){return[this.current_question]},t.prototype._operator_type=function(){var e,n;return null==(e=t.__super__._operator_type.apply(this,arguments))&&(n=this.current_question.get_type().operators[0],e=i.operator_types[1===n?this.current_question.get_type().operators[1]:n]),e},t}(i.SkipLogicBuilder),a.ValidationLogicHelperContext=function(e){function t(e,n,r,i){this.model_factory=e,this.view_factory=n,this.helper_factory=r,this.state={serialize:function(){return i}},this.questionTypeHasNoValidationOperators()?this.use_hand_code_helper():t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.use_mode_selector_helper=function(){return this.state=new a.ValidationLogicModeSelectorHelper(this.view_factory,this),this.render(this.destination)},t.prototype.use_hand_code_helper=function(){this.state=new a.ValidationLogicHandCodeHelper(this.state.serialize(),this.builder,this.view_factory,this),this.questionTypeHasNoValidationOperators()&&(this.state.button=this.view_factory.create_empty()),this.render(this.destination)},t.prototype.questionTypeHasNoValidationOperators=function(){var e,t,n;return(n=this.helper_factory.current_question.get("type").get("typeId"))?((e=null!=(t=i.question_types[n])?t.operators:void 0)||(e=i.question_types.default.operators),e.length===e[0]):console.error("no type id found for question",this.helper_factory.current_question)},t}(i.SkipLogicHelperContext),a.ValidationLogicModeSelectorHelper=function(e){function t(e,n){this.context=n,t.__super__.constructor.apply(this,arguments),this.handcode_button=e.create_button("<i>${}</i> "+s("Manually enter your validation logic in XLSForm code"),"skiplogic__button skiplogic__select-handcode")}return u(t,e),t}(i.SkipLogicModeSelectorHelper),a.ValidationLogicHandCodeHelper=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.$handCode=r('<div class="card__settings__fields__field">\n  <label for="'+this.context.helper_factory.current_question.cid+'-handcode">'+s("Validation Code:")+'</label>\n  <span class="settings__input">\n    <input type="text" name="constraint" id="'+this.context.helper_factory.current_question.cid+'-handcode" class="text" value="'+this.criteria+'">\n  </span>\n</div>'),this.textarea=this.$handCode.find("#"+this.context.helper_factory.current_question.cid+"-handcode")}return u(t,e),t.prototype.render=function(e){var t;return e.replaceWith(this.$handCode),this.button.render().attach_to(this.$handCode),this.button.bind_event("click",(t=this,function(){return t.$handCode.replaceWith(e),t.context.use_mode_selector_helper()})),this.$handCode.on("change",function(e){return function(){return e.context.view_factory.survey.trigger("change")}}(this))},t.prototype.serialize=function(){return this.textarea.val()},t}(i.SkipLogicHandCodeHelper),a)},301:function(e,t,n){var r,i,o=function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},s={}.hasOwnProperty,a=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};n(20),r=n(64),e.exports=((i={}).ValidationLogicModelFactory=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.create_operator=function(e,t,n){var o;switch(o=null,e){case"text":o=new i.ValidationLogicTextOperator(t);break;case"date":o=new i.ValidationLogicDateOperator(t);break;case"basic":o=new i.ValidationLogicBasicOperator(t);break;case"existence":o=new i.ValidationLogicExistenceOperator(t);break;case"select_multiple":o=new i.ValidationLogicSelectMultipleOperator(t);break;case"empty":return new r.EmptyOperator}return o.set("id",n),o},t.prototype.create_criterion_model=function(){return new i.ValidationLogicCriterion(this,this.survey)},t}(r.SkipLogicFactory),i.ValidationLogicBasicOperator=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.serialize=function(e,t){return". "+this.get("symbol")+" "+t},t}(r.SkipLogicOperator),i.ValidationLogicTextOperator=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.serialize=function(e,n){return t.__super__.serialize.call(this,""," '"+n.replace(/'/g,"\\'")+"'")},t}(i.ValidationLogicBasicOperator),i.ValidationLogicDateOperator=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.serialize=function(e,n){return-1===n.indexOf("date")&&(n="date('"+n+"')"),t.__super__.serialize.call(this,""," "+n)},t}(i.ValidationLogicBasicOperator),i.ValidationLogicExistenceOperator=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.serialize=function(){return t.__super__.serialize.call(this,"","''")},t}(i.ValidationLogicBasicOperator),i.ValidationLogicSelectMultipleOperator=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.serialize=function(e,t){var n;return n="selected(., '"+t+"')",this.get("is_negated")?"not("+n+")":n},t}(r.SelectMultipleSkipLogicOperator),i.ValidationLogicCriterion=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.change_question=function(e){var t,n,r,i;if(t=this._get_question()?this._get_question().get_type():{name:null},this.set("question_cid",e),n=this._get_question().get_type(),null==this.get("operator").get_id()||(r=this.get("operator").get_id(),a.call(n.operators,r)>=0)?t.name!==n.name&&this.change_operator(this.get("operator").get_value()):this.change_operator(1!==n.operators[0]?n.operators[0]:n.operators[1]),null===this.get("operator").get_type().response_type&&this._get_question().response_type!==(null!=(i=this.get("response_value"))?i.get_type():void 0))return this.change_response(this.get("response_value").get("value"))},t}(r.SkipLogicCriterion),i)},302:function(e,t,n){var r,i,o,s,a,u=function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},l={}.hasOwnProperty,c=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};s=n(15),i=n(86),o=n(124),r=n(39),e.exports=((a={}).ValidationLogicViewFactory=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.create_criterion_builder_view=function(){return new a.ValidationLogicCriterionBuilder},t.prototype.create_question_picker=function(){return new a.ValidationLogicQuestionPicker},t.prototype.create_operator_picker=function(e){var t;return t=s.filter(r.operator_types,(function(t){var n;return 1!==t.id&&(n=t.id,c.call(e.operators,n)>=0)})),new i.OperatorPicker(t)},t}(i.SkipLogicViewFactory),a.ValidationLogicCriterionBuilder=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.render=function(){return t.__super__.render.apply(this,arguments),this.$el.html(this.$el.html().replace("only be displayed","be valid only")),this},t}(i.SkipLogicCriterionBuilderView),a.ValidationLogicQuestionPicker=function(e){function t(){t.__super__.constructor.call(this,"This question's response has to be")}return u(t,e),t.prototype.attach_to=function(e){return e.find(".skiplogic__rowselect").remove(),t.__super__.attach_to.call(this,e)},t}(o.Label),a)},303:function(e,t,n){var r,i,o,s,a,u,l,c,p,d,h,f,_,m,g,v,y=function(e,t){for(var n in t)b.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},b={}.hasOwnProperty,w=[].slice,k=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};l=n(15),u=n(20),r=n(43),o=n(106),n(53),a=n(19),i=n(35),n(87),s=n(39),e.exports=(n(1).t,v={},d=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return y(t,e),t.prototype._isSelectQuestion=function(){return!1},t}(u.Model),h=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return y(t,e),t.prototype.model=d,t}(u.Collection),p=function(){function e(e){var t,n,r,i,o,s,a,u;if(this._kobomatrix_columns=new h,this._rowAttributeName="_kobomatrix_columns",i=function(t,n){return l.isFunction(t)?e[n]=function(){var n;return n=1<=arguments.length?w.call(arguments,0):[],t.apply(e,n)}:e[n]=t},l.each(this,i),i(this.forEachRow,"forEachRow"),t=e.getValue("$kuid",!1),n={type:"end_"+this._beginEndKey(),$kuid:"/"+t},e._afterIterator=function(e,t){var r;if(r={export_relevant_values:function(e,t){return e.push(l.extend({},n))},toJSON:function(){return l.extend({},n)}},t.includeGroupEnds)return e(r)},r=e.toJSON,e.clone=function(){return console.error("clone kobomatrix rows")},e.toJSON=function(){return l.extend(r.call(e),{type:"begin_"+e._beginEndKey()},"function"==typeof this._additionalJson?this._additionalJson():void 0)},l.each(this.constructor.prototype,i),e.attributes.__rows){for(o=0,s=(a=e.attributes.__rows).length;o<s;o++)u=a[o],this[this._rowAttributeName].add(u);delete e.attributes.__rows}}return e.prototype._kobomatrix_cols=function(){return this.rows},e.prototype._isSelectQuestion=function(){return!1},e.prototype.get_type=function(){return s.question_types.default},e.prototype._beginEndKey=function(){return"kobomatrix"},e.prototype.linkUp=function(e){var t,n,r,i;return this.getList=(i=this,function(){return i.items}),t={},(n=null!=(r=this.get("kobo--matrix_list"))?r.get("value"):void 0)?t[n]=this.getSurvey().choices.get(n):(n=this.set("kobo--matrix_list","matrix_"+a.txtid()),t[n]=this.getSurvey().choices.create()),this.rows.each(function(e){return function(n){var r,i;if(r=null!=(i=n.get("select_from_list_name"))?i.get("value"):void 0)return t[r]=e.getSurvey().choices.get(r)}}(this)),this.items=t,this.items},e}(),g=function(e,t){return e["__"+t]=e[t],e[t]=function(){var n;return n=1<=arguments.length?w.call(arguments,0):[],e._meta[t].apply(e._meta,n)}},m=function(e,t){"_beforeIterator"in this&&this._beforeIterator(e,t),"includeErrors"in t||(t.includeErrors=!1),this.rows.each((function(n,r,i){if("function"==typeof n.forEachRow){if(t.includeGroups&&e(n),!t.flat)return n.forEachRow(e,t)}else{if(!n.isError())return e(n);if(t.includeErrors)return e(n)}})),"_afterIterator"in this&&this._afterIterator(e,t)},v.SurveyFragment=function(e){function t(e,n){this.rows=new f([],{_parent:this}),this._meta=new u.Model,g(this,"set"),g(this,"get"),g(this,"on"),g(this,"off"),g(this,"trigger"),t.__super__.constructor.call(this,e,n)}return y(t,e),t.prototype._validate=function(){var e;return this.clearErrors(),e=!0,this.settings.get("form_id")||(this.addError("form id must not be empty"),e=!1),this.settings.get("form_title")||(this.addError("form title must not be empty"),e=!1),e},t.prototype.clearErrors=function(){return this.errors=[]},t.prototype.addError=function(e){return this.errors.push(e)},t.prototype.linkUp=function(e){return this.invoke("linkUp",e)},t.prototype.forEachRow=function(e,t){return null==t&&(t={}),m.apply(this,[e,t])},t.prototype.getRowDescriptors=function(){var e;return e=[],this.forEachRow((function(t){var n;return n={label:t.getValue("label"),name:t.getValue("name")},e.push(n)})),e},t.prototype.findRowByCid=function(e,t){var n,r;return null==t&&(t={}),r=!1,n=function(t){return t.cid===e&&(r=t),!r},this.forEachRow(n,t),r},t.prototype.findRowByName=function(e,t){var n;return n=!1,this.forEachRow((function(t){return(t.getValue("name")||a.sluggifyLabel(t.getValue("label")))===e&&(n=t),!n}),t),n},t.prototype.addRowAtIndex=function(e,t){return this.addRow(e,{at:t})},t.prototype.addRow=function(e,t){var n,r,i;return null==t&&(t={}),(n=t.after)?(delete t.after,t._parent=n._parent,i=1+t._parent.models.indexOf(n),t.at=i):(r=t.before)?(delete t.before,t._parent=r._parent,i=t._parent.models.indexOf(r),t.at=i):t._parent=this.rows,t._parent.add(e,t)},t.prototype.detach=function(){this._parent.remove(this)},t.prototype.remove=function(e){return e.detach()},t.prototype._addGroup=function(e){var t,n,r,o,s,a,u,l,c,p,d,h,f;e._parent=this.rows,"type"in e||(e.type="group"),"__rows"in e||(e.__rows=[]),e.__rows=[].concat.apply([],e.__rows),h=[],this.forEachRow((function(e){return h.push(e.cid)}),{includeGroups:!0,includeErrors:!0}),l=!1;for(o=0,a=(c=e.__rows).length;o<a;o++)d=c[o],f=h.indexOf(d.cid),(!1===l||f<l)&&(l=f,n=d);for(t={previous:n.precedingRow(),parent:n.parentRow()},s=0,u=(p=e.__rows).length;s<u;s++)(d=p[s]).detach({silent:!0});return null==e.label&&(e.label=i.newGroupDetails.label.value),r=new v.Group(e),this.getSurvey()._insertRowInPlace(r,t),(t.parent||this.getSurvey().rows).trigger("add",r)},t.prototype._allRows=function(){var e;return e=[],this.forEachRow((function(t){if("Row"===t.constructor.kls)return e.push(t)}),{}),e},t.prototype.finalize=function(){return this.forEachRow((function(e){return e.finalize()}),{includeGroups:!0}),this},t}(r.BaseCollection),v.Group=function(e){function t(e,n){var r,i,o,s;for(null==e&&(e={}),r=e.__rows||[],void 0===e.label&&(e.label=""),this._parent=e._parent,delete e.__rows,this.rows=new f([],{_parent:this}),t.__super__.constructor.call(this,e,n),r&&this.rows.add(r),i=0,o=r.length;i<o;i++)(s=r[i])._parent=s.collection=this.rows}return y(t,e),t.kls="Group",t.key="group",t.prototype._isSelectQuestion=function(){return!1},t.prototype.get_type=function(){return s.question_types.default},t.prototype.initialize=function(){var e,t,n,r;for(t in e=i.newGroupDetails)n=e[t],this.has(t)||("function"==typeof n.value?this.set(t,n.value(this)):this.set(t,n));if(this.ensureKuid(),r="repeat"===this.get("type"),this.set("_isRepeat",r),this.convertAttributesToRowDetails(),"kobomatrix"===this.getValue("type"))return new p(this)},t.prototype.addRowAtIndex=function(e,t){return e._parent=this.rows,this.rows.add(e,{at:t})},t.prototype._isRepeat=function(){var e;return!!(null!=(e=this.get("_isRepeat"))?e.get("value"):void 0)},t.prototype.autoname=function(){var e,t,n;if(void 0===(e=this.getValue("name"))||""===e)return n={lowerCase:!1,stripSpaces:!0,lrstrip:!0,incrementorPadding:3,validXmlTag:!0},t=a.sluggify(this.getValue("label"),n),this.setDetail("name",t)},t.prototype.finalize=function(){return this.autoname()},t.prototype.detach=function(e){return this._parent.remove(this,e)},t.prototype.splitApart=function(){var e,t,n,r,i,o,s;for(s=this._parent.models.indexOf(this),this.detach(),i=[],n=e=0,t=(r=this.rows.models).length;e<t;n=++e)(o=r[n])._parent=this._parent,i.push(this._parent._parent.addRowAtIndex(o,s+n));return i},t.prototype._beforeIterator=function(e,t){if(t.includeGroupEnds)return e(this.groupStart())},t.prototype._afterIterator=function(e,t){if(t.includeGroupEnds)return e(this.groupEnd())},t.prototype.forEachRow=function(e,t){return null==t&&(t={}),m.apply(this,[e,t])},t.prototype._groupOrRepeatKey=function(){return this._isRepeat()?"repeat":"group"},t.prototype.groupStart=function(){var e;return e=this,{export_relevant_values:function(e,t){return e.push(this.toJSON())},toJSON:function(){var t,n,r,i;for(t in n={},r=e.attributes)i=r[t],"_isRepeat"!==t&&(n[t]=i.getValue());return n.type="begin_"+e._groupOrRepeatKey(),n}}},t.prototype.groupEnd=function(){var e,t;return t=this.getValue("$kuid"),e={type:"end_"+this._groupOrRepeatKey(),$kuid:"/"+t},{export_relevant_values:function(t,n){return t.push(l.extend({},e))},toJSON:function(){return l.extend({},e)}}},t}(o.BaseRow),c=["begin_group","end_group","begin_repeat","end_repeat"],_=function(e){var t,n;if(t=function(){var e,t,n,r;for(e in n=[],t=i.defaultSurveyDetails)r=t[e],n.push(r.name);return n}(),n=null!=e?e.type:void 0,k.call(c,n)>=0)throw new Error("Invalid type at this stage: "+n);if(k.call(t,n)>=0)throw new Error(n+" is not properly handled as a SurveyDetail");return"score"===n?o.Row:"group"===n||"repeat"===n||"kobomatrix"===n?v.Group:o.Row},f=function(e){function t(){var e,n;e=1<=arguments.length?w.call(arguments,0):[],t.__super__.constructor.apply(this,e),this.on("add",(n=this,function(e,t,r){return n._parent.getSurvey().trigger("rows-add",e,t,r)})),this.on("remove",function(e){return function(t,n,r){return e._parent.getSurvey().trigger("rows-remove",t,n,r)}}(this))}return y(t,e),t.prototype.model=function(e,t){var n,r;n=_(e);try{return new n(e,l.extend({},t,{_parent:t.collection}))}catch(n){return r=n,new o.RowError(e,l.extend({},t,{error:r,_parent:t.collection}))}},t.prototype.comparator=function(e){return e.ordinal},t}(r.BaseCollection),v)},304:function(e,t,n){var r;r=n(43),e.exports={RowDetail:r.RowDetail}},305:function(e,t,n){var r,i;r=n(74),e.exports=((i={}).mdSurveyStructureToObject=function(e){var t,n,r,i,o,s,a,u,l,c,p,d,h,f;for(r=function(e){return String(e).replace(/^\s+|\s+$/g,"")},f=!1,o=!1,h={},t=function(){var e,t,n,r,i,s,a,u,l,c,p;for(t=o[0],p=[],n=0,i=(u=o.slice(1)).length;n<i;n++){for(c={},a=r=0,s=(l=u[n]).length;r<s;a=++r)e=l[a],t[a]&&(c[t[a]]=e);p.push(c)}return h[f]=p,o=[]},a=0,l=(d=e.split("\n")).length;a<l;a++){for(n=[],s=u=0,c=(p=r(d[a]).split("|")).length;u<c;s=++u)i=p[s],s>0&&n.push(r(i));n[0]?(o&&t(),f=n[0],o=[]):o&&o.push(n.slice(1,n.length-1))}return t(),h},i.csvJsonToMarkdown=function(e){var t,n,i,o,s,a,u,l,c,p,d,h,f,_,m,g,v,y,b,w,k,O,E,S;for(S in n=[],o=function(e,t){n[t]||(n[t]=0),e>n[t]&&(n[t]=e)},i=function(e,t){var n;return e||(e=""),(n=t-e.length)>0&&(e+=new Array(n+1).join(" ")),e},t=function(e,t){var r,o,s,a,u,l;for(null==t&&(t=0),r=o=0,u=t;0<=u?o<u:o>u;r=0<=u?++o:--o)e.unshift("");for(e.length=n.length,r=s=0,a=e.length;s<a;r=++s)l=e[r],e[r]=i(l,n[r]);g+="| "+e.join(" | ")+" |\n"},E=r.sheeted(),g="\n",e){for(a=e[S],o(S.length,0),s=E.sheet(S,r(a)),u=l=0,d=(v=a.columns).length;l<d;u=++l)o(v[u].length,u+1);for(c=0,h=(y=s.rowArray).length;c<h;c++)for(u=p=0,f=(k=y[c]).length;p<f;u=++p)o(k[u].length,u+1)}for(S in b=E._sheets)for(O=b[S],t([S]),t(O.columns,1),m=0,_=(w=O.rowArray).length;m<_;m++)t(k=w[m],1);return g},i)},35:function(e,t,n){var r,i,o,s,a,u,l,c,p,d,h=function(e,t){for(var n in t)f.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},f={}.hasOwnProperty;o=n(15),i=n(20),r=n(19),e.exports=((s={}).defaultSurveyDetails={start_time:{name:"start",label:"start time",description:"Records when the survey was begun",default:!0},end_time:{name:"end",label:"end time",description:"records when the survey was marked as completed",default:!0},today:{name:"today",label:"today",description:"includes today's date",default:!1},username:{name:"username",label:"username",description:"includes interviewer's username",default:!1},simserial:{name:"simserial",label:"sim serial",description:"records the serial number of the network sim card",default:!1},subscriberid:{name:"subscriberid",label:"subscriber id",description:"records the subscriber id of the sim card",default:!1},deviceid:{name:"deviceid",label:"device id",aliases:["imei"],description:"Records the internal device ID number (works on Android phones)",default:!1},phoneNumber:{name:"phonenumber",label:"phone number",description:"Records the device's phone number, when available",default:!1},audit:{name:"audit",label:"audit",description:"Records the behavior of enumerators as they navigate through a form",default:!1}},a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return h(t,e),t.prototype._forSurvey=function(){return{name:this.get("name"),label:this.get("label"),description:this.get("description")}},t}(i.Model),s.SurveyDetailSchema=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return h(t,e),t.prototype.model=a,t.prototype.typeList=function(){var e;return this._typeList||(this._typeList=function(){var t,n,r,i;for(i=[],t=0,n=(r=this.models).length;t<n;t++)e=r[t],i.push(e.get("name"));return i}.call(this)),this._typeList},t}(i.Collection),s.surveyDetailSchema=new s.SurveyDetailSchema(o.values(s.defaultSurveyDetails)),s.defaultsGeneral={label:{value:"New Question"}},s.defaultsForType={geotrace:{label:{value:"Record a line"},required:{value:!1,_hideUnlessChanged:!0}},geoshape:{label:{value:"Record an area"},required:{value:!1,_hideUnlessChanged:!0}},geopoint:{label:{value:"Record your current location"},required:{value:!1,_hideUnlessChanged:!0}},image:{label:{value:"Point and shoot! Use the camera to take a photo"}},video:{label:{value:"Use the camera to record a video"}},audio:{label:{value:"Use the camera's microphone to record a sound"}},file:{label:{value:"Upload a file"}},note:{label:{value:"This note can be read out loud"},required:{value:!1,_hideUnlessChanged:!0}},integer:{label:{value:"Enter a number"}},barcode:{label:{value:"Use the camera to scan a barcode"}},decimal:{label:{value:"Enter a number"}},date:{label:{value:"Enter a date"}},range:{label:{value:"Enter a number within a specified range"}},calculate:{calculation:{value:""},label:{value:"calculation"},required:{value:!1,_hideUnlessChanged:!0}},datetime:{label:{value:"Enter a date and time"}},time:{label:{value:"Enter a time"}},acknowledge:{label:{value:"Acknowledge"}}},s.paramTypes={number:"number",boolean:"boolean"},s.questionParams={range:{start:{type:s.paramTypes.number,defaultValue:0},end:{type:s.paramTypes.number,defaultValue:10},step:{type:s.paramTypes.number,defaultValue:1}},image:{"max-pixels":{type:s.paramTypes.number,defaultValue:1024}},select_one:{randomize:{type:s.paramTypes.boolean},seed:{type:s.paramTypes.number}},select_multiple:{randomize:{type:s.paramTypes.boolean},seed:{type:s.paramTypes.number}}},s.columns=["type","name","label","hint","guidance_hint","required","relevant","default","constraint"],s.lookupRowType=(p=[["note","Note",{preventRequired:!0}],["acknowledge","Acknowledge"],["text","Text"],["integer","Integer"],["decimal","Decimal"],["range","Range"],["geopoint","Geopoint (GPS)"],["geotrace","Geotrace (GPS)"],["geoshape","Geoshape (GPS)"],["image","Image",{isMedia:!0}],["barcode","Barcode / QR code"],["date","Date"],["time","Time"],["datetime","Date and Time"],["audio","Audio",{isMedia:!0}],["video","Video",{isMedia:!0}],["file","File"],["calculate","Calculate"],["select_one","Select",{orOtherOption:!0,specifyChoice:!0}],["score","Score"],["score__row","Score Row"],["rank","Rank"],["kobomatrix","Advanced Matrix"],["rank__level","Rank Level"],["select_multiple","Multiple choice",{orOtherOption:!0,specifyChoice:!0}]],u=function(e){var t;this.name=e[0],this.label=e[1],(t=e[2])||(t={}),o.extend(this,t)},d=function(){var e,t,n;for(n=[],e=0,t=p.length;e<t;e++)l=p[e],n.push(new u(l));return n}(),(c=function(e){var t,n,r,i;for(t=0,n=d.length;t<n;t++)(i=d[t]).name===e&&(r=i);return r}).typeSelectList=function(){return d},c),s.autoset_kuid=!0,s.columnOrder=function(e){return-1===s.columns.indexOf(e)&&s.columns.push(e),s.columns.indexOf(e)},s.newRowDetails={name:{value:""},type:{value:"text"},hint:{value:"",_hideUnlessChanged:!0},guidance_hint:{value:""},required:{value:!1,_hideUnlessChanged:!0},relevant:{value:"",_hideUnlessChanged:!0},default:{value:"",_hideUnlessChanged:!0},constraint:{value:"",_hideUnlessChanged:!0},constraint_message:{value:"",_hideUnlessChanged:!0},tags:{value:"",_hideUnlessChanged:!0},appearance:{value:"",_hideUnlessChanged:!0}},s.newGroupDetails={name:{value:function(){return"group_"+r.txtid()}},label:{value:"Group"},type:{value:"group"},_isRepeat:{value:!1},relevant:{value:"",_hideUnlessChanged:!0},appearance:{value:"",_hideUnlessChanged:!0}},s.question_types={},s.truthyValues=["yes","YES","true","true()","TRUE"],s.falsyValues=["no","NO","false","false()","FALSE"],s.boolOutputs={true:"true",false:"false"},s)},356:function(e,t,n){var r={"./af":138,"./af.js":138,"./ar":139,"./ar-dz":140,"./ar-dz.js":140,"./ar-kw":141,"./ar-kw.js":141,"./ar-ly":142,"./ar-ly.js":142,"./ar-ma":143,"./ar-ma.js":143,"./ar-sa":144,"./ar-sa.js":144,"./ar-tn":145,"./ar-tn.js":145,"./ar.js":139,"./az":146,"./az.js":146,"./be":147,"./be.js":147,"./bg":148,"./bg.js":148,"./bm":149,"./bm.js":149,"./bn":150,"./bn.js":150,"./bo":151,"./bo.js":151,"./br":152,"./br.js":152,"./bs":153,"./bs.js":153,"./ca":154,"./ca.js":154,"./cs":155,"./cs.js":155,"./cv":156,"./cv.js":156,"./cy":157,"./cy.js":157,"./da":158,"./da.js":158,"./de":159,"./de-at":160,"./de-at.js":160,"./de-ch":161,"./de-ch.js":161,"./de.js":159,"./dv":162,"./dv.js":162,"./el":163,"./el.js":163,"./en-SG":164,"./en-SG.js":164,"./en-au":165,"./en-au.js":165,"./en-ca":166,"./en-ca.js":166,"./en-gb":167,"./en-gb.js":167,"./en-ie":168,"./en-ie.js":168,"./en-il":169,"./en-il.js":169,"./en-nz":170,"./en-nz.js":170,"./eo":171,"./eo.js":171,"./es":172,"./es-do":173,"./es-do.js":173,"./es-us":174,"./es-us.js":174,"./es.js":172,"./et":175,"./et.js":175,"./eu":176,"./eu.js":176,"./fa":177,"./fa.js":177,"./fi":178,"./fi.js":178,"./fo":179,"./fo.js":179,"./fr":180,"./fr-ca":181,"./fr-ca.js":181,"./fr-ch":182,"./fr-ch.js":182,"./fr.js":180,"./fy":183,"./fy.js":183,"./ga":184,"./ga.js":184,"./gd":185,"./gd.js":185,"./gl":186,"./gl.js":186,"./gom-latn":187,"./gom-latn.js":187,"./gu":188,"./gu.js":188,"./he":189,"./he.js":189,"./hi":190,"./hi.js":190,"./hr":191,"./hr.js":191,"./hu":192,"./hu.js":192,"./hy-am":193,"./hy-am.js":193,"./id":194,"./id.js":194,"./is":195,"./is.js":195,"./it":196,"./it-ch":197,"./it-ch.js":197,"./it.js":196,"./ja":198,"./ja.js":198,"./jv":199,"./jv.js":199,"./ka":200,"./ka.js":200,"./kk":201,"./kk.js":201,"./km":202,"./km.js":202,"./kn":203,"./kn.js":203,"./ko":204,"./ko.js":204,"./ku":205,"./ku.js":205,"./ky":206,"./ky.js":206,"./lb":207,"./lb.js":207,"./lo":208,"./lo.js":208,"./lt":209,"./lt.js":209,"./lv":210,"./lv.js":210,"./me":211,"./me.js":211,"./mi":212,"./mi.js":212,"./mk":213,"./mk.js":213,"./ml":214,"./ml.js":214,"./mn":215,"./mn.js":215,"./mr":216,"./mr.js":216,"./ms":217,"./ms-my":218,"./ms-my.js":218,"./ms.js":217,"./mt":219,"./mt.js":219,"./my":220,"./my.js":220,"./nb":221,"./nb.js":221,"./ne":222,"./ne.js":222,"./nl":223,"./nl-be":224,"./nl-be.js":224,"./nl.js":223,"./nn":225,"./nn.js":225,"./pa-in":226,"./pa-in.js":226,"./pl":227,"./pl.js":227,"./pt":228,"./pt-br":229,"./pt-br.js":229,"./pt.js":228,"./ro":230,"./ro.js":230,"./ru":231,"./ru.js":231,"./sd":232,"./sd.js":232,"./se":233,"./se.js":233,"./si":234,"./si.js":234,"./sk":235,"./sk.js":235,"./sl":236,"./sl.js":236,"./sq":237,"./sq.js":237,"./sr":238,"./sr-cyrl":239,"./sr-cyrl.js":239,"./sr.js":238,"./ss":240,"./ss.js":240,"./sv":241,"./sv.js":241,"./sw":242,"./sw.js":242,"./ta":243,"./ta.js":243,"./te":244,"./te.js":244,"./tet":245,"./tet.js":245,"./tg":246,"./tg.js":246,"./th":247,"./th.js":247,"./tl-ph":248,"./tl-ph.js":248,"./tlh":249,"./tlh.js":249,"./tr":250,"./tr.js":250,"./tzl":251,"./tzl.js":251,"./tzm":252,"./tzm-latn":253,"./tzm-latn.js":253,"./tzm.js":252,"./ug-cn":254,"./ug-cn.js":254,"./uk":255,"./uk.js":255,"./ur":256,"./ur.js":256,"./uz":257,"./uz-latn":258,"./uz-latn.js":258,"./uz.js":257,"./vi":259,"./vi.js":259,"./x-pseudo":260,"./x-pseudo.js":260,"./yo":261,"./yo.js":261,"./zh-cn":262,"./zh-cn.js":262,"./zh-hk":263,"./zh-hk.js":263,"./zh-tw":264,"./zh-tw.js":264};function i(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id=356},39:function(e,t,n){var r,i,o,s,a,u,l,c,p=function(e,t){return function(){return e.apply(t,arguments)}},d=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};s=n(15),o=n(20),r=n(12),i=n(121),a=n(1).t,e.exports=((c={}).SkipLogicHelperFactory=function(){function e(e,t,n,r,i){this.model_factory=e,this.view_factory=t,this.survey=n,this.current_question=r,this.serialized_criteria=i}return e.prototype.create_presenter=function(e,t){return new c.SkipLogicPresenter(e,t,this.current_question,this.survey,this.view_factory)},e.prototype.create_builder=function(){return new c.SkipLogicBuilder(this.model_factory,this.view_factory,this.survey,this.current_question,this)},e.prototype.create_context=function(){return new c.SkipLogicHelperContext(this.model_factory,this.view_factory,this,this.serialized_criteria)},e}(),c.SkipLogicPresentationFacade=function(){function e(e,t,n){this.model_factory=e,this.helper_factory=t,this.view_factory=n}return e.prototype.initialize=function(){return null!=this.context?this.context:this.context=this.helper_factory.create_context()},e.prototype.serialize=function(){return null==this.context&&(this.context=this.helper_factory.create_context()),this.context.serialize()},e.prototype.render=function(e){return null==this.context&&(this.context=this.helper_factory.create_context()),this.context.render(e)},e}(),c.SkipLogicPresenter=function(){function e(e,t,n,r,i){var o,a;this.model=e,this.view=t,this.current_question=n,this.survey=r,this.view_factory=i,this.view.presenter=this,this.survey?(a=this,o=function(e){var t,n,r;if((r=a.model._get_question())&&r._isSelectQuestion()&&r.getList().cid===e)return t=a.model.get("response_value").get("cid"),r.getList().options.get(t)?(n=s.map(r.getList().options.models,(function(e){return{text:e.get("label"),value:e.cid}})),a.view.response_value_view.options.set("options",n),a.view.response_value_view.val(t),a.view.response_value_view.$el.trigger("change"),a.model.change_response(t)):a.dispatcher.trigger("remove:presenter",a.model.cid)},this.survey.on("choice-list-update",o,this),this.survey.on("remove-option",o,this),this.survey.on("row-detail-change",function(e){return function(t,n){if(e.destination&&"label"===n)return e.render(e.destination)}}(this),this)):console.error("this.survey is not yet available")}return e.prototype.change_question=function(e){var t,n;return this.model.change_question(e),this.question=this.model._get_question(),t=this.question.get_type(),this.question.on("remove",(n=this,function(){return n.dispatcher.trigger("remove:presenter",n.model.cid)})),this.view.change_operator(this.view_factory.create_operator_picker(t)),this.view.operator_picker_view.val(this.model.get("operator").get_value()),this.view.attach_operator(),this.change_response_view(t,this.model.get("operator").get_type()),this.finish_changing()},e.prototype.change_operator=function(e){return this.model.change_operator(e),this.change_response_view(this.model._get_question().get_type(),this.model.get("operator").get_type()),this.finish_changing()},e.prototype.change_response=function(e){return this.model.change_response(e),this.finish_changing()},e.prototype.change_response_view=function(e,t){var n,r,i,o;return(o=this.view_factory.create_response_value_view(this.model._get_question(),e,t)).model=this.model.get("response_value"),this.view.change_response(o),this.view.attach_response(),i=o.model.get("value"),(n=this.model._get_question())._isSelectQuestion()&&(r=s.find(n.getList().options.models,(function(e){return e.get("name")===i})))&&r.cid&&(i=r.cid),this.view.response_value_view.val(i),o.$el.trigger("change")},e.prototype.finish_changing=function(){return this.dispatcher.trigger("changed:model",this)},e.prototype.is_valid=function(){var e;return!!this.model._get_question()&&(1===this.model.get("operator").get_type().id||""!==(e=this.model.get("response_value").get("value"))&&void 0!==e&&!1!==this.model.get("response_value").isValid())},e.prototype.render=function(e){var t,n,r,i;return this.destination=e,this.view.question_picker_view.detach(),this.view.question_picker_view=this.view_factory.create_question_picker(this.current_question),this.view.render(),this.view.question_picker_view.val(this.model.get("question_cid")),this.view.operator_picker_view.val(this.model.get("operator").get_value()),i=null!=(n=this.model.get("response_value"))?n.get("value"):void 0,(t=this.model._get_question())&&t._isSelectQuestion()&&(i=null!=(r=s.find(t.getList().options.models,(function(e){return e.get("name")===i})))?r.cid:void 0),this.view.response_value_view.val(i),this.view.attach_to(this.destination),this.dispatcher.trigger("rendered",this)},e.prototype.serialize=function(){return this.model.serialize()},e}(),c.SkipLogicBuilder=function(){function e(e,t,n,r,i){this.model_factory=e,this.view_factory=t,this.survey=n,this.current_question=r,this.helper_factory=i,this.build_empty_criterion=p(this.build_empty_criterion,this),this.build_criterion=p(this.build_criterion,this),this.build_operator_logic=p(this.build_operator_logic,this)}return e.prototype.build_criterion_builder=function(e){var t,n,r;if(""===e)return[[this.build_empty_criterion()],"and"];try{n=this._parse_skip_logic_criteria(e),0===(t=s.filter(s.map(n.criteria,(r=this,function(e){return r.criterion=e,r.build_criterion()})),(function(e){return!!e}))).length&&t.push(this.build_empty_criterion())}catch(t){return"undefined"!=typeof Raven&&null!==Raven&&Raven.captureException(new Error("could not parse skip logic. falling back to hand-coded"),{extra:{criteria:e}}),!1}return[t,n.operator]},e.prototype._parse_skip_logic_criteria=function(e){return i(e)},e.prototype.build_operator_logic=function(e){return[this.build_operator_model(e,this._operator_type().symbol[this.criterion.operator]),this.view_factory.create_operator_picker(e)]},e.prototype.build_operator_model=function(e,t){var n;return n=this._operator_type(),this.model_factory.create_operator("existence"===n.type?"existence":e.equality_operator_type,t,n.id)},e.prototype._operator_type=function(){return s.find(c.operator_types,(e=this,function(t){var n,r;return n=null!=(r=e.criterion)?r.operator:void 0,d.call(t.parser_name,n)>=0}));var e},e.prototype.build_criterion_logic=function(e,t,n){var r,i;return(r=this.model_factory.create_criterion_model()).set("operator",e),(i=this.view_factory.create_criterion_view(this.view_factory.create_question_picker(this.current_question),t,n)).model=r,this.helper_factory.create_presenter(r,i)},e.prototype.build_criterion=function(){var e,t,n,r,i,o,a,u,l,c;if(!(r=this._get_question()))return!1;if(!(d.call(this.questions(),r)>=0))throw"question is not selectable";return i=r.get_type(),e=(o=this.build_operator_logic(i))[0],t=o[1],l=this.view_factory.create_response_value_view(r,i,this._operator_type()),(n=this.build_criterion_logic(e,t,l)).model.change_question(r.cid),u=r._isSelectQuestion()?null!=(a=s.find(r.getList().options.models,(c=this,function(e){return e.get("name")===c.criterion.response_value})))?a.cid:void 0:this.criterion.response_value,n.model.change_response(u||""),l.model=n.model.get("response_value"),l.val(u),n},e.prototype._get_question=function(){return this.survey.findRowByName(this.criterion.name)},e.prototype.build_empty_criterion=function(){var e,t;return e=this.view_factory.create_operator_picker(null),t=this.view_factory.create_response_value_view(null),this.build_criterion_logic(this.model_factory.create_operator("empty"),e,t)},e.prototype.questions=function(){return this.selectable=this.current_question.selectableRows()||this.selectable,this.selectable},e}(),c.SkipLogicHelperContext=function(){function e(e,t,n,r){this.model_factory=e,this.view_factory=t,this.helper_factory=n,this.state={serialize:function(){return r}},null==r||""===r?(r="",this.use_mode_selector_helper()):this.use_criterion_builder_helper(),null==this.state&&(this.state={serialize:function(){return r}},this.use_hand_code_helper())}return e.prototype.render=function(e){this.destination=e,null!=this.destination&&(this.destination.empty(),this.state.render(this.destination))},e.prototype.serialize=function(){return this.state.serialize()},e.prototype.use_criterion_builder_helper=function(){var e;null==this.builder&&(this.builder=this.helper_factory.create_builder()),!1===(e=this.builder.build_criterion_builder(this.state.serialize()))?this.state=null:(this.state=new c.SkipLogicCriterionBuilderHelper(e[0],e[1],this.builder,this.view_factory,this),this.render(this.destination))},e.prototype.use_hand_code_helper=function(){this.state=new c.SkipLogicHandCodeHelper(this.state.serialize(),this.builder,this.view_factory,this),this.render(this.destination)},e.prototype.use_mode_selector_helper=function(){this.helper_factory.survey.off(null,null,this.state),this.state=new c.SkipLogicModeSelectorHelper(this.view_factory,this),this.render(this.destination)},e}(),c.SkipLogicCriterionBuilderHelper=function(){function e(e,t,n,r,i){var a,u;this.presenters=e,this.builder=n,this.view_factory=r,this.context=i,this.view=this.view_factory.create_criterion_builder_view(),this.view.criterion_delimiter=(t||"and").toLowerCase(),this.view.facade=this,this.dispatcher=s.clone(o.Events),this.dispatcher.on("remove:presenter",(u=this,function(e){return u.remove(e)})),this.dispatcher.on("changed:model",function(e){return function(t){return e.determine_add_new_criterion_visibility()}}(this)),this.dispatcher.on("rendered",function(e){return function(t){return e.determine_add_new_criterion_visibility()}}(this)),a=function(e){return function(){var t,n,r,i,o;for(o=e.builder.questions(),i=[],s.each(e.presenters,(function(e){var t;if(e.model._get_question()&&(t=e.model._get_question(),!(d.call(o,t)>=0)))return i.push(e.model.cid)})),t=0,n=i.length;t<n;t++)r=i[t],e.remove(r);if(0===e.presenters.length)return e.context.use_mode_selector_helper()}}(this),this.builder.survey.on("sortablestop",a,this),a(),s.each(this.presenters,function(e){return function(t){return t.dispatcher=e.dispatcher,t.serialize_all=s.bind(e.serialize,e)}}(this))}return e.prototype.determine_criterion_delimiter_visibility=function(){return this.presenters.length<2?this.$criterion_delimiter.hide():this.$criterion_delimiter.show()},e.prototype.render=function(e){return this.view.render().attach_to(e),this.$criterion_delimiter=this.view.$(".skiplogic__delimselect"),this.$add_new_criterion_button=this.view.$(".skiplogic__addcriterion"),this.determine_criterion_delimiter_visibility(),this.destination=this.view.$(".skiplogic__criterialist"),s.each(this.presenters,(t=this,function(e){return e.render(t.destination)}));var t},e.prototype.serialize=function(){var e;return e=s.map(this.presenters,(function(e){return e.serialize()})),s.filter(e,(function(e){return e})).join(" "+this.view.criterion_delimiter+" ")},e.prototype.add_empty=function(){var e;return(e=this.builder.build_empty_criterion()).dispatcher=this.dispatcher,e.serialize_all=s.bind(this.serialize,this),this.presenters.push(e),e.render(this.destination),this.determine_criterion_delimiter_visibility()},e.prototype.remove=function(e){var t;if(s.each(this.presenters,(t=this,function(n,r){if(null!=n&&n.model.cid===e)return(n=t.presenters.splice(r,1)[0]).view.$el.remove(),t.builder.survey.off(null,null,n),t.determine_add_new_criterion_visibility()})),0===this.presenters.length)return this.context.use_mode_selector_helper()},e.prototype.determine_add_new_criterion_visibility=function(){var e,t,n;if(this.all_presenters_are_valid()?(e="show()",null!=(t=this.$add_new_criterion_button)&&t.show()):(e="hide()",null!=(n=this.$add_new_criterion_button)&&n.hide()),!this.$add_new_criterion_button)return"undefined"!=typeof Raven&&null!==Raven?Raven.captureException("@$add_new_criterion_button is not defined. cannot call "+e+" [inside of determine_add_new_criterion_visibility]"):void 0},e.prototype.all_presenters_are_valid=function(){return!s.find(this.presenters,(function(e){return!e.is_valid()}))},e.prototype.switch_editing_mode=function(){return this.builder.build_hand_code_criteria(this.serialize())},e}(),c.SkipLogicHandCodeHelper=function(){function e(e,t,n,i){this.criteria=e,this.builder=t,this.view_factory=n,this.context=i,this.$parent=r("<div>"),this.textarea=this.view_factory.create_textarea(this.criteria,"skiplogic__handcode-edit"),this.button=this.view_factory.create_button('<i class="fa fa-trash-o"></i>',"skiplogic-handcode__cancel")}return e.prototype.render=function(e){return e.append(this.$parent),this.textarea.render().attach_to(this.$parent),this.button.render().attach_to(this.$parent),this.button.bind_event("click",(t=this,function(){return t.context.use_mode_selector_helper()}));var t},e.prototype.serialize=function(){return this.textarea.$el.val()||this.criteria},e}(),c.SkipLogicModeSelectorHelper=function(){function e(e,t){this.context=t,this.criterion_builder_button=e.create_button('<i class="fa fa-plus"></i> '+a("Add a condition"),"skiplogic__button skiplogic__select-builder"),this.handcode_button=e.create_button("<i>${}</i> "+a("Manually enter your skip logic in XLSForm code"),"skiplogic__button skiplogic__select-handcode")}return e.prototype.render=function(e){var t,n;return t=r("<div>"),e.append(t),this.criterion_builder_button.render().attach_to(t),this.handcode_button.render().attach_to(t),this.criterion_builder_button.bind_event("click",(n=this,function(){return n.context.view_factory.survey.trigger("change"),n.context.use_criterion_builder_helper()})),this.handcode_button.bind_event("click",function(e){return function(){return e.context.view_factory.survey.trigger("change"),e.context.use_hand_code_helper()}}(this))},e.prototype.serialize=function(){return""},e.prototype.switch_editing_mode=function(){},e}(),l={EX:(u={EXISTENCE:1,EQUALITY:2,GREATER_THAN:3,GREATER_THAN_EQ:4}).EXISTENCE,EQ:u.EQUALITY,GT:u.GREATER_THAN,GE:u.GREATER_THAN_EQ},c.question_types={default:{operators:[l.EX,l.EQ],equality_operator_type:"text",response_type:"text",name:"default"},select_one:{operators:[l.EQ,l.EX],equality_operator_type:"text",response_type:"dropdown",name:"select_one"},select_multiple:{operators:[l.EQ,l.EX],equality_operator_type:"select_multiple",response_type:"dropdown",name:"select_multiple"},integer:{operators:[l.GT,l.EX,l.EQ,l.GE],equality_operator_type:"basic",response_type:"integer",name:"integer"},barcode:{operators:[l.GT,l.EX,l.EQ,l.GE],equality_operator_type:"text",response_type:"text",name:"barcode"},decimal:{operators:[l.EX,l.EQ,l.GT,l.GE],equality_operator_type:"basic",response_type:"decimal",name:"decimal"},geopoint:{operators:[l.EX],name:"geopoint"},geotrace:{operators:[l.EX],name:"geotrace"},geoshape:{operators:[l.EX],name:"geoshape"},image:{operators:[l.EX],name:"image"},audio:{operators:[l.EX],name:"audio"},video:{operators:[l.EX],name:"video"},acknowledge:{operators:[l.EX],name:"acknowledge"},date:{operators:[l.EQ,l.GT,l.GE],equality_operator_type:"date",response_type:"text",name:"date"}},c.operator_types=[{id:1,type:"existence",label:a("Was Answered"),negated_label:a("Was not Answered"),abbreviated_label:a("Was Answered"),abbreviated_negated_label:a("Was not Answered"),parser_name:["ans_notnull","ans_null"],symbol:{ans_notnull:"!=",ans_null:"="},response_type:"empty"},{id:2,type:"equality",label:"",negated_label:a("not"),abbreviated_label:"=",abbreviated_negated_label:"!=",parser_name:["resp_equals","resp_notequals","multiplechoice_selected","multiplechoice_notselected"],symbol:{resp_equals:"=",resp_notequals:"!=",multiplechoice_selected:"=",multiplechoice_notselected:"!="}},{id:3,type:"equality",label:a("Greater Than"),negated_label:a("Less Than"),abbreviated_label:">",abbreviated_negated_label:"<",parser_name:["resp_greater","resp_less"],symbol:{resp_greater:">",resp_less:"<"}},{id:4,type:"equality",label:a("Greater Than or Equal to"),negated_label:a("Less Than or Equal to"),abbreviated_label:">=",abbreviated_negated_label:"<=",parser_name:["resp_greaterequals","resp_lessequals"],symbol:{resp_greaterequals:">=",resp_lessequals:"<="}}],c)},43:function(e,t,n){var r,i,o,s,a,u,l,c=function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},p={}.hasOwnProperty,d=function(e,t){return function(){return e.apply(t,arguments)}};a=n(15),s=n(20),u=n(357),o=n(72),r=n(35),i=n(299),e.exports=(a.extend(u.validators,{invalidChars:function(e,t,n){if(!o.Validator.__validators.invalidChars(e,n))return e+" contains invalid characters"},unique:function(e,t,n,r){var i,s;return i=r.getSurvey().rows.pluck(r.key),s=a.map(i,(function(e){return e.get("value")})),o.Validator.__validators.unique(e,s)?void 0:"Question name isn't unique"}}),a.extend(s.Model.prototype,u.mixin),(l={}).BaseCollection=function(e){function t(e,n){if(e&&"_parent"in e)throw new Error("_parent chould be assigned as property to 2nd argument to XLF.BaseCollection (not first)");n&&n._parent&&(this._parent=n._parent),t.__super__.constructor.call(this,e,n)}return c(t,e),t.prototype.getSurvey=function(){var e;for(e=this._parent;e._parent;)e=e._parent;return e},t}(s.Collection),l.BaseModel=function(e){function t(e,n){n&&"_parent"in n?this._parent=n._parent:"object"==typeof e&&"_parent"in e&&(this._parent=e._parent,delete e._parent),t.__super__.constructor.call(this,e,n)}return c(t,e),t.prototype.parse=function(){},t.prototype.linkUp=function(e){},t.prototype.finalize=function(){},t.prototype.getValue=function(e){var t;if(e){if(void 0===(t=this.get(e)))throw new Error("Could not get value");t.getValue&&(t=t.getValue())}else t=this.get("value");return t},t.prototype.setDetail=function(e,t){return t.constructor===l.RowDetail?this.set(e,t):this.set(e,new l.RowDetail({key:e,value:t},{_parent:this}))},t.prototype.parentRow=function(){return this._parent._parent},t.prototype.precedingRow=function(){var e;if(0!==(e=this._parent.models.indexOf(this)))return this._parent.at(e-1)},t.prototype.nextRow=function(){var e;return e=this._parent.models.indexOf(this),this._parent.at(e+1)},t.prototype.getSurvey=function(){var e;if(null==(e=this._parent))return null;for(;e._parent||e.collection;)if(e._parent)e=e._parent;else{if(!e.collection||!e.collection._parent)break;e=e.collection._parent}return e},t}(s.Model),l.RowDetail=function(e){function t(e,n){var o,s;this.key=e.key,s=e.value,this.validation=d(this.validation,this),this._parent=n._parent,this.key in i&&a.extend(this,i[this.key]),t.__super__.constructor.call(this),null!=s&&(o={},a.isString(s)||a.isNumber(s)?o.value=s:a.isObject(s)&&"value"in s?a.extend(o,s):o.value=s,this.set(o)),this._order=r.columnOrder(this.key),this.postInitialize()}return c(t,e),t.prototype.idAttribute="name",t.prototype.validation=function(){return"name"===this.key?{value:{unique:!0,required:!0}}:"calculation"===this.key?{value:{required:!0}}:"label"===this.key&&"group"!==this._parent.constructor.key?{value:{required:!0}}:{}},t.prototype.postInitialize=function(){},t.prototype.initialize=function(){var e,t;if(this.get("_hideUnlessChanged")&&(this.hidden=!0,this._oValue=this.get("value"),this.on("change",(function(){return this.hidden=this.get("value")===this._oValue}))),this.on("change:value",(t=this,function(e,n,r){return t._parent.trigger("detail-change",t.key,n,r),t.getSurvey().trigger("row-detail-change",t._parent,t.key,n,r)})),"name"===(e=this.key)||"label"===e||"hint"===e||"guidance_hint"===e||"required"===e||"calculation"===e||"default"===e||"appearance"===e||"constraint_message"===e||"tags"===e||this.key.match(/^.+::.+/))return this.on("change",function(e){return function(t){return e.getSurvey().trigger("change",t)}}(this))},t}(l.BaseModel),l)},5:function(e,t,n){"use strict";var r=n(11),i=n.n(r),o=n(8),s=n.n(o);function a(e,t){var n=e.utils;return{triggerPromise:function(){var e=this,r=arguments,i=this.children.indexOf("completed")>=0&&this.children.indexOf("failed")>=0,o=new t((function(t,o){if(e.willCallPromise)n.nextTick((function(){var n=e.promise;e.promise=function(r){return r.then(t,o),e.promise=n,e.promise.apply(e,arguments)},e.trigger.apply(e,r)}));else{if(i)var s=e.completed.listen((function(){var e=Array.prototype.slice.call(arguments);s(),a(),t(e.length>1?e:e[0])})),a=e.failed.listen((function(){var e=Array.prototype.slice.call(arguments);s(),a(),o(e.length>1?e:e[0])}));n.nextTick((function(){e.trigger.apply(e,r)})),i||t()}}));return o.catch((function(){})),o},promise:function(e){var t=this;if(!(this.children.indexOf("completed")>=0&&this.children.indexOf("failed")>=0))throw new Error('Publisher must have "completed" and "failed" child publishers');e.then((function(e){return t.completed(e)}),(function(e){return t.failed(e)}))},listenAndPromise:function(e,t){var n=this;t=t||this,this.willCallPromise=(this.willCallPromise||0)+1;var r=this.listen((function(){if(!e)throw new Error("Expected a function returning a promise but got "+e);var r=arguments,i=e.apply(t,r);return n.promise.call(n,i)}),t);return function(){n.willCallPromise--,r.call(n)}}}}var u=function(e){return function(t){var n=a(t,e),r=n.triggerPromise,i=n.promise,o=n.listenAndPromise;t.PublisherMethods.triggerAsync=r,t.PublisherMethods.promise=i,t.PublisherMethods.listenAndPromise=o}},l=u,c=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(a,"createFunctions","/srv/src/kpi/jsapp/js/libs/reflux-promise.js"),__REACT_HOT_LOADER__.register(u,"default","/srv/src/kpi/jsapp/js/libs/reflux-promise.js")),n(6)),p=n(1);s.a.use(l(window.Promise));var d=s.a.createActions({getConfig:{children:["completed","failed"]},getAssetPermissions:{children:["completed","failed"]},getCollectionPermissions:{children:["completed","failed"]},bulkSetAssetPermissions:{children:["completed","failed"]},assignCollectionPermission:{children:["completed","failed"]},assignAssetPermission:{children:["completed","failed"]},removeAssetPermission:{children:["completed","failed"]},removeCollectionPermission:{children:["completed","failed"]},copyPermissionsFrom:{children:["completed","failed"]},assignPublicPerm:{children:["completed","failed"]},setCollectionDiscoverability:{children:["completed","failed"]}});d.getConfig.listen((function(){c.a.getPermissionsConfig().done(d.getConfig.completed).fail(d.getConfig.failed)})),d.getAssetPermissions.listen((function(e){c.a.getAssetPermissions(e).done(d.getAssetPermissions.completed).fail(d.getAssetPermissions.failed)})),d.getCollectionPermissions.listen((function(e){c.a.getCollectionPermissions(e).done(d.getCollectionPermissions.completed).fail(d.getCollectionPermissions.failed)})),d.bulkSetAssetPermissions.listen((function(e,t){c.a.bulkSetAssetPermissions(e,t).done((function(e){d.bulkSetAssetPermissions.completed(e)})).fail((function(){d.getAssetPermissions(e),d.bulkSetAssetPermissions.failed()}))})),d.assignCollectionPermission.listen((function(e,t){c.a.assignCollectionPermission(e,t).done((function(){d.getCollectionPermissions(e),d.assignCollectionPermission.completed(e)})).fail((function(){d.getCollectionPermissions(e),d.assignCollectionPermission.failed(e)}))})),d.assignAssetPermission.listen((function(e,t){c.a.assignAssetPermission(e,t).done((function(){d.getAssetPermissions(e),d.assignAssetPermission.completed(e)})).fail((function(){d.getAssetPermissions(e),d.assignAssetPermission.failed(e)}))})),d.removeAssetPermission.listen((function(e,t){c.a.removePermission(t).done((function(){d.getAssetPermissions(e),d.removeAssetPermission.completed()})).fail((function(){d.getAssetPermissions(e),d.removeAssetPermission.failed()}))})),d.removeCollectionPermission.listen((function(e,t){c.a.removePermission(t).done((function(){d.getCollectionPermissions(e),d.removeCollectionPermission.completed()})).fail((function(){d.getCollectionPermissions(e),d.removeCollectionPermission.failed()}))})),d.copyPermissionsFrom.listen((function(e,t){c.a.copyPermissionsFrom(e,t).done((function(){d.getAssetPermissions(t),d.copyPermissionsFrom.completed(e,t)})).fail(d.copyPermissionsFrom.failed)})),d.setCollectionDiscoverability.listen((function(e,t){c.a.patchCollection(e,{discoverable_when_public:t}).done(d.setCollectionDiscoverability.completed).fail(d.setCollectionDiscoverability.failed)}));"undefined"!=typeof __REACT_HOT_LOADER__&&__REACT_HOT_LOADER__.register(d,"permissionsActions","/srv/src/kpi/jsapp/js/actions/permissions.es6");var h=s.a.createActions({getInAppMessages:{children:["completed","failed"]},setMessageAcknowledged:{children:["completed","failed"]},setMessageReadTime:{children:["completed","failed"]}});h.getInAppMessages.listen((function(){c.a.getHelpInAppMessages().done(h.getInAppMessages.completed).fail(h.getInAppMessages.failed)})),h.getInAppMessages.failed.listen((function(){Object(p.notify)(Object(p.t)("Failed to get in app messages."),"error")})),h.setMessageReadTime.listen((function(e,t){c.a.patchHelpInAppMessage(e,{interactions:{readTime:t,acknowledged:!0}}).done(h.setMessageReadTime.completed).fail(h.setMessageReadTime.failed)})),h.setMessageReadTime.failed.listen((function(){Object(p.notify)(Object(p.t)("Failed to set message readTime."),"error")})),h.setMessageAcknowledged.listen((function(e,t){c.a.patchHelpInAppMessage(e,{interactions:{acknowledged:t}}).done(h.setMessageAcknowledged.completed).fail(h.setMessageAcknowledged.failed)})),h.setMessageAcknowledged.failed.listen((function(){Object(p.notify)(Object(p.t)("Failed to set message acknowledged."),"error")}));"undefined"!=typeof __REACT_HOT_LOADER__&&__REACT_HOT_LOADER__.register(h,"helpActions","/srv/src/kpi/jsapp/js/actions/help.es6");function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.d(t,"a",(function(){return _})),s.a.use(l(window.Promise));var _={permissions:d,help:h};_.navigation=s.a.createActions(["transitionStart","transitionEnd","routeUpdate","documentTitleUpdate"]),_.auth=s.a.createActions({verifyLogin:{children:["loggedin","anonymous","failed"]},logout:{children:["completed","failed"]},changePassword:{children:["completed","failed"]},getEnvironment:{children:["completed","failed"]},getApiToken:{children:["completed","failed"]}}),_.survey=s.a.createActions({addExternalItemAtPosition:{children:["completed","failed"]}}),_.search=s.a.createActions({assets:{children:["completed","failed"]},collections:{children:["completed","failed"]}}),_.resources=s.a.createActions({listCollections:{children:["completed","failed"]},createAsset:{children:["completed","failed"]},createImport:{children:["completed","failed"]},loadAsset:{children:["completed","failed"]},deployAsset:{children:["completed","failed"]},setDeploymentActive:{children:["completed","failed"]},createSnapshot:{children:["completed","failed"]},cloneAsset:{children:["completed","failed"]},deleteAsset:{children:["completed","failed"]},listTags:{children:["completed","failed"]},createCollection:{children:["completed","failed"]},updateCollection:{asyncResult:!0},deleteCollection:{children:["completed","failed"]},loadAssetSubResource:{children:["completed","failed"]},loadAssetContent:{children:["completed","failed"]},loadResource:{children:["completed","failed"]},createResource:{asyncResult:!0},updateAsset:{asyncResult:!0},updateSubmissionValidationStatus:{children:["completed","failed"]},removeSubmissionValidationStatus:{children:["completed","failed"]},getAssetFiles:{children:["completed","failed"]},notFound:{}}),_.hooks=s.a.createActions({getAll:{children:["completed","failed"]},add:{children:["completed","failed"]},update:{children:["completed","failed"]},delete:{children:["completed","failed"]},getLogs:{children:["completed","failed"]},retryLog:{children:["completed","failed"]},retryLogs:{children:["completed","failed"]}}),_.misc=s.a.createActions({checkUsername:{asyncResult:!0,children:["completed","failed"]},updateProfile:{children:["completed","failed"]},getServerEnvironment:{children:["completed","failed"]}}),d.assignAssetPermission.failed.listen((function(){Object(p.notify)(Object(p.t)("Failed to update permissions"),"error")})),d.removeAssetPermission.failed.listen((function(){Object(p.notify)(Object(p.t)("Failed to remove permissions"),"error")})),d.assignCollectionPermission.failed.listen((function(){Object(p.notify)(Object(p.t)("Failed to update permissions"),"error")})),d.removeCollectionPermission.failed.listen((function(){Object(p.notify)(Object(p.t)("Failed to update permissions"),"error")})),d.assignAssetPermission.completed.listen((function(e){_.resources.loadAsset({id:e})})),d.copyPermissionsFrom.completed.listen((function(e,t){_.resources.loadAsset({id:t})})),d.removeAssetPermission.completed.listen((function(e){_.resources.loadAsset({id:e})})),d.setCollectionDiscoverability.completed.listen((function(e){_.resources.loadAsset({url:e.url})})),_.misc.checkUsername.listen((function(e){c.a.queryUserExistence(e).done(_.misc.checkUsername.completed).fail(_.misc.checkUsername.failed)})),_.misc.updateProfile.listen((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c.a.patchProfile(e).done((function(){var e;(e=_.misc.updateProfile).completed.apply(e,arguments),t.onComplete&&t.onComplete.apply(t,arguments)})).fail((function(){var e;(e=_.misc.updateProfile).failed.apply(e,arguments),t.onFail&&t.onFail.apply(t,arguments)}))})),_.misc.updateProfile.completed.listen((function(){Object(p.notify)(Object(p.t)("updated profile successfully"))})),_.misc.updateProfile.failed.listen((function(e){for(var t=!1,n=0,r=Object.entries(e.responseJSON);n<r.length;n++){var i=f(r[n],2),o=i[0];i[1];"non_fields_error"!==o&&(t=!0)}t?Object(p.notify)(Object(p.t)("Some fields contain errors"),"error"):Object(p.notify)(Object(p.t)("failed to update profile"),"error")})),_.misc.getServerEnvironment.listen((function(){c.a.serverEnvironment().done(_.misc.getServerEnvironment.completed).fail(_.misc.getServerEnvironment.failed)})),_.resources.createImport.listen((function(e){e.base64Encoded?c.a.postCreateImport(e).done(_.resources.createImport.completed).fail(_.resources.createImport.failed):e.content&&c.a.createResource(e)})),_.resources.createImport.completed.listen((function(e){e.status?"processing"===e.status?(Object(p.notify)(Object(p.t)("successfully uploaded file; processing may take a few minutes")),Object(p.log)("processing import "+e.uid,e)):Object(p.notify)(Object(p.t)("unexpected import status ##STATUS##").replace("##STATUS##",e.status),"error"):Object(p.notify)(Object(p.t)("Error: import.status not available"))})),_.resources.createSnapshot.listen((function(e){c.a.createAssetSnapshot(e).done(_.resources.createSnapshot.completed).fail(_.resources.createSnapshot.failed)})),_.resources.listTags.listen((function(e){c.a.listTags(e).done(_.resources.listTags.completed).fail(_.resources.listTags.failed)})),_.resources.listTags.completed.listen((function(e){e.next&&window.Raven&&Raven.captureMessage("MAX_TAGS_EXCEEDED: Too many tags")})),_.resources.updateAsset.listen((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};c.a.patchAsset(e,t).done((function(r){_.resources.updateAsset.completed(r),"function"==typeof n.onComplete&&n.onComplete(r,e,t),Object(p.notify)(Object(p.t)("successfully updated"))})).fail((function(e){_.resources.updateAsset.failed(e),n.onFailed&&n.onFailed(e)}))})),_.resources.deployAsset.listen((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};c.a.deployAsset(e,t).done((function(e){_.resources.deployAsset.completed(e.asset),"function"==typeof n.onDone&&n.onDone(e,t)})).fail((function(e){_.resources.deployAsset.failed(e,t),"function"==typeof n.onFail&&n.onFail(e,t)}))})),_.resources.deployAsset.failed.listen((function(e,t){var n,r=null;e.responseJSON&&(e.responseJSON.xform_id_string||e.responseJSON.detail)?e.responseJSON.xform_id_string?r="\n      <p>".concat(Object(p.t)("your form id was not valid:"),"</p>\n      <p><pre>").concat(e.responseJSON.xform_id_string,"</pre></p>\n      <p>").concat(Object(p.replaceSupportEmail)(Object(p.t)("if this problem persists, contact help@kobotoolbox.org")),"</p>\n    "):e.responseJSON.detail&&(r="\n      <p>".concat(Object(p.t)("your form cannot be deployed because it contains errors:"),"</p>\n      <p><pre>").concat(e.responseJSON.detail,"</pre></p>\n    ")):(n=500==e.status&&e.responseJSON&&e.responseJSON.error?"<pre>".concat(e.responseJSON.error,"</pre>"):500==e.status&&e.responseText?"<pre>".concat(e.responseText,"</pre>"):Object(p.t)("please check your connection and try again."),r="\n      <p>".concat(Object(p.replaceSupportEmail)(Object(p.t)("if this problem persists, contact help@kobotoolbox.org")),"</p>\n      <p>").concat(n,"</p>\n    "));i.a.alert(Object(p.t)("unable to deploy"),r)})),_.resources.setDeploymentActive.listen((function(e){c.a.setDeploymentActive(e).done((function(e){_.resources.setDeploymentActive.completed(e.asset)})).fail(_.resources.setDeploymentActive.failed)})),_.resources.setDeploymentActive.completed.listen((function(e){e.deployment__active?Object(p.notify)(Object(p.t)("Project unarchived successfully")):Object(p.notify)(Object(p.t)("Project archived successfully"))})),_.resources.getAssetFiles.listen((function(e){c.a.getAssetFiles(e).done(_.resources.getAssetFiles.completed).fail(_.resources.getAssetFiles.failed)})),_.reports=s.a.createActions({setStyle:{children:["completed","failed"]},setCustom:{children:["completed","failed"]}}),_.reports.setStyle.listen((function(e,t){c.a.patchAsset(e,{report_styles:JSON.stringify(t)}).done((function(e){_.reports.setStyle.completed(e),_.resources.updateAsset.completed(e)})).fail(_.reports.setStyle.failed)})),_.reports.setCustom.listen((function(e,t){c.a.patchAsset(e,{report_custom:JSON.stringify(t)}).done((function(e){_.reports.setCustom.completed(e),_.resources.updateAsset.completed(e)})).fail(_.reports.setCustom.failed)})),_.table=s.a.createActions({updateSettings:{children:["completed","failed"]}}),_.table.updateSettings.listen((function(e,t){c.a.patchAsset(e,{settings:JSON.stringify(t)}).done((function(e){_.table.updateSettings.completed(e),_.resources.updateAsset.completed(e)})).fail(_.table.updateSettings.failed)})),_.map=s.a.createActions({setMapStyles:{children:["started","completed","failed"]}}),_.map.setMapStyles.listen((function(e,t){c.a.patchAsset(e,{map_styles:JSON.stringify(t)}).done((function(e){_.map.setMapStyles.completed(e),_.resources.updateAsset.completed(e)})).fail(_.map.setMapStyles.failed),_.map.setMapStyles.started(e,t)})),_.resources.createResource.listen((function(e){c.a.createResource(e).done((function(e){_.resources.createResource.completed(e)})).fail((function(){var e;(e=_.resources.createResource).failed.apply(e,arguments)}))})),_.resources.deleteAsset.listen((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c.a.deleteAsset(e).done((function(){_.resources.deleteAsset.completed(e),"function"==typeof t.onComplete&&t.onComplete(e)})).fail((function(t){_.resources.deleteAsset.failed(e),i.a.alert(Object(p.t)("Unable to delete asset!"),"<p>".concat(Object(p.t)("Error details:"),"</p><pre style='max-height: 200px;'>").concat(t.responseText,"</pre>"))}))})),_.resources.deleteCollection.listen((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c.a.deleteCollection(e).done((function(n){_.resources.deleteCollection.completed(e,n),"function"==typeof t.onComplete&&t.onComplete(e,n)})).fail(_.resources.deleteCollection.failed)})),_.resources.deleteCollection.failed.listen((function(){Object(p.notify)(Object(p.t)("Failed to delete collection."),"error")})),_.resources.updateCollection.listen((function(e,t){c.a.patchCollection(e,t).done((function(e){_.resources.updateCollection.completed(e),Object(p.notify)(Object(p.t)("successfully updated"))})).fail((function(){var e;(e=_.resources.updateCollection).failed.apply(e,arguments)}))})),_.resources.cloneAsset.listen((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c.a.cloneAsset(e).done((function(e){_.resources.cloneAsset.completed(e),"function"==typeof t.onComplete&&t.onComplete(e)})).fail(_.resources.cloneAsset.failed)})),_.resources.cloneAsset.failed.listen((function(){Object(p.notify)(Object(p.t)("Could not create project!"),"error")})),_.search.assets.listen((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c.a.searchAssets(e).done((function(n){_.search.assets.completed(e,n),"function"==typeof t.onComplete&&t.onComplete(e,n)})).fail((function(n){_.search.assets.failed(e,n),"function"==typeof t.onFailed&&t.onFailed(e,n)}))})),_.auth.logout.completed.listen((function(){window.setTimeout((function(){window.location.replace("","")}),1)})),_.auth.logout.listen((function(){c.a.logout().done(_.auth.logout.completed).fail((function(){console.error("logout failed for some reason. what should happen now?")}))})),_.auth.verifyLogin.listen((function(){c.a.selfProfile().done((function(e){e.username?_.auth.verifyLogin.loggedin(e):_.auth.verifyLogin.anonymous(e)})).fail(_.auth.verifyLogin.failed)})),_.auth.changePassword.listen((function(e,t){c.a.patchProfile({current_password:e,new_password:t}).done(_.auth.changePassword.completed).fail(_.auth.changePassword.failed)})),_.auth.changePassword.completed.listen((function(){Object(p.notify)(Object(p.t)("changed password successfully"))})),_.auth.changePassword.failed.listen((function(){Object(p.notify)(Object(p.t)("failed to change password"),"error")})),_.auth.getEnvironment.listen((function(){c.a.environment().done((function(e){_.auth.getEnvironment.completed(e)})).fail(_.auth.getEnvironment.failed)})),_.auth.getEnvironment.failed.listen((function(){Object(p.notify)(Object(p.t)("failed to load environment data"),"error")})),_.auth.getApiToken.listen((function(){c.a.apiToken().done((function(e){_.auth.getApiToken.completed(e.token)})).fail(_.auth.getApiToken.failed)})),_.auth.getApiToken.failed.listen((function(){Object(p.notify)(Object(p.t)("failed to load API token"),"error")})),_.resources.loadAsset.listen((function(e){var t;e.url?t=-1===e.url.indexOf("collections")?"getAsset":"getCollection":e.id&&(t={c:"getCollection",a:"getAsset"}[e.id[0]]),t&&c.a[t](e).done(_.resources.loadAsset.completed).fail(_.resources.loadAsset.failed)})),_.resources.loadAssetContent.listen((function(e){c.a.getAssetContent(e).done(_.resources.loadAssetContent.completed).fail(_.resources.loadAssetContent.failed)})),_.resources.listCollections.listen((function(){c.a.listCollections().done(_.resources.listCollections.completed).fail(_.resources.listCollections.failed)})),_.resources.updateSubmissionValidationStatus.listen((function(e,t,n){c.a.updateSubmissionValidationStatus(e,t,n).done((function(e){_.resources.updateSubmissionValidationStatus.completed(e,t)})).fail((function(e){console.error(e),_.resources.updateSubmissionValidationStatus.failed(e)}))})),_.resources.removeSubmissionValidationStatus.listen((function(e,t){c.a.removeSubmissionValidationStatus(e,t).done((function(e){_.resources.removeSubmissionValidationStatus.completed(e,t)})).fail((function(e){console.error(e),_.resources.removeSubmissionValidationStatus.failed(e)}))})),_.hooks.getAll.listen((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c.a.getHooks(e).done((function(){var e;(e=_.hooks.getAll).completed.apply(e,arguments),"function"==typeof t.onComplete&&t.onComplete.apply(t,arguments)})).fail((function(){var e;(e=_.hooks.getAll).failed.apply(e,arguments),"function"==typeof t.onFail&&t.onFail.apply(t,arguments)}))})),_.hooks.add.listen((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};c.a.addExternalService(e,t).done((function(){var t;_.hooks.getAll(e),(t=_.hooks.add).completed.apply(t,arguments),"function"==typeof n.onComplete&&n.onComplete.apply(n,arguments)})).fail((function(){var e;(e=_.hooks.add).failed.apply(e,arguments),"function"==typeof n.onFail&&n.onFail.apply(n,arguments)}))})),_.hooks.add.completed.listen((function(e){Object(p.notify)(Object(p.t)("REST Service added successfully"))})),_.hooks.add.failed.listen((function(e){Object(p.notify)(Object(p.t)("Failed adding REST Service"),"error")})),_.hooks.update.listen((function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};c.a.updateExternalService(e,t,n).done((function(){var t;_.hooks.getAll(e),(t=_.hooks.update).completed.apply(t,arguments),"function"==typeof r.onComplete&&r.onComplete.apply(r,arguments)})).fail((function(){var e;(e=_.hooks.update).failed.apply(e,arguments),"function"==typeof r.onFail&&r.onFail.apply(r,arguments)}))})),_.hooks.update.completed.listen((function(){Object(p.notify)(Object(p.t)("REST Service updated successfully"))})),_.hooks.update.failed.listen((function(){i.a.error(Object(p.t)("Failed saving REST Service"))})),_.hooks.delete.listen((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};c.a.deleteExternalService(e,t).done((function(){var t;_.hooks.getAll(e),(t=_.hooks.delete).completed.apply(t,arguments),"function"==typeof n.onComplete&&n.onComplete.apply(n,arguments)})).fail((function(){var e;(e=_.hooks.delete).failed.apply(e,arguments),"function"==typeof n.onFail&&n.onFail.apply(n,arguments)}))})),_.hooks.delete.completed.listen((function(e){Object(p.notify)(Object(p.t)("REST Service deleted permanently"))})),_.hooks.delete.failed.listen((function(e){Object(p.notify)(Object(p.t)("Could not delete REST Service"),"error")})),_.hooks.getLogs.listen((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};c.a.getHookLogs(e,t).done((function(){var e;(e=_.hooks.getLogs).completed.apply(e,arguments),"function"==typeof n.onComplete&&n.onComplete.apply(n,arguments)})).fail((function(){var e;(e=_.hooks.getLogs).failed.apply(e,arguments),"function"==typeof n.onFail&&n.onFail.apply(n,arguments)}))})),_.hooks.retryLog.listen((function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};c.a.retryExternalServiceLog(e,t,n).done((function(){var n;_.hooks.getLogs(e,t),(n=_.hooks.retryLog).completed.apply(n,arguments),"function"==typeof r.onComplete&&r.onComplete.apply(r,arguments)})).fail((function(){var e;(e=_.hooks.retryLog).failed.apply(e,arguments),"function"==typeof r.onFail&&r.onFail.apply(r,arguments)}))})),_.hooks.retryLog.completed.listen((function(e){Object(p.notify)(Object(p.t)("Submission retry requested successfully"))})),_.hooks.retryLog.failed.listen((function(e){Object(p.notify)(Object(p.t)("Submission retry request failed"),"error")})),_.hooks.retryLogs.listen((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};c.a.retryExternalServiceLogs(e,t).done((function(){var e;(e=_.hooks.retryLogs).completed.apply(e,arguments),"function"==typeof n.onComplete&&n.onComplete.apply(n,arguments)})).fail((function(){var r;_.hooks.getLogs(e,t),(r=_.hooks.retryLogs).failed.apply(r,arguments),"function"==typeof n.onFail&&n.onFail.apply(n,arguments)}))})),_.hooks.retryLogs.completed.listen((function(e){Object(p.notify)(Object(p.t)(e.detail),"warning")})),_.hooks.retryLogs.failed.listen((function(e){Object(p.notify)(Object(p.t)("Retrying all submissions failed"),"error")}));"undefined"!=typeof __REACT_HOT_LOADER__&&__REACT_HOT_LOADER__.register(_,"actions","/srv/src/kpi/jsapp/js/actions.es6")},53:function(e,t,n){var r,i,o,s,a=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};r=n(15),e.exports=(o={group:["begin group","end group","begin_group","end_group"],repeat:["begin repeat","end repeat","begin_repeat","end_repeat"],kobomatrix:["begin_kobomatrix","end_kobomatrix"],score:["begin score","end score","begin_score","end_score"],rank:["begin_rank","end_rank","begin rank","end rank"],kobomatrix:["begin_kobomatrix","end_kobomatrix"]},i=function(e){return o[e]||[e]},(s={}).groupable=function(){return r.flatten([i("group"),i("repeat"),i("score"),i("rank"),i("kobomatrix")])},s.groupsOrRepeats=function(){return r.flatten([i("group"),i("repeat")])},s.requiredSheetNameList=function(){return["survey"]},s.testGroupable=function(e){var t;return t=!1,a.call(o.group,e)>=0?t={type:"group"}:a.call(o.repeat,e)>=0?t={type:"repeat"}:a.call(o.score,e)>=0?t={type:"score"}:a.call(o.rank,e)>=0?t={type:"rank"}:a.call(o.kobomatrix,e)>=0&&(t={type:"kobomatrix"}),t&&t.type&&(t.begin=!e.match(/end/)),t},s.testGroupOrRepeat=function(e){return console.error("q.testGroupOrRepeat is renamed to q.testGroupable"),s.testGroupable(e)},s.hiddenTypes=function(){return r.flatten([["imei","deviceid"],["start"],["end"],["today"],["simserial"],["subscriberid"],["phonenumber","phone_number"],["audit"]])},i.q=i.custom=s,i)},6:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r,i=n(12),o=n.n(i),s=n(11),a=n.n(s),u=n(1),l=n(3);(function(){var e=function(e){return o.a.ajax(Object(u.assign)({},{dataType:"json",method:"GET"},e))},t={a:"assets",c:"collections",p:"permissions"};o()(document).ajaxError((function(e,t,n){403!==t.status&&401!==t.status&&404!==t.status||r.selfProfile().done((function(e){if("user is not logged in"===e.message){var n=Object(u.t)("Please try reloading the page. If you need to contact support, note the following message: <pre>##server_message##</pre>"),r=t.status.toString();t.responseJSON&&t.responseJSON.detail&&(r+=": "+t.responseJSON.detail),n=n.replace("##server_message##",r),a.a.alert(Object(u.t)("You are not logged in"),n)}}))})),Object(u.assign)(this,{selfProfile:function(){return e({url:"".concat(l.ROOT_URL,"/me/")})},serverEnvironment:function(){return e({url:"".concat(l.ROOT_URL,"/environment/")})},apiToken:function(){return e({url:"".concat(l.ROOT_URL,"/token/?format=json")})},queryUserExistence:function(t){var n=new o.a.Deferred;return e({url:"".concat(l.ROOT_URL,"/api/v2/users/").concat(t,"/")}).done((function(){n.resolve(t,!0)})).fail((function(){n.reject(t,!1)})),n.promise()},logout:function(){var t=new o.a.Deferred;return e({url:"".concat(l.ROOT_URL,"/api-auth/logout/")}).done(t.resolve).fail((function(){r.selfProfile().done((function(e){"user is not logged in"===e.message?t.resolve(e):t.fail(e)})).fail(t.fail)})),t.promise()},patchProfile:function(t){return e({url:"".concat(l.ROOT_URL,"/me/"),method:"PATCH",data:t})},listTemplates:function(){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/?q=asset_type:template")})},listCollections:function(){return o.a.getJSON("".concat(l.ROOT_URL,"/api/v2/collections/?all_public=true"))},createAssetSnapshot:function(t){return e({url:"".concat(l.ROOT_URL,"/api/v2/asset_snapshots/"),method:"POST",data:t})},createTemporaryAssetSnapshot:function(t){var n=t.source;return e({url:"".concat(l.ROOT_URL,"/api/v2/asset_snapshots/"),method:"POST",data:{source:n}})},getHooks:function(t){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/hooks/"),method:"GET"})},getHook:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/hooks/").concat(n,"/"),method:"GET"})},addExternalService:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/hooks/"),method:"POST",data:JSON.stringify(n),dataType:"json",contentType:"application/json"})},updateExternalService:function(t,n,r){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/hooks/").concat(n,"/"),method:"PATCH",data:JSON.stringify(r),dataType:"json",contentType:"application/json"})},deleteExternalService:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/hooks/").concat(n,"/"),method:"DELETE"})},getHookLogs:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/hooks/").concat(n,"/logs/"),method:"GET"})},getHookLog:function(t,n,r){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/hooks/").concat(n,"/logs/").concat(r,"/"),method:"GET"})},retryExternalServiceLogs:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/hooks/").concat(n,"/retry/"),method:"PATCH"})},retryExternalServiceLog:function(t,n,r){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/hooks/").concat(n,"/logs/").concat(r,"/retry/"),method:"PATCH"})},getReportData:function(t){var n;return t.identifiers&&(n="?names=".concat(t.identifiers.join(","))),""!=t.group_by&&(n+="&split_by=".concat(t.group_by)),e({url:"".concat(l.ROOT_URL,"/reports/").concat(t.uid,"/").concat(n)})},cloneAsset:function(t){var n=t.uid,r=t.name,i=t.version_id,o=t.new_asset_type,s={clone_from:n};return r&&(s.name=r),i&&(s.clone_from_version_id=i),o&&(s.asset_type=o),e({method:"POST",url:"".concat(l.ROOT_URL,"/api/v2/assets/"),data:s})},cloneCollection:function(t){var n=t.uid;return e({method:"POST",url:"".concat(l.ROOT_URL,"/api/v2/collections/"),data:{clone_from:n}})},getPermissionsConfig:function(){return e({url:"".concat(l.ROOT_URL,"/api/v2/permissions/"),method:"GET"})},getAssetPermissions:function(t){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/permission-assignments/"),method:"GET"})},getCollectionPermissions:function(t){return e({url:"".concat(l.ROOT_URL,"/api/v2/collections/").concat(t,"/permission-assignments/"),method:"GET"})},bulkSetAssetPermissions:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/permission-assignments/bulk/"),method:"POST",data:JSON.stringify(n),dataType:"json",contentType:"application/json"})},assignAssetPermission:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/permission-assignments/"),method:"POST",data:JSON.stringify(n),dataType:"json",contentType:"application/json"})},assignCollectionPermission:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/collections/").concat(t,"/permission-assignments/"),method:"POST",data:JSON.stringify(n),dataType:"json",contentType:"application/json"})},removePermission:function(t){return e({method:"DELETE",url:t})},copyPermissionsFrom:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(n,"/permission-assignments/clone/"),method:"PATCH",data:{clone_from:t}})},setCollectionDiscoverability:function(e,t){r.patchCollection(e,{discoverable_when_public:t})},libraryDefaultSearch:function(){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/"),data:{q:"asset_type:question OR asset_type:block OR asset_type:template"},method:"GET"})},deleteCollection:function(t){var n=t.uid;return e({url:"".concat(l.ROOT_URL,"/api/v2/collections/").concat(n,"/"),method:"DELETE"})},deleteAsset:function(t){var n=t.uid;return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(n,"/"),method:"DELETE"})},subscribeCollection:function(t){var n=t.uid;return e({url:"".concat(l.ROOT_URL,"/collection_subscriptions/"),data:{collection:"".concat(l.ROOT_URL,"/api/v2/collections/").concat(n,"/")},method:"POST"})},unsubscribeCollection:function(t){var n=t.uid;return e({url:"".concat(l.ROOT_URL,"/collection_subscriptions/"),data:{collection__uid:n},method:"GET"}).then((function(t){return e({url:t.results[0].url,method:"DELETE"})}))},getAssetContent:function(e){var t=e.id;return o.a.getJSON("".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/content/"))},getImportDetails:function(e){var t=e.uid;return o.a.getJSON("".concat(l.ROOT_URL,"/imports/").concat(t,"/"))},getAsset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.url?o.a.getJSON(e.url):o.a.getJSON("".concat(l.ROOT_URL,"/api/v2/assets/").concat(e.id,"/"))},createExport:function(t){return e({url:"".concat(l.ROOT_URL,"/exports/"),method:"POST",data:t})},getAssetExports:function(t){return e({url:"".concat(l.ROOT_URL,"/exports/"),data:{q:"source:".concat(t)}})},deleteAssetExport:function(t){return e({url:"".concat(l.ROOT_URL,"/exports/").concat(t,"/"),method:"DELETE"})},getAssetXformView:function(t){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/xform/"),dataType:"html"})},searchAssets:function(e){return e.limit=200,o.a.ajax({url:"".concat(l.ROOT_URL,"/api/v2/assets/"),dataType:"json",data:e,method:"GET"})},assetsHash:function(){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/hash/"),method:"GET"})},createCollection:function(t){return e({method:"POST",url:"".concat(l.ROOT_URL,"/api/v2/collections/"),data:t})},patchCollection:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/collections/").concat(t,"/"),method:"PATCH",data:n})},createResource:function(t){return e({method:"POST",url:"".concat(l.ROOT_URL,"/api/v2/assets/"),data:t})},patchAsset:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/"),method:"PATCH",data:n})},listTags:function(t){return e({url:"".concat(l.ROOT_URL,"/tags/"),method:"GET",data:Object(u.assign)({limit:9999},t)})},getCollection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.url?o.a.getJSON(e.url):o.a.getJSON("".concat(l.ROOT_URL,"/api/v2/collections/").concat(e.id,"/"))},loadNextPageUrl:function(t){return e({url:t,method:"GET"})},deployAsset:function(t,n){var r={active:!0},i="POST";return n&&(i="PATCH",r.version_id=t.version_id),e({method:i,url:"".concat(t.url,"deployment/"),data:r})},setDeploymentActive:function(t){var n=t.asset,r=t.active;return e({method:"PATCH",url:"".concat(n.url,"deployment/"),data:{active:r}})},postCreateImport:function(e){var t=new FormData;return Object.keys(e).forEach((function(n){t.append(n,e[n])})),o.a.ajax({method:"POST",url:"".concat(l.ROOT_URL,"/imports/"),data:t,processData:!1,contentType:!1})},getResource:function(e){var n=e.id,r=t[n[0]];return o.a.getJSON("".concat(l.ROOT_URL,"/").concat(r,"/").concat(n,"/"))},getSubmissions:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",a="limit=".concat(n,"&start=").concat(r),u='&sort={"_id":-1}',c="";return i.length&&(u=!0===i[0].desc?'&sort={"'.concat(i[0].id,'":-1}'):'&sort={"'.concat(i[0].id,'":1}')),o.length&&(c="&fields=".concat(JSON.stringify(o))),e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/data/?").concat(a).concat(u).concat(c).concat(s),method:"GET"})},getSubmission:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/data/").concat(n,"/"),method:"GET"})},patchSubmissions:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/data/validation_statuses/"),method:"PATCH",data:{payload:JSON.stringify(n)}})},bulkRemoveSubmissionsValidationStatus:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/data/validation_statuses/"),method:"DELETE",data:{payload:JSON.stringify(n)}})},updateSubmissionValidationStatus:function(t,n,r){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/data/").concat(n,"/validation_status/"),method:"PATCH",data:r})},removeSubmissionValidationStatus:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/data/").concat(n,"/validation_status/"),method:"DELETE"})},getSubmissionsQuery:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/data/?").concat(n),method:"GET"})},deleteSubmission:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/data/").concat(n),method:"DELETE"})},bulkDeleteSubmissions:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/data/bulk/"),method:"DELETE",data:{payload:JSON.stringify(n)}})},getEnketoEditLink:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/data/").concat(n,"/edit/?return_url=false"),method:"GET"})},uploadAssetFile:function(t,n){var r=new FormData;return Object.keys(n).forEach((function(e){r.append(e,n[e])})),e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/files/"),method:"POST",data:r,processData:!1,contentType:!1})},getAssetFiles:function(t){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/files/"),method:"GET"})},deleteAssetFile:function(t,n){return e({url:"".concat(l.ROOT_URL,"/api/v2/assets/").concat(t,"/files/").concat(n,"/"),method:"DELETE"})},getHelpInAppMessages:function(){return e({url:"".concat(l.ROOT_URL,"/help/in_app_messages/"),method:"GET"})},patchHelpInAppMessage:function(t,n){return e({url:"".concat(l.ROOT_URL,"/help/in_app_messages/").concat(t,"/"),method:"PATCH",data:JSON.stringify(n),dataType:"json",contentType:"application/json"})},setLanguage:function(t){return e({url:"".concat(l.ROOT_URL,"/i18n/setlang/"),method:"POST",data:t})},environment:function(){return e({url:"".concat(l.ROOT_URL,"/environment/"),method:"GET"})},login:function(t){return e({url:"".concat(l.ROOT_URL,"/api-auth/login/?next=/me/"),data:t,method:"POST"})}})}).call(r={});"undefined"!=typeof __REACT_HOT_LOADER__&&__REACT_HOT_LOADER__.register(r,"dataInterface","/srv/src/kpi/jsapp/js/dataInterface.es6")},63:function(e,t,n){var r,i;r=n(426),i=r.expect,e.exports={chai:i,expect:function(e){return{toBe:function(t){return i(e).to.equal(t)},toThrow:function(t){return i(e).to.throw(t)},toBeDefined:function(){return i(e).not.to.be.a("undefined")},toContain:function(t){return i(e).to.contain(t)},toEqual:function(t){return i(e).eql(t)},toBeTruthy:function(){return i(e).to.be.ok},toBeUndefined:function(){return i(e).to.be.a("undefined")},not:{toEqual:function(t){return i(e).to.not.eql(t)},toBe:function(t){return i(e).to.not.equal(t)},toThrow:function(t){return i(e).to.not.throw(t)},toBeTruthy:function(){return i(e).to.not.be.ok},toBeDefined:function(){return i(e).to.be.a("undefined")}}}}}},64:function(e,t,n){var r,i,o,s,a,u=function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},l={}.hasOwnProperty,c=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};s=n(15),o=n(20),i=n(19),r=n(39),(a={}).SkipLogicFactory=function(){function e(e){this.survey=e}return e.prototype.create_operator=function(e,t,n){var r;switch(e){case"text":r=new a.TextOperator(t);break;case"date":r=new a.DateOperator(t);break;case"basic":r=new a.SkipLogicOperator(t);break;case"existence":r=new a.ExistenceSkipLogicOperator(t);break;case"select_multiple":r=new a.SelectMultipleSkipLogicOperator(t);break;case"empty":return new a.EmptyOperator}return r.set("id",n),r},e.prototype.create_criterion_model=function(){return new a.SkipLogicCriterion(this,this.survey)},e.prototype.create_response_model=function(e){var t;switch(t=null,e){case"integer":t=new a.IntegerResponseModel;break;case"decimal":t=new a.DecimalResponseModel;break;default:t=new a.ResponseModel(e)}return t.set("type",e)},e}(),a.SkipLogicCriterion=function(e){function t(e,n){this.factory=e,this.survey=n,t.__super__.constructor.call(this)}return u(t,e),t.prototype.serialize=function(){var e;if(null!=(e=this.get("response_value"))&&null!=this.get("operator")&&null!=this.get("question_cid")&&!1!==e.isValid()&&null!=e.get("value")&&this._get_question()){this._get_question().finalize();var t=this._get_question().getValue("name");return this.get("operator").serialize(t,e.get("value"))}return""},t.prototype._get_question=function(){return this.survey.findRowByCid(this.get("question_cid"),{includeGroups:!0})},t.prototype.change_question=function(e){var t,n,r,i,o;if(t=(null!=(r=this._get_question())&&"function"==typeof r.get_type?r.get_type():void 0)||{name:null},this.set("question_cid",e),n=this._get_question().get_type(),i=this.get("operator").get_id(),c.call(n.operators,i)<0?this.change_operator(n.operators[0]):t.name!==n.name&&this.change_operator(this.get("operator").get_value()),null==this.get("operator").get_type().response_type&&this._get_question().response_type!==(null!=(o=this.get("response_value"))?o.get_type():void 0))return this.change_response(null!=(response_model=this.get("response_value"))?this._get_question()._isSelectQuestion()?response_model.get("cid"):response_model.get("value"):"")},t.prototype.change_operator=function(e){var t,n,i,o,s,a,u;if(t=!1,(e=+e)<0&&(t=!0,e*=-1),i=this._get_question().get_type(),c.call(i.operators,e)>=0)return a=(u=r.operator_types[e-1]).symbol[u.parser_name[+t]],n=this.factory.create_operator("equality"===u.type?i.equality_operator_type:u.type,a,e),this.set("operator",n),(u.response_type||i.response_type)!==(null!=(o=this.get("response_value"))?o.get("type"):void 0)?this.change_response((null!=(s=this.get("response_value"))?s.get(this._get_question()._isSelectQuestion()?"cid":"value"):void 0)||""):void 0},t.prototype.get_correct_type=function(){return this.get("operator").get_type().response_type||this._get_question().get_type().response_type},t.prototype.set_option_names=function(e){s.each(e,(function(e){if(null==e.get("name"))return e.set("name",i.sluggify(e.get("label")))}))},t.prototype.change_response=function(e){var t,n,r,i;if((i=this.get("response_value"))&&i.get("type")===this.get_correct_type()||(i=this.factory.create_response_model(this.get_correct_type()),this.set("response_value",i)),"dropdown"===this.get_correct_type()){r=i?i.get("cid"):null;var o=this._get_question().getList();return i.set("choicelist",o),n=o.options.models,this.set_option_names(n),t=s.map(n,(function(e){return e.cid})),c.call(t,e)>=0?i.set_value(e):c.call(t,r)>=0?i.set_value(r):i.set_value(n[0].cid)}return i.set_value(e)},t}(o.Model),a.Operator=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.serialize=function(e,t){throw new Error("Not Implemented")},t.prototype.get_value=function(){var e;return e="",this.get("is_negated")&&(e="-"),e+this.get("id")},t.prototype.get_type=function(){return r.operator_types[this.get("id")-1]},t.prototype.get_id=function(){return this.get("id")},t}(o.Model),a.EmptyOperator=function(e){function t(){t.__super__.constructor.call(this),this.set("id",0),this.set("is_negated",!1)}return u(t,e),t.prototype.serialize=function(){return""},t}(a.Operator),a.SkipLogicOperator=function(e){function t(e){t.__super__.constructor.call(this),this.set("symbol",e),this.set("is_negated",["!=","<","<="].indexOf(e)>-1)}return u(t,e),t.prototype.serialize=function(e,t){return"${"+e+"} "+this.get("symbol")+" "+t},t}(a.Operator),a.TextOperator=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.serialize=function(e,n){return t.__super__.serialize.call(this,e,"'"+n.replace(/'/g,"\\'")+"'")},t}(a.SkipLogicOperator),a.DateOperator=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.serialize=function(e,n){return-1==n.indexOf("date")&&(n="date('"+n+"')"),t.__super__.serialize.call(this,e,n)},t}(a.SkipLogicOperator),a.ExistenceSkipLogicOperator=function(e){function t(e){t.__super__.constructor.call(this,e),this.set("is_negated","="===e)}return u(t,e),t.prototype.serialize=function(e){return t.__super__.serialize.call(this,e,"''")},t}(a.SkipLogicOperator),a.SelectMultipleSkipLogicOperator=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.serialize=function(e,t){var n;return n="selected(${"+e+"}, '"+t+"')",this.get("is_negated")?"not("+n+")":n},t}(a.SkipLogicOperator),a.ResponseModel=function(e){function t(e){t.__super__.constructor.call(this),"dropdown"===e&&(this._set_value=this.set_value,this.set_value=function(e){var t;(t=this.get("choicelist").options.get(e))&&(this._set_value(t.get("name")),this.set("cid",e))})}return u(t,e),t.prototype.get_type=function(){return this.get("type")},t.prototype.set_value=function(e){return this.set("value",e,{validate:!0})},t}(o.Model),a.IntegerResponseModel=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.validation={value:{pattern:/^-?\d+$/,msg:"Number must be integer"}},t.prototype.set_value=function(e){return""===e&&(e=void 0),this.set("value",e,{validate:!!e})},t}(a.ResponseModel),a.DecimalResponseModel=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.validation={value:{pattern:"number",msg:"Number must be decimal"}},t.prototype.set_value=function(e){function t(){return"number"!=typeof e}return void 0===e||""===e?e=null:(t()&&(e=+(e=e.replace(/\s/g,""))||e),t()&&(e=+e.replace(",",".")||e),t()&&(e=e.lastIndexOf(",")>e.lastIndexOf(".")?+e.replace(/\./g,"").replace(",","."):+e.replace(",",""))),this.set("value",e,{validate:!0})},t}(a.ResponseModel),a.DateResponseModel=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.validation={value:{pattern:/date\(\'\d{4}-\d{2}-\d{2}\'\)/}},t.prototype.set_value=function(e){return/^\d{4}-\d{2}-\d{2}$/.test(e)&&(e="date('"+e+"')"),this.set("value",e,{validate:!0})},t}(a.ResponseModel),e.exports=a},72:function(e,t,n){var r,i,o,s,a,u,l,c,p,d,h,f=[].slice;i=n(15),n(12),r=n(298),e.exports=((o={}).Validator=r,o.normalizeEventName=function(e){var t;return t=new RegExp("[: ()]","g"),e=e.replace(t,"-")},o.reorderElemsByData=function(e,t,n){var r,o,s,a,u;for(o=[],u=!1,$(t).find(e).each((function(e){var t,r;if(0===e)u=this.parentElement;else if(this.parentElement!==u)throw new Error("All reordered items must be siblings");if(r=(t=$(this).detach()).data(n),i.isNumber(r))return o[r]=t})),s=0,a=o.length;s<a;s++)(r=o[s])&&r.appendTo(u)},o.cleanStringify=function(e){var t,n,r;for(n in t=[],e)""!==(r=e[n])&&t.push('<span class="atts"><i>'+n+'</i>="<em>'+r+'</em>"</span>');return t.join("&nbsp;")},o.debugFrame=(s=!1,a={position:"fixed",width:"95%",height:"80%",bottom:10,left:"2.5%",overflow:"auto",zIndex:100,backgroundColor:"rgba(255,255,255,0.7)"},(u=function(e){var t;return t=e.split("\n").join("<br>"),s=$("<div>",{class:"well debug-frame"}).html("<code>"+t+"</code>").css(a).appendTo("body")}).close=function(){if(s)return s.remove(),s=!1},u),o.launchQuestionLibrary=function(e){var t;return null==e&&(e={}),t=$("<div>",{class:"js-click-remove-iframe iframe-bg-shade"}),$("<div>").text('Launch question library in this element\n<section koboform-question-library=""></section>').appendTo(t),t.click((function(){return t.remove()})),t},o.enketoIframe=(d="https://enketo.org",p="/webform/preview",c=function(e){return""+d+p+"?form="+e},l=function(e){if(e.enketoPreviewUri&&(p=e.enketoPreviewUri),e.enketoServer)return d=e.enketoServer},(h=function(e,t){return null==t&&(t={}),l(t),console.log(t),$(".enketo-holder").append($("<iframe>",{src:c(e)})),$(".enketo-holder iframe").load((function(){return $(".enketo-loading-message").remove()}))}).close=function(){return $(".iframe-bg-shade").remove(),$(".enketo-holder").remove()},h.fromCsv=function(e,t){var n,r,i,o,s;return null==t&&(t={}),r=$("<div>",{class:"enketo-holder"}).html('<div class=\'enketo-iframe-icon\'></div>\n<div class="enketo-loading-message">\n  <p>\n  <i class="fa fa-spin fa-spinner"></i>\n  <br/>\n  Loading Preview\n</p>\n<p>\n  This will take a few seconds depending on the size of your form.\n</p>\n</div>'),s=$("<div>",{class:"js-click-remove-iframe iframe-bg-shade"}),r.appendTo("body"),s.appendTo("body"),s.click((function(){return s.remove(),r.remove()})),$(".enketo-holder .enketo-iframe-icon").click((function(){return s.remove(),r.remove()})),o=t.previewServer||"",n=JSON.stringify({body:e}),l(t),i=t.onError||function(){var e;return e=1<=arguments.length?f.call(arguments,0):[],"undefined"!=typeof console&&null!==console?console.error.apply(console,e):void 0},$.ajax({url:o+"/koboform/survey_preview/",method:"POST",data:n,complete:function(e,n){var a,u,l;return u=e.responseJSON,"success"===n&&u&&u.unique_string?(l=u.unique_string,h(o+"/koboform/survey_preview/"+l),null!=t.onSuccess?t.onSuccess():void 0):"success"!==n?(s.remove(),r.remove(),(a=e.responseText||e.statusText).split("\n").length>0&&(a=a.split("\n").slice(0,3).join("<br>")),i(a,{title:"Error launching preview"})):u&&u.error?(s.remove(),r.remove(),i(u.error)):(s.remove(),r.remove(),i("SurveyPreview response JSON is not recognized"))}})},h),o.ViewComposer=function(){function e(){this.views=[]}return e.prototype.add=function(e,t){return this.views.push(e)},e.prototype.remove=function(e){throw"not implemented"},e.prototype.get=function(e){throw"not implemented"},e.prototype.render=function(){var e,t,n,r,i;for(r=[],e=0,t=(n=this.views).length;e<t;e++)i=n[e],r.push(i.render());return r},e.prototype.attach_to=function(e){var t,n,r,i,o;for(i=[],t=0,n=(r=this.views).length;t<n;t++)o=r[t],i.push(o.attach_to(e));return i},e.prototype.bind_event=function(e,t){throw"not implemented"},e}(),o)},73:function(e,t,n){var r,i,o,s,a=function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},u={}.hasOwnProperty;i=n(15),o=n(43),r=n(19),e.exports=((s={}).Option=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.initialize=function(){return this.unset("list name"),this.unset("list_name")},t.prototype.destroy=function(){var e,t,n;return t=(e=this.list()._parent).cid,n=e.collection._parent,this.collection.remove(this),n.trigger("remove-option",t,this.cid)},t.prototype.list=function(){return this.collection},t.prototype.getKeys=function(e){var t,n,r;for(t in n=[],r=this.attributes)r[t],e?this.get(t)&&n.push(t):n.push(t);return n},t.prototype.toJSON=function(){var e,t,n;for(t in e={},n=this.attributes)n[t],e[t]=this.get(t);return e},t}(o.BaseModel),s.Options=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.model=s.Option,t}(o.BaseCollection),s.ChoiceList=function(e){function t(e,n){var r;null==e&&(e={}),r=e.options||[],t.__super__.constructor.call(this,{name:e.name},n),this.options=new s.Options(r||[],{_parent:this})}return a(t,e),t.prototype.idAttribute="name",t.prototype.summaryObj=function(){return this.toJSON()},t.prototype.getSurvey=function(){return this.collection.getSurvey()},t.prototype.getList=function(){return this.__cascadedList?this.__cascadedList:null},t.prototype._get_previous_linked_choice_list=function(){return this.collection.find((e=this,function(t){return t.getList()===e}));var e},t.prototype._get_last_linked_choice_list=function(){var e,t;for(t=e=this;e=t._get_previous_linked_choice_list();)t=e;return t},t.prototype._get_first_linked_choice_list=function(){var e,t;for(t=e=this;e=t.getList();)t=e;return t},t.prototype._has_corresponding_row=function(){var e;return e=this.get("name"),!!this.getSurvey().rows.find((function(t){return t.get("type").get("listName")===e}))},t.prototype._create_corresponding_row_data=function(e){var t,n,r,o,s,a;for(null==e&&(e={}),r=!!e._full_path_choice_filter,n=this._get_first_linked_choice_list(),s=[],(a=[]).push((t=function(e){var t;return{label:t=e.get("name"),type:"select_one "+t,choice_filter:(r?s:i.compact([i.last(s)])).map((function(e){var t;return(t=e.get("name"))+"=${"+t+"}"})).join(" and ")}})(n)),o=n,s.push(n);o=o._get_previous_linked_choice_list();)a.push(t(o)),s.push(o);return a},t.prototype.create_corresponding_rows=function(e){var t,n,r,i,o,s,a,u;for(null==e&&(e={}),a=this._create_corresponding_row_data(),u=this.getSurvey(),t=e.at||0,o=[],n=0,r=(i=a.reverse()).length;n<r;n++)s=i[n],o.push(u.addRowAtIndex(s,t));return o},t.prototype.getOptionKeys=function(e){var t,n,r,o,s,a,u,l;for(null==e&&(e=!0),a=[],t=0,r=(u=this.options.models).length;t<r;t++)for(n=0,o=(l=u[t].getKeys(e)).length;n<o;n++)s=l[n],a.push(s);return i.uniq(a)},t.prototype.finalize=function(){var e,t,n,i,o,s,a;for(o=[],e=0,n=(a=this.options.models).length;e<n;e++)t=(s=a[e]).get("label"),(i=s.get("name"))||(i=r.sluggify(t,{preventDuplicates:o,lowerCase:!0,lrstrip:!0,characterLimit:40,incrementorPadding:!1,validXmlTag:!1}),s.set("name",i)),o.push(i)},t.prototype.clone=function(){var e;return delete(e=this.toJSON()).name,i.assign(new s.ChoiceList(e),{collection:this.collection})},t.prototype.toJSON=function(){return this.finalize(),{name:this.get("name"),options:this.options.invoke("toJSON")}},t.prototype.getNames=function(){var e;return e=this.options.map((function(e){return e.get("name")})),i.compact(e)},t}(o.BaseModel),s.ChoiceLists=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.model=s.ChoiceList,t.prototype.create=function(){var e;return this.add(e=new s.ChoiceList({name:r.txtid()})),e},t.prototype.getListNames=function(){return this.invoke("get","name")},t.prototype.summaryObj=function(e){var t,n,r,i,o;for(null==e&&(e=!1),i={},t=0,n=(o=this.models).length;t<n;t++)i[(r=o[t]).get("name")]=e?r.summaryObj().options:r.summaryObj();return i},t}(o.BaseCollection),s)},74:function(e,t){var n,r,i,o,s,a,u,l,c,p,d,h,f=[].slice,_={}.hasOwnProperty,m=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};e.exports=(n=function(){function e(e,t){var n,r,s,a,u,c,d;if(null==t&&(t={}),o(e))this.string=e,c=p.toArray(this.string),this.rows=l(c),this.columns=c[0],this.rowArray=2<=c.length?f.call(c,1):[];else if(i(e))this.rows=e,this.columns=(d=this,function(){var e,t,n,r,i,o;for(e=[],t=0,r=(i=d.rows).length;t<r;t++)for(n in o=i[t])_.call(o,n)&&m.call(e,n)<0&&e.push(n);return e})(),this.buildRowArray(),this.obj=e;else if(e){if(this.columns=i(e.columns)?e.columns:[],e.rowObjects){if(0===this.columns.length)for(n=0,s=(a=e.rowObjects).length;n<s;n++)for(r in u=a[n])u[r],r in columns||this.columns.push(r);this.rowArray=function(t){return function(){var n,r,i,o,s;for(s=[],r=0,i=(o=e.rowObjects).length;r<i;r++)u=o[r],s.push(function(){var e,t,r,i;for(i=[],e=0,t=(r=this.columns).length;e<t;e++)n=r[e],i.push(u[n]);return i}.call(t));return s}}(this)()}else this.rowArray=i(e.rows)?e.rows:[];null!=e.kind&&(this.kind=e.kind),this.rows=function(e){return function(){var t,n,r,i,o,s,a,l,c;for(l=[],r=0,o=(a=e.rowArray).length;r<o;r++){for(c={},n=i=0,s=(u=a[r]).length;i<s;n=++i)t=u[n],null!=e.columns[n]&&(c[e.columns[n]]=t);l.push(c)}return l}}(this)()}else this.rows=[],this.columns=[],this.rowArray=[]}return e.prototype.buildRowArray=function(){return this.rowArray=(e=this,function(){var t,n,r,i,o,s;for(o=[],n=0,r=(i=e.rows).length;n<r;n++)s=i[n],o.push(function(){var e,n,r,i;for(i=[],e=0,n=(r=this.columns).length;e<n;e++)t=r[e],i.push(s[t]||"");return i}.call(e));return o})();var e},e.prototype.addRow=function(e){var t,n,r;for(r in t=!1,e)_.call(e,r)&&(e[r],m.call(this.columns,r)<0&&(t=!0,this.columns.push(r)));return this.rows.push(e),t?this.buildRowArray():this.rowArray.push(function(){var t,r,i,o;for(o=[],t=0,r=(i=this.columns).length;t<r;t++)n=i[t],o.push(e[n]);return o}.call(this)),e},e.prototype.toObjects=function(e){return null==e&&(e={}),this.string?p.toObjects(this.string,e):this.rows?this.rows:void 0},e.prototype.toObject=function(){var e;return e={columns:this.columns,rows:this.rowArray},this.kind&&(e.kind=this.kind),e},e.prototype.toArrays=function(){var e,t,n,r,i;for(n=[this.columns],e=0,t=(r=this.rowArray).length;e<t;e++)(i=r[e]).length>0&&n.push(i);return n},e.prototype.toString=function(){var e,t;return function(){var t,n,r,i;for(i=[],t=0,n=(r=this.columns).length;t<n;t++)e=r[t],i.push(c(e));return i}.call(this).join(p.settings.delimiter)+"\n"+function(){var n,r,i,o;for(o=[],n=0,r=(i=this.rowArray).length;n<r;n++)t=i[n],o.push(function(){var n,r,i;for(i=[],n=0,r=t.length;n<r;n++)e=t[n],i.push(c(e));return i}().join(p.settings.delimiter));return o}.call(this).join("\n")},e}(),a=function(e){return e.replace(/\\\\/g,"\\")},c=function(e){var t;return void 0===e?"":RegExp("\\W|\\w|"+p.settings.delimiter).test(e)?(t=JSON.stringify(""+e),a(t)):e},(p=function(e,t){return e instanceof n?e:new n(e,t)}).fromStringArray=function(e,t){var n,r;return null==t&&(t={}),function(){var t,i,o;for(o=[],t=0,i=e.length;t<i;t++)r=e[t],o.push(function(){var e,t,i;for(i=[],e=0,t=r.length;e<t;e++)n=r[e],i.push(c(n));return i}().join(p.settings.delimiter));return o}().join("\n")},p.fromArray=function(e,t){var n,r,i,o,s,a,u,l;for(null==t&&(t={}),l=!!t.sort,r=[],i=0,s=e.length;i<s;i++)for(o in u=e[i])_.call(u,o)&&-1===r.indexOf(o)&&r.push(o);return l&&r.sort(),(a=function(){var t,i,o;for(o=[],t=0,i=e.length;t<i;t++)u=e[t],o.push(function(){var e,t,i;for(i=[],e=0,t=r.length;e<t;e++)n=r[e],i.push(c(u[n]));return i}());return o}()).unshift(function(){var e,t,i;for(i=[],e=0,t=r.length;e<t;e++)n=r[e],i.push(c(n));return i}()),p.fromStringArray(a,t)},p.toObjects=function(e){return l(p.toArray(e))},l=function(e){var t,n,r,i,o,s,a,u,l,c;for(t=e[0],u=[],r=0,o=(c=2<=e.length?f.call(e,1):[]).length;r<o;r++)if(1!==(l=c[r]).length||""!==l[0]){for(a={},n=i=0,s=t.length;i<s;n=++i)a[t[n]]=l[n];u.push(a)}return u},p.toObject=function(e,t){return u(p.toArray(e),t)},u=function(e,t){var n,r,i,o,s,a,u,l,c,p,d,h,_,m,g;for(null==t&&(t={}),n=e[0],h=2<=e.length?f.call(e,1):[],m=t.sortByKey,i=t.includeSortByKey,m||(m=n[0]),g=n.indexOf(m),p={},o=0,u=h.length;o<u;o++)if(1!==(d=h[o]).length||""!==d[0]){for(c={},_=d[g],r=s=0,l=n.length;s<l;r=++s)a=n[r],r!==g&&(c[a]=d[r]);i&&(c[m]=_),p[_]=c}return p},h=function(e){return e.replace(/(\n+)$/g,"")},p._parse_string=function(e){return JSON.parse('"'+e.replace(/\\/g,"\\\\").replace(/\\\\"/g,'\\"')+'"')},p.toArray=function(e){var t,n,r,i,o,s,a;for(p.settings.removeTrailingNewlines&&(e=h(e)),o=p.settings.delimiter,i=[],r=[],p._objPattern=new RegExp('(\\,|\\r?\\n|\\r|^)(?:"((?:(?:[^\\\\]|\\\\\\\\|[\\\\(?=")]"|[\\\\(?!")])*?))"|([^"\\,\\r\\n]*))',"gi");t=p._objPattern.exec(e);)(s=t[1]).length&&s!==o&&(i.push(r),r=[]),a=t[2]?p._parse_string(t[2]):t[3],p.settings.parseFloat&&!isNaN(n=parseFloat(a))&&(a=n),r.push(a);return i.push(r),i},r=function(){function e(e,t){var n;this._sheetIds=[],this._sheets={},o(e)&&d(e,(n=this,function(e,t){var r,i,o,s,a,u,l;for(u=[],o=0,s=e.length;o<s;o++)r=(a=t[i=e[o]])[0],l=2<=a.length?f.call(a,1):[],u.push(n.sheet(i,p({columns:r,rows:l})));return u}))}return e.prototype.sheet=function(e,t){return null==t&&(t=!1),t?(m.call(this._sheetIds,e)<0&&this._sheetIds.push(e),this._sheets[e]=t):this._sheets[e]},e.prototype.toString=function(){var e,t,n,r,i,o,s,a,u,l,d,h,f,_,m,g,v;for(d=[],r=p.settings.delimiter,o=0,u=(h=this._sheetIds).length;o<u;o++){for(v=h[o],g=this._sheets[v],n=g.columns,m=g.rowArray,i=c(v),s=0,f=n.length;0<=f?s<f:s>f;0<=f?++s:--s)i+=r;for(d.push(i),d.push(r+function(){var e,r,i;for(i=[],e=0,r=n.length;e<r;e++)t=n[e],i.push(c(t));return i}().join(r)),a=0,l=m.length;a<l;a++)_=m[a],d.push(r+function(){var t,n,r;for(r=[],n=0,t=_.length;n<t;n++)e=_[n],r.push(c(e));return r}().join(r))}return d.join("\n")},e}(),p.sheeted=function(e,t){return e instanceof r?e:new r(e,t)},d=function(e,t){var n,r,i,o,s,a,u,l,c;for(null==t&&(t=!1),c={},s=[],i=0,o=(a=p.toArray(e)).length;i<o;i++){if(n=(u=a[i])[0],l=2<=u.length?f.call(u,1):[],n&&(r=n),!r)throw new Error("Sheet id must be defined in the first column and cannot be falsey");m.call(s,r)<0&&s.push(r),c[r]||(c[r]=[]),function(){var e,t;for(e=0,t=l.length;e<t;e++)if(l[e])return!0}()&&c[r].push(l)}return t?t.apply(this,[s,c]):[s,c]},p.sheeted.toObjects=function(e){return d(e,(function(e,t){var n,r,i,o;for(i={},n=0,r=e.length;n<r;n++)i[o=e[n]]=l(t[o]);return i}))},p.sheeted.toArray=function(e){return d(e,(function(e,t){var n,r,i,o;for(i=[],n=0,r=e.length;n<r;n++)o=e[n],i.push({id:o,sheet:l(t[o])});return i}))},o=function(e){return!!(""===e||e&&e.charCodeAt&&e.substr)},s=Array.isArray,i=s||function(e){return!(!(e&&e.concat&&e.unshift)||e.callee)},Object.keys,p.settings={delimiter:",",parseFloat:!1,removeTrailingNewlines:!0},p)},844:function(e,t,n){var r=n(426).expect;window.jQuery=window.$=n(12),n(348),n(867),n(868),n(869),n(870),n(871),n(872),n(873),n(874),n(875),n(876),n(877),n(882),n(881);"undefined"!=typeof __REACT_HOT_LOADER__&&__REACT_HOT_LOADER__.register(r,"expect","/srv/src/kpi/test/index.js")},85:function(e,t,n){var r,i,o,s,a,u,l,c,p,d,h,f,_,m,g=function(e,t){for(var n in t)v.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},v={}.hasOwnProperty,y=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},b=[].slice;d=n(15),r=n(43),i=n(73),l=n(19),o=n(35),p=n(303),c=n(87),s=n(125),a=n(126),u=n(305),h=n(74),e.exports=((_=function(e){function t(e,n){var r,s,u,l,p,d,h;if(null==e&&(e={}),t.__super__.constructor.call(this),e.error)throw new Error("instantiating survey with error parameter");if(this._initialParams=e,this.settings=new f(e.settings,{_parent:this}),e.settings||this.settings.enable_auto_name(),(d=this.settings.get("name")||e.name)&&this.set("name",d),this.newRowDetails=e.newRowDetails||o.newRowDetails,this.defaultsForType=e.defaultsForType||o.defaultsForType,this.surveyDetails=new c.SurveyDetails([],{_parent:this}).loadSchema(e.surveyDetailsSchema||o.surveyDetailSchema),this.choices=new i.ChoiceLists([],{_parent:this}),a.loadChoiceLists(e.choices||[],this.choices),e.survey)for(a.hasBeenParsed(e)||(e.survey=a.parseArr(e.survey)),r=0,s=(l=e.survey).length;r<s;r++){if(void 0!==(u=l[r]).id)throw new Error("Forbidden column `id` for row: "+JSON.stringify(u,null,2));p=u.type,y.call(o.surveyDetailSchema.typeList(),p)>=0?this.surveyDetails.importDetail(u):this.rows.add(u,{collection:this.rows,silent:!0,_parent:this.rows})}else this.surveyDetails.importDefaults();this.context={warnings:[],errors:[]},this.forEachRow((h=this,function(e){if("function"==typeof e.linkUp)return e.linkUp(h.context)})),this.linkUpChoiceLists()}return g(t,e),t.create=function(e,n){return null==e&&(e={}),new t(e,n)},t.prototype.linkUpChoiceLists=function(){var e,t,n,r,i,o;for(e=this.choices.getListNames(),n=0,r=(o=this.choices.models).length;n<r;n++){if(t=o[n],(i=d.intersection(e,t.getOptionKeys(!0))).length>1)throw new Error("cascading choices can only reference one choice list");1===i.length&&(t.__cascadedList=this.choices.get(i[0]))}},t.prototype.insert_row=function(e,t){var n,r,i,o;return e._isCloned?this.rows.add(e,{at:t}):this.rows.add(e.toJSON(),{at:t}),r=this.rows.at(t),o=this.getSurvey(),(i=e.getList())&&(o.choices.add({options:i.options.toJSON()}),r.get("type").set("list",i)),(n=r.get("name")).set("value",n.deduplicate(o))},t.prototype._ensure_row_list_is_copied=function(e){var t;if(!e.rows&&(t=e.getList()))return this.choices.add({name:t.get("name"),options:t.options.toJSON()})},t.prototype.insertSurvey=function(e,t,n){var r,i,o,s,a,u,l,c,p;for(null==t&&(t=-1),-1===t&&(t=this.rows.length),c=i=0,s=(u=e.rows.models).length;i<s;c=++i){if(l=u[c],p=this,n){if(!(r=this.findRowByCid(n,{includeGroups:!0})))throw new Error("Couldn't find group "+n+"!");p=r}o=t+c,l.rows?(l.forEachRow&&l.forEachRow(function(e){return function(t){return e._ensure_row_list_is_copied(t)}}(this),{includeGroups:!0}),this._insertRowInPlace(l,{index:o,parent:p,noDetach:!0}),this.trigger("change")):(this._ensure_row_list_is_copied(l),(a=l.get("name")).set("value",a.deduplicate(this)),p.rows.add(l.toJSON(),{at:o}))}},t.prototype.toFlatJSON=function(e,t){var n,r,i,o,s,a,u,l,c,p;if(null==e&&(e=!1),null==t&&(t=4),(u=this.toJSON()).survey=function(){var e,t,n,r;for(r=[],e=0,t=(n=u.survey).length;e<t;e++)c=n[e],d.isObject(c.type)&&(c.type=[d.keys(c.type)[0],d.values(c.type)[0]].join(" ")),r.push(c);return r}(),d.isObject(u.choices)){for(o in r=[],l=u.choices)if(v.call(l,o))for(i=0,s=(p=l[o]).length;i<s;i++)a=p[i],delete(n=$.extend({list_name:o},a)).setManually,r.push(n);u.choices=r}return u.settings=[this.settings.attributes],e?JSON.stringify(u,null,t):u},t.prototype.toJSON=function(e,t){var n,r,o,s,a;for(s in null==e&&(e=!1),null==t&&(t=4),r={},n={choices:new i.ChoiceLists},r.survey=(a=this,function(){var e,t,r,i,o,s;for(i=[],e=function(e){var t;return"getList"in e&&(t=e.getList())&&n.choices.add(t),"function"==typeof e.export_relevant_values?e.export_relevant_values(i,n):console.error("No r.export_relevant_values. Does this survey have non-standard columns?",e)},a.forEachRow(e,{includeGroupEnds:!0}),t=0,r=(o=a.surveyDetails.models).length;t<r;t++)(s=o[t]).get("value")&&i.push(s.toJSON());return i})(),n)(o=n[s]).length>0&&(r[s]=o.summaryObj(!0));return e?JSON.stringify(r,null,t):r},t.prototype.getSurvey=function(){return this},t.prototype.log=function(e){var t,n,r;null==e&&(e={}),t=e.log||function(){var e;return e=1<=arguments.length?b.call(arguments,0):[],console.log.apply(console,e)},r=["-"],n=function(e){return"forEachRow"in e?(t(r.join("").replace(/-/g,"="),e.get("label").get("value")),r.push("-"),e.forEachRow(n,{flat:!0,includeGroups:!0}),r.pop()):t(r.join(""),e.get("label").get("value"))},this.forEachRow(n,{flat:!0,includeGroups:!0})},t.prototype.summarize=function(){var e,t,n;return n=0,t=!1,e=function(e){return"geopoint"===e.get("type").get("value")&&(t=!0),n++},this.forEachRow(e,{includeGroups:!1}),{rowCount:n,hasGps:t}},t.prototype._insertRowInPlace=function(e,t){var n,r,i;null==t&&(t={}),e._parent&&!t.noDetach&&e.detach({silent:!0}),n=0,t.index&&(n=t.index),i=t.previous,r=t.parent,i&&(n=(r=i.parentRow()).rows.indexOf(i)+1),r||(r=this),r.rows.add(e,{at:n}),e._parent=r.rows,t.event&&r.rows.trigger(t.event)},t.prototype.prepCols=function(e,t){var n,r,i;if(null==t&&(t={}),r=t.exclude||[],n=t.add||[],d.isString(r)||d.isString(n))throw new Error("prepCols parameters should be arrays");return(i=d.filter(d.uniq(d.flatten(e)),(function(e){return y.call(r,e)<0}))).concat.apply(i,n)},t.prototype.toSsStructure=function(){var e,t,n,r;for(r in t={},n=this.toCsvJson())e=n[r],t[r]=e.rowObjects;return t},t.prototype.toCsvJson=function(){var e,t,n;return this.finalize(),(t={}).survey=(n=this,function(){var e,t,r,i,o,s,a;for(i=["name","type","label"],o=[],e=function(e){var t,n;for(n in t=e.toJSON())v.call(t,n)&&(t[n],y.call(i,n)<0&&i.push(n));return o.push(t)},n.forEachRow(e,{includeErrors:!0,includeGroupEnds:!0}),t=0,r=(s=n.surveyDetails.models).length;t<r;t++)(a=s[t]).get("value")&&e(a);return{columns:i,rowObjects:o}})(),(e=function(e){return function(){var t,n,r,o,s,a,u,c,p,h,f,_,m;for(p=new i.ChoiceLists,e.forEachRow((function(e){var t;return(t=function(e){var n;if("getList"in e&&(n=e.getList())&&!p.get(n.get("name")))return p.add(n),t(n)})(e)})),m=[],o=[],s=0,u=(f=p.models).length;s<u;s++)for((t=f[s]).get("name")||t.set("name",l.txtid(),{silent:!0}),t.finalize(),r=(n=t.toJSON()).name,a=0,c=(_=n.options).length;a<c;a++)h=_[a],o.push(d.keys(h)),m.push(d.extend({},h,{list_name:r}));return m.length>0&&{columns:e.prepCols(o,{exclude:["setManually"],add:["list_name"]}),rowObjects:m}}}(this)())&&(t.choices=e),t.settings=this.settings.toCsvJson(),t},t.prototype.toMarkdown=function(){return u.csvJsonToMarkdown(this.toCsvJson())},t.prototype.toCSV=function(){var e,t,n,r;for(r in n=h.sheeted(),t=this.toCsvJson())e=t[r],n.sheet(r,h(e));return n.toString()},t}(p.SurveyFragment)).load=function(e,t){var n,r;if(null==t&&(t=!1),d.isString(e)&&!m(e))throw Error("Invalid CSV passed to form builder");return n=s.deserialize(e),r=a.parse(n),new _(r)},_.load.csv=function(e){return _.load(e,!0)},_.load.md=function(e){var t;return t=u.mdSurveyStructureToObject(e),new _(t)},_.loadDict=function(e,t){var n;return n=a.parse(e,t),new _(n)},m=function(e){return y.call(e,"\n")>=0&&y.call(e,",")>=0},f=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return g(t,e),t.prototype.validation={},t.prototype.toCsvJson=function(){return{columns:d.keys(this.attributes),rowObjects:[this.toJSON()]}},t.prototype.enable_auto_name=function(){var e;return this.auto_name=!0,this.on("change:form_id",(e=this,function(){return e.changing_form_title?e.changing_form_title=!1:e.auto_name=!1})),this.on("change:form_title",function(e){return function(t,n){if(e.auto_name)return e.changing_form_title=!0,e.set("form_id",l.sluggifyLabel(n))}}(this))},t}(r.BaseModel),{Survey:_,Settings:f})},86:function(e,t,n){var r,i,o,s,a,u=function(e,t){return function(){return e.apply(t,arguments)}},l=function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},c={}.hasOwnProperty,p=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};o=n(15),n(20),n(64),i=n(124),r=n(39),s=n(1).t,e.exports=((a={}).SkipLogicCriterionBuilderView=function(e){function t(){return this.addCriterion=u(this.addCriterion,this),t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.events={"click .skiplogic__deletecriterion":"deleteCriterion","click .skiplogic__addcriterion":"addCriterion","change .skiplogic__delimselect":"markChangedDelimSelector"},t.prototype.render=function(){return o.uniqueId("skiplogic_expr"),this.$el.html("<p>\n  "+s("This question will only be displayed if the following conditions apply")+'\n</p>\n<div class="skiplogic__criterialist"></div>\n<p class="skiplogic__addnew">\n  <button class="skiplogic__addcriterion">+ '+s("Add another condition")+'</button>\n</p>\n<select class="skiplogic__delimselect">\n  <option value="and">'+s("Question should match all of these criteria")+'</option>\n  <option value="or">'+s("Question should match any of these criteria")+"</option>\n</select>"),this.$(".skiplogic__delimselect").val(this.criterion_delimiter).children("[value="+this.criterion_delimiter+"]").attr("selected","selected"),this},t.prototype.addCriterion=function(e){return this.facade.view_factory.survey.trigger("change"),this.facade.add_empty()},t.prototype.deleteCriterion=function(e){var t,n;return this.facade.view_factory.survey.trigger("change"),n=(t=$(e.target)).data("criterionId"),this.facade.remove(n),t.parent().remove()},t.prototype.markChangedDelimSelector=function(e){return this.criterion_delimiter=e.target.value},t}(i.Base),a.SkipLogicCriterion=function(e){function t(e,n,r,i){this.question_picker_view=e,this.operator_picker_view=n,this.response_value_view=r,this.presenter=i,t.__super__.constructor.call(this)}return l(t,e),t.prototype.tagName="div",t.prototype.className="skiplogic__criterion",t.prototype.render=function(){return this.question_picker_view.render(),this.alreadyRendered||this.$el.append($('<i class="skiplogic__deletecriterion fa fa-trash-o" data-criterion-id="'+this.model.cid+'"></i>')),this.change_operator(this.operator_picker_view),this.change_response(this.response_value_view),this.alreadyRendered=!0,this},t.prototype.mark_question_specified=function(e){return null==e&&(e=!1),this.$el.toggleClass("skiplogic__criterion--unspecified-question",!e)},t.prototype.bind_question_picker=function(){var e,t;e=this.$question_picker.val(),this.mark_question_specified("placeholderVal"!==e),"placeholderVal"!==e&&""!==e&&this.question_picker_view.disable_placeholder_option(),this.$question_picker.on("change",(t=this,function(e){"placeholderVal"===e.val&&console.error("Changing question to placeholderVal should not happen!"),t.model.survey.trigger("change"),t.mark_question_specified("placeholderVal"!==e.val),t.presenter.change_question(e.val)}))},t.prototype.bind_operator_picker=function(){return this.$operator_picker.on("change",(e=this,function(){return e.operator_picker_view.value=e.$operator_picker.select2("val"),e.presenter.change_operator(e.operator_picker_view.value),e.model.survey.trigger("change")}));var e},t.prototype.bind_response_value=function(){return this.response_value_view.bind_event((e=this,function(){return e.presenter.change_response(e.response_value_view.val()),e.model.survey.trigger("change")}));var e},t.prototype.response_value_handler=function(){return this.presenter.change_response(this.response_value_view.val())},t.prototype.change_operator=function(e){return this.operator_picker_view=e,this.operator_picker_view.render(),this.$operator_picker=this.operator_picker_view.$el},t.prototype.change_response=function(e){return this.response_value_view.detach(),this.response_value_view=e,this.response_value_view.render(),this.$response_value=this.response_value_view.$el},t.prototype.attach_operator=function(){return this.operator_picker_view.attach_to(this.$el),this.bind_operator_picker()},t.prototype.attach_response=function(){return this.$(".skiplogic__responseval-wrapper").length>0&&this.$(".skiplogic__responseval-wrapper").remove(),this.response_value_view.attach_to(this.$el),this.bind_response_value()},t.prototype.attach_to=function(e){return this.question_picker_view.attach_to(this.$el),this.$question_picker=this.question_picker_view.$el,this.bind_question_picker(),this.attach_operator(),this.attach_response(),t.__super__.attach_to.apply(this,arguments)},t}(i.Base),a.QuestionPicker=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.tagName="select",t.prototype.className="skiplogic__rowselect",t.prototype.render=function(){return t.__super__.render.call(this),"placeholderVal"!==this.$el.val()&&this.disable_placeholder_option(),this.$el.on("change",this.disable_placeholder_option.bind(this)),this},t.prototype.disable_placeholder_option=function(){var e;"placeholderVal"===(e=this.$el.children(":first")).val()&&e.prop("disabled",!0)},t.prototype.attach_to=function(e){return e.find(".skiplogic__rowselect").remove(),t.__super__.attach_to.call(this,e)},t}(i.DropDown),a.OperatorPicker=function(e){function t(e){this.operators=e,t.__super__.constructor.call(this)}return l(t,e),t.prototype.tagName="div",t.prototype.className="skiplogic__expressionselect",t.prototype.render=function(){return this},t.prototype.attach_to=function(e){var n;return e.find(".skiplogic__expressionselect").remove(),t.__super__.attach_to.call(this,e),this.$el.select2({minimumResultsForSearch:-1,data:(n=this,function(){var e;return e=[],o.each(n.operators,(function(t){return e.push({id:t.id,text:t.label+(1!==t.id?" ("+t.symbol[t.parser_name[0]]+")":"")}),e.push({id:"-"+t.id,text:t.negated_label+(1!==t.id?" ("+t.symbol[t.parser_name[1]]+")":"")})})),e})()}),e.find(".skiplogic__expressionselect.select2-container").show(),this.value?this.val(this.value):this.value=this.$el.select2("val"),this.$el.on("select2-close",function(e){return function(){return e._set_style()}}(this))},t.prototype.val=function(e){return null!=e?(this.$el.select2("val",e),this._set_style(),this.value=e):this.$el.val()},t.prototype._set_style=function(){var e,t,n,r;n=Number(this.$el.val()),this.$el.toggleClass("skiplogic__expressionselect--no-response-value",-1===n||1===n),0!==(t=Math.abs(n))&&(r=o.find(this.operators,(function(e){return e.id===t})),e=n<0?r.abbreviated_negated_label:r.abbreviated_label,this.$el.parents(".skiplogic__criterion").find(".select2-container.skiplogic__expressionselect .select2-chosen").text(e))},t}(i.Base),a.SkipLogicEmptyResponse=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.className="skiplogic__responseval",t.prototype.attach_to=function(e){return e.find(".skiplogic__responseval").remove(),t.__super__.attach_to.call(this,e)},t}(i.EmptyView),a.SkipLogicTextResponse=function(e){function t(e){t.__super__.constructor.call(this,e,"skiplogic__responseval",s("response value"))}return l(t,e),t.prototype.attach_to=function(e){return e.find(".skiplogic__responseval").remove(),t.__super__.attach_to.apply(this,arguments)},t.prototype.bind_event=function(e){return this.$el.on("blur",e)},t}(i.TextBox),a.SkipLogicValidatingTextResponseView=function(e){function t(){return this.val=u(this.val,this),this.clear_invalid_view=u(this.clear_invalid_view,this),this.show_invalid_view=u(this.show_invalid_view,this),t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.render=function(){return t.__super__.render.apply(this,arguments),this.setElement('<div class="skiplogic__responseval-wrapper">'+this.$el+"<div></div></div>"),this.$error_message=this.$("div"),this.model.bind("validated:invalid",this.show_invalid_view),this.model.bind("validated:valid",this.clear_invalid_view),this.$input=this.$el.find("input"),this},t.prototype.show_invalid_view=function(e,t){if(this.$input.val())return this.$el.addClass("textbox--invalid"),this.$error_message.html(t.value),this.$input.focus()},t.prototype.clear_invalid_view=function(e,t){return this.$el.removeClass("textbox--invalid"),this.$error_message.html("")},t.prototype.bind_event=function(e){return this.$input.on("change",e)},t.prototype.val=function(e){return null!=e?this.$input.val(e):this.$input.val()},t}(a.SkipLogicTextResponse),a.SkipLogicDropDownResponse=function(e){function t(e,n){this.responses=e,this.model=n,t.__super__.constructor.call(this,o.map(this.responses.models,(function(e){return{text:e.get("label"),value:e.cid}})))}return l(t,e),t.prototype.tagName="select",t.prototype.className="skiplogic__responseval",t.prototype.attach_to=function(e){return e.find(".skiplogic__responseval").remove(),t.__super__.attach_to.call(this,e),e.find(".skiplogic__responseval.select2-container").show()},t.prototype.bind_event=function(e){return t.__super__.bind_event.call(this,"change",e)},t.prototype.render=function(){var e,n;return t.__super__.render.apply(this,arguments),n=this,e=function(){return n.val(n.model.get("cid"))},this.model.off("change:cid",e),this.model.on("change:cid",e)},t}(i.DropDown),a.SkipLogicViewFactory=function(){function e(e){this.survey=e}return e.prototype.create_question_picker=function(e){var t,n;return t=new i.DropDownModel,(n=function(){var n;(n=o.map(e.selectableRows(),(function(e){return{value:e.cid,text:e.getValue("label")}}))).unshift({value:"placeholderVal",text:s("Select question from list")}),t.set("options",n)})(),this.survey.on("sortablestop",n),new a.QuestionPicker(t)},e.prototype.create_operator_picker=function(e){var t;return t=null!=e?o.filter(r.operator_types,(function(t){var n;return n=t.id,p.call(e.operators,n)>=0})):[],new a.OperatorPicker(t)},e.prototype.create_response_value_view=function(e,t,n){switch(null==e?"empty":null!=n.response_type?n.response_type:t.response_type){case"empty":return new a.SkipLogicEmptyResponse;case"text":return new a.SkipLogicTextResponse;case"dropdown":return new a.SkipLogicDropDownResponse(e.getList().options);case"integer":case"decimal":return new a.SkipLogicTextResponse;default:return null}},e.prototype.create_criterion_view=function(e,t,n,r){return new a.SkipLogicCriterion(e,t,n,r)},e.prototype.create_criterion_builder_view=function(){return new a.SkipLogicCriterionBuilderView},e.prototype.create_textarea=function(e,t){return new i.TextArea(e,t)},e.prototype.create_button=function(e,t){return new i.Button(e,t)},e.prototype.create_textbox=function(e,t,n){return null==t&&(t=""),null==n&&(n=""),new i.TextBox(e,t,n)},e.prototype.create_label=function(e,t){return new i.Label(e,t)},e.prototype.create_empty=function(){return new i.EmptyView},e}(),a)},867:function(e,t,n){var r,i,o;i=n(63).expect,r=n(53),e.exports=(o=function(e){if(!(e instanceof Array))throw new Error("aliases.tests:expectSorted needs an array");return e.sort(),i(e)},describe("$aliases",(function(){return describe("returns correct results from",(function(){return describe("basic queries",(function(){return it("[groups]",(function(){return o(r("group")).toEqual(["begin group","begin_group","end group","end_group"])})),it("[repeats]",(function(){return o(r("repeat")).toEqual(["begin repeat","begin_repeat","end repeat","end_repeat"])}))}))})),describe("custom queries",(function(){return it("[groupsOrRepeats]",(function(){return o(r.q.groupsOrRepeats()).toEqual(["begin group","begin repeat","begin_group","begin_repeat","end group","end repeat","end_group","end_repeat"])})),it("[groupable]",(function(){return o(r.q.groupable()).toEqual(["begin group","begin rank","begin repeat","begin score","begin_group","begin_kobomatrix","begin_rank","begin_repeat","begin_score","end group","end rank","end repeat","end score","end_group","end_kobomatrix","end_rank","end_repeat","end_score"])})),it("[availableSheetNames]",(function(){return o(r.q.requiredSheetNameList()).toEqual(["survey"])})),it("[hidden_types]",(function(){return i(r.q.hiddenTypes()).toContain("imei")})),describe("q.testGroupOrRepeat",(function(){var e;return e=function(e){return i(r.q.testGroupable(e))},it("parses group properly",(function(){return e("begin group").toEqual({type:"group",begin:!0}),e("begin_group").toEqual({type:"group",begin:!0}),e("end group").toEqual({type:"group",begin:!1}),e("end_group").toEqual({type:"group",begin:!1})})),it("parses repeat properly",(function(){return e("begin repeat").toEqual({type:"repeat",begin:!0}),e("begin_repeat").toEqual({type:"repeat",begin:!0}),e("end repeat").toEqual({type:"repeat",begin:!1}),e("end_repeat").toEqual({type:"repeat",begin:!1})}))}))}))})))},868:function(e,t,n){var r,i,o,s;s=n(63).expect,n(12),r=n(85),n(73),o=n(15),i=n(285),window._=o,e.exports=describe("model.choices",(function(){return beforeEach((function(){return this.survey=r.Survey.load({survey:[{type:"select_one yes_no",name:"yes_or_no",label:"Yes or no?"}],choices:[{"list name":"yes_no",name:"yes",label:"Yes"},{"list name":"yes_no",name:"no",label:"No"}]}),this.choices=this.survey.choices,this.yesno=this.choices.get("yes_no")})),it("has options in list",(function(){return s(this.yesno.options.length).toBe(2)})),it("can add option to a choice list",(function(){return this.yesno.options.add({name:"maybe",label:"Maybe"}),s(this.yesno.options.length).toBe(3)})),it("can remove option from a choice list",(function(){var e;return e=this.yesno.options.find((function(e){return"yes"===e.get("name")})),s(e).toBeDefined(),s(this.yesno.options.length).toBe(2),this.yesno.options.remove(e),s(this.yesno.options.length).toBe(1)})),it("exports choice list properly",(function(){return s(this.choices.toJSON()).toEqual([{name:"yes_no",options:[{name:"yes",label:"Yes"},{name:"no",label:"No"}]}])})),describe("model.choices--CASCADES",(function(){return it("cascade choice list utility methods work",(function(){var e,t,n;return n=r.Survey.load(i.cascading),s(n.choices.models.map((function(e){return e.get("name")}))).toEqual(["state","county","city"]),s(n.choices.models.map((function(e){return e._get_last_linked_choice_list().get("name")}))).toEqual(["city","city","city"]),s(n.choices.models.map((function(e){return e._get_first_linked_choice_list().get("name")}))).toEqual(["state","state","state"]),e=n.choices.get("city"),s(e.get("name")).toBe("city"),s(e._has_corresponding_row()).toEqual(!1),t=e._create_corresponding_row_data({_full_path_choice_filter:!0}),s(t).toEqual([{label:"state",type:"select_one state",choice_filter:""},{label:"county",type:"select_one county",choice_filter:"state=${state}"},{label:"city",type:"select_one city",choice_filter:"state=${state} and county=${county}"}]),t=e._create_corresponding_row_data({_full_path_choice_filter:!1}),s(t).toEqual([{label:"state",type:"select_one state",choice_filter:""},{label:"county",type:"select_one county",choice_filter:"state=${state}"},{label:"city",type:"select_one city",choice_filter:"county=${county}"}])})),it("imports a survey with a cascading choice list",(function(){var e,t,n,o,a,u,l,c,p,d;for(e=(d=r.Survey.load(i.cascading)).choices.get("city"),n=0,a=(l=d.choices.models).length;n<a;n++)t=l[n],s(t._has_corresponding_row()).toEqual(!1);for(e.create_corresponding_rows(),o=0,u=(c=d.choices.models).length;o<u;o++)t=c[o],s(t._has_corresponding_row()).toEqual(!0);return d.rows.at(0),p=d.rows.at(2),s(d.toCsvJson().choices.rowObjects.map((function(e){return e.list_name+"-"+e.name})).sort()).toEqual(["city-brownsville","city-dumont","city-finney","city-harlingen","city-puyallup","city-redmond","city-seattle","city-tacoma","county-cameron","county-king","county-king","county-pierce","state-texas","state-washington"]),s(d.toCsvJson().survey.rowObjects.map((function(e){return e.type+"-"+e.name}))).toEqual(["select_one state-state","select_one county-county","select_one city-city","start-start","end-end"]),s(p.getList().get("name")).toBe("city"),s(p.getList().getList).toBeDefined(),s(p.getList().getList()).not.toBe(null),s(p.getList().getList().get("name")).toBe("county"),s(p.getList().getList().getList().get("name")).toBe("state")}))})),describe("Choicelist",(function(){return describe("Clone method",(function(){return it("Clones itself and all of its options",(function(){var e;return(e=this.yesno.clone()).getSurvey(),s(e.options.length).toBe(2),s(e.options.at(0).get("name")).toBe("yes"),s(e.options.at(1).get("name")).toBe("no"),s(e.cid).not.toEqual(this.yesno.cid),s(e.get("name")).not.toBe(this.yesno.get("name"))}))}))}))}))},869:function(e,t,n){var r,i,o,s,a;o=n(63).expect,i=n(74),s='"type","constraint"\n"text","regex(., \'^\\S+( \\S+){4}$\' )"',describe("csv parsing",(function(){return beforeEach((function(){return window._csv=i,this.compile=function(e){return i(e).toObjects()[0]}})),it("equals",(function(){return o((function(){return i('"regex_sheet"\r\n"","col1","regexcol"\r\n"","row1","regex( \\s+ )"\r\n"regex_sheet2"\r\n"","s2col1","example2"\r\n"","s2row1","\\s\\d\\w\\S\\D\\W"\r\n')})).not.toThrow()})),it("handles simple csvs",(function(){var e;return e=this.compile("a,b,c,d\ne,f,g,h"),o(e.a).toBe("e"),o(e.b).toBe("f"),o(e.c).toBe("g"),o(e.d).toBe("h")})),it("handles csvs with quotes",(function(){var e;return e=this.compile('"a","b","c","d"\n"e","f","g","h"'),o(e.a).toBe("e"),o(e.b).toBe("f"),o(e.c).toBe("g"),o(e.d).toBe("h")})),it("imports cells with escape characters",(function(){var e;return e=this.compile(s),o(e.type).toBe("text"),o(e.constraint).toBe("regex(., '^\\S+( \\S+){4}$' )")})),it("reexports cells with escape characters",(function(){var e,t;return e=i(s).toObjects(),t=i(e).toString(),o(t).toEqual(s)}))})),r=n(125),a=r.deserialize,describe("$inputDeserializer",(function(){return beforeEach((function(){return this.sampleSurveyObj={survey:[{key1:"val1",key2:"val2",key3:"val3"}],choices:[{k4:"v4",k5:"v5"}]}})),describe(". deserialize parses csv, json, and object",(function(){return it("has deserialize method defined",(function(){return o(a).toBeDefined()})),it("parses a js object",(function(){return o(a(this.sampleSurveyObj)).toEqual(this.sampleSurveyObj)}))})),describe(".validateParse notifies validity",(function(){return beforeEach((function(){return this.validate=function(e,t,n){var i,s;if(null==t&&(t=!0),null==n&&(n=!1),i={},s=r.validateParse(e,i),o(i).toBeDefined(),o(s).toBe(t),n)return o(i.error).toEqual(n)}})),it("with just survey sheet",(function(){return this.validate({survey:[]})})),describe("but does not accept non-object parameters",(function(){return it("[string]",(function(){return this.validate("cant be a string",!1)})),it("[array]",(function(){return this.validate(["cant be an array"],!1)}))}))})),describe("deserializes and records errors",(function(){return it("when input is missing survey sheet",(function(){var e,t;return t={notSurvey:this.sampleSurveyObj.survey,choices:this.sampleSurveyObj.choices},r(t,e={validate:!0}),o(e.error).toBeDefined(),o(e.error).toContain("survey sheet")}))}))}))},87:function(e,t,n){var r,i,o=function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},s={}.hasOwnProperty;r=n(43),e.exports=(i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.idAttribute="name",t.prototype.toJSON=function(){var e,t;return!!this.get("value")&&((e={}).name=this.get("name"),e.type=e.name,(t=this.get("parameters"))&&(e.parameters=t),e)},t}(r.BaseModel),{SurveyDetails:function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.model=i,t.prototype.loadSchema=function(e){var t,n,r,o;for(t=0,r=(o=e.models).length;t<r;t++)n=o[t],this.add(new i(n._forSurvey()));return this._schema=e,this.add=this.loadSchema=function(){throw new Error("New survey details must be added to the schema")},this},t.prototype.importDefaults=function(){var e,t,n,r;for(e=0,n=(r=this._schema.models).length;e<n;e++)t=r[e],this.get(t.get("name")).set("value",t.get("default"))},t.prototype.importDetail=function(e){var t;if(!(t=this.get(e.type)))throw new Error("SurveyDetail `"+key+"` not loaded from schema. [Aliases have not been implemented]");e.parameters&&t.set("parameters",e.parameters),t.set("value",!0)},t}(r.BaseCollection),SurveyDetail:i})},870:function(e,t,n){var r,i,o;i=n(63).expect,r=n(125),n(285),o=r.deserialize,describe("$inputDeserializer",(function(){return beforeEach((function(){return this.sampleSurveyObj={survey:[{key1:"val1",key2:"val2",key3:"val3"}],choices:[{k4:"v4",k5:"v5"}]}})),describe(". deserialize parses csv, json, and object",(function(){return it("has deserialize method defined",(function(){return i(o).toBeDefined()})),it("parses a js object",(function(){return i(o(this.sampleSurveyObj)).toEqual(this.sampleSurveyObj)}))})),describe(".validateParse notifies validity",(function(){return beforeEach((function(){return this.validate=function(e,t,n){var o,s;if(null==t&&(t=!0),null==n&&(n=!1),o={},s=r.validateParse(e,o),i(o).toBeDefined(),i(s).toBe(t),n)return i(o.error).toEqual(n)}})),it("with just survey sheet",(function(){return this.validate({survey:[]})})),describe("but does not accept non-object parameters",(function(){return it("[string]",(function(){return this.validate("cant be a string",!1)})),it("[array]",(function(){return this.validate(["cant be an array"],!1)}))}))})),describe("deserializes and records errors",(function(){return it("when input is missing survey sheet",(function(){var e,t;return t={notSurvey:this.sampleSurveyObj.survey,choices:this.sampleSurveyObj.choices},r(t,e={validate:!0}),i(e.error).toBeDefined(),i(e.error).toContain("survey sheet")}))}))}))},871:function(e,t,n){var r,i,o,s;s=n(63).expect,o=n(15),n(53),i=n(85),r=n(35),n(285),describe("rank.tests",(function(){return describe("survey imports ranks >",(function(){return beforeEach((function(){return this.survey=i.Survey.load({survey:[["type","name","label","kobo--rank-items"],{type:"begin_rank",name:"koborank",label:"Label","kobo--rank-items":"needs"},["rank__level","rnk1","Rank Level 1"],["rank__level","rnk2","Rank Level 2"],{type:"end_rank"}],choices:[["list name","name","label"],["needs","food","Food"],["needs","water","Water"],["needs","shelter","Shelter"]]})})),it("can import a simple rank group",(function(){var e;return e=this.survey.rows.at(0),s(e.get("kobo--rank-items").get("value")).toBeDefined(),s(e.get("$kuid").get("value")).toBeDefined(),s(e).toBeDefined(),s(e._rankRows.length).toBe(2),e._rankRows.forEach((function(e){return s(e.get("$kuid")).toBeDefined()})),s(e._rankLevels.options.length).toBe(3)})),describe("clone a rank group",(function(){return beforeEach((function(){return this.rankRow=this.survey.rows.at(0),s(this.rankRow.get("$kuid").get("value")).toBeDefined(),s(this.rankRow.get("kobo--rank-items").get("value")).toBeDefined(),this.clonedRow=this.rankRow.clone(),this.survey._insertRowInPlace(this.clonedRow,{previous:this.rankRow})})),it("has the correct structure",(function(){var e;return s(this.survey.rows.length).toBe(2),s(this.survey.choices.length).toBe(2),e=0,this.survey.forEachRow((function(t){return e++})),s(e).toBe(6)})),it("exports to csv",(function(){var e,t,n,r,i,a;return r=(a=(n=this.survey.toCsvJson()).survey.rowObjects)[0],a[1],a[2],i=a[3],e=a[4],a[5],a[6],t=a[7],s(r.label).toEqual(e.label),s(r.$kuid).toBeDefined(),s(r.type).toEqual("begin_rank"),s(r["kobo--rank-items"]).not.toEqual(e["kobo--rank-items"]),s(i.type).toEqual("end_rank"),s(t.type).toEqual("end_rank"),s(i.$kuid).toEqual("/"+r.$kuid),s(t.$kuid).toEqual("/"+e.$kuid),s(o.pluck(n.choices.rowObjects,"name")).toEqual(["food","water","shelter","food","water","shelter"])})),it("exports to json",(function(){var e,t,n,r,i,a;return r=(a=(n=this.survey.toJSON()).survey)[0],a[1],a[2],i=a[3],e=a[4],a[5],a[6],t=a[7],s(r.label).toEqual(e.label),s(r.$kuid).toBeDefined(),s(r["kobo--rank-items"]).not.toEqual(e["kobo--rank-items"]),s(i.type).toEqual("end_rank"),s(t.type).toEqual("end_rank"),s(i.$kuid).toBeDefined(),s(t.$kuid).toBeDefined(),s(o.chain(n.choices).values().flatten().pluck("name").value()).toEqual(["food","water","shelter","food","water","shelter"])}))}))}))})),describe("score.tests",(function(){return describe("survey imports scores >",(function(){return beforeEach((function(){return this.survey=i.Survey.load({survey:[["type","name","label","kobo--score-choices"],{type:"begin score",name:"koboskore",label:"Label","kobo--score-choices":"koboskorechoices"},["score__row","skore_1","Score 1"],["score__row","skore_2","Score 2"],{type:"end score"}],choices:[["list_name","name","label"],["koboskorechoices","ok","Okay"],["koboskorechoices","not_ok","Not okay"]]})})),it("can import a simple score group",(function(){var e;return e=this.survey.rows.at(0),s(e.get("kobo--score-choices").get("value")).toBeDefined(),s(e).toBeDefined()})),it("scores can be exported",(function(){var e;return e=this.survey.toJSON(),s(e.survey.length).toBe(4),s(e.survey[0].type).toBe("begin_score"),s(e.choices).toBeDefined(),s(e.choices.koboskorechoices).toEqual([{name:"ok",label:"Okay"},{name:"not_ok",label:"Not okay"}])}))}))})),describe("group.tests",(function(){var e,t;return e=function(e){return o.first(e.rows.filter((function(e,t){return"Group"===e.constructor.name})))},t=function(e){return o.last(e.rows.filter((function(e,t){return"Group"===e.constructor.name})))},describe("survey imports groups >",(function(){return beforeEach((function(){return this.survey=i.Survey.load({survey:[["type","name","label"],["begin group","grp1","Group1"],["text","g1q1","Group1Question1"],["end group"]]})})),it("can import a simple group",(function(){var t;return t=e(this.survey),s(t).toBeDefined(),s(t.rows.length).toBe(1)})),it("can add a group to the survey",(function(){return this.survey.addRow({type:"group",name:"grp2"}),s(this.survey.rows.length).toBe(2),s(t(this.survey).rows.length).toBe(0)})),it("leaves empty group labels intact",(function(){var t,n;return n=i.Survey.load({survey:[["type","name","label"],["begin group","grp1",null],["text","g1q1","Group1Question1"],["end group"]]}),t=e(n),s(t.getValue("label")).toBe("")})),describe("groups can be exported >",(function(){return it("works with a simple group",(function(){return s(this.survey.toCSV().split("\n").length).toBe(8)})),it("works with a nested group",(function(){var e;return e=i.Survey.load({survey:[["type","name","label"],["begin group","grp1","Group1"],["text","g1q1","Grp2Question1"],["begin group","g1g2","Group1Question1"],["text","g1g2q1","Grp2Question1"],["end group"],["end group"]]}),s(e.toCSV().split("\n").length).toBe(11)}))}))})),it("can import repeats",(function(){var e;return e=i.Survey.load({survey:[["type","name","label"],["begin repeat","grp1","Group1"],["text","g1q1","Group1Question1"],["end repeat"]]}).rows.first(),s(e).toBeDefined(),s(e.constructor.name).toBe("Group"),s(e._isRepeat()).toBeTruthy()})),describe("fails on unmatched group types",(function(){return function(e,t){return s((function(){return i.Survey.load(t)})).toThrow()}})),describe("group creation",(function(){return beforeEach((function(){return this.survey=i.Survey.load({survey:[["type","name","label"],["text","q1","Q1"],["text","q2","Q2"],["text","q3","Q3"],["text","q4","Q4"],["text","q5","Q5"]]})})),describe("group naming",(function(){return beforeEach((function(){var e;return this.getNames=function(e){var t;return t=[],e.forEachRow((function(e){var n,r;return n=(null!=(r=e.get("name"))?r.get("value"):void 0)||"noname",t.push(n)}),{includeGroups:!0}),t},s(this.survey._allRows().length).toBe(5),this.rows=function(){var t,n,r,i;for(i=[],t=0,n=(r=[0,2,4]).length;t<n;t++)e=r[t],i.push(this.survey.rows.at(e));return i}.call(this)})),it("uses opts.label when not undefined",(function(){return this.survey._addGroup({label:"My Group",__rows:this.rows}),s(e(this.survey).getValue("label")).toBe("My Group")})),it("uses default label when no label is passed",(function(){return this.survey._addGroup({__rows:this.rows}),s(e(this.survey).getValue("label")).toBe(r.newGroupDetails.label.value)}))})),describe("can create group with existing rows",(function(){return beforeEach((function(){var e,t;return this.getNames=function(e){var t;return t=[],e.forEachRow((function(e){var n,r;return n=(null!=(r=e.get("name"))?r.get("value"):void 0)||"noname",t.push(n)}),{includeGroups:!0}),t},s(this.survey._allRows().length).toBe(5),t=function(){var t,n,r,i;for(i=[],t=0,n=(r=[0,2,4]).length;t<n;t++)e=r[t],i.push(this.survey.rows.at(e));return i}.call(this),this.survey._addGroup({label:"My Group",__rows:t})})),it("and has the right number of rows",(function(){return s(this.survey._allRows().length).toBe(5)})),it("has the right order of names",(function(){var e;return this.survey.finalize(),(e=this.getNames(this.survey))[0]="group_xxxxxxx",s(e).toEqual(["group_xxxxxxx","q1","q3","q5","q2","q4"])})),describe("can generate missing names on finalize",(function(){return beforeEach((function(){return this.grp=e(this.survey)})),it("and has a finalize method",(function(){return s(this.grp.finalize).toBeDefined()})),it("has the correct name",(function(){var e;return this.survey.finalize(),(e=this.getNames(this.survey))[0]="group_xxxxxxx",s(e).toEqual(["group_xxxxxxx","q1","q3","q5","q2","q4"])}))}))}))})),describe("group manipulation",(function(){return beforeEach((function(){return this.survey=i.Survey.load({survey:[["type","name","label"],["text","q1","Q1"],["begin group","grp1","Group1"],["text","g1q1","Group1Question1"],["end group"],["text","q2","Q2"]]}),this.g1=e(this.survey),this.getNames=function(e){var t;return t=[],e.forEachRow((function(e){var n,r;return n=(null!=(r=e.get("name"))?r.get("value"):void 0)||"noname",t.push(n)}),{includeGroups:!0}),t}})),it("group can be deleted",(function(){var t;return t=e(this.survey),s(this.survey._allRows().length).toBe(3),this.survey.remove(t),s(this.survey._allRows().length).toBe(2)})),it("group can be detached from parent",(function(){return s(this.getNames(this.survey)).toEqual(["q1","grp1","g1q1","q2"]),this.g1.detach(),s(this.getNames(this.survey)).toEqual(["q1","q2"])})),it("group can be split apart",(function(){return s(this.getNames(this.survey)).toEqual(["q1","grp1","g1q1","q2"]),this.g1.splitApart(),s(this.getNames(this.survey)).toEqual(["q1","g1q1","q2"])})),describe("nested group can be split apart",(function(){return beforeEach((function(){return this.survey=i.Survey.load({survey:[["type","name","label"],["begin group","grp1","Group1"],["begin group","grp2","Group1"],["text","q1","Q1"],["end group"],["end group"],["text","q2","Q2"]]}),this.g1=e(this.survey),this.g2=this.g1.rows.at(0)})),it("is set up",(function(){return s(this.g2.constructor.key).toEqual("group"),s(this.getNames(this.survey)).toEqual(["grp1","grp2","q1","q2"])})),it("can break apart outer group",(function(){return this.g1.splitApart(),s(this.getNames(this.survey)).toEqual(["grp2","q1","q2"])})),it("can break apart outer group",(function(){return this.g2.splitApart(),s(this.getNames(this.survey)).toEqual(["grp1","q1","q2"])}))}))}))})),describe("kuids",(function(){var e;return e={group:function(){return{survey:[["type","name","label","$kuid"],{type:"begin_group",name:"grp",label:"Group",$kuid:"abc"},["note","n1","Note 1","def"],{type:"end_group",$kuid:"/abc (never parsed)"}]}},rank:function(){return{survey:[["type","name","label","$kuid"],{type:"begin_rank",name:"koborank",label:"Label","kobo--rank-items":"needs",$kuid:"abc"},["rank__level","rnk1","Rank Level 1","def"],["rank__level","rnk2","Rank Level 2","ghi"],{type:"end_rank",$kuid:"/abc (never parsed)"}],choices:[["list_name","name","label","$kuid"],["needs","food","Food","mno"],["needs","water","Water","pqr"],["needs","shelter","Shelter","stu"]]}},score:function(){return{survey:[["type","name","label","$kuid"],{type:"begin_score",name:"koboscore",label:"Label","kobo--score-choices":"scores",$kuid:"abcd"},["score__row","sc1","Rank Level 1","efgh"],{type:"end_score",$kuid:"/abcd (never parsed)"}],choices:[["list_name","name","label","$kuid"],["scores","bad","Bad","mnop"],["scores","ok","Ok","qrst"],["scores","good","Good","uvwx"]]}}},describe("passed to export",(function(){return it("for group",(function(){var t,n,r,o;return t=(o=i.Survey.load(e.group()).toFlatJSON().survey)[0],n=o[1],r=o[2],s(t.$kuid).toEqual("abc"),s(n.$kuid).toEqual("def"),s(r.$kuid).toEqual("/abc")})),it("for rank survey",(function(){var t,n,r,o,a,u,l,c,p;return p=i.Survey.load(e.rank()),r=(l=(n=p.toFlatJSON()).survey)[0],o=l[1],a=l[2],u=l[3],s(r.$kuid).toEqual("abc"),s(o.$kuid).toEqual("def"),s(a.$kuid).toEqual("ghi"),s(u.$kuid).toEqual("/abc"),(c=n.choices)[0],c[1],c[2],c[3],s(function(){var e,r,i,o;for(o=[],e=0,r=(i=n.choices).length;e<r;e++)t=i[e],o.push(t.$kuid);return o}()).toEqual(["mno","pqr","stu"])})),it("for score survey",(function(){var t,n,r,o,a,u,l,c;return c=i.Survey.load(e.score()),r=(u=(n=c.toFlatJSON()).survey)[0],o=u[1],a=u[2],u[3],s(r.$kuid).toEqual("abcd"),s(o.$kuid).toEqual("efgh"),s(a.$kuid).toEqual("/abcd"),(l=n.choices)[0],l[1],l[2],s(function(){var e,r,i,o;for(o=[],e=0,r=(i=n.choices).length;e<r;e++)t=i[e],o.push(t.$kuid);return o}()).toEqual(["mnop","qrst","uvwx"])}))})),describe("preserved from import",(function(){return it("for group",(function(){var t;return t=i.Survey.load(e.group()).rows.at(0),s(t.isGroup()).toBeTruthy(),s(t.getValue("$kuid")).toEqual("abc"),s(t.rows.at(0).getValue("$kuid")).toEqual("def")})),it("for rank survey",(function(){var t,n,r;return n=(t=i.Survey.load(e.rank()).rows.at(0))._rankRows.at(0),r=t._rankRows.at(1),s(t.getValue("$kuid")).toBe("abc"),s(n.attributes.$kuid).toBe("def"),s(r.attributes.$kuid).toBe("ghi")})),it("for score survey",(function(){var t,n,r,o,a,u,l;return o=(l=i.Survey.load(e.score())).rows.at(0),s(o.getValue("$kuid")).toBe("abcd"),a=o._scoreRows.at(0),s(a.attributes.$kuid).toBe("efgh"),t=(u=l.choices.at(0).options.models)[0],n=u[1],r=u[2],s(t.getValue("$kuid")).toEqual("mnop"),s(n.getValue("$kuid")).toEqual("qrst"),s(r.getValue("$kuid")).toEqual("uvwx")}))}))}))},872:function(e,t,n){var r,i,o,s;s=n(63).expect,i=n(126),r=n(73),o=n(285),describe('" $inputParser',(function(){return beforeEach((function(){return this.sampleSurveyObj={survey:[{key1:"val1",key2:"val2",key3:"val3"}],choices:[{k4:"v4",k5:"v5"}]}})),describe('. loadChoiceLists()"',(function(){var e;return e=new r.ChoiceList,i.loadChoiceLists(o.pizza_survey.main().choices,e)})),describe('. parse()"',(function(){return describe(" translated surveys",(function(){return it("flattens translated lists 1",(function(){var e;return e=i.parseArr("survey",[{type:"text",name:"q1",label:["q1x","q1null"]},{type:"text",name:"q2",label:["q2x","q2null"]}],["lx",null]),s(e).toEqual([{type:"text",name:"q1","label::lx":"q1x",label:"q1null"},{type:"text",name:"q2","label::lx":"q2x",label:"q2null"}])})),it("flattens translated lists 2",(function(){var e,t,n,r,o,a,u,l;for(l=["lx","ly"],a=i.parseArr("survey",[{type:"text",name:"q1",label:["q1x","q1y"]},{type:"text",name:"q2",label:["q2x","q2y"]}],l),e=[{type:"text",name:"q1","label::lx":"q1x","label::ly":"q1y"},{type:"text",name:"q2","label::lx":"q2x","label::ly":"q2y"}],u=[],n=0,r=(o=[0,1]).length;n<r;n++)t=o[n],u.push(s(a[t]).toEqual(e[t]));return u}))})),it("parses group hierarchy",(function(){var e;return e=i.parseArr("survey",[{type:"begin group",name:"grp1"},{type:"text",name:"q1"},{type:"end group"}]),s(e).toEqual([{type:"group",name:"grp1",__rows:[{type:"text",name:"q1"}]}])})),it("parses scoring questions",(function(){var e;return e=i.parseArr("survey",[{type:"begin score",name:"koboskore",label:"Label"},{type:"end score"}]),s(e).toEqual([{type:"score",name:"koboskore",label:"Label",__rows:[]}])})),it("parses nested groups hierarchy",(function(){var e;return e=i.parseArr("survey",[{type:"begin group",name:"grp1",$kuid:"aaa"},{type:"begin group",name:"grp2",$kuid:"bbb"},{type:"text",name:"q1",$kuid:"ccc"},{type:"text",name:"q2",$kuid:"ddd"},{type:"end group",$kuid:"eee"},{type:"end group",$kuid:"fff"}]),s(e).toEqual([{type:"group",name:"grp1",$kuid:"aaa",__rows:[{type:"group",name:"grp2",$kuid:"bbb",__rows:[{type:"text",name:"q1",$kuid:"ccc"},{type:"text",name:"q2",$kuid:"ddd"}]}]}])})),it("parses non-grouped list of questions",(function(){var e;return e=i.parseArr("survey",[{type:"text",name:"q1"},{type:"text",name:"q2"}]),s(e).toEqual([{type:"text",name:"q1"},{type:"text",name:"q2"}])}))}))}))},873:function(e,t,n){var r,i,o;o=n(63).expect,r=n(126),i=n(85),describe("translations",(function(){var e;return e=function(e){var t;return t=r.parse(e),new i.Survey(t)},it("should not allow editing form with unnamed translation",(function(){return o((function(){return e({survey:[{type:"text",label:["Ciasto?","Pizza?"],name:"Pizza survey"}],translations:["polski (pl)",null]})})).toThrow('There is an unnamed translation in your form definition.\nPlease give a name to all translations in your form.\nUse "Manage Translations" option from form landing page.')}))}))},874:function(e,t,n){var r,i,o,s,a,u,l;u=n(63).expect,a=n(15),r=n(265),l=function(e){return beforeEach((function(){var t;return this.pizzaSurvey=e.Survey.load(s),this.createSurveyCsv=function(e,t){var n;return null==e&&(e=[]),null==t&&(t=[]),n=0===t.length?"":"choices,,,\n,list name,name,label\n,"+t.join("\n,"),"survey,,,\n,type,name,label,hint\n,"+e.join("\n,")+"\n"+n},this.createSurvey=(t=this,function(n,r){return null==n&&(n=[]),null==r&&(r=[]),e.Survey.load(t.createSurveyCsv(n,r))}),this.firstRow=function(e){return e.rows.at(0)},this.compareCsvs=function(e,t){var n,r,i,o,s,l;for(s=e.split("\n"),l=t.split("\n"),n=0,r=(o=a.min([s.length,l.length])).length;n<r;n++)i=o[n],u(s[i]).toBe(l[i]);return u(e).toBe(t)},this.dumpAndLoad=function(t){return function(n){var r,i;return r=e.Survey.load(n).toCSV(),i=e.Survey.load(r).toCSV(),t.compareCsvs(r,i)}}(this)})),it("creates xlform",(function(){var t;return t=new e.Survey({name:"Sample"}),u(t).toBeDefined(),u(t instanceof e.Survey).toBe(!0),u(t.get("name")).toBe("Sample")})),it("ensures every node has access to the parent survey",(function(){return this.pizzaSurvey.getSurvey})),it("can append a survey to another",(function(){var e;return e=this.createSurvey(["text,q1,Question1,q1hint","text,q2,Question2,q2hint"]),u(e.rows.length).toBe(2),u(this.pizzaSurvey.rows.length).toBe(1),e.insertSurvey(this.pizzaSurvey),u(e.rows.length).toBe(3),u(e.rows.at(2).getValue("name")).toBe("likes_pizza")})),it("can import from csv_repr",(function(){var e;return u(this.pizzaSurvey.rows.length).toBe(1),e=this.pizzaSurvey.rows.at(0),u(e.getValue("name")).toEqual("likes_pizza")})),describe("with simple survey",(function(){return beforeEach((function(){return this.firstRow=this.pizzaSurvey.rows.at(0)})),describe("lists",(function(){return it("iterates over every row",(function(){return u(this.pizzaSurvey.rows).toBeDefined(),u(this.firstRow).toBeDefined()})),it("can add a list as an object",(function(){var e,t;return u(this.pizzaSurvey.choices.length).toBe(1),this.pizzaSurvey.choices.add(o.gender),u(this.pizzaSurvey.choices.length).toBe(2),e=this.pizzaSurvey.toCsvJson(),this.pizzaSurvey.choices.add(o.yes_no),u(this.pizzaSurvey.choices.length).toBe(2),t=this.pizzaSurvey.toCsvJson(),u(e).toEqual(t)})),it("can add row to a specific index",(function(){var e,t;return u(this.pizzaSurvey.addRowAtIndex).toBeDefined(),t=this.pizzaSurvey.rows.length,u(this.pizzaSurvey.rows.length).toBe(1),this.pizzaSurvey.addRowAtIndex({name:"lastrow",label:"last row",type:"text"},t),u(this.pizzaSurvey.rows.length).toBe(2),u(this.pizzaSurvey.rows.last().get("label").get("value")).toBe("last row"),this.pizzaSurvey.addRowAtIndex({name:"firstrow",label:"first row",type:"note"},0),u(this.pizzaSurvey.rows.length).toBe(3),u(this.pizzaSurvey.rows.first().get("label").get("value")).toBe("first row"),this.pizzaSurvey.addRowAtIndex({name:"secondrow",label:"second row",type:"note"},1),u(this.pizzaSurvey.rows.length).toBe(4),u(this.pizzaSurvey.rows.at(1).get("label").get("value")).toBe("second row"),e=a.map(this.pizzaSurvey.rows.pluck("label"),(function(e){return e.get("value")})),u(e).toEqual(["first row","second row","Do you like pizza?","last row"])}))})),it("row types changing is trackable",(function(){var e,t;return u(this.firstRow.getValue("type")).toBe("select_one yes_no"),t=this.firstRow.get("type"),u(t.get("typeId")).toBe("select_one"),u(t.get("list").get("name")).toBe("yes_no"),e=this.firstRow.getList(),u(e).toBeDefined(),u(e.get("name")).toBe("yes_no")}))})),describe("with custom surveys",(function(){return beforeEach((function(){var t;return this.createSurveyCsv=function(e,t){var n;return null==e&&(e=[]),null==t&&(t=[]),n=0===t.length?"":"choices,,,\n,list name,name,label\n,"+t.join("\n,"),"survey,,,\n,type,name,label,hint\n,"+e.join("\n,")+"\n"+n},this.createSurvey=(t=this,function(n,r){return null==n&&(n=[]),null==r&&(r=[]),e.Survey.load(t.createSurveyCsv(n,r))}),this.firstRow=function(e){return e.rows.at(0)},this.compareCsvs=function(e,t){var n,r,i,o,s,l;for(s=e.split("\n"),l=t.split("\n"),n=0,r=(o=a.min([s.length,l.length])).length;n<r;n++)i=o[n],u(s[i]).toBe(l[i]);return u(e).toBe(t)},this.dumpAndLoad=function(t){return function(n){var r,i;return r=e.Survey.load(n).toCSV(),i=e.Survey.load(r).toCSV(),t.compareCsvs(r,i)}}(this)})),it("breaks with an unk qtype",(function(){})),it("exports and imports without breaking",(function(){})),it("reflects correct required value",(function(){var t;return u((t=function(t){return e.Survey.loadDict({survey:[{type:"text",name:"nm",required:t}]}).toFlatJSON().survey[0].required})("true")).toEqual("true"),u(t("TRUE")).toEqual("true"),u(t("yes")).toEqual("true"),u(t("YES")).toEqual("true"),u(t(!0)).toEqual("true"),u(t("false")).toEqual("false"),u(t("FALSE")).toEqual("false"),u(t("NO")).toEqual("false"),u(t("no")).toEqual("false"),u(t(!1)).toEqual("false"),u(t(void 0)).toEqual("false"),u(t("")).toEqual("false")})),it("captures required values",(function(){var t;return t=e.Survey.loadDict({survey:[{type:"text",name:"q1",required:!0},{type:"text",name:"q2",required:!1}]}).toJSON(),u(t.survey[0].required).toEqual("true"),u(t.survey[1].required).toEqual("false")})),it("tries a few question types",(function(){var e,t;e=(t=this.createSurvey(["text,text,text,text"]).rows.at(0)).get("type"),u(e.get("rowType").name).toBe("text"),e=(t=this.createSurvey(['"select_multiple x",a,a,a'],["x,ax,ax","x,bx,bx,","y,ay,ay","y,by,by"]).rows.at(0)).get("type"),u(e.get("typeId")).toBe("select_multiple"),u(e.get("list").get("name")).toBe("x"),u(t.getList().get("name")).toBe("x"),e.set("value","select_multiple y"),u(e.get("typeId")).toBe("select_multiple"),u(e.get("list").get("name")).toBe("y"),u(t.toJSON().type).toBe("select_multiple y"),u(t.getList().get("name")).toBe("y"),t.get("type").set("value","text"),u(t.get("type").get("value")).toBe("text"),u(t.get("type").get("list").get("name")).toBeDefined(),u(t.getList().get("name")).toBeDefined(),u(t.toJSON().type).toBe("text")}))})),describe("groups",(function(){return it("cannot add a group by adding a row type=group",(function(){var t;return this.pizzaSurvey.addRow({type:"text",name:"pizza",hint:"pizza",label:"pizza"}),u(this.pizzaSurvey.rows.last()instanceof e.Row).toBe(!0),u(this.pizzaSurvey.rows.length).toBe(2),this.pizzaSurvey.addRow({type:"group",name:"group"}),u(this.pizzaSurvey.rows.length).toBe(3),t=this.pizzaSurvey.rows.last(),u(t instanceof e.BaseRow).toBe(!0)})),it("exports group to json",(function(){var t,n,r,i,o;for(this.pizzaSurvey.addRow({type:"text",name:"pizza",hint:"pizza",label:"pizza"}),u(this.pizzaSurvey.rows.last()instanceof e.Row).toBe(!0),u(this.pizzaSurvey.rows.length).toBe(2),this.pizzaSurvey.addRow({type:"group",name:"group"}),u(this.pizzaSurvey.rows.length).toBe(3),this.pizzaSurvey.rows.last(),i=[],t=0,r=(o=this.pizzaSurvey.toFlatJSON().survey.map((function(e){return e.$kuid}))).length;t<r;t++)n=o[t],i.push(u(n).toBeDefined());return i}))})),describe("automatic naming",(function(){return it("can import questions without names",(function(){var e,t;return t=this.createSurvey(['text,,"Label with no name"']),u(null!=(e=t.rows.at(0))?e.get("name").getValue():void 0).not.toBeTruthy()})),it("can finalize survey and generate names",(function(){var e,t,n;return n=this.createSurvey(['text,,"Label with no name"']),u(null!=(e=n.rows.at(0))?e.get("name").getValue():void 0).not.toBeTruthy(),n.rows.at(0).finalize(),u(null!=(t=n.rows.at(0))?t.get("name").getValue():void 0).toBe("Label_with_no_name")})),it("increments names that are already taken",(function(){var e,t,n;return n=this.createSurvey(['text,question_one,"already named question_one"','text,,"question one"']),u(null!=(e=n.rows.at(0))?e.get("name").getValue():void 0).toBe("question_one"),u(null!=(t=n.finalize().rows.at(1))?t.get("name").getValue():void 0).toBe("question_one_001")}))})),describe("lists",(function(){return it("can change a list for a question",(function(){var e,t,n;return this.pizzaSurvey.choices.add({name:"yes_no_maybe"}),n=this.pizzaSurvey.choices.get("yes_no_maybe"),u(n).toBeDefined(),e=this.pizzaSurvey.rows.first(),u(e.getList().get("name")).toBe("yes_no"),u(e.getList().get("name")).toBe("yes_no"),e.setList(n),u(e.getList().get("name")).toBe("yes_no_maybe"),e.setList("yes_no"),u(e.getList().get("name")).toBe("yes_no"),u((function(){return e.setList("nonexistant_list")})).toThrow(),e.getList().set("name","no_yes"),u(e.getList()).toBeDefined(),u(null!=(t=e.getList())?t.get("name"):void 0).toBe("no_yes")})),it("can change options for a list",(function(){var e,t;return e=this.pizzaSurvey.choices.get("yes_no"),u(e.options).toBeDefined(),this.pizzaSurvey.choices.add({name:"yes_no_maybe"}),t=this.pizzaSurvey.choices.get("yes_no_maybe"),u(t).toBeDefined(),u(t.options.length).toBe(0),t.options.add({name:"maybe",label:"Maybe"}),t.options.add([{name:"yes",label:"Yes"},{name:"no",label:"No"}]),u(t.options.length).toBe(3)}))})),describe("census xlform",(function(){return beforeEach((function(){return this.census=e.Survey.load(i)})),it("looks good",(function(){return u(this.census).toBeDefined()}))}))},s="survey,,,\n,type,name,label\n,select_one yes_no,likes_pizza,Do you like pizza?\nchoices,,,\n,list name,name,label\n,yes_no,yes,Yes\n,yes_no,no,No",i='"survey","type","name","label"\n,"integer","q1","How many people were living or staying in this house, apartment, or mobile home on April 1, 2010?"\n,"select_one yes_no","q2","Were there any additional people staying here April 1, 2010 that you did not include in Question 1?"\n,"select_one ownership_type or_other","q3","Is this house, apartment, or mobile home: owned with mortgage, owned without mortgage, rented, occupied without rent?"\n,"text","q4","What is your telephone number?"\n,"text","q5","Please provide information for each person living here. Start with a person here who owns or rents this house, apartment, or mobile home. If the owner or renter lives somewhere else, start with any adult living here. This will be Person 1. What is Person 1\'s name?"\n,"select_one male_female","q6","What is Person 1\'s sex?"\n,"date","q7","What is Person 1\'s age and Date of Birth?"\n,"text","q8","Is Person 1 of Hispanic, Latino or Spanish origin?"\n,"text","q9","What is Person 1\'s race?"\n,"select_one yes_no","q10","Does Person 1 sometimes live or stay somewhere else?"\n"choices","list name","name","label"\n,"yes_no","yes","Yes"\n,"yes_no","no","No"\n,"male_female","male","Male"\n,"male_female","female","Female"\n,"ownership_type","owned_with_mortgage","owned with mortgage",\n,"ownership_type","owned_without_mortgage","owned without mortgage"\n,"ownership_type","rented","rented"\n,"ownership_type","occupied_without_rent","occupied without rent"\n"settings"\n,"form_title","form_id"\n,"Census Questions (2010)","census2010"',o={yes_no:{name:"yes_no",options:[{"list name":"yes_no",name:"yes",label:"Yes"},{"list name":"yes_no",name:"no",label:"No"}]},gender:{name:"gender",options:[{"list name":"gender",name:"f",label:"Female"},{"list name":"gender",name:"m",label:"Male"}]}},describe("xlform survey model",(function(){return l.call(this,r)}))},875:function(e,t,n){var r,i,o;i=n(63).expect,r=n(265),(o={}).group="survey,,,\n,type,name,label\n,text,q1,Question1\n,begin group,grp,\n,text,g1q1,Group1Question1\n,text,g1q2,Group1Question2\n,end group,,",o.iterateOver="survey,,,\n,type,name,label\n,text,q1,Question1\n,begin group,grp,\n,text,g1q1,Group1Question1\n,text,g1q2,Group1Question2\n,end group,,\n,text,q8,Question8\n,text,q9,Question9\n,err,err,err",o.singleQ="survey,,,\n,type,name,label\n,text,q1,Question1",o.withChoices="survey,,,\n,type,name,label\n,select_one yesno,yn,YesNo\nchoices,,,\n,list name,label,name\n,yesno,Yes,yes\n,yesno,No,no",describe("survey.tests: Row content",(function(){return it("properly sluggifies row labels",(function(){var e,t;return(t=new r.Survey).rows.add({type:"text",label:"how many people?"}),i(t.rows.length).toBe(1),e=t.rows.at(0),i(e.get("name").get("value")).toBe(""),i(e.get("label").get("value")).toBe("how many people?"),e.finalize(),i(e.get("name").get("value")).toBe("how_many_people")}))})),describe("survey.tests: Row types",(function(){return beforeEach((function(){return window.xlfHideWarnings=!0,this.survey=new r.Survey})),afterEach((function(){return window.xlfHideWarnings=!1})),describe("populates default values properly",(function(){return beforeEach((function(){var e;return this.populateRow=(e=this,function(t){return null==t&&(t={}),e.survey.rows.add(t),e.row=e.survey.rows.at(0)}),this.expectValue=function(e){return i(this.row.get(e).get("value"))}})),it("text is required",(function(){return this.populateRow({type:"text"}),this.expectValue("required").toBe(!1)})),it("select one is required",(function(){return this.populateRow({type:"select_one"}),this.expectValue("required").toBe(!1)})),it("integer is required",(function(){return this.populateRow({type:"integer"}),this.expectValue("required").toBe(!1)})),it("geopoint is not required",(function(){return this.populateRow({type:"geopoint"}),this.expectValue("required").toBe(!1)})),it("geotrace is not required",(function(){return this.populateRow({type:"geotrace"}),this.expectValue("required").toBe(!1)})),it("geoshape is not required",(function(){return this.populateRow({type:"geoshape"}),this.expectValue("required").toBe(!1)})),it("note is not required",(function(){return this.populateRow({type:"note"}),this.expectValue("required").toBe(!1)}))})),it("has a valid empty survey",(function(){return i(this.survey.toCSV()).toBeDefined()})),it("can add rows to the survey",(function(){return this.survey.rows.add({type:"text",name:"q1"}),i(this.survey.rows.at(0).toJSON().name).toBe("q1"),this.survey.rows.add({type:"_errortype",name:"q2"}),i(this.survey.rows.at(1).toJSON().type).toBe("_errortype"),this.survey.rows.add({type:"note",name:"q3"}),i(this.survey.rows.at(2).toJSON().type).toBe("note")}))})),describe("Survey load",(function(){return beforeEach((function(){var e;return this._load_csv=(e=this,function(t){return e.survey=r.Survey.load(t)}),this._load_md=function(e){return function(t){return e.survey=r.Survey.load.md(t)}}(this),this.expectKeys=function(e,t){var n;return i(function(){var r,i,o;for(o=[],r=0,i=t.length;r<i;r++)n=t[r],o.push(e[n]);return o}())}})),it("loads a single question survey",(function(){return this._load_csv(o.singleQ),this.expectKeys(this.survey.toCsvJson().survey.rowObjects[0],["type","name","label"]).toEqual(["text","q1","Question1"])})),it("loads a multiple choice survey",(function(){var e,t,n,r,s;for(this._load_csv(o.withChoices),t=0,n=(r=(e=this.survey.toJSON()).survey).length;t<n;t++)s=r[t],i(s.$kuid).toBeDefined(),delete s.$kuid;return i(e).toEqual({survey:[{type:"select_one",select_from_list_name:"yesno",name:"yn",label:"YesNo",required:"false"}],choices:{yesno:[{label:"Yes",name:"yes"},{label:"No",name:"no"}]}})})),describe("survey row reordering",(function(){return beforeEach((function(){return this.surveyNames=function(){var e,t;return t=[],e=function(e){return t.push(e.get("name").get("value"))},this.survey.forEachRow(e,{includeGroups:!0}),t}})),it("can switch ABC -> ACB",(function(){var e,t,n,r;return this._load_csv("survey,,,\n,type,name,label\n,text,qa,QuestionA\n,text,qb,QuestionB\n,text,qc,QuestionC"),i(this.surveyNames()).toEqual(["qa","qb","qc"]),t=(r=this.survey.rows.models)[0],r[1],n=r[2],e=t._parent,this.survey._insertRowInPlace(n,{previous:t}),i(n._parent).toBe(e),i(this.surveyNames()).toEqual(["qa","qc","qb"])}))})),describe("forEachRow iterator tests",(function(){return beforeEach((function(){return window.xlfHideWarnings=!0,this._load_csv(o.iterateOver),this.getProp=function(e,t){return function(n){var r;return t.push(null!=(r=n.get(e))?r.get("value"):void 0)}}})),afterEach((function(){return window.xlfHideWarnings=!1})),it("runs normally",(function(){var e;return this.survey.forEachRow(this.getProp("name",e=[])),i(e).toEqual("q1 g1q1 g1q2 q8 q9".split(" "))})),it("runs flat",(function(){var e,t;return t={flat:!0},this.survey.forEachRow(this.getProp("name",e=[]),t),i(e).toEqual("q1 q8 q9".split(" "))})),it("runs with includeGroups",(function(){var e,t;return t={includeGroups:!0},this.survey.forEachRow(this.getProp("name",e=[]),t),i(e).toEqual("q1 grp g1q1 g1q2 q8 q9".split(" "))})),it("runs with includeGroups",(function(){var e,t;return t={includeGroups:!0},this.survey.forEachRow(this.getProp("name",e=[]),t),i(e).toEqual("q1 grp g1q1 g1q2 q8 q9".split(" "))})),it("runs with includeErrors",(function(){var e,t;return t={includeErrors:!0},this.survey.forEachRow(this.getProp("name",e=[]),t),i(e).toEqual("q1 g1q1 g1q2 q8 q9 err".split(" "))}))}))})),describe("survey.tests: form_id auto-naming",(function(){return describe("initialization",(function(){return it("enables auto-naming when form is new",(function(){var e;return e=new r.Survey,i(e.settings.auto_name).toBe(!0)}))})),describe("change:form_id",(function(){return it("disables auto naming when changed manually",(function(){var e;return(e=new r.Settings).enable_auto_name(),e.set("form_id","test"),i(e.auto_name).toBe(!1)})),it("ignores when changed as part of a title change",(function(){var e;return(e=new r.Settings).enable_auto_name(),e.set("form_title","test"),i(e.auto_name).toBe(!0)}))})),describe("change:form_title",(function(){return it("sets the form id when form in auto naming mode",(function(){var e;return(e=new r.Settings).enable_auto_name(),e.set("form_title","test"),i(e.get("form_id")).toBe("test")})),it("sluggifies label before setting id",(function(){var e;return(e=new r.Settings).enable_auto_name(),e.set("form_title","test me"),i(e.get("form_id")).toBe("test_me")}))}))})),describe("survey.tests: prep_cols",(function(){return it("flattens and deduplicates arrays of strings",(function(){var e;return e=new r.Survey,i(e.prepCols([["a","b"],["b","c"],["e","a","d"]])).toEqual(["a","b","c","e","d"])})),it("excludes passed array of strings from result",(function(){var e;return e=new r.Survey,i(e.prepCols([["a","b"],["b","c"],["e","a","de"]],{exclude:["de"]})).toEqual(["a","b","c","e"])})),it("add passed string to result",(function(){var e;return e=new r.Survey,i(e.prepCols([["a","b"],["b","c"],["e","a","de"]],{exclude:["de"],add:["abc"]})).toEqual(["a","b","c","e","abc"])}))}))},876:function(e,t,n){var r,i,o,s;i=n(63).expect,r=n(19),s=[["list_name","name","label","state","county"],["state","texas","Texas",""],["state","washington","Washington",""],["county","king 1","King","washington",""],["county","pierce","Pierce","washington",""],["county","king 2","King","texas",""],["county","cameron","Cameron","texas",""],["city","dumont","Dumont","texas","king 2"],["city","finney","Finney","texas","king 2"],["city","brownsville","brownsville","texas","cameron"],["city","harlingen","harlingen","texas","cameron"],["city","seattle","Seattle","washington","king 1"],["city","redmond","Redmond","washington","king 1"],["city","tacoma","Tacoma","washington","pierce"],["city","puyallup","Puyallup","washington","pierce"]].map((function(e){return e.join("\t")})).join("\n"),o=JSON.parse('[\n    {\n        "list_name": "state",\n        "name": "texas",\n        "label": "Texas"\n    },\n    {\n        "list_name": "state",\n        "name": "washington",\n        "label": "Washington"\n    },\n    {\n        "list_name": "county",\n        "name": "king 1",\n        "label": "King",\n        "state": "washington"\n    },\n    {\n        "list_name": "county",\n        "name": "pierce",\n        "label": "Pierce",\n        "state": "washington"\n    },\n    {\n        "list_name": "county",\n        "name": "king 2",\n        "label": "King",\n        "state": "texas"\n    },\n    {\n        "list_name": "county",\n        "name": "cameron",\n        "label": "Cameron",\n        "state": "texas"\n    },\n    {\n        "list_name": "city",\n        "name": "dumont",\n        "label": "Dumont",\n        "state": "texas",\n        "county": "king 2"\n    },\n    {\n        "list_name": "city",\n        "name": "finney",\n        "label": "Finney",\n        "state": "texas",\n        "county": "king 2"\n    },\n    {\n        "list_name": "city",\n        "name": "brownsville",\n        "label": "brownsville",\n        "state": "texas",\n        "county": "cameron"\n    },\n    {\n        "list_name": "city",\n        "name": "harlingen",\n        "label": "harlingen",\n        "state": "texas",\n        "county": "cameron"\n    },\n    {\n        "list_name": "city",\n        "name": "seattle",\n        "label": "Seattle",\n        "state": "washington",\n        "county": "king 1"\n    },\n    {\n        "list_name": "city",\n        "name": "redmond",\n        "label": "Redmond",\n        "state": "washington",\n        "county": "king 1"\n    },\n    {\n        "list_name": "city",\n        "name": "tacoma",\n        "label": "Tacoma",\n        "state": "washington",\n        "county": "pierce"\n    },\n    {\n        "list_name": "city",\n        "name": "puyallup",\n        "label": "Puyallup",\n        "state": "washington",\n        "county": "pierce"\n    }\n]'),describe("model.utils",(function(){return describe("pasted",(function(){var e;return e=function(e,t){return i(_.keys(e).sort().join(",")).toEqual(_.keys(t).sort().join(",")),i(_.values(e).sort().join(",")).toEqual(_.values(t).sort().join(","))},it("splits pasted code into appropriate chunks",(function(){var t,n,a,u,l;for(l=r.split_paste(s),i(l.length).toEqual(o.length),u=[],t=n=0,a=l.length;0<=a?n<=a:n>=a;t=0<=a?++n:--n)u.push(e(l[t],o[t]));return u}))})),describe("sluggify",(function(){return it("lowerCases: true",(function(){return i(r.sluggify("TESTING LOWERCASE TRUE",{lowerCase:!0})).toEqual("testing_lowercase_true")})),it("lowerCases: false",(function(){return i(r.sluggify("TESTING LOWERCASE FALSE",{lowerCase:!1})).toEqual("TESTING_LOWERCASE_FALSE")})),it("isValidXmlTag passes with valid strings",(function(){var e,t,n,o,s;for(n=[],e=0,t=(s=["abc","_123","a456","_."]).length;e<t;e++)o=s[e],n.push(i(r.isValidXmlTag(o)).toBeTruthy());return n})),it("isValidXmlTag fails with invalid strings",(function(){var e,t,n,o,s;for(o=[],t=0,n=(e=["1xyz"," startswithspace","._"]).length;t<n;t++)s=e[t],o.push(i(r.isValidXmlTag(s)).not.toBeTruthy());return o})),it("handles a number of strings consistenly",(function(){var e,t,n,o,s,a,u,l,c,p,d;for(p=[],o=u=0,l=(s=[[["asdf jkl"],"asdf_jkl"],[["asdf",["asdf"]],"asdf_001"],[["2. asdf"],"_2_asdf"],[["2. asdf",["_2_asdf"]],"_2_asdf_001"],[["asdf#123"],"asdf_123"],[[" hello "],"hello"]]).length;u<l;o=++u)a=(c=s[o])[0],n=c[1],d=a[0],t=a[1],e=r.sluggifyLabel(d,t),p.push(i(e).toBe(n));return p}))}))}))},877:function(e,t,n){"use strict";n.r(t);var r=n(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}describe("utils",(function(){describe("getLangAsObject",(function(){it("should return object for valid langString",(function(){var e=Object(r.getLangAsObject)("English (en)");chai.expect(e.name).to.equal("English"),chai.expect(e.code).to.equal("en")})),it("should return undefined for invalid langString",(function(){chai.expect(Object(r.getLangAsObject)("English")).to.equal(void 0),chai.expect(Object(r.getLangAsObject)("(en)")).to.equal(void 0),chai.expect(Object(r.getLangAsObject)("English [en]")).to.equal(void 0),chai.expect(Object(r.getLangAsObject)("English, en")).to.equal(void 0),chai.expect(Object(r.getLangAsObject)("English: en")).to.equal(void 0),chai.expect(Object(r.getLangAsObject)("(en) English")).to.equal(void 0),chai.expect(Object(r.getLangAsObject)("English (en) (fr) (de)")).to.equal(void 0),chai.expect(Object(r.getLangAsObject)("Pizza time!")).to.equal(void 0)})),it("should work properly with getLangString",(function(){var e=Object(r.getLangAsObject)(Object(r.getLangString)({name:"English",code:"en"}));chai.expect(e.name).to.equal("English"),chai.expect(e.code).to.equal("en")}))})),describe("getLangString",(function(){it("should return valid langString from langObj",(function(){var e=Object(r.getLangString)({name:"English",code:"en"});chai.expect(e).to.equal("English (en)")})),it("should return nothing for invalid object",(function(){var e=Object(r.getLangString)({pizzaType:2,delivery:!1});chai.expect(e).to.equal(void 0)})),it("should work properly with getLangAsObject",(function(){var e=Object(r.getLangString)(Object(r.getLangAsObject)("English (en)"));chai.expect(e).to.equal("English (en)")}))}))})),describe("translations hack",(function(){describe("nullifyTranslations",(function(){it("should return array with null for no translations",(function(){var e={survey:[{label:["Hello"]}]};expect(Object(r.nullifyTranslations)(e.translations,e.translated,e.survey,e.baseSurvey)).to.deep.equal({survey:[{label:["Hello"]}],translations:[null]})})),it("should throw if there are unnamed translations",(function(){var e={survey:[{label:["Hello"]}],translations:[null,"English (en)"]};expect((function(){Object(r.nullifyTranslations)(e.translations,e.translated,e.survey,e.baseSurvey)})).to.throw()})),it("should not reorder anything if survey has same default language as base survey",(function(){var e={_initialParams:{translations_0:"English (en)"}},t=[{label:["Hello","Cześć"]}],n=["English (en)","Polski (pl)"],i=["label"];expect(Object(r.nullifyTranslations)(n,i,t,e)).to.deep.equal({survey:[{label:["Hello","Cześć"]}],translations:[null,"Polski (pl)"],translations_0:"English (en)"})})),it("should reorder translated props if survey has same default language as base survey but in different order",(function(){var e={_initialParams:{translations_0:"English (en)"}},t=[{label:["Allo","Cześć","Hello"]}],n=["Francais (fr)","Polski (pl)","English (en)"],i=["label"];expect(Object(r.nullifyTranslations)(n,i,t,e)).to.deep.equal({survey:[{label:["Hello","Allo","Cześć"]}],translations:[null,"Francais (fr)","Polski (pl)"],translations_0:"English (en)"})})),it("should add base survey's default language if survey doesn't have it",(function(){var e={_initialParams:{translations_0:"English (en)"}},t=[{label:["Allo","Cześć"],name:"welcome_message"}],n=["Francais (fr)","Polski (pl)"],i=["label"];expect(Object(r.nullifyTranslations)(n,i,t,e)).to.deep.equal({survey:[{label:["welcome_message","Allo","Cześć"],name:"welcome_message"}],translations:[null,"Francais (fr)","Polski (pl)"],translations_0:"English (en)"})})),it("should add null language if base survey has no translations but survey does",(function(){var e={_initialParams:{}},t=[{label:["Allo","Cześć"],name:"welcome_message"}],n=["Francais (fr)","Polski (pl)"],i=["label"];expect(Object(r.nullifyTranslations)(n,i,t,e)).to.deep.equal({survey:[{label:["welcome_message","Allo","Cześć"],name:"welcome_message"}],translations:[null,"Francais (fr)","Polski (pl)"]})})),it("should do nothing if neither base survey nor survey have translations",(function(){var e={_initialParams:{}},t=[{label:["Hello"]}],n=[null],i=[];expect(Object(r.nullifyTranslations)(n,i,t,e)).to.deep.equal({survey:[{label:["Hello"]}],translations:[null]})}))})),describe("unnullifyTranslations",(function(){it("should set default language if it's not set already",(function(){var e={surveyDataJSON:JSON.stringify({survey:[{label:"Cheese?"}],settings:[{}]}),assetContent:{translated:["label"],translations_0:"English (en)"}},t=JSON.stringify({survey:[{"label::English (en)":"Cheese?"}],settings:[{default_language:"English (en)"}]});expect(Object(r.unnullifyTranslations)(e.surveyDataJSON,e.assetContent)).to.deep.equal(t)})),it("should replace nullified props with translated ones",(function(){var e={surveyDataJSON:JSON.stringify({survey:[{label:"Cheese?","label::Polski (pl)":"Ser?"}],choices:[{label:"Yes"},{label:"No","label::Polski (pl)":"Nie"}],settings:[{default_language:"English (en)"}]}),assetContent:{translated:["label"],translations_0:"English (en)"}},t=JSON.stringify({survey:[{"label::Polski (pl)":"Ser?","label::English (en)":"Cheese?"}],choices:[{"label::English (en)":"Yes"},{"label::Polski (pl)":"Nie","label::English (en)":"No"}],settings:[{default_language:"English (en)"}]});expect(Object(r.unnullifyTranslations)(e.surveyDataJSON,e.assetContent)).to.deep.equal(t)}))}))})),describe("readParameters",(function(){[{str:"foo=",obj:{foo:""},note:"empty parameter"},{str:"foo=;bar=1;fum=;baz=",obj:{foo:"",bar:"1",fum:"",baz:""},note:"empty parameters"},{str:"foo=bar",obj:{foo:"bar"},note:"single parameter"},{str:"foo=1 bar=10 fum=1",obj:{foo:"1",bar:"10",fum:"1"},note:"space-separated parameters"},{str:"foo=1,bar=10,fum=1",obj:{foo:"1",bar:"10",fum:"1"},note:"comma-separated parameters"},{str:"foo=1;bar=10;fum=1",obj:{foo:"1",bar:"10",fum:"1"},note:"semicolon-separated parameters"},{str:"foo  = 1    bar  =  10    fum  =  1",obj:{foo:"1",bar:"10",fum:"1"},note:"space-dirty space-separated parameters"},{str:"foo = 1 , bar = 10 , fum = 1",obj:{foo:"1",bar:"10",fum:"1"},note:"space-dirty comma-separated parameters"},{str:"foo = 1  ; bar = 10 ; fum = 1",obj:{foo:"1",bar:"10",fum:"1"},note:"space-dirty semicolon-separated parameters"},{str:"foo=1 bar=10,fum=1;baz=0",obj:{foo:"1 bar=10,fum=1",baz:"0"},note:"parameters with mixed separators"},{str:"foo    =2",obj:{foo:"2"},note:"left-space-dirty single parameter"},{str:"foo     =   2",obj:{foo:"2"},note:"both-space-dirty single parameter"},{str:"foo=      2",obj:{foo:"2"},note:"right-space-dirty single parameter"},{str:"foo = 2, 4  ; bar =  4 , , 4 a   ,  ; fum=baz",obj:{foo:"2, 4",bar:"4 , , 4 a",fum:"baz"},note:"dirty parameters with mixed separators"}].forEach((function(e){it("should return valid object from ".concat(e.note),(function(){chai.expect(Object(r.readParameters)(e.str)).to.deep.equal(e.obj)}))})),it("should read parameters values as strings",(function(){var e=Object(r.readParameters)("foo=1;bar=false;fum=0.5;baz=[1,2,3]");chai.expect(i(e.foo)).to.equal("string"),chai.expect(i(e.bar)).to.equal("string"),chai.expect(i(e.fum)).to.equal("string"),chai.expect(i(e.baz)).to.equal("string")})),it("should return null for invalid parameter string",(function(){chai.expect(Object(r.readParameters)("abc:1")).to.equal(null),chai.expect(Object(r.readParameters)("1")).to.equal(null),chai.expect(Object(r.readParameters)("")).to.equal(null),chai.expect(Object(r.readParameters)(0)).to.equal(null),chai.expect(Object(r.readParameters)(!1)).to.equal(null),chai.expect(Object(r.readParameters)(null)).to.equal(null),chai.expect(Object(r.readParameters)(void 0)).to.equal(null),chai.expect(Object(r.readParameters)({})).to.equal(null),chai.expect(Object(r.readParameters)([])).to.equal(null)}))})),describe("writeParameters",(function(){[{str:"foo=1;bar=10;fum=1",obj:{foo:"1",bar:"10",fum:"1"},note:"valid string from object with multiple parameters"},{str:"foo=2",obj:{foo:"2"},note:"valid string from object with single parameter"},{str:"bar=0;baz=false",obj:{foo:null,bar:0,fum:void 0,baz:!1},note:"valid string omitting empty values from object with multiple parameters"},{str:'foo={"bar":"a","fum":{"baz":"b"}}',obj:{foo:{bar:"a",fum:{baz:"b"}}},note:"valid string from nested object"}].forEach((function(e){it("should return ".concat(e.note),(function(){chai.expect(Object(r.writeParameters)(e.obj)).to.equal(e.str)}))}))}))},881:function(e,t,n){"use strict";n.r(t);var r=[{$autoname:"start",$kuid:"RCRVJs6v8",type:"start",name:"start"},{$autoname:"end",$kuid:"Oaffb3Ce1",type:"end",name:"end"},{$autoname:"Your_place",$kuid:"ry17h97",required:!1,type:"geopoint",label:["Your place"]},{$autoname:"Your_name",$kuid:"bp66l95",required:!1,type:"text",label:["Your name"]},{$autoname:"group_breakfast",$kuid:"eu4rd78",type:"begin_group",name:"group_breakfast",label:["Breakfast"]},{$autoname:"When_did_you_eat",$kuid:"sn0ll77",required:!1,type:"time",label:["When did you eat?"]},{$autoname:"What_did_you_eat",$kuid:"lh5jq54",required:!1,type:"text",label:["What did you eat?"]},{$kuid:"/eu4rd78",type:"end_group"},{$autoname:"group_snacks",$kuid:"yq4bo29",type:"begin_repeat",name:"group_snacks",label:["Snacks during the day"]},{$autoname:"Snack_name",$kuid:"tb3mh66",required:!1,type:"text",label:["Snack name"]},{$autoname:"Time_of_consumption",$kuid:"tq2zv81",required:!1,type:"time",label:["Time of consumption"]},{$autoname:"group_nutrients",$kuid:"su3ww56",type:"begin_group",name:"group_nutrients",label:["Nutrients"]},{$autoname:"How_much_protein_was_it",$kuid:"bg5yt06",required:!1,type:"integer",label:["How much protein was it?"]},{$autoname:"How_much_H2O_was_it",$kuid:"iz5bf84",required:!1,type:"integer",label:["How much H2O was it?"]},{$kuid:"/su3ww56",type:"end_group"},{$kuid:"/yq4bo29",type:"end_repeat"},{$autoname:"group_favs",$kuid:"vy2km60",type:"begin_group",name:"group_favs",label:["Favourites"]},{$autoname:"Favourite_food",$kuid:"yt3yl96",required:!1,type:"text",label:["Favourite food"]},{$autoname:"group_favplant",$kuid:"vj5yb24",type:"begin_group",name:"group_favplant",label:["Favourite plant food"]},{$autoname:"Favourite_fruit",$kuid:"wa1gp21",required:!1,type:"text",label:["Favourite fruit"]},{$autoname:"group_favveg",$kuid:"qq1rn39",type:"begin_group",name:"group_favveg",label:["Favourite vegetables"]},{$autoname:"Favourite_carrot",$kuid:"ik3zw20",required:!1,type:"text",label:["Favourite carrot"]},{$autoname:"Favourite_potato",$kuid:"ea5uq17",required:!1,type:"text",label:["Favourite potato"]},{$kuid:"/qq1rn39",type:"end_group"},{$kuid:"/vj5yb24",type:"end_group"},{$autoname:"group_favvegan",$kuid:"oe2bb55",type:"begin_group",name:"group_favvegan",label:["Favourite vegan stuff"]},{$autoname:"Favourite_vegan_hummus",$kuid:"lk4jn23",required:!1,type:"text",label:["Favourite vegan hummus"]},{$kuid:"/oe2bb55",type:"end_group"},{$autoname:"Favourite_spiece",$kuid:"zv21a26",required:!1,type:"text",label:["Favourite spiece"]},{$kuid:"/vy2km60",type:"end_group"},{$autoname:"Comments",$kuid:"sm0pu34",required:!1,type:"text",label:["Comments"]}],i=("undefined"!=typeof __REACT_HOT_LOADER__&&__REACT_HOT_LOADER__.register(r,"surveyWithGroups","/srv/src/kpi/jsapp/js/assetUtils.mocks.es6"),n(103));describe("getSurveyFlatPaths",(function(){it("should return a list of paths for all questions",(function(){var e=Object(i.b)(r);expect(e).to.deep.equal({Your_place:"Your_place",Your_name:"Your_name",When_did_you_eat:"group_breakfast/When_did_you_eat",What_did_you_eat:"group_breakfast/What_did_you_eat",Snack_name:"group_snacks/Snack_name",Time_of_consumption:"group_snacks/Time_of_consumption",How_much_protein_was_it:"group_snacks/group_nutrients/How_much_protein_was_it",How_much_H2O_was_it:"group_snacks/group_nutrients/How_much_H2O_was_it",Favourite_food:"group_favs/Favourite_food",Favourite_fruit:"group_favs/group_favplant/Favourite_fruit",Favourite_carrot:"group_favs/group_favplant/group_favveg/Favourite_carrot",Favourite_potato:"group_favs/group_favplant/group_favveg/Favourite_potato",Favourite_vegan_hummus:"group_favs/group_favvegan/Favourite_vegan_hummus",Favourite_spiece:"group_favs/Favourite_spiece",Comments:"Comments"})}))}))},882:function(e,t,n){"use strict";n.r(t);var r=n(28),i=n(16),o={count:9,next:null,previous:null,results:[{url:"/api/v2/permissions/add_submissions/",codename:"add_submissions",implied:["/api/v2/permissions/view_asset/"],contradictory:[],name:"",description:"Can submit data to asset"},{url:"/api/v2/permissions/change_asset/",codename:"change_asset",implied:["/api/v2/permissions/view_asset/"],contradictory:[],name:"",description:"Can change asset"},{url:"/api/v2/permissions/change_submissions/",codename:"change_submissions",implied:["/api/v2/permissions/view_asset/","/api/v2/permissions/view_submissions/"],contradictory:["/api/v2/permissions/partial_submissions/"],name:"",description:"Can modify submitted data for asset"},{url:"/api/v2/permissions/partial_submissions/",codename:"partial_submissions",implied:["/api/v2/permissions/view_asset/"],contradictory:["/api/v2/permissions/view_submissions/","/api/v2/permissions/change_submissions/","/api/v2/permissions/validate_submissions/"],name:"",description:"Can make partial actions on submitted data for asset for specific users"},{url:"/api/v2/permissions/validate_submissions/",codename:"validate_submissions",implied:["/api/v2/permissions/view_asset/","/api/v2/permissions/view_submissions/"],contradictory:["/api/v2/permissions/partial_submissions/"],name:"",description:"Can validate submitted data asset"},{url:"/api/v2/permissions/view_asset/",codename:"view_asset",implied:[],contradictory:[],name:"",description:"Can view asset"},{url:"/api/v2/permissions/view_submissions/",codename:"view_submissions",implied:["/api/v2/permissions/view_asset/"],contradictory:["/api/v2/permissions/partial_submissions/"],name:"",description:"Can view submitted data for asset"},{url:"/api/v2/permissions/change_collection/",codename:"change_collection",implied:["/api/v2/permissions/view_collection/"],contradictory:[],name:"",description:"Can change collection"},{url:"/api/v2/permissions/view_collection/",codename:"view_collection",implied:[],contradictory:[],name:"",description:"Can view collection"}]},s={count:7,next:null,previous:null,results:[{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pTi9qyEax49ZA5RP9KnNHB/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/add_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pATUgtDW6v44QG4dDDpnEV/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/change_asset/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pUUcqTtQ6FgEDfHUiQbS24/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/change_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/p5BjfEz9JDQtQTzkT7fHA5/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/validate_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pBjfyz5Zxj95866GtEtsR2/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/view_asset/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pQGiudmuLvN6iHEdH8dJAs/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/view_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pV9kCoWAQT9QUeV2EsTLqj/",user:"/api/v2/users/AnonymousUser/",permission:"/api/v2/permissions/view_asset/"}]},a={count:9,next:null,previous:null,results:[{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pTi9qyEax49ZA5RP9KnNHB/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/add_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pATUgtDW6v44QG4dDDpnEV/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/change_asset/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pUUcqTtQ6FgEDfHUiQbS24/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/change_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/p5BjfEz9JDQtQTzkT7fHA5/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/validate_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pBjfyz5Zxj95866GtEtsR2/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/view_asset/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pQGiudmuLvN6iHEdH8dJAs/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/view_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pETvxGayAJwvPaCnt5biVD/",user:"/api/v2/users/olivier/",permission:"/api/v2/permissions/view_asset/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/p6KekjhZabd7ao9MBQwN7X/",user:"/api/v2/users/john/",permission:"/api/v2/permissions/view_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pxp7BPnP9fohF5ZoH5Uwfa/",user:"/api/v2/users/john/",permission:"/api/v2/permissions/view_asset/"}]},u={count:8,next:null,previous:null,results:[{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pTi9qyEax49ZA5RP9KnNHB/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/add_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pATUgtDW6v44QG4dDDpnEV/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/change_asset/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pUUcqTtQ6FgEDfHUiQbS24/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/change_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/p5BjfEz9JDQtQTzkT7fHA5/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/validate_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pBjfyz5Zxj95866GtEtsR2/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/view_asset/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pQGiudmuLvN6iHEdH8dJAs/",user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/view_submissions/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/p6KekjhZabd7ao9MBQwN7X/",user:"/api/v2/users/leszek/",permission:"/api/v2/permissions/view_asset/"},{url:"/api/v2/assets/arMB2dNgwewktv954wmo9e/permission-assignments/pxp7BPnP9fohF5ZoH5Uwfa/",user:"/api/v2/users/leszek/",permission:"/api/v2/permissions/partial_submissions/",partial_permissions:[{url:"/api/v2/permissions/view_submissions/",filters:[{_submitted_by:{$in:["john","olivier"]}}]}]}]},l={permissions:o,assetWithAnonymousUser:s,assetWithMultipleUsers:a,assetWithPartial:u},c=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(o,"permissions","/srv/src/kpi/jsapp/js/components/permissions/permissionsMocks.es6"),__REACT_HOT_LOADER__.register(s,"assetWithAnonymousUser","/srv/src/kpi/jsapp/js/components/permissions/permissionsMocks.es6"),__REACT_HOT_LOADER__.register(a,"assetWithMultipleUsers","/srv/src/kpi/jsapp/js/components/permissions/permissionsMocks.es6"),__REACT_HOT_LOADER__.register(u,"assetWithPartial","/srv/src/kpi/jsapp/js/components/permissions/permissionsMocks.es6"),__REACT_HOT_LOADER__.register(l,"endpoints","/srv/src/kpi/jsapp/js/components/permissions/permissionsMocks.es6")),n(3));describe("permParser",(function(){beforeEach((function(){i.a.onGetConfigCompleted(l.permissions),c.default.ROOT_URL=""})),describe("parseBackendData",(function(){it("should hide anonymous user permissions from output by default",(function(){chai.expect(l.assetWithAnonymousUser.results.length).to.equal(7);var e=r.a.parseBackendData(l.assetWithAnonymousUser.results,l.assetWithAnonymousUser.results[0].user);chai.expect(e.length).to.equal(1),chai.expect(e[0].user.name).to.equal("kobo")})),it("should show anonymous user permissions from output when ordered to",(function(){chai.expect(l.assetWithAnonymousUser.results.length).to.equal(7);var e=r.a.parseBackendData(l.assetWithAnonymousUser.results,l.assetWithAnonymousUser.results[0].user,!0);chai.expect(e.length).to.equal(2),chai.expect(e[0].user.name).to.equal("kobo"),chai.expect(e[1].user.name).to.equal(c.default.ANON_USERNAME)})),it("should group permissions by users properly",(function(){chai.expect(l.assetWithMultipleUsers.results.length).to.equal(9);var e=r.a.parseBackendData(l.assetWithMultipleUsers.results,l.assetWithMultipleUsers.results[0].user);chai.expect(e.length).to.equal(3),chai.expect(e[0].user.name).to.equal("kobo"),chai.expect(e[0].permissions.length).to.equal(6),chai.expect(e[1].user.name).to.equal("john"),chai.expect(e[1].permissions.length).to.equal(2),chai.expect(e[2].user.name).to.equal("olivier"),chai.expect(e[2].permissions.length).to.equal(1)}))})),describe("sortParseBackendOutput",(function(){it("should sort alphabetically with owner always first",(function(){var e=r.a.sortParseBackendOutput([{user:{url:"/api/v2/users/frank",isOwner:!1}},{user:{url:"/api/v2/users/bob",isOwner:!1}},{user:{url:"/api/v2/users/diana",isOwner:!0}},{user:{url:"/api/v2/users/arthur",isOwner:!1}},{user:{url:"/api/v2/users/esther",isOwner:!1}},{user:{url:"/api/v2/users/christian",isOwner:!1}}]);chai.expect(e).to.deep.equal([{user:{url:"/api/v2/users/diana",isOwner:!0}},{user:{url:"/api/v2/users/arthur",isOwner:!1}},{user:{url:"/api/v2/users/bob",isOwner:!1}},{user:{url:"/api/v2/users/christian",isOwner:!1}},{user:{url:"/api/v2/users/esther",isOwner:!1}},{user:{url:"/api/v2/users/frank",isOwner:!1}}])}))})),describe("buildFormData",(function(){it("should check proper options",(function(){var e=r.a.parseBackendData(l.assetWithMultipleUsers.results,l.assetWithMultipleUsers.results[0].user),t=r.a.buildFormData(e[1].permissions);chai.expect(t).to.deep.equal({formView:!0,submissionsView:!0})})),it("should handle partial permissions",(function(){var e=r.a.parseBackendData(l.assetWithPartial.results,l.assetWithPartial.results[0].user),t=r.a.buildFormData(e[1].permissions);chai.expect(t).to.deep.equal({formView:!0,submissionsView:!0,submissionsViewPartial:!0,submissionsViewPartialUsers:["john","olivier"]})}))})),describe("parseFormData",(function(){it("should exclude all implied permissions as they are not needed",(function(){var e=r.a.parseFormData({username:"leszek",formView:!0,formEdit:!0,submissionsView:!0,submissionsViewPartial:!1,submissionsViewPartialUsers:[],submissionsAdd:!1,submissionsEdit:!1,submissionsValidate:!0});chai.expect(e).to.deep.equal([{user:"/api/v2/users/leszek/",permission:"/api/v2/permissions/change_asset/"},{user:"/api/v2/users/leszek/",permission:"/api/v2/permissions/validate_submissions/"}])})),it("should add partial_permissions property for partial submissions permission",(function(){var e=r.a.parseFormData({username:"leszek",formView:!0,formEdit:!1,submissionsView:!0,submissionsViewPartial:!0,submissionsViewPartialUsers:["john","olivier","eric"],submissionsAdd:!1,submissionsEdit:!1,submissionsValidate:!1});chai.expect(e).to.deep.equal([{user:"/api/v2/users/leszek/",permission:"/api/v2/permissions/partial_submissions/",partial_permissions:[{url:"/api/v2/permissions/view_submissions/",filters:[{_submitted_by:{$in:["john","olivier","eric"]}}]}]}])}))})),describe("parseUserWithPermsList",(function(){it("should return flat list of permissions",(function(){var e=r.a.parseBackendData(l.assetWithMultipleUsers.results,l.assetWithMultipleUsers.results[0].user),t=r.a.parseUserWithPermsList(e);chai.expect(t).to.deep.equal([{user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/add_submissions/"},{user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/change_asset/"},{user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/change_submissions/"},{user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/validate_submissions/"},{user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/view_asset/"},{user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/view_submissions/"},{user:"/api/v2/users/john/",permission:"/api/v2/permissions/view_submissions/"},{user:"/api/v2/users/john/",permission:"/api/v2/permissions/view_asset/"},{user:"/api/v2/users/olivier/",permission:"/api/v2/permissions/view_asset/"}])})),it("should not omit partial permissions",(function(){var e=r.a.parseBackendData(l.assetWithPartial.results,l.assetWithPartial.results[0].user),t=r.a.parseUserWithPermsList(e);chai.expect(t).to.deep.equal([{user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/add_submissions/"},{user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/change_asset/"},{user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/change_submissions/"},{user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/validate_submissions/"},{user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/view_asset/"},{user:"/api/v2/users/kobo/",permission:"/api/v2/permissions/view_submissions/"},{user:"/api/v2/users/leszek/",permission:"/api/v2/permissions/view_asset/"},{user:"/api/v2/users/leszek/",permission:"/api/v2/permissions/partial_submissions/",partial_permissions:[{url:"/api/v2/permissions/view_submissions/",filters:[{_submitted_by:{$in:["john","olivier"]}}]}]}])}))}))}))}});
//# sourceMappingURL=tests-0d7a490cd2ebc6452d34.js.map