"use strict";!function(){const e=navigator.userAgent,t=navigator.platform,n={get ios(){return/iPad|iPhone|iPod/i.test(t)||/Mac/i.test(t)&&void 0!==document.documentElement.ontouchstart},get android(){return/android/i.test(e)}},i={};let r=!1;["date","datetime-local","time","month"].forEach(e=>{const t=document.createElement("input");t.setAttribute("type",e),i[e]="text"!==t.type}),(n.ios||n.android)&&(r=!0,document.documentElement.classList.add("touch"));var o={get inputTypes(){return i},get touch(){return r},set touch(e){r=e}},a={googleApiKey:"",maps:[{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> & <a href="https://www.hotosm.org/updates/2013-09-29_a_new_window_on_openstreetmap_data">Yohan Boniface & Humanitarian OpenStreetMap Team</a> | <a href="https://www.openstreetmap.org/copyright">Terms</a>',name:"humanitarian",tiles:["https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"]},{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",name:"satellite",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"]},{attribution:'&copy; <a href="https://openstreetmap.org">OpenStreetMap</a> | <a href="https://www.openstreetmap.org/copyright">Terms</a>',name:"terrain",tiles:["https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png"]},{attribution:'&copy; <a href="https://openstreetmap.org">OpenStreetMap</a> | <a href="https://www.openstreetmap.org/copyright">Terms</a>',name:"streets",tiles:["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"]}],modernBrowsersURL:"modern-browsers",themesSupported:["formhub","grid","kobo","plain"],defaultTheme:"kobo",languagesSupported:["ar","cs","de","el","en","es","fa","fi","fr","hi","it","ka","lo","nl","no","pl","pt","ro","ru","sk","sq","sv","sw","tr","vi","zh"],timeout:3e5,submissionParameter:{name:""},basePath:"",repeatOrdinals:!1,validateContinuously:!1,validatePage:!0,textMaxChars:1e6},s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function l(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function u(e,t){return e(t={exports:{}},t.exports),t.exports}var c=u((function(e,t){
/* @license
    Papa Parse
    v5.2.0
    https://github.com/mholt/PapaParse
    License: MIT
    */
e.exports=function e(){var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},n=!t.document&&!!t.postMessage,i=n&&/blob:/i.test((t.location||{}).protocol),r={},o=0,a={parse:function(n,i){var s=(i=i||{}).dynamicTyping||!1;if(w(s)&&(i.dynamicTypingFunction=s,s={}),i.dynamicTyping=s,i.transform=!!w(i.transform)&&i.transform,i.worker&&a.WORKERS_SUPPORTED){var l=function(){if(!a.WORKERS_SUPPORTED)return!1;var n,i,s=(n=t.URL||t.webkitURL||null,i=e.toString(),a.BLOB_URL||(a.BLOB_URL=n.createObjectURL(new Blob(["(",i,")();"],{type:"text/javascript"})))),l=new t.Worker(s);return l.onmessage=m,l.id=o++,r[l.id]=l}();return l.userStep=i.step,l.userChunk=i.chunk,l.userComplete=i.complete,l.userError=i.error,i.step=w(i.step),i.chunk=w(i.chunk),i.complete=w(i.complete),i.error=w(i.error),delete i.worker,void l.postMessage({input:n,config:i,workerId:l.id})}var p=null;return"string"==typeof n?p=i.download?new u(i):new h(i):!0===n.readable&&w(n.read)&&w(n.on)?p=new d(i):(t.File&&n instanceof File||n instanceof Object)&&(p=new c(i)),p.stream(n)},unparse:function(e,t){var n=!1,i=!0,r=",",o="\r\n",s='"',l=s+s,u=!1,c=null;!function(){if("object"==typeof t){if("string"!=typeof t.delimiter||a.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(r=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(u=t.skipEmptyLines),"string"==typeof t.newline&&(o=t.newline),"string"==typeof t.quoteChar&&(s=t.quoteChar),"boolean"==typeof t.header&&(i=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");c=t.columns}void 0!==t.escapeChar&&(l=t.escapeChar+s)}}();var h=new RegExp(f(s),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return p(null,e,u);if("object"==typeof e[0])return p(c||d(e[0]),e,u)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:d(e.data[0])),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),p(e.fields||[],e.data||[],u);throw new Error("Unable to serialize unrecognized input");function d(e){if("object"!=typeof e)return[];var t=[];for(var n in e)t.push(n);return t}function p(e,t,n){var a="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var s=Array.isArray(e)&&0<e.length,l=!Array.isArray(t[0]);if(s&&i){for(var u=0;u<e.length;u++)0<u&&(a+=r),a+=g(e[u],u);0<t.length&&(a+=o)}for(var c=0;c<t.length;c++){var h=s?e.length:t[c].length,d=!1,p=s?0===Object.keys(t[c]).length:0===t[c].length;if(n&&!s&&(d="greedy"===n?""===t[c].join("").trim():1===t[c].length&&0===t[c][0].length),"greedy"===n&&s){for(var f=[],m=0;m<h;m++){var v=l?e[m]:m;f.push(t[c][v])}d=""===f.join("").trim()}if(!d){for(var y=0;y<h;y++){0<y&&!p&&(a+=r);var _=s&&l?e[y]:y;a+=g(t[c][_],y)}c<t.length-1&&(!n||0<h&&!p)&&(a+=o)}}return a}function g(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);var i=e.toString().replace(h,l);return"boolean"==typeof n&&n||"function"==typeof n&&n(e,t)||Array.isArray(n)&&n[t]||function(e,t){for(var n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1}(i,a.BAD_DELIMITERS)||-1<i.indexOf(r)||" "===i.charAt(0)||" "===i.charAt(i.length-1)?s+i+s:i}}};if(a.RECORD_SEP=String.fromCharCode(30),a.UNIT_SEP=String.fromCharCode(31),a.BYTE_ORDER_MARK="\ufeff",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!n&&!!t.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=g,a.ParserHandle=p,a.NetworkStreamer=u,a.FileStreamer=c,a.StringStreamer=h,a.ReadableStreamStreamer=d,t.jQuery){var s=t.jQuery;s.fn.parse=function(e){var n=e.config||{},i=[];return this.each((function(e){if("INPUT"!==s(this).prop("tagName").toUpperCase()||"file"!==s(this).attr("type").toLowerCase()||!t.FileReader||!this.files||0===this.files.length)return!0;for(var r=0;r<this.files.length;r++)i.push({file:this.files[r],inputElem:this,instanceConfig:s.extend({},n)})})),r(),this;function r(){if(0!==i.length){var t,n,r,l=i[0];if(w(e.before)){var u=e.before(l.file,l.inputElem);if("object"==typeof u){if("abort"===u.action)return t=l.file,n=l.inputElem,r=u.reason,void(w(e.error)&&e.error({name:"AbortError"},t,n,r));if("skip"===u.action)return void o();"object"==typeof u.config&&(l.instanceConfig=s.extend(l.instanceConfig,u.config))}else if("skip"===u)return void o()}var c=l.instanceConfig.complete;l.instanceConfig.complete=function(e){w(c)&&c(e,l.file,l.inputElem),o()},a.parse(l.file,l.instanceConfig)}else w(e.complete)&&e.complete()}function o(){i.splice(0,1),r()}}}function l(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=_(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new p(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,n){if(this.isFirstChunk&&w(this._config.beforeFirstChunk)){var r=this._config.beforeFirstChunk(e);void 0!==r&&(e=r)}this.isFirstChunk=!1,this._halted=!1;var o=this._partialLine+e;this._partialLine="";var s=this._handle.parse(o,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var l=s.meta.cursor;this._finished||(this._partialLine=o.substring(l-this._baseIndex),this._baseIndex=l),s&&s.data&&(this._rowCount+=s.data.length);var u=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(i)t.postMessage({results:s,workerId:a.WORKER_ID,finished:u});else if(w(this._config.chunk)&&!n){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);s=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),this._completed||!u||!w(this._config.complete)||s&&s.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),u||s&&s.meta.paused||this._nextChunk(),s}this._halted=!0},this._sendError=function(e){w(this._config.error)?this._config.error(e):i&&this._config.error&&t.postMessage({workerId:a.WORKER_ID,error:e,finished:!1})}}function u(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),l.call(this,e),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),n||(t.onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var i in e)t.setRequestHeader(i,e[i])}if(this._config.chunkSize){var r=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+r)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}n&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substring(t.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var n=t.statusText||e;this._sendError(new Error(n))}}function c(e){var t,n;(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),l.call(this,e);var i="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,i?((t=new FileReader).onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var r=Math.min(this._start+this._config.chunkSize,this._input.size);e=n.call(e,this._start,r)}var o=t.readAsText(e,this._config.encoding);i||this._chunkLoaded({target:{result:o}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function h(e){var t;l.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,n=this._config.chunkSize;return n?(e=t.substring(0,n),t=t.substring(n)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function d(e){l.call(this,e=e||{});var t=[],n=!0,i=!1;this.pause=function(){l.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){l.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){i&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=b((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=b((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=b((function(){this._streamCleanUp(),i=!0,this._streamData("")}),this),this._streamCleanUp=b((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function p(e){var t,n,i,r=Math.pow(2,53),o=-r,s=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,l=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,u=this,c=0,h=0,d=!1,p=!1,m=[],v={data:[],errors:[],meta:{}};if(w(e.step)){var y=e.step;e.step=function(t){if(v=t,C())E();else{if(E(),0===v.data.length)return;c+=t.data.length,e.preview&&c>e.preview?n.abort():(v.data=v.data[0],y(v,u))}}}function b(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function E(){if(v&&i&&(k("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),i=!1),e.skipEmptyLines)for(var t=0;t<v.data.length;t++)b(v.data[t])&&v.data.splice(t--,1);return C()&&function(){if(v)if(Array.isArray(v.data[0])){for(var t=0;C()&&t<v.data.length;t++)v.data[t].forEach(n);v.data.splice(0,1)}else v.data.forEach(n);function n(t){w(e.transformHeader)&&(t=e.transformHeader(t)),m.push(t)}}(),function(){if(!v||!e.header&&!e.dynamicTyping&&!e.transform)return v;function t(t,n){var i,r=e.header?{}:[];for(i=0;i<t.length;i++){var o=i,a=t[i];e.header&&(o=i>=m.length?"__parsed_extra":m[i]),e.transform&&(a=e.transform(a,o)),a=S(o,a),"__parsed_extra"===o?(r[o]=r[o]||[],r[o].push(a)):r[o]=a}return e.header&&(i>m.length?k("FieldMismatch","TooManyFields","Too many fields: expected "+m.length+" fields but parsed "+i,h+n):i<m.length&&k("FieldMismatch","TooFewFields","Too few fields: expected "+m.length+" fields but parsed "+i,h+n)),r}var n=1;return!v.data.length||Array.isArray(v.data[0])?(v.data=v.data.map(t),n=v.data.length):v.data=t(v.data,0),e.header&&v.meta&&(v.meta.fields=m),h+=n,v}()}function C(){return e.header&&0===m.length}function S(t,n){return i=t,e.dynamicTypingFunction&&void 0===e.dynamicTyping[i]&&(e.dynamicTyping[i]=e.dynamicTypingFunction(i)),!0===(e.dynamicTyping[i]||e.dynamicTyping)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&(function(e){if(s.test(e)){var t=parseFloat(e);if(o<t&&t<r)return!0}return!1}(n)?parseFloat(n):l.test(n)?new Date(n):""===n?null:n):n;var i}function k(e,t,n,i){var r={type:e,code:t,message:n};void 0!==i&&(r.row=i),v.errors.push(r)}this.parse=function(r,o,s){var l=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substring(0,1048576);var n=new RegExp(f(t)+"([^]*?)"+f(t),"gm"),i=(e=e.replace(n,"")).split("\r"),r=e.split("\n"),o=1<r.length&&r[0].length<i[0].length;if(1===i.length||o)return"\n";for(var a=0,s=0;s<i.length;s++)"\n"===i[s][0]&&a++;return a>=i.length/2?"\r\n":"\r"}(r,l)),i=!1,e.delimiter)w(e.delimiter)&&(e.delimiter=e.delimiter(r),v.meta.delimiter=e.delimiter);else{var u=function(t,n,i,r,o){var s,l,u,c;o=o||[",","\t","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var h=0;h<o.length;h++){var d=o[h],p=0,f=0,m=0;u=void 0;for(var v=new g({comments:r,delimiter:d,newline:n,preview:10}).parse(t),y=0;y<v.data.length;y++)if(i&&b(v.data[y]))m++;else{var _=v.data[y].length;f+=_,void 0!==u?0<_&&(p+=Math.abs(_-u),u=_):u=_}0<v.data.length&&(f/=v.data.length-m),(void 0===l||p<=l)&&(void 0===c||c<f)&&1.99<f&&(l=p,s=d,c=f)}return{successful:!!(e.delimiter=s),bestDelimiter:s}}(r,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);u.successful?e.delimiter=u.bestDelimiter:(i=!0,e.delimiter=a.DefaultDelimiter),v.meta.delimiter=e.delimiter}var c=_(e);return e.preview&&e.header&&c.preview++,t=r,n=new g(c),v=n.parse(t,o,s),E(),d?{meta:{paused:!0}}:v||{meta:{paused:!1}}},this.paused=function(){return d},this.pause=function(){d=!0,n.abort(),t=w(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){u.streamer._halted?(d=!1,u.streamer.parseChunk(t,!0)):setTimeout(u.resume,3)},this.aborted=function(){return p},this.abort=function(){p=!0,n.abort(),v.meta.aborted=!0,w(e.complete)&&e.complete(v),t=""}}function f(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function g(e){var t,n=(e=e||{}).delimiter,i=e.newline,r=e.comments,o=e.step,s=e.preview,l=e.fastMode,u=t=void 0===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(u=e.escapeChar),("string"!=typeof n||-1<a.BAD_DELIMITERS.indexOf(n))&&(n=","),r===n)throw new Error("Comment character same as delimiter");!0===r?r="#":("string"!=typeof r||-1<a.BAD_DELIMITERS.indexOf(r))&&(r=!1),"\n"!==i&&"\r"!==i&&"\r\n"!==i&&(i="\n");var c=0,h=!1;this.parse=function(e,a,d){if("string"!=typeof e)throw new Error("Input must be a string");var p=e.length,g=n.length,m=i.length,v=r.length,y=w(o),_=[],b=[],E=[],C=c=0;if(!e)return O();if(l||!1!==l&&-1===e.indexOf(t)){for(var S=e.split(i),k=0;k<S.length;k++){if(E=S[k],c+=E.length,k!==S.length-1)c+=i.length;else if(d)return O();if(!r||E.substring(0,v)!==r){if(y){if(_=[],P(E.split(n)),U(),h)return O()}else P(E.split(n));if(s&&s<=k)return _=_.slice(0,s),O(!0)}}return O()}for(var T=e.indexOf(n,c),x=e.indexOf(i,c),L=new RegExp(f(u)+f(t),"g"),I=e.indexOf(t,c);;)if(e[c]!==t)if(r&&0===E.length&&e.substring(c,c+v)===r){if(-1===x)return O();c=x+m,x=e.indexOf(i,c),T=e.indexOf(n,c)}else{if(-1!==T&&(T<x||-1===x)){if(!(T<I)){E.push(e.substring(c,T)),c=T+g,T=e.indexOf(n,c);continue}var A=z(T,I,x);if(A&&void 0!==A.nextDelim){T=A.nextDelim,I=A.quoteSearch,E.push(e.substring(c,T)),c=T+g,T=e.indexOf(n,c);continue}}if(-1===x)break;if(E.push(e.substring(c,x)),M(x+m),y&&(U(),h))return O();if(s&&_.length>=s)return O(!0)}else for(I=c,c++;;){if(-1===(I=e.indexOf(t,I+1)))return d||b.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:_.length,index:c}),R();if(I===p-1)return R(e.substring(c,I).replace(L,t));if(t!==u||e[I+1]!==u){if(t===u||0===I||e[I-1]!==u){-1!==T&&T<I+1&&(T=e.indexOf(n,I+1)),-1!==x&&x<I+1&&(x=e.indexOf(i,I+1));var D=B(-1===x?T:Math.min(T,x));if(e[I+1+D]===n){E.push(e.substring(c,I).replace(L,t)),e[c=I+1+D+g]!==t&&(I=e.indexOf(t,c)),T=e.indexOf(n,c),x=e.indexOf(i,c);break}var N=B(x);if(e.substring(I+1+N,I+1+N+m)===i){if(E.push(e.substring(c,I).replace(L,t)),M(I+1+N+m),T=e.indexOf(n,c),I=e.indexOf(t,c),y&&(U(),h))return O();if(s&&_.length>=s)return O(!0);break}b.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:_.length,index:c}),I++}}else I++}return R();function P(e){_.push(e),C=c}function B(t){var n=0;if(-1!==t){var i=e.substring(I+1,t);i&&""===i.trim()&&(n=i.length)}return n}function R(t){return d||(void 0===t&&(t=e.substring(c)),E.push(t),c=p,P(E),y&&U()),O()}function M(t){c=t,P(E),E=[],x=e.indexOf(i,c)}function O(e){return{data:_,errors:b,meta:{delimiter:n,linebreak:i,aborted:h,truncated:!!e,cursor:C+(a||0)}}}function U(){o(O()),_=[],b=[]}function z(i,r,o){var a={nextDelim:void 0,quoteSearch:void 0},s=e.indexOf(t,r+1);if(r<i&&i<s&&(s<o||-1===o)){var l=e.indexOf(n,s);if(-1===l)return a;s<l&&(s=e.indexOf(t,s+1)),a=z(l,s,o)}else a={nextDelim:i,quoteSearch:r};return a}},this.abort=function(){h=!0},this.getCharIndex=function(){return c}}function m(e){var t=e.data,n=r[t.workerId],i=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var o={abort:function(){i=!0,v(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:y,resume:y};if(w(n.userStep)){for(var a=0;a<t.results.data.length&&(n.userStep({data:t.results.data[a],errors:t.results.errors,meta:t.results.meta},o),!i);a++);delete t.results}else w(n.userChunk)&&(n.userChunk(t.results,o,t.file),delete t.results)}t.finished&&!i&&v(t.workerId,t.results)}function v(e,t){var n=r[e];w(n.userComplete)&&n.userComplete(t),n.terminate(),delete r[e]}function y(){throw new Error("Not implemented.")}function _(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var n in e)t[n]=_(e[n]);return t}function b(e,t){return function(){e.apply(t,arguments)}}function w(e){return"function"==typeof e}return i&&(t.onmessage=function(e){var n=e.data;if(void 0===a.WORKER_ID&&n&&(a.WORKER_ID=n.workerId),"string"==typeof n.input)t.postMessage({workerId:a.WORKER_ID,results:a.parse(n.input,n.config),finished:!0});else if(t.File&&n.input instanceof File||n.input instanceof Object){var i=a.parse(n.input,n.config);i&&t.postMessage({workerId:a.WORKER_ID,results:i,finished:!0})}}),(u.prototype=Object.create(l.prototype)).constructor=u,(c.prototype=Object.create(l.prototype)).constructor=c,(h.prototype=Object.create(h.prototype)).constructor=h,(d.prototype=Object.create(l.prototype)).constructor=d,a}()}));let h;function d(e,t){let n;const i=new RegExp(t+"\\s*\\(","g"),r=[];if(!e||!t)return r;for(;null!==(n=i.exec(e));){const t=[];let o=1,a=n.index,s=i.lastIndex,l=s-1;for(;0!==o&&l<e.length;)l++,"("===e[l]?o++:")"===e[l]?o--:","===e[l]&&1===o&&(t.push(e.substring(s,l).trim()),s=l+1);s<l&&t.push(e.substring(s,l).trim()),r.push([e.substring(a,l+1),t])}return r}function p(e){return/^".+"$/.test(e)||/^'.+'$/.test(e)?e.substring(1,e.length-1):e}function f(e,t){if("object"==typeof e&&null!==e&&e.name){t=t||"";const n=e.name.split(".");return n.length>1?n[n.length-2]+=t:1===n.length&&(n[0]+=t),n.join(".")}return""}function g(e){return!isNaN(parseFloat(e))&&isFinite(e)}function m(e){const t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),r=new Uint8Array(i);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return new Blob([r],{type:n})}function v(e){const t=e.clipboardData||window.clipboardData;return t?t.getData("text"):null}function y(){let e=[];for(var t=0,n=arguments.length;t<n;t++)e=e.concat(arguments[t].split("/"));let i=[];for(t=0,n=e.length;t<n;t++){var r=e[t];r&&"."!==r&&(".."===r?i.pop():i.push(r))}return""===e[0]&&i.unshift(""),i.join("/")||(i.length?"/":".")}const _={};function b(e){const t=c.parse(e.trim(),{skipEmptyLines:!0});if(t.errors.length)throw t.errors[0];return t.data}function w(e,t){let n=e.shift();const i=[];t="object"!=typeof t?{}:t,n=n.map(e=>e.trim()),n=n.map((e,n)=>{const r=e.split("::");let o;return r&&2===r.length?(o=t[r[1]]||r[1],i[n]=o,r[0]):(i[n]="",e)}),n.every(E);const r=(new DOMParser).parseFromString("<root></root>","text/xml");return e.forEach(e=>{const t=r.createElement("item");r.firstChild.appendChild(t),e.forEach((e,o)=>{const a=r.createElement(n[o]);i[o]&&a.setAttribute("lang",i[o]),a.textContent=e.trim(),t.appendChild(a)})}),r}function E(e){if(/^(?!xml)[A-Za-z._][A-Za-z0-9._]*$/.test(e))return!0;throw new Error(`CSV column heading "${e}" cannot be turned into a valid XML element`)}var C={blobToDataUri:function(e,t){let n;const i=t||(e&&e.name?e.name:null),r=i?_[i]:null;return new Promise((t,o)=>{r?t(r):e instanceof Blob?(n=new FileReader,n.onloadend=()=>{const e=n.result;i&&(_[i]=e),t(e)},n.onerror=e=>{o(e)},n.readAsDataURL(e)):o(new Error("TypeError: Require Blob"))})},blobToArrayBuffer:function(e){const t=new FileReader;return new Promise((n,i)=>{t.onloadend=()=>{n(t.result)},t.onerror=e=>{i(e)},e instanceof Blob?t.readAsArrayBuffer(e):i(new Error("TypeError: Require Blob"))})},dataUriToBlob:function(e){let t;return new Promise((n,i)=>{try{t=m(e),n(t)}catch(e){i(e)}})},dataUriToBlobSync:m,getThemeFromFormStr:function(e){const t=e.match(/<\s?form .*theme-([A-z-]+)/);return t&&t.length>1?t[1]:null},getTitleFromFormStr:function(e){if("string"!=typeof e)return void console.error("Cannot extract form title. Not a string.");const t=e.match(/<\s?h3 [^>]*id="form-title">([^<]+)</);return t&&t.length>1?t[1]:null},csvToXml:function(e,t){return w(b(e),t)},arrayToXml:w,csvToArray:b,getQueryString:function(e){let t,n;return t=Array.isArray(e)?e:[e],n=t.reduce((e,t)=>{let n="";return t&&void 0!==t.name&&void 0!==t.value&&""!==t.value&&null!==t.value&&(n=e?"&":"",n+=function(e,t){let n,i="";if("object"==typeof t){for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i&&(i+="&"),i+=`${encodeURIComponent(e)}[${encodeURIComponent(n)}]=${encodeURIComponent(t[n])}`);return i}return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`}(t.name,t.value)),e+n},""),n.length>0?"?"+n:""},getEnketoId:function(e){const t=(e=e.endsWith("/")?e.substring(0,e.length-1):e).substring(e.lastIndexOf("/")+1);return"preview"===t||"i"===t?null:t}};const S=function(){let e,t;const n=window.location.search.substring(1).split("&"),i={};for(let r=0;r<n.length;r++){const o=n[r].split("=");o[0].length>0&&(e=decodeURIComponent(o[1]),t="true"===e||"false"!==e&&e,i[o[0]]=t)}return i}(),k={};[{q:"return",s:"returnUrl"},{q:"returnURL",s:"returnUrl"},"returnUrl",{q:"server",s:"serverUrl"},{q:"serverURL",s:"serverUrl"},"serverUrl",{q:"form",s:"xformUrl"},{q:"id",s:"xformId"},"instanceId",{q:"instance_id",s:"instanceId"},"parentWindowOrigin","print","format","landscape","margin","touch"].forEach(e=>{"string"==typeof e&&void 0!==S[e]&&void 0===k[e]?k[e]=S[e]:void 0!==S[e.q]&&void 0===k[e.s]&&(k[e.s]=S[e.q])}),k.loginUrl=a.basePath+"/login",k.defaultReturnUrl=a.basePath+"/thanks",k.defaults={};for(const e in S)if(Object.prototype.hasOwnProperty.call(S,e)){const t=decodeURIComponent(e).match(/d\[(.*)\]/);t&&t[1]&&(k.defaults[t[1]]=decodeURIComponent(S[e]))}for(const e in a)Object.prototype.hasOwnProperty.call(a,e)&&(k[e]=a[e]);k.submissionParameter&&k.submissionParameter.name&&(k.submissionParameter.value=S[k.submissionParameter.name]),k.languageOverrideParameter=S.lang?{name:"lang",value:S.lang}:void 0,k.maxSize=5242880,window.location.pathname.includes("/preview/")||window.location.pathname.endsWith("/preview")?k.type="preview":window.location.pathname.includes("/single/")?k.type="single":window.location.pathname.includes("/edit/")?k.type="edit":window.location.pathname.includes("/view/")?k.type="view":k.type="other",k.offline=window.location.pathname.includes("/x/"),k.offlinePath=k.offline?"/x":"",k.enketoId=C.getEnketoId(window.location.pathname),"single"===k.type&&k.enketoId.length<32&&(k.multipleAllowed=!0),k.goTo="edit"===k.type||"preview"===k.type||"view"===k.type,k.printRelevantOnly=!!k.instanceId;var T=u((function(e){
/*!
     * jQuery JavaScript Library v3.5.1
     * https://jquery.com/
     *
     * Includes Sizzle.js
     * https://sizzlejs.com/
     *
     * Copyright JS Foundation and other contributors
     * Released under the MIT license
     * https://jquery.org/license
     *
     * Date: 2020-05-04T22:49Z
     */
!function(t,n){e.exports=t.document?n(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return n(e)}}("undefined"!=typeof window?window:s,(function(e,t){var n=[],i=Object.getPrototypeOf,r=n.slice,o=n.flat?function(e){return n.flat.call(e)}:function(e){return n.concat.apply([],e)},a=n.push,s=n.indexOf,l={},u=l.toString,c=l.hasOwnProperty,h=c.toString,d=h.call(Object),p={},f=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},g=function(e){return null!=e&&e===e.window},m=e.document,v={type:!0,src:!0,nonce:!0,noModule:!0};function y(e,t,n){var i,r,o=(n=n||m).createElement("script");if(o.text=e,t)for(i in v)(r=t[i]||t.getAttribute&&t.getAttribute(i))&&o.setAttribute(i,r);n.head.appendChild(o).parentNode.removeChild(o)}function _(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[u.call(e)]||"object":typeof e}var b=function e(t,n){return new e.fn.init(t,n)};function w(e){var t=!!e&&"length"in e&&e.length,n=_(e);return!f(e)&&!g(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}b.fn=b.prototype={jquery:"3.5.1",constructor:b,length:0,toArray:function(){return r.call(this)},get:function(e){return null==e?r.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return b.each(this,e)},map:function(e){return this.pushStack(b.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(b.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(b.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:a,sort:n.sort,splice:n.splice},b.extend=b.fn.extend=function(){var e,t,n,i,r,o,a=arguments[0]||{},s=1,l=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[s]||{},s++),"object"==typeof a||f(a)||(a={}),s===l&&(a=this,s--);s<l;s++)if(null!=(e=arguments[s]))for(t in e)i=e[t],"__proto__"!==t&&a!==i&&(u&&i&&(b.isPlainObject(i)||(r=Array.isArray(i)))?(n=a[t],o=r&&!Array.isArray(n)?[]:r||b.isPlainObject(n)?n:{},r=!1,a[t]=b.extend(u,o,i)):void 0!==i&&(a[t]=i));return a},b.extend({expando:"jQuery"+("3.5.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==u.call(e))&&(!(t=i(e))||"function"==typeof(n=c.call(t,"constructor")&&t.constructor)&&h.call(n)===d)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){y(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,i=0;if(w(e))for(n=e.length;i<n&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(w(Object(e))?b.merge(n,"string"==typeof e?[e]:e):a.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:s.call(t,e,n)},merge:function(e,t){for(var n=+t.length,i=0,r=e.length;i<n;i++)e[r++]=t[i];return e.length=r,e},grep:function(e,t,n){for(var i=[],r=0,o=e.length,a=!n;r<o;r++)!t(e[r],r)!==a&&i.push(e[r]);return i},map:function(e,t,n){var i,r,a=0,s=[];if(w(e))for(i=e.length;a<i;a++)null!=(r=t(e[a],a,n))&&s.push(r);else for(a in e)null!=(r=t(e[a],a,n))&&s.push(r);return o(s)},guid:1,support:p}),"function"==typeof Symbol&&(b.fn[Symbol.iterator]=n[Symbol.iterator]),b.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){l["[object "+t+"]"]=t.toLowerCase()}));var E=
/*!
     * Sizzle CSS Selector Engine v2.3.5
     * https://sizzlejs.com/
     *
     * Copyright JS Foundation and other contributors
     * Released under the MIT license
     * https://js.foundation/
     *
     * Date: 2020-03-14
     */
function(e){var t,n,i,r,o,a,s,l,u,c,h,d,p,f,g,m,v,y,_,b="sizzle"+1*new Date,w=e.document,E=0,C=0,S=le(),k=le(),T=le(),x=le(),L=function(e,t){return e===t&&(h=!0),0},I={}.hasOwnProperty,A=[],D=A.pop,N=A.push,P=A.push,B=A.slice,R=function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},M="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",O="[\\x20\\t\\r\\n\\f]",U="(?:\\\\[\\da-fA-F]{1,6}"+O+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",z="\\["+O+"*("+U+")(?:"+O+"*([*^$|!~]?=)"+O+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+U+"))|)"+O+"*\\]",F=":("+U+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+z+")*)|.*)\\)|)",V=new RegExp(O+"+","g"),q=new RegExp("^"+O+"+|((?:^|[^\\\\])(?:\\\\.)*)"+O+"+$","g"),j=new RegExp("^"+O+"*,"+O+"*"),$=new RegExp("^"+O+"*([>+~]|"+O+")"+O+"*"),H=new RegExp(O+"|>"),W=new RegExp(F),K=new RegExp("^"+U+"$"),G={ID:new RegExp("^#("+U+")"),CLASS:new RegExp("^\\.("+U+")"),TAG:new RegExp("^("+U+"|[*])"),ATTR:new RegExp("^"+z),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+O+"*(even|odd|(([+-]|)(\\d*)n|)"+O+"*(?:([+-]|)"+O+"*(\\d+)|))"+O+"*\\)|)","i"),bool:new RegExp("^(?:"+M+")$","i"),needsContext:new RegExp("^"+O+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+O+"*((?:-\\d)?\\d*)"+O+"*\\)|)(?=[^-]|$)","i")},Z=/HTML$/i,Y=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+O+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},ie=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,re=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){d()},ae=be((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{P.apply(A=B.call(w.childNodes),w.childNodes),A[w.childNodes.length].nodeType}catch(e){P={apply:A.length?function(e,t){N.apply(e,B.call(t))}:function(e,t){for(var n=e.length,i=0;e[n++]=t[i++];);e.length=n-1}}}function se(e,t,i,r){var o,s,u,c,h,f,v,y=t&&t.ownerDocument,w=t?t.nodeType:9;if(i=i||[],"string"!=typeof e||!e||1!==w&&9!==w&&11!==w)return i;if(!r&&(d(t),t=t||p,g)){if(11!==w&&(h=J.exec(e)))if(o=h[1]){if(9===w){if(!(u=t.getElementById(o)))return i;if(u.id===o)return i.push(u),i}else if(y&&(u=y.getElementById(o))&&_(t,u)&&u.id===o)return i.push(u),i}else{if(h[2])return P.apply(i,t.getElementsByTagName(e)),i;if((o=h[3])&&n.getElementsByClassName&&t.getElementsByClassName)return P.apply(i,t.getElementsByClassName(o)),i}if(n.qsa&&!x[e+" "]&&(!m||!m.test(e))&&(1!==w||"object"!==t.nodeName.toLowerCase())){if(v=e,y=t,1===w&&(H.test(e)||$.test(e))){for((y=ee.test(e)&&ve(t.parentNode)||t)===t&&n.scope||((c=t.getAttribute("id"))?c=c.replace(ie,re):t.setAttribute("id",c=b)),s=(f=a(e)).length;s--;)f[s]=(c?"#"+c:":scope")+" "+_e(f[s]);v=f.join(",")}try{return P.apply(i,y.querySelectorAll(v)),i}catch(t){x(e,!0)}finally{c===b&&t.removeAttribute("id")}}}return l(e.replace(q,"$1"),t,i,r)}function le(){var e=[];return function t(n,r){return e.push(n+" ")>i.cacheLength&&delete t[e.shift()],t[n+" "]=r}}function ue(e){return e[b]=!0,e}function ce(e){var t=p.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function he(e,t){for(var n=e.split("|"),r=n.length;r--;)i.attrHandle[n[r]]=t}function de(e,t){var n=t&&e,i=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function pe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function fe(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ge(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ae(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function me(e){return ue((function(t){return t=+t,ue((function(n,i){for(var r,o=e([],n.length,t),a=o.length;a--;)n[r=o[a]]&&(n[r]=!(i[r]=n[r]))}))}))}function ve(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=se.support={},o=se.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!Z.test(t||n&&n.nodeName||"HTML")},d=se.setDocument=function(e){var t,r,a=e?e.ownerDocument||e:w;return a!=p&&9===a.nodeType&&a.documentElement?(f=(p=a).documentElement,g=!o(p),w!=p&&(r=p.defaultView)&&r.top!==r&&(r.addEventListener?r.addEventListener("unload",oe,!1):r.attachEvent&&r.attachEvent("onunload",oe)),n.scope=ce((function(e){return f.appendChild(e).appendChild(p.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),n.attributes=ce((function(e){return e.className="i",!e.getAttribute("className")})),n.getElementsByTagName=ce((function(e){return e.appendChild(p.createComment("")),!e.getElementsByTagName("*").length})),n.getElementsByClassName=Q.test(p.getElementsByClassName),n.getById=ce((function(e){return f.appendChild(e).id=b,!p.getElementsByName||!p.getElementsByName(b).length})),n.getById?(i.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},i.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var n=t.getElementById(e);return n?[n]:[]}}):(i.filter.ID=function(e){var t=e.replace(te,ne);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},i.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var n,i,r,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];for(r=t.getElementsByName(e),i=0;o=r[i++];)if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),i.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,i=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[r++];)1===n.nodeType&&i.push(n);return i}return o},i.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&g)return t.getElementsByClassName(e)},v=[],m=[],(n.qsa=Q.test(p.querySelectorAll))&&(ce((function(e){var t;f.appendChild(e).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+O+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+O+"*(?:value|"+M+")"),e.querySelectorAll("[id~="+b+"-]").length||m.push("~="),(t=p.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||m.push("\\["+O+"*name"+O+"*="+O+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+b+"+*").length||m.push(".#.+[+~]"),e.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")})),ce((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=p.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+O+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),f.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")}))),(n.matchesSelector=Q.test(y=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&ce((function(e){n.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),v.push("!=",F)})),m=m.length&&new RegExp(m.join("|")),v=v.length&&new RegExp(v.join("|")),t=Q.test(f.compareDocumentPosition),_=t||Q.test(f.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},L=t?function(e,t){if(e===t)return h=!0,0;var i=!e.compareDocumentPosition-!t.compareDocumentPosition;return i||(1&(i=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===i?e==p||e.ownerDocument==w&&_(w,e)?-1:t==p||t.ownerDocument==w&&_(w,t)?1:c?R(c,e)-R(c,t):0:4&i?-1:1)}:function(e,t){if(e===t)return h=!0,0;var n,i=0,r=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!r||!o)return e==p?-1:t==p?1:r?-1:o?1:c?R(c,e)-R(c,t):0;if(r===o)return de(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;a[i]===s[i];)i++;return i?de(a[i],s[i]):a[i]==w?-1:s[i]==w?1:0},p):p},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(d(e),n.matchesSelector&&g&&!x[t+" "]&&(!v||!v.test(t))&&(!m||!m.test(t)))try{var i=y.call(e,t);if(i||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(e){x(t,!0)}return se(t,p,null,[e]).length>0},se.contains=function(e,t){return(e.ownerDocument||e)!=p&&d(e),_(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=p&&d(e);var r=i.attrHandle[t.toLowerCase()],o=r&&I.call(i.attrHandle,t.toLowerCase())?r(e,t,!g):void 0;return void 0!==o?o:n.attributes||!g?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},se.escape=function(e){return(e+"").replace(ie,re)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,i=[],r=0,o=0;if(h=!n.detectDuplicates,c=!n.sortStable&&e.slice(0),e.sort(L),h){for(;t=e[o++];)t===e[o]&&(r=i.push(o));for(;r--;)e.splice(i[r],1)}return c=null,e},r=se.getText=function(e){var t,n="",i=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=r(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[i++];)n+=r(t);return n},(i=se.selectors={cacheLength:50,createPseudo:ue,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&W.test(n)&&(t=a(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=S[e+" "];return t||(t=new RegExp("(^|"+O+")"+e+"("+O+"|$)"))&&S(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(i){var r=se.attr(i,e);return null==r?"!="===t:!t||(r+="","="===t?r===n:"!="===t?r!==n:"^="===t?n&&0===r.indexOf(n):"*="===t?n&&r.indexOf(n)>-1:"$="===t?n&&r.slice(-n.length)===n:"~="===t?(" "+r.replace(V," ")+" ").indexOf(n)>-1:"|="===t&&(r===n||r.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,i,r){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===i&&0===r?function(e){return!!e.parentNode}:function(t,n,l){var u,c,h,d,p,f,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!l&&!s,_=!1;if(m){if(o){for(;g;){for(d=t;d=d[g];)if(s?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[a?m.firstChild:m.lastChild],a&&y){for(_=(p=(u=(c=(h=(d=m)[b]||(d[b]={}))[d.uniqueID]||(h[d.uniqueID]={}))[e]||[])[0]===E&&u[1])&&u[2],d=p&&m.childNodes[p];d=++p&&d&&d[g]||(_=p=0)||f.pop();)if(1===d.nodeType&&++_&&d===t){c[e]=[E,p,_];break}}else if(y&&(_=p=(u=(c=(h=(d=t)[b]||(d[b]={}))[d.uniqueID]||(h[d.uniqueID]={}))[e]||[])[0]===E&&u[1]),!1===_)for(;(d=++p&&d&&d[g]||(_=p=0)||f.pop())&&((s?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++_||(y&&((c=(h=d[b]||(d[b]={}))[d.uniqueID]||(h[d.uniqueID]={}))[e]=[E,_]),d!==t)););return(_-=r)===i||_%i==0&&_/i>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ue((function(e,n){for(var i,o=r(e,t),a=o.length;a--;)e[i=R(e,o[a])]=!(n[i]=o[a])})):function(e){return r(e,0,n)}):r}},pseudos:{not:ue((function(e){var t=[],n=[],i=s(e.replace(q,"$1"));return i[b]?ue((function(e,t,n,r){for(var o,a=i(e,null,r,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))})):function(e,r,o){return t[0]=e,i(t,null,o,n),t[0]=null,!n.pop()}})),has:ue((function(e){return function(t){return se(e,t).length>0}})),contains:ue((function(e){return e=e.replace(te,ne),function(t){return(t.textContent||r(t)).indexOf(e)>-1}})),lang:ue((function(e){return K.test(e||"")||se.error("unsupported lang: "+e),e=e.replace(te,ne).toLowerCase(),function(t){var n;do{if(n=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return X.test(e.nodeName)},input:function(e){return Y.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:me((function(){return[0]})),last:me((function(e,t){return[t-1]})),eq:me((function(e,t,n){return[n<0?n+t:n]})),even:me((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:me((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:me((function(e,t,n){for(var i=n<0?n+t:n>t?t:n;--i>=0;)e.push(i);return e})),gt:me((function(e,t,n){for(var i=n<0?n+t:n;++i<t;)e.push(i);return e}))}}).pseudos.nth=i.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[t]=pe(t);for(t in{submit:!0,reset:!0})i.pseudos[t]=fe(t);function ye(){}function _e(e){for(var t=0,n=e.length,i="";t<n;t++)i+=e[t].value;return i}function be(e,t,n){var i=t.dir,r=t.next,o=r||i,a=n&&"parentNode"===o,s=C++;return t.first?function(t,n,r){for(;t=t[i];)if(1===t.nodeType||a)return e(t,n,r);return!1}:function(t,n,l){var u,c,h,d=[E,s];if(l){for(;t=t[i];)if((1===t.nodeType||a)&&e(t,n,l))return!0}else for(;t=t[i];)if(1===t.nodeType||a)if(c=(h=t[b]||(t[b]={}))[t.uniqueID]||(h[t.uniqueID]={}),r&&r===t.nodeName.toLowerCase())t=t[i]||t;else{if((u=c[o])&&u[0]===E&&u[1]===s)return d[2]=u[2];if(c[o]=d,d[2]=e(t,n,l))return!0}return!1}}function we(e){return e.length>1?function(t,n,i){for(var r=e.length;r--;)if(!e[r](t,n,i))return!1;return!0}:e[0]}function Ee(e,t,n,i,r){for(var o,a=[],s=0,l=e.length,u=null!=t;s<l;s++)(o=e[s])&&(n&&!n(o,i,r)||(a.push(o),u&&t.push(s)));return a}function Ce(e,t,n,i,r,o){return i&&!i[b]&&(i=Ce(i)),r&&!r[b]&&(r=Ce(r,o)),ue((function(o,a,s,l){var u,c,h,d=[],p=[],f=a.length,g=o||function(e,t,n){for(var i=0,r=t.length;i<r;i++)se(e,t[i],n);return n}(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:Ee(g,d,e,s,l),v=n?r||(o?e:f||i)?[]:a:m;if(n&&n(m,v,s,l),i)for(u=Ee(v,p),i(u,[],s,l),c=u.length;c--;)(h=u[c])&&(v[p[c]]=!(m[p[c]]=h));if(o){if(r||e){if(r){for(u=[],c=v.length;c--;)(h=v[c])&&u.push(m[c]=h);r(null,v=[],u,l)}for(c=v.length;c--;)(h=v[c])&&(u=r?R(o,h):d[c])>-1&&(o[u]=!(a[u]=h))}}else v=Ee(v===a?v.splice(f,v.length):v),r?r(null,a,v,l):P.apply(a,v)}))}function Se(e){for(var t,n,r,o=e.length,a=i.relative[e[0].type],s=a||i.relative[" "],l=a?1:0,c=be((function(e){return e===t}),s,!0),h=be((function(e){return R(t,e)>-1}),s,!0),d=[function(e,n,i){var r=!a&&(i||n!==u)||((t=n).nodeType?c(e,n,i):h(e,n,i));return t=null,r}];l<o;l++)if(n=i.relative[e[l].type])d=[be(we(d),n)];else{if((n=i.filter[e[l].type].apply(null,e[l].matches))[b]){for(r=++l;r<o&&!i.relative[e[r].type];r++);return Ce(l>1&&we(d),l>1&&_e(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(q,"$1"),n,l<r&&Se(e.slice(l,r)),r<o&&Se(e=e.slice(r)),r<o&&_e(e))}d.push(n)}return we(d)}return ye.prototype=i.filters=i.pseudos,i.setFilters=new ye,a=se.tokenize=function(e,t){var n,r,o,a,s,l,u,c=k[e+" "];if(c)return t?0:c.slice(0);for(s=e,l=[],u=i.preFilter;s;){for(a in n&&!(r=j.exec(s))||(r&&(s=s.slice(r[0].length)||s),l.push(o=[])),n=!1,(r=$.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(q," ")}),s=s.slice(n.length)),i.filter)!(r=G[a].exec(s))||u[a]&&!(r=u[a](r))||(n=r.shift(),o.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?se.error(e):k(e,l).slice(0)},s=se.compile=function(e,t){var n,r=[],o=[],s=T[e+" "];if(!s){for(t||(t=a(e)),n=t.length;n--;)(s=Se(t[n]))[b]?r.push(s):o.push(s);(s=T(e,function(e,t){var n=t.length>0,r=e.length>0,o=function(o,a,s,l,c){var h,f,m,v=0,y="0",_=o&&[],b=[],w=u,C=o||r&&i.find.TAG("*",c),S=E+=null==w?1:Math.random()||.1,k=C.length;for(c&&(u=a==p||a||c);y!==k&&null!=(h=C[y]);y++){if(r&&h){for(f=0,a||h.ownerDocument==p||(d(h),s=!g);m=e[f++];)if(m(h,a||p,s)){l.push(h);break}c&&(E=S)}n&&((h=!m&&h)&&v--,o&&_.push(h))}if(v+=y,n&&y!==v){for(f=0;m=t[f++];)m(_,b,a,s);if(o){if(v>0)for(;y--;)_[y]||b[y]||(b[y]=D.call(l));b=Ee(b)}P.apply(l,b),c&&!o&&b.length>0&&v+t.length>1&&se.uniqueSort(l)}return c&&(E=S,u=w),_};return n?ue(o):o}(o,r))).selector=e}return s},l=se.select=function(e,t,n,r){var o,l,u,c,h,d="function"==typeof e&&e,p=!r&&a(e=d.selector||e);if(n=n||[],1===p.length){if((l=p[0]=p[0].slice(0)).length>2&&"ID"===(u=l[0]).type&&9===t.nodeType&&g&&i.relative[l[1].type]){if(!(t=(i.find.ID(u.matches[0].replace(te,ne),t)||[])[0]))return n;d&&(t=t.parentNode),e=e.slice(l.shift().value.length)}for(o=G.needsContext.test(e)?0:l.length;o--&&(u=l[o],!i.relative[c=u.type]);)if((h=i.find[c])&&(r=h(u.matches[0].replace(te,ne),ee.test(l[0].type)&&ve(t.parentNode)||t))){if(l.splice(o,1),!(e=r.length&&_e(l)))return P.apply(n,r),n;break}}return(d||s(e,p))(r,t,!g,n,!t||ee.test(e)&&ve(t.parentNode)||t),n},n.sortStable=b.split("").sort(L).join("")===b,n.detectDuplicates=!!h,d(),n.sortDetached=ce((function(e){return 1&e.compareDocumentPosition(p.createElement("fieldset"))})),ce((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||he("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),n.attributes&&ce((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||he("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),ce((function(e){return null==e.getAttribute("disabled")}))||he(M,(function(e,t,n){var i;if(!n)return!0===e[t]?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null})),se}(e);b.find=E,(b.expr=E.selectors)[":"]=b.expr.pseudos,b.uniqueSort=b.unique=E.uniqueSort,b.text=E.getText,b.isXMLDoc=E.isXML,b.contains=E.contains,b.escapeSelector=E.escape;var C=function(e,t,n){for(var i=[],r=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&b(e).is(n))break;i.push(e)}return i},S=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=b.expr.match.needsContext;function T(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var x=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function L(e,t,n){return f(t)?b.grep(e,(function(e,i){return!!t.call(e,i,e)!==n})):t.nodeType?b.grep(e,(function(e){return e===t!==n})):"string"!=typeof t?b.grep(e,(function(e){return s.call(t,e)>-1!==n})):b.filter(t,e,n)}b.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?b.find.matchesSelector(i,e)?[i]:[]:b.find.matches(e,b.grep(t,(function(e){return 1===e.nodeType})))},b.fn.extend({find:function(e){var t,n,i=this.length,r=this;if("string"!=typeof e)return this.pushStack(b(e).filter((function(){for(t=0;t<i;t++)if(b.contains(r[t],this))return!0})));for(n=this.pushStack([]),t=0;t<i;t++)b.find(e,r[t],n);return i>1?b.uniqueSort(n):n},filter:function(e){return this.pushStack(L(this,e||[],!1))},not:function(e){return this.pushStack(L(this,e||[],!0))},is:function(e){return!!L(this,"string"==typeof e&&k.test(e)?b(e):e||[],!1).length}});var I,A=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(b.fn.init=function(e,t,n){var i,r;if(!e)return this;if(n=n||I,"string"==typeof e){if(!(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:A.exec(e))||!i[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof b?t[0]:t,b.merge(this,b.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:m,!0)),x.test(i[1])&&b.isPlainObject(t))for(i in t)f(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return(r=m.getElementById(i[2]))&&(this[0]=r,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):f(e)?void 0!==n.ready?n.ready(e):e(b):b.makeArray(e,this)}).prototype=b.fn,I=b(m);var D=/^(?:parents|prev(?:Until|All))/,N={children:!0,contents:!0,next:!0,prev:!0};function P(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}b.fn.extend({has:function(e){var t=b(e,this),n=t.length;return this.filter((function(){for(var e=0;e<n;e++)if(b.contains(this,t[e]))return!0}))},closest:function(e,t){var n,i=0,r=this.length,o=[],a="string"!=typeof e&&b(e);if(!k.test(e))for(;i<r;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&b.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?b.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?s.call(b(e),this[0]):s.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(b.uniqueSort(b.merge(this.get(),b(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return C(e,"parentNode")},parentsUntil:function(e,t,n){return C(e,"parentNode",n)},next:function(e){return P(e,"nextSibling")},prev:function(e){return P(e,"previousSibling")},nextAll:function(e){return C(e,"nextSibling")},prevAll:function(e){return C(e,"previousSibling")},nextUntil:function(e,t,n){return C(e,"nextSibling",n)},prevUntil:function(e,t,n){return C(e,"previousSibling",n)},siblings:function(e){return S((e.parentNode||{}).firstChild,e)},children:function(e){return S(e.firstChild)},contents:function(e){return null!=e.contentDocument&&i(e.contentDocument)?e.contentDocument:(T(e,"template")&&(e=e.content||e),b.merge([],e.childNodes))}},(function(e,t){b.fn[e]=function(n,i){var r=b.map(this,t,n);return"Until"!==e.slice(-5)&&(i=n),i&&"string"==typeof i&&(r=b.filter(i,r)),this.length>1&&(N[e]||b.uniqueSort(r),D.test(e)&&r.reverse()),this.pushStack(r)}}));var B=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function O(e,t,n,i){var r;try{e&&f(r=e.promise)?r.call(e).done(t).fail(n):e&&f(r=e.then)?r.call(e,t,n):t.apply(void 0,[e].slice(i))}catch(e){n.apply(void 0,[e])}}b.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return b.each(e.match(B)||[],(function(e,n){t[n]=!0})),t}(e):b.extend({},e);var t,n,i,r,o=[],a=[],s=-1,l=function(){for(r=r||e.once,i=t=!0;a.length;s=-1)for(n=a.shift();++s<o.length;)!1===o[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=o.length,n=!1);e.memory||(n=!1),t=!1,r&&(o=n?[]:"")},u={add:function(){return o&&(n&&!t&&(s=o.length-1,a.push(n)),function t(n){b.each(n,(function(n,i){f(i)?e.unique&&u.has(i)||o.push(i):i&&i.length&&"string"!==_(i)&&t(i)}))}(arguments),n&&!t&&l()),this},remove:function(){return b.each(arguments,(function(e,t){for(var n;(n=b.inArray(t,o,n))>-1;)o.splice(n,1),n<=s&&s--})),this},has:function(e){return e?b.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return r=a=[],o=n="",this},disabled:function(){return!o},lock:function(){return r=a=[],n||t||(o=n=""),this},locked:function(){return!!r},fireWith:function(e,n){return r||(n=[e,(n=n||[]).slice?n.slice():n],a.push(n),t||l()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!i}};return u},b.extend({Deferred:function(t){var n=[["notify","progress",b.Callbacks("memory"),b.Callbacks("memory"),2],["resolve","done",b.Callbacks("once memory"),b.Callbacks("once memory"),0,"resolved"],["reject","fail",b.Callbacks("once memory"),b.Callbacks("once memory"),1,"rejected"]],i="pending",r={state:function(){return i},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return r.then(null,e)},pipe:function(){var e=arguments;return b.Deferred((function(t){b.each(n,(function(n,i){var r=f(e[i[4]])&&e[i[4]];o[i[1]]((function(){var e=r&&r.apply(this,arguments);e&&f(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[i[0]+"With"](this,r?[e]:arguments)}))})),e=null})).promise()},then:function(t,i,r){var o=0;function a(t,n,i,r){return function(){var s=this,l=arguments,u=function(){var e,u;if(!(t<o)){if((e=i.apply(s,l))===n.promise())throw new TypeError("Thenable self-resolution");u=e&&("object"==typeof e||"function"==typeof e)&&e.then,f(u)?r?u.call(e,a(o,n,R,r),a(o,n,M,r)):(o++,u.call(e,a(o,n,R,r),a(o,n,M,r),a(o,n,R,n.notifyWith))):(i!==R&&(s=void 0,l=[e]),(r||n.resolveWith)(s,l))}},c=r?u:function(){try{u()}catch(e){b.Deferred.exceptionHook&&b.Deferred.exceptionHook(e,c.stackTrace),t+1>=o&&(i!==M&&(s=void 0,l=[e]),n.rejectWith(s,l))}};t?c():(b.Deferred.getStackHook&&(c.stackTrace=b.Deferred.getStackHook()),e.setTimeout(c))}}return b.Deferred((function(e){n[0][3].add(a(0,e,f(r)?r:R,e.notifyWith)),n[1][3].add(a(0,e,f(t)?t:R)),n[2][3].add(a(0,e,f(i)?i:M))})).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},o={};return b.each(n,(function(e,t){var a=t[2],s=t[5];r[t[1]]=a.add,s&&a.add((function(){i=s}),n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),a.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=a.fireWith})),r.promise(o),t&&t.call(o,o),o},when:function(e){var t=arguments.length,n=t,i=Array(n),o=r.call(arguments),a=b.Deferred(),s=function(e){return function(n){i[e]=this,o[e]=arguments.length>1?r.call(arguments):n,--t||a.resolveWith(i,o)}};if(t<=1&&(O(e,a.done(s(n)).resolve,a.reject,!t),"pending"===a.state()||f(o[n]&&o[n].then)))return a.then();for(;n--;)O(o[n],s(n),a.reject);return a.promise()}});var U=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;b.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&U.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},b.readyException=function(t){e.setTimeout((function(){throw t}))};var z=b.Deferred();function F(){m.removeEventListener("DOMContentLoaded",F),e.removeEventListener("load",F),b.ready()}b.fn.ready=function(e){return z.then(e).catch((function(e){b.readyException(e)})),this},b.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--b.readyWait:b.isReady)||(b.isReady=!0,!0!==e&&--b.readyWait>0||z.resolveWith(m,[b]))}}),b.ready.then=z.then,"complete"===m.readyState||"loading"!==m.readyState&&!m.documentElement.doScroll?e.setTimeout(b.ready):(m.addEventListener("DOMContentLoaded",F),e.addEventListener("load",F));var V=function e(t,n,i,r,o,a,s){var l=0,u=t.length,c=null==i;if("object"===_(i))for(l in o=!0,i)e(t,n,l,i[l],!0,a,s);else if(void 0!==r&&(o=!0,f(r)||(s=!0),c&&(s?(n.call(t,r),n=null):(c=n,n=function(e,t,n){return c.call(b(e),n)})),n))for(;l<u;l++)n(t[l],i,s?r:r.call(t[l],l,n(t[l],i)));return o?t:c?n.call(t):u?n(t[0],i):a},q=/^-ms-/,j=/-([a-z])/g;function $(e,t){return t.toUpperCase()}function H(e){return e.replace(q,"ms-").replace(j,$)}var W=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function K(){this.expando=b.expando+K.uid++}K.uid=1,K.prototype={cache:function(e){var t=e[this.expando];return t||(t={},W(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var i,r=this.cache(e);if("string"==typeof t)r[H(t)]=n;else for(i in t)r[H(i)]=t[i];return r},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][H(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,i=e[this.expando];if(void 0!==i){if(void 0!==t){n=(t=Array.isArray(t)?t.map(H):(t=H(t))in i?[t]:t.match(B)||[]).length;for(;n--;)delete i[t[n]]}(void 0===t||b.isEmptyObject(i))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!b.isEmptyObject(t)}};var G=new K,Z=new K,Y=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,X=/[A-Z]/g;function Q(e,t,n){var i;if(void 0===n&&1===e.nodeType)if(i="data-"+t.replace(X,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(i))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Y.test(e)?JSON.parse(e):e)}(n)}catch(e){}Z.set(e,t,n)}else n=void 0;return n}b.extend({hasData:function(e){return Z.hasData(e)||G.hasData(e)},data:function(e,t,n){return Z.access(e,t,n)},removeData:function(e,t){Z.remove(e,t)},_data:function(e,t,n){return G.access(e,t,n)},_removeData:function(e,t){G.remove(e,t)}}),b.fn.extend({data:function(e,t){var n,i,r,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(r=Z.get(o),1===o.nodeType&&!G.get(o,"hasDataAttrs"))){for(n=a.length;n--;)a[n]&&0===(i=a[n].name).indexOf("data-")&&(i=H(i.slice(5)),Q(o,i,r[i]));G.set(o,"hasDataAttrs",!0)}return r}return"object"==typeof e?this.each((function(){Z.set(this,e)})):V(this,(function(t){var n;if(o&&void 0===t)return void 0!==(n=Z.get(o,e))||void 0!==(n=Q(o,e))?n:void 0;this.each((function(){Z.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){Z.remove(this,e)}))}}),b.extend({queue:function(e,t,n){var i;if(e)return t=(t||"fx")+"queue",i=G.get(e,t),n&&(!i||Array.isArray(n)?i=G.access(e,t,b.makeArray(n)):i.push(n)),i||[]},dequeue:function(e,t){var n=b.queue(e,t=t||"fx"),i=n.length,r=n.shift(),o=b._queueHooks(e,t);"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===t&&n.unshift("inprogress"),delete o.stop,r.call(e,(function(){b.dequeue(e,t)}),o)),!i&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return G.get(e,n)||G.access(e,n,{empty:b.Callbacks("once memory").add((function(){G.remove(e,[t+"queue",n])}))})}}),b.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?b.queue(this[0],e):void 0===t?this:this.each((function(){var n=b.queue(this,e,t);b._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&b.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){b.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,i=1,r=b.Deferred(),o=this,a=this.length,s=function(){--i||r.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(n=G.get(o[a],e+"queueHooks"))&&n.empty&&(i++,n.empty.add(s));return s(),r.promise(t)}});var J=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ee=new RegExp("^(?:([+-])=|)("+J+")([a-z%]*)$","i"),te=["Top","Right","Bottom","Left"],ne=m.documentElement,ie=function(e){return b.contains(e.ownerDocument,e)},re={composed:!0};ne.getRootNode&&(ie=function(e){return b.contains(e.ownerDocument,e)||e.getRootNode(re)===e.ownerDocument});var oe=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===b.css(e,"display")};function ae(e,t,n,i){var r,o,a=20,s=i?function(){return i.cur()}:function(){return b.css(e,t,"")},l=s(),u=n&&n[3]||(b.cssNumber[t]?"":"px"),c=e.nodeType&&(b.cssNumber[t]||"px"!==u&&+l)&&ee.exec(b.css(e,t));if(c&&c[3]!==u){for(l/=2,u=u||c[3],c=+l||1;a--;)b.style(e,t,c+u),(1-o)*(1-(o=s()/l||.5))<=0&&(a=0),c/=o;b.style(e,t,(c*=2)+u),n=n||[]}return n&&(c=+c||+l||0,r=n[1]?c+(n[1]+1)*n[2]:+n[2],i&&(i.unit=u,i.start=c,i.end=r)),r}var se={};function le(e){var t,n=e.ownerDocument,i=e.nodeName,r=se[i];return r||(t=n.body.appendChild(n.createElement(i)),r=b.css(t,"display"),t.parentNode.removeChild(t),"none"===r&&(r="block"),se[i]=r,r)}function ue(e,t){for(var n,i,r=[],o=0,a=e.length;o<a;o++)(i=e[o]).style&&(n=i.style.display,t?("none"===n&&(r[o]=G.get(i,"display")||null,r[o]||(i.style.display="")),""===i.style.display&&oe(i)&&(r[o]=le(i))):"none"!==n&&(r[o]="none",G.set(i,"display",n)));for(o=0;o<a;o++)null!=r[o]&&(e[o].style.display=r[o]);return e}b.fn.extend({show:function(){return ue(this,!0)},hide:function(){return ue(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){oe(this)?b(this).show():b(this).hide()}))}});var ce,he,de=/^(?:checkbox|radio)$/i,pe=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,fe=/^$|^module$|\/(?:java|ecma)script/i;ce=m.createDocumentFragment().appendChild(m.createElement("div")),(he=m.createElement("input")).setAttribute("type","radio"),he.setAttribute("checked","checked"),he.setAttribute("name","t"),ce.appendChild(he),p.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",p.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",p.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function me(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&T(e,t)?b.merge([e],n):n}function ve(e,t){for(var n=0,i=e.length;n<i;n++)G.set(e[n],"globalEval",!t||G.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,p.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var ye=/<|&#?\w+;/;function _e(e,t,n,i,r){for(var o,a,s,l,u,c,h=t.createDocumentFragment(),d=[],p=0,f=e.length;p<f;p++)if((o=e[p])||0===o)if("object"===_(o))b.merge(d,o.nodeType?[o]:o);else if(ye.test(o)){for(a=a||h.appendChild(t.createElement("div")),s=(pe.exec(o)||["",""])[1].toLowerCase(),l=ge[s]||ge._default,a.innerHTML=l[1]+b.htmlPrefilter(o)+l[2],c=l[0];c--;)a=a.lastChild;b.merge(d,a.childNodes),(a=h.firstChild).textContent=""}else d.push(t.createTextNode(o));for(h.textContent="",p=0;o=d[p++];)if(i&&b.inArray(o,i)>-1)r&&r.push(o);else if(u=ie(o),a=me(h.appendChild(o),"script"),u&&ve(a),n)for(c=0;o=a[c++];)fe.test(o.type||"")&&n.push(o);return h}var be=/^key/,we=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ee=/^([^.]*)(?:\.(.+)|)/;function Ce(){return!0}function Se(){return!1}function ke(e,t){return e===function(){try{return m.activeElement}catch(e){}}()==("focus"===t)}function Te(e,t,n,i,r,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(i=i||n,n=void 0),t)Te(e,s,n,i,t[s],o);return e}if(null==i&&null==r?(r=n,i=n=void 0):null==r&&("string"==typeof n?(r=i,i=void 0):(r=i,i=n,n=void 0)),!1===r)r=Se;else if(!r)return e;return 1===o&&(a=r,(r=function(e){return b().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=b.guid++)),e.each((function(){b.event.add(this,t,r,i,n)}))}function xe(e,t,n){n?(G.set(e,t,!1),b.event.add(e,t,{namespace:!1,handler:function(e){var i,o,a=G.get(this,t);if(1&e.isTrigger&&this[t]){if(a.length)(b.event.special[t]||{}).delegateType&&e.stopPropagation();else if(a=r.call(arguments),G.set(this,t,a),i=n(this,t),this[t](),a!==(o=G.get(this,t))||i?G.set(this,t,!1):o={},a!==o)return e.stopImmediatePropagation(),e.preventDefault(),o.value}else a.length&&(G.set(this,t,{value:b.event.trigger(b.extend(a[0],b.Event.prototype),a.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===G.get(e,t)&&b.event.add(e,t,Ce)}b.event={global:{},add:function(e,t,n,i,r){var o,a,s,l,u,c,h,d,p,f,g,m=G.get(e);if(W(e))for(n.handler&&(n=(o=n).handler,r=o.selector),r&&b.find.matchesSelector(ne,r),n.guid||(n.guid=b.guid++),(l=m.events)||(l=m.events=Object.create(null)),(a=m.handle)||(a=m.handle=function(t){return void 0!==b&&b.event.triggered!==t.type?b.event.dispatch.apply(e,arguments):void 0}),u=(t=(t||"").match(B)||[""]).length;u--;)p=g=(s=Ee.exec(t[u])||[])[1],f=(s[2]||"").split(".").sort(),p&&(h=b.event.special[p]||{},p=(r?h.delegateType:h.bindType)||p,h=b.event.special[p]||{},c=b.extend({type:p,origType:g,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&b.expr.match.needsContext.test(r),namespace:f.join(".")},o),(d=l[p])||((d=l[p]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(e,i,f,a)||e.addEventListener&&e.addEventListener(p,a)),h.add&&(h.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),r?d.splice(d.delegateCount++,0,c):d.push(c),b.event.global[p]=!0)},remove:function(e,t,n,i,r){var o,a,s,l,u,c,h,d,p,f,g,m=G.hasData(e)&&G.get(e);if(m&&(l=m.events)){for(u=(t=(t||"").match(B)||[""]).length;u--;)if(p=g=(s=Ee.exec(t[u])||[])[1],f=(s[2]||"").split(".").sort(),p){for(h=b.event.special[p]||{},d=l[p=(i?h.delegateType:h.bindType)||p]||[],s=s[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=d.length;o--;)c=d[o],!r&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||i&&i!==c.selector&&("**"!==i||!c.selector)||(d.splice(o,1),c.selector&&d.delegateCount--,h.remove&&h.remove.call(e,c));a&&!d.length&&(h.teardown&&!1!==h.teardown.call(e,f,m.handle)||b.removeEvent(e,p,m.handle),delete l[p])}else for(p in l)b.event.remove(e,p+t[u],n,i,!0);b.isEmptyObject(l)&&G.remove(e,"handle events")}},dispatch:function(e){var t,n,i,r,o,a,s=new Array(arguments.length),l=b.event.fix(e),u=(G.get(this,"events")||Object.create(null))[l.type]||[],c=b.event.special[l.type]||{};for(s[0]=l,t=1;t<arguments.length;t++)s[t]=arguments[t];if(l.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,l)){for(a=b.event.handlers.call(this,l,u),t=0;(r=a[t++])&&!l.isPropagationStopped();)for(l.currentTarget=r.elem,n=0;(o=r.handlers[n++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==o.namespace&&!l.rnamespace.test(o.namespace)||(l.handleObj=o,l.data=o.data,void 0!==(i=((b.event.special[o.origType]||{}).handle||o.handler).apply(r.elem,s))&&!1===(l.result=i)&&(l.preventDefault(),l.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,l),l.result}},handlers:function(e,t){var n,i,r,o,a,s=[],l=t.delegateCount,u=e.target;if(l&&u.nodeType&&!("click"===e.type&&e.button>=1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&("click"!==e.type||!0!==u.disabled)){for(o=[],a={},n=0;n<l;n++)void 0===a[r=(i=t[n]).selector+" "]&&(a[r]=i.needsContext?b(r,this).index(u)>-1:b.find(r,this,null,[u]).length),a[r]&&o.push(i);o.length&&s.push({elem:u,handlers:o})}return u=this,l<t.length&&s.push({elem:u,handlers:t.slice(l)}),s},addProp:function(e,t){Object.defineProperty(b.Event.prototype,e,{enumerable:!0,configurable:!0,get:f(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[b.expando]?e:new b.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return de.test(t.type)&&t.click&&T(t,"input")&&xe(t,"click",Ce),!1},trigger:function(e){var t=this||e;return de.test(t.type)&&t.click&&T(t,"input")&&xe(t,"click"),!0},_default:function(e){var t=e.target;return de.test(t.type)&&t.click&&T(t,"input")&&G.get(t,"click")||T(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},b.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},(b.Event=function(e,t){if(!(this instanceof b.Event))return new b.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ce:Se,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&b.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[b.expando]=!0}).prototype={constructor:b.Event,isDefaultPrevented:Se,isPropagationStopped:Se,isImmediatePropagationStopped:Se,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ce,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ce,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ce,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},b.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&be.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&we.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},b.event.addProp),b.each({focus:"focusin",blur:"focusout"},(function(e,t){b.event.special[e]={setup:function(){return xe(this,e,ke),!1},trigger:function(){return xe(this,e),!0},delegateType:t}})),b.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,r=e.relatedTarget,o=e.handleObj;return r&&(r===i||b.contains(i,r))||(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}})),b.fn.extend({on:function(e,t,n,i){return Te(this,e,t,n,i)},one:function(e,t,n,i){return Te(this,e,t,n,i,1)},off:function(e,t,n){var i,r;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(r in e)this.off(r,t,e[r]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Se),this.each((function(){b.event.remove(this,e,n,t)}))}});var Le=/<script|<style|<link/i,Ie=/checked\s*(?:[^=]|=\s*.checked.)/i,Ae=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function De(e,t){return T(e,"table")&&T(11!==t.nodeType?t:t.firstChild,"tr")&&b(e).children("tbody")[0]||e}function Ne(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Pe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Be(e,t){var n,i,r,o,a,s;if(1===t.nodeType){if(G.hasData(e)&&(s=G.get(e).events))for(r in G.remove(t,"handle events"),s)for(n=0,i=s[r].length;n<i;n++)b.event.add(t,r,s[r][n]);Z.hasData(e)&&(o=Z.access(e),a=b.extend({},o),Z.set(t,a))}}function Re(e,t){var n=t.nodeName.toLowerCase();"input"===n&&de.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function Me(e,t,n,i){t=o(t);var r,a,s,l,u,c,h=0,d=e.length,g=d-1,m=t[0],v=f(m);if(v||d>1&&"string"==typeof m&&!p.checkClone&&Ie.test(m))return e.each((function(r){var o=e.eq(r);v&&(t[0]=m.call(this,r,o.html())),Me(o,t,n,i)}));if(d&&(a=(r=_e(t,e[0].ownerDocument,!1,e,i)).firstChild,1===r.childNodes.length&&(r=a),a||i)){for(l=(s=b.map(me(r,"script"),Ne)).length;h<d;h++)u=r,h!==g&&(u=b.clone(u,!0,!0),l&&b.merge(s,me(u,"script"))),n.call(e[h],u,h);if(l)for(c=s[s.length-1].ownerDocument,b.map(s,Pe),h=0;h<l;h++)u=s[h],fe.test(u.type||"")&&!G.access(u,"globalEval")&&b.contains(c,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?b._evalUrl&&!u.noModule&&b._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},c):y(u.textContent.replace(Ae,""),u,c))}return e}function Oe(e,t,n){for(var i,r=t?b.filter(t,e):e,o=0;null!=(i=r[o]);o++)n||1!==i.nodeType||b.cleanData(me(i)),i.parentNode&&(n&&ie(i)&&ve(me(i,"script")),i.parentNode.removeChild(i));return e}b.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var i,r,o,a,s=e.cloneNode(!0),l=ie(e);if(!(p.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(a=me(s),i=0,r=(o=me(e)).length;i<r;i++)Re(o[i],a[i]);if(t)if(n)for(o=o||me(e),a=a||me(s),i=0,r=o.length;i<r;i++)Be(o[i],a[i]);else Be(e,s);return(a=me(s,"script")).length>0&&ve(a,!l&&me(e,"script")),s},cleanData:function(e){for(var t,n,i,r=b.event.special,o=0;void 0!==(n=e[o]);o++)if(W(n)){if(t=n[G.expando]){if(t.events)for(i in t.events)r[i]?b.event.remove(n,i):b.removeEvent(n,i,t.handle);n[G.expando]=void 0}n[Z.expando]&&(n[Z.expando]=void 0)}}}),b.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return V(this,(function(e){return void 0===e?b.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return Me(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||De(this,e).appendChild(e)}))},prepend:function(){return Me(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=De(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return Me(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return Me(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(b.cleanData(me(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return b.clone(this,e,t)}))},html:function(e){return V(this,(function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Le.test(e)&&!ge[(pe.exec(e)||["",""])[1].toLowerCase()]){e=b.htmlPrefilter(e);try{for(;n<i;n++)1===(t=this[n]||{}).nodeType&&(b.cleanData(me(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return Me(this,arguments,(function(t){var n=this.parentNode;b.inArray(this,e)<0&&(b.cleanData(me(this)),n&&n.replaceChild(t,this))}),e)}}),b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){b.fn[e]=function(e){for(var n,i=[],r=b(e),o=r.length-1,s=0;s<=o;s++)n=s===o?this:this.clone(!0),b(r[s])[t](n),a.apply(i,n.get());return this.pushStack(i)}}));var Ue=new RegExp("^("+J+")(?!px)[a-z%]+$","i"),ze=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},Fe=function(e,t,n){var i,r,o={};for(r in t)o[r]=e.style[r],e.style[r]=t[r];for(r in i=n.call(e),t)e.style[r]=o[r];return i},Ve=new RegExp(te.join("|"),"i");function qe(e,t,n){var i,r,o,a,s=e.style;return(n=n||ze(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||ie(e)||(a=b.style(e,t)),!p.pixelBoxStyles()&&Ue.test(a)&&Ve.test(t)&&(i=s.width,r=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=i,s.minWidth=r,s.maxWidth=o)),void 0!==a?a+"":a}function je(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function t(){if(c){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ne.appendChild(u).appendChild(c);var t=e.getComputedStyle(c);i="1%"!==t.top,l=12===n(t.marginLeft),c.style.right="60%",a=36===n(t.right),r=36===n(t.width),c.style.position="absolute",o=12===n(c.offsetWidth/3),ne.removeChild(u),c=null}}function n(e){return Math.round(parseFloat(e))}var i,r,o,a,s,l,u=m.createElement("div"),c=m.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",p.clearCloneStyle="content-box"===c.style.backgroundClip,b.extend(p,{boxSizingReliable:function(){return t(),r},pixelBoxStyles:function(){return t(),a},pixelPosition:function(){return t(),i},reliableMarginLeft:function(){return t(),l},scrollboxSize:function(){return t(),o},reliableTrDimensions:function(){var t,n,i,r;return null==s&&(t=m.createElement("table"),n=m.createElement("tr"),i=m.createElement("div"),t.style.cssText="position:absolute;left:-11111px",n.style.height="1px",i.style.height="9px",ne.appendChild(t).appendChild(n).appendChild(i),r=e.getComputedStyle(n),s=parseInt(r.height)>3,ne.removeChild(t)),s}}))}();var $e=["Webkit","Moz","ms"],He=m.createElement("div").style,We={};function Ke(e){var t=b.cssProps[e]||We[e];return t||(e in He?e:We[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=$e.length;n--;)if((e=$e[n]+t)in He)return e}(e)||e)}var Ge=/^(none|table(?!-c[ea]).+)/,Ze=/^--/,Ye={position:"absolute",visibility:"hidden",display:"block"},Xe={letterSpacing:"0",fontWeight:"400"};function Qe(e,t,n){var i=ee.exec(t);return i?Math.max(0,i[2]-(n||0))+(i[3]||"px"):t}function Je(e,t,n,i,r,o){var a="width"===t?1:0,s=0,l=0;if(n===(i?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(l+=b.css(e,n+te[a],!0,r)),i?("content"===n&&(l-=b.css(e,"padding"+te[a],!0,r)),"margin"!==n&&(l-=b.css(e,"border"+te[a]+"Width",!0,r))):(l+=b.css(e,"padding"+te[a],!0,r),"padding"!==n?l+=b.css(e,"border"+te[a]+"Width",!0,r):s+=b.css(e,"border"+te[a]+"Width",!0,r));return!i&&o>=0&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-l-s-.5))||0),l}function et(e,t,n){var i=ze(e),r=(!p.boxSizingReliable()||n)&&"border-box"===b.css(e,"boxSizing",!1,i),o=r,a=qe(e,t,i),s="offset"+t[0].toUpperCase()+t.slice(1);if(Ue.test(a)){if(!n)return a;a="auto"}return(!p.boxSizingReliable()&&r||!p.reliableTrDimensions()&&T(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===b.css(e,"display",!1,i))&&e.getClientRects().length&&(r="border-box"===b.css(e,"boxSizing",!1,i),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Je(e,t,n||(r?"border":"content"),o,i,a)+"px"}function tt(e,t,n,i,r){return new tt.prototype.init(e,t,n,i,r)}b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=qe(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,o,a,s=H(t),l=Ze.test(t),u=e.style;if(l||(t=Ke(s)),a=b.cssHooks[t]||b.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(r=a.get(e,!1,i))?r:u[t];"string"===(o=typeof n)&&(r=ee.exec(n))&&r[1]&&(n=ae(e,t,r),o="number"),null!=n&&n==n&&("number"!==o||l||(n+=r&&r[3]||(b.cssNumber[s]?"":"px")),p.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,i))||(l?u.setProperty(t,n):u[t]=n))}},css:function(e,t,n,i){var r,o,a,s=H(t);return Ze.test(t)||(t=Ke(s)),(a=b.cssHooks[t]||b.cssHooks[s])&&"get"in a&&(r=a.get(e,!0,n)),void 0===r&&(r=qe(e,t,i)),"normal"===r&&t in Xe&&(r=Xe[t]),""===n||n?(o=parseFloat(r),!0===n||isFinite(o)?o||0:r):r}}),b.each(["height","width"],(function(e,t){b.cssHooks[t]={get:function(e,n,i){if(n)return!Ge.test(b.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?et(e,t,i):Fe(e,Ye,(function(){return et(e,t,i)}))},set:function(e,n,i){var r,o=ze(e),a=!p.scrollboxSize()&&"absolute"===o.position,s=(a||i)&&"border-box"===b.css(e,"boxSizing",!1,o),l=i?Je(e,t,i,s,o):0;return s&&a&&(l-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(o[t])-Je(e,t,"border",!1,o)-.5)),l&&(r=ee.exec(n))&&"px"!==(r[3]||"px")&&(e.style[t]=n,n=b.css(e,t)),Qe(0,n,l)}}})),b.cssHooks.marginLeft=je(p.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(qe(e,"marginLeft"))||e.getBoundingClientRect().left-Fe(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),b.each({margin:"",padding:"",border:"Width"},(function(e,t){b.cssHooks[e+t]={expand:function(n){for(var i=0,r={},o="string"==typeof n?n.split(" "):[n];i<4;i++)r[e+te[i]+t]=o[i]||o[i-2]||o[0];return r}},"margin"!==e&&(b.cssHooks[e+t].set=Qe)})),b.fn.extend({css:function(e,t){return V(this,(function(e,t,n){var i,r,o={},a=0;if(Array.isArray(t)){for(i=ze(e),r=t.length;a<r;a++)o[t[a]]=b.css(e,t[a],!1,i);return o}return void 0!==n?b.style(e,t,n):b.css(e,t)}),e,t,arguments.length>1)}}),b.Tween=tt,tt.prototype={constructor:tt,init:function(e,t,n,i,r,o){this.elem=e,this.prop=n,this.easing=r||b.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(b.cssNumber[n]?"":"px")},cur:function(){var e=tt.propHooks[this.prop];return e&&e.get?e.get(this):tt.propHooks._default.get(this)},run:function(e){var t,n=tt.propHooks[this.prop];return this.options.duration?this.pos=t=b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):tt.propHooks._default.set(this),this}},tt.prototype.init.prototype=tt.prototype,tt.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=b.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):1!==e.elem.nodeType||!b.cssHooks[e.prop]&&null==e.elem.style[Ke(e.prop)]?e.elem[e.prop]=e.now:b.style(e.elem,e.prop,e.now+e.unit)}}},tt.propHooks.scrollTop=tt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},(b.fx=tt.prototype.init).step={};var nt,it,rt=/^(?:toggle|show|hide)$/,ot=/queueHooks$/;function at(){it&&(!1===m.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(at):e.setTimeout(at,b.fx.interval),b.fx.tick())}function st(){return e.setTimeout((function(){nt=void 0})),nt=Date.now()}function lt(e,t){var n,i=0,r={height:e};for(t=t?1:0;i<4;i+=2-t)r["margin"+(n=te[i])]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function ut(e,t,n){for(var i,r=(ct.tweeners[t]||[]).concat(ct.tweeners["*"]),o=0,a=r.length;o<a;o++)if(i=r[o].call(n,t,e))return i}function ct(e,t,n){var i,r,o=0,a=ct.prefilters.length,s=b.Deferred().always((function(){delete l.elem})),l=function(){if(r)return!1;for(var t=nt||st(),n=Math.max(0,u.startTime+u.duration-t),i=1-(n/u.duration||0),o=0,a=u.tweens.length;o<a;o++)u.tweens[o].run(i);return s.notifyWith(e,[u,i,n]),i<1&&a?n:(a||s.notifyWith(e,[u,1,0]),s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{},easing:b.easing._default},n),originalProperties:t,originalOptions:n,startTime:nt||st(),duration:n.duration,tweens:[],createTween:function(t,n){var i=b.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(i),i},stop:function(t){var n=0,i=t?u.tweens.length:0;if(r)return this;for(r=!0;n<i;n++)u.tweens[n].run(1);return t?(s.notifyWith(e,[u,1,0]),s.resolveWith(e,[u,t])):s.rejectWith(e,[u,t]),this}}),c=u.props;for(!function(e,t){var n,i,r,o,a;for(n in e)if(r=t[i=H(n)],o=e[n],Array.isArray(o)&&(r=o[1],o=e[n]=o[0]),n!==i&&(e[i]=o,delete e[n]),(a=b.cssHooks[i])&&"expand"in a)for(n in o=a.expand(o),delete e[i],o)n in e||(e[n]=o[n],t[n]=r);else t[i]=r}(c,u.opts.specialEasing);o<a;o++)if(i=ct.prefilters[o].call(u,e,c,u.opts))return f(i.stop)&&(b._queueHooks(u.elem,u.opts.queue).stop=i.stop.bind(i)),i;return b.map(c,ut,u),f(u.opts.start)&&u.opts.start.call(e,u),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always),b.fx.timer(b.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u}b.Animation=b.extend(ct,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return ae(n.elem,e,ee.exec(t),n),n}]},tweener:function(e,t){f(e)?(t=e,e=["*"]):e=e.match(B);for(var n,i=0,r=e.length;i<r;i++)n=e[i],ct.tweeners[n]=ct.tweeners[n]||[],ct.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var i,r,o,a,s,l,u,c,h="width"in t||"height"in t,d=this,p={},f=e.style,g=e.nodeType&&oe(e),m=G.get(e,"fxshow");for(i in n.queue||(null==(a=b._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,d.always((function(){d.always((function(){a.unqueued--,b.queue(e,"fx").length||a.empty.fire()}))}))),t)if(r=t[i],rt.test(r)){if(delete t[i],o=o||"toggle"===r,r===(g?"hide":"show")){if("show"!==r||!m||void 0===m[i])continue;g=!0}p[i]=m&&m[i]||b.style(e,i)}if((l=!b.isEmptyObject(t))||!b.isEmptyObject(p))for(i in h&&1===e.nodeType&&(n.overflow=[f.overflow,f.overflowX,f.overflowY],null==(u=m&&m.display)&&(u=G.get(e,"display")),"none"===(c=b.css(e,"display"))&&(u?c=u:(ue([e],!0),u=e.style.display||u,c=b.css(e,"display"),ue([e]))),("inline"===c||"inline-block"===c&&null!=u)&&"none"===b.css(e,"float")&&(l||(d.done((function(){f.display=u})),null==u&&(c=f.display,u="none"===c?"":c)),f.display="inline-block")),n.overflow&&(f.overflow="hidden",d.always((function(){f.overflow=n.overflow[0],f.overflowX=n.overflow[1],f.overflowY=n.overflow[2]}))),l=!1,p)l||(m?"hidden"in m&&(g=m.hidden):m=G.access(e,"fxshow",{display:u}),o&&(m.hidden=!g),g&&ue([e],!0),d.done((function(){for(i in g||ue([e]),G.remove(e,"fxshow"),p)b.style(e,i,p[i])}))),l=ut(g?m[i]:0,i,d),i in m||(m[i]=l.start,g&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?ct.prefilters.unshift(e):ct.prefilters.push(e)}}),b.speed=function(e,t,n){var i=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||f(e)&&e,duration:e,easing:n&&t||t&&!f(t)&&t};return b.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in b.fx.speeds?i.duration=b.fx.speeds[i.duration]:i.duration=b.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){f(i.old)&&i.old.call(this),i.queue&&b.dequeue(this,i.queue)},i},b.fn.extend({fadeTo:function(e,t,n,i){return this.filter(oe).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var r=b.isEmptyObject(e),o=b.speed(t,n,i),a=function(){var t=ct(this,b.extend({},e),o);(r||G.get(this,"finish"))&&t.stop(!0)};return a.finish=a,r||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(e,t,n){var i=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,r=null!=e&&e+"queueHooks",o=b.timers,a=G.get(this);if(r)a[r]&&a[r].stop&&i(a[r]);else for(r in a)a[r]&&a[r].stop&&ot.test(r)&&i(a[r]);for(r=o.length;r--;)o[r].elem!==this||null!=e&&o[r].queue!==e||(o[r].anim.stop(n),t=!1,o.splice(r,1));!t&&n||b.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,n=G.get(this),i=n[e+"queue"],r=n[e+"queueHooks"],o=b.timers,a=i?i.length:0;for(n.finish=!0,b.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<a;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish}))}}),b.each(["toggle","show","hide"],(function(e,t){var n=b.fn[t];b.fn[t]=function(e,i,r){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(lt(t,!0),e,i,r)}})),b.each({slideDown:lt("show"),slideUp:lt("hide"),slideToggle:lt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){b.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}})),b.timers=[],b.fx.tick=function(){var e,t=0,n=b.timers;for(nt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||b.fx.stop(),nt=void 0},b.fx.timer=function(e){b.timers.push(e),b.fx.start()},b.fx.interval=13,b.fx.start=function(){it||(it=!0,at())},b.fx.stop=function(){it=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fn.delay=function(t,n){return t=b.fx&&b.fx.speeds[t]||t,n=n||"fx",this.queue(n,(function(n,i){var r=e.setTimeout(n,t);i.stop=function(){e.clearTimeout(r)}}))},function(){var e=m.createElement("input"),t=m.createElement("select").appendChild(m.createElement("option"));e.type="checkbox",p.checkOn=""!==e.value,p.optSelected=t.selected,(e=m.createElement("input")).value="t",e.type="radio",p.radioValue="t"===e.value}();var ht,dt=b.expr.attrHandle;b.fn.extend({attr:function(e,t){return V(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){b.removeAttr(this,e)}))}}),b.extend({attr:function(e,t,n){var i,r,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?b.prop(e,t,n):(1===o&&b.isXMLDoc(e)||(r=b.attrHooks[t.toLowerCase()]||(b.expr.match.bool.test(t)?ht:void 0)),void 0!==n?null===n?void b.removeAttr(e,t):r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:(e.setAttribute(t,n+""),n):r&&"get"in r&&null!==(i=r.get(e,t))?i:null==(i=b.find.attr(e,t))?void 0:i)},attrHooks:{type:{set:function(e,t){if(!p.radioValue&&"radio"===t&&T(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,i=0,r=t&&t.match(B);if(r&&1===e.nodeType)for(;n=r[i++];)e.removeAttribute(n)}}),ht={set:function(e,t,n){return!1===t?b.removeAttr(e,n):e.setAttribute(n,n),n}},b.each(b.expr.match.bool.source.match(/\w+/g),(function(e,t){var n=dt[t]||b.find.attr;dt[t]=function(e,t,i){var r,o,a=t.toLowerCase();return i||(o=dt[a],dt[a]=r,r=null!=n(e,t,i)?a:null,dt[a]=o),r}}));var pt=/^(?:input|select|textarea|button)$/i,ft=/^(?:a|area)$/i;function gt(e){return(e.match(B)||[]).join(" ")}function mt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(B)||[]}b.fn.extend({prop:function(e,t){return V(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[b.propFix[e]||e]}))}}),b.extend({prop:function(e,t,n){var i,r,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&b.isXMLDoc(e)||(t=b.propFix[t]||t,r=b.propHooks[t]),void 0!==n?r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:e[t]=n:r&&"get"in r&&null!==(i=r.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){var t=b.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||ft.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),p.optSelected||(b.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),b.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){b.propFix[this.toLowerCase()]=this})),b.fn.extend({addClass:function(e){var t,n,i,r,o,a,s,l=0;if(f(e))return this.each((function(t){b(this).addClass(e.call(this,t,mt(this)))}));if((t=vt(e)).length)for(;n=this[l++];)if(r=mt(n),i=1===n.nodeType&&" "+gt(r)+" "){for(a=0;o=t[a++];)i.indexOf(" "+o+" ")<0&&(i+=o+" ");r!==(s=gt(i))&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,i,r,o,a,s,l=0;if(f(e))return this.each((function(t){b(this).removeClass(e.call(this,t,mt(this)))}));if(!arguments.length)return this.attr("class","");if((t=vt(e)).length)for(;n=this[l++];)if(r=mt(n),i=1===n.nodeType&&" "+gt(r)+" "){for(a=0;o=t[a++];)for(;i.indexOf(" "+o+" ")>-1;)i=i.replace(" "+o+" "," ");r!==(s=gt(i))&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n=typeof e,i="string"===n||Array.isArray(e);return"boolean"==typeof t&&i?t?this.addClass(e):this.removeClass(e):f(e)?this.each((function(n){b(this).toggleClass(e.call(this,n,mt(this),t),t)})):this.each((function(){var t,r,o,a;if(i)for(r=0,o=b(this),a=vt(e);t=a[r++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else void 0!==e&&"boolean"!==n||((t=mt(this))&&G.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":G.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,i=0;for(t=" "+e+" ";n=this[i++];)if(1===n.nodeType&&(" "+gt(mt(n))+" ").indexOf(t)>-1)return!0;return!1}});var yt=/\r/g;b.fn.extend({val:function(e){var t,n,i,r=this[0];return arguments.length?(i=f(e),this.each((function(n){var r;1===this.nodeType&&(null==(r=i?e.call(this,n,b(this).val()):e)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=b.map(r,(function(e){return null==e?"":e+""}))),(t=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,r,"value")||(this.value=r))}))):r?(t=b.valHooks[r.type]||b.valHooks[r.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(r,"value"))?n:"string"==typeof(n=r.value)?n.replace(yt,""):null==n?"":n:void 0}}),b.extend({valHooks:{option:{get:function(e){var t=b.find.attr(e,"value");return null!=t?t:gt(b.text(e))}},select:{get:function(e){var t,n,i,r=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],l=a?o+1:r.length;for(i=o<0?l:a?o:0;i<l;i++)if(((n=r[i]).selected||i===o)&&!n.disabled&&(!n.parentNode.disabled||!T(n.parentNode,"optgroup"))){if(t=b(n).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var n,i,r=e.options,o=b.makeArray(t),a=r.length;a--;)((i=r[a]).selected=b.inArray(b.valHooks.option.get(i),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),b.each(["radio","checkbox"],(function(){b.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=b.inArray(b(e).val(),t)>-1}},p.checkOn||(b.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})),p.focusin="onfocusin"in e;var _t=/^(?:focusinfocus|focusoutblur)$/,bt=function(e){e.stopPropagation()};b.extend(b.event,{trigger:function(t,n,i,r){var o,a,s,l,u,h,d,p,v=[i||m],y=c.call(t,"type")?t.type:t,_=c.call(t,"namespace")?t.namespace.split("."):[];if(a=p=s=i=i||m,3!==i.nodeType&&8!==i.nodeType&&!_t.test(y+b.event.triggered)&&(y.indexOf(".")>-1&&(_=y.split("."),y=_.shift(),_.sort()),u=y.indexOf(":")<0&&"on"+y,(t=t[b.expando]?t:new b.Event(y,"object"==typeof t&&t)).isTrigger=r?2:3,t.namespace=_.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+_.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),n=null==n?[t]:b.makeArray(n,[t]),d=b.event.special[y]||{},r||!d.trigger||!1!==d.trigger.apply(i,n))){if(!r&&!d.noBubble&&!g(i)){for(l=d.delegateType||y,_t.test(l+y)||(a=a.parentNode);a;a=a.parentNode)v.push(a),s=a;s===(i.ownerDocument||m)&&v.push(s.defaultView||s.parentWindow||e)}for(o=0;(a=v[o++])&&!t.isPropagationStopped();)p=a,t.type=o>1?l:d.bindType||y,(h=(G.get(a,"events")||Object.create(null))[t.type]&&G.get(a,"handle"))&&h.apply(a,n),(h=u&&a[u])&&h.apply&&W(a)&&(t.result=h.apply(a,n),!1===t.result&&t.preventDefault());return t.type=y,r||t.isDefaultPrevented()||d._default&&!1!==d._default.apply(v.pop(),n)||!W(i)||u&&f(i[y])&&!g(i)&&((s=i[u])&&(i[u]=null),b.event.triggered=y,t.isPropagationStopped()&&p.addEventListener(y,bt),i[y](),t.isPropagationStopped()&&p.removeEventListener(y,bt),b.event.triggered=void 0,s&&(i[u]=s)),t.result}},simulate:function(e,t,n){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0});b.event.trigger(i,null,t)}}),b.fn.extend({trigger:function(e,t){return this.each((function(){b.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var n=this[0];if(n)return b.event.trigger(e,t,n,!0)}}),p.focusin||b.each({focus:"focusin",blur:"focusout"},(function(e,t){var n=function(e){b.event.simulate(t,e.target,b.event.fix(e))};b.event.special[t]={setup:function(){var i=this.ownerDocument||this.document||this,r=G.access(i,t);r||i.addEventListener(e,n,!0),G.access(i,t,(r||0)+1)},teardown:function(){var i=this.ownerDocument||this.document||this,r=G.access(i,t)-1;r?G.access(i,t,r):(i.removeEventListener(e,n,!0),G.remove(i,t))}}}));var wt=e.location,Et={guid:Date.now()},Ct=/\?/;b.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+t),n};var St=/\[\]$/,kt=/\r?\n/g,Tt=/^(?:submit|button|image|reset|file)$/i,xt=/^(?:input|select|textarea|keygen)/i;function Lt(e,t,n,i){var r;if(Array.isArray(t))b.each(t,(function(t,r){n||St.test(e)?i(e,r):Lt(e+"["+("object"==typeof r&&null!=r?t:"")+"]",r,n,i)}));else if(n||"object"!==_(t))i(e,t);else for(r in t)Lt(e+"["+r+"]",t[r],n,i)}b.param=function(e,t){var n,i=[],r=function(e,t){var n=f(t)?t():t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,(function(){r(this.name,this.value)}));else for(n in e)Lt(n,e[n],t,r);return i.join("&")},b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&xt.test(this.nodeName)&&!Tt.test(e)&&(this.checked||!de.test(e))})).map((function(e,t){var n=b(this).val();return null==n?null:Array.isArray(n)?b.map(n,(function(e){return{name:t.name,value:e.replace(kt,"\r\n")}})):{name:t.name,value:n.replace(kt,"\r\n")}})).get()}});var It=/%20/g,At=/#.*$/,Dt=/([?&])_=[^&]*/,Nt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Pt=/^(?:GET|HEAD)$/,Bt=/^\/\//,Rt={},Mt={},Ot="*/".concat("*"),Ut=m.createElement("a");function zt(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,r=0,o=t.toLowerCase().match(B)||[];if(f(n))for(;i=o[r++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function Ft(e,t,n,i){var r={},o=e===Mt;function a(s){var l;return r[s]=!0,b.each(e[s]||[],(function(e,s){var u=s(t,n,i);return"string"!=typeof u||o||r[u]?o?!(l=u):void 0:(t.dataTypes.unshift(u),a(u),!1)})),l}return a(t.dataTypes[0])||!r["*"]&&a("*")}function Vt(e,t){var n,i,r=b.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((r[n]?e:i||(i={}))[n]=t[n]);return i&&b.extend(!0,e,i),e}Ut.href=wt.href,b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:wt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(wt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ot,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Vt(Vt(e,b.ajaxSettings),t):Vt(b.ajaxSettings,e)},ajaxPrefilter:zt(Rt),ajaxTransport:zt(Mt),ajax:function(t,n){"object"==typeof t&&(n=t,t=void 0);var i,r,o,a,s,l,u,c,h,d,p=b.ajaxSetup({},n=n||{}),f=p.context||p,g=p.context&&(f.nodeType||f.jquery)?b(f):b.event,v=b.Deferred(),y=b.Callbacks("once memory"),_=p.statusCode||{},w={},E={},C="canceled",S={readyState:0,getResponseHeader:function(e){var t;if(u){if(!a)for(a={};t=Nt.exec(o);)a[t[1].toLowerCase()+" "]=(a[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=a[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return u?o:null},setRequestHeader:function(e,t){return null==u&&(e=E[e.toLowerCase()]=E[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==u&&(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(u)S.always(e[S.status]);else for(t in e)_[t]=[_[t],e[t]];return this},abort:function(e){var t=e||C;return i&&i.abort(t),k(0,t),this}};if(v.promise(S),p.url=((t||p.url||wt.href)+"").replace(Bt,wt.protocol+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(B)||[""],null==p.crossDomain){l=m.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=Ut.protocol+"//"+Ut.host!=l.protocol+"//"+l.host}catch(e){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=b.param(p.data,p.traditional)),Ft(Rt,p,n,S),u)return S;for(h in(c=b.event&&p.global)&&0==b.active++&&b.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Pt.test(p.type),r=p.url.replace(At,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(It,"+")):(d=p.url.slice(r.length),p.data&&(p.processData||"string"==typeof p.data)&&(r+=(Ct.test(r)?"&":"?")+p.data,delete p.data),!1===p.cache&&(r=r.replace(Dt,"$1"),d=(Ct.test(r)?"&":"?")+"_="+Et.guid+++d),p.url=r+d),p.ifModified&&(b.lastModified[r]&&S.setRequestHeader("If-Modified-Since",b.lastModified[r]),b.etag[r]&&S.setRequestHeader("If-None-Match",b.etag[r])),(p.data&&p.hasContent&&!1!==p.contentType||n.contentType)&&S.setRequestHeader("Content-Type",p.contentType),S.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Ot+"; q=0.01":""):p.accepts["*"]),p.headers)S.setRequestHeader(h,p.headers[h]);if(p.beforeSend&&(!1===p.beforeSend.call(f,S,p)||u))return S.abort();if(C="abort",y.add(p.complete),S.done(p.success),S.fail(p.error),i=Ft(Mt,p,n,S)){if(S.readyState=1,c&&g.trigger("ajaxSend",[S,p]),u)return S;p.async&&p.timeout>0&&(s=e.setTimeout((function(){S.abort("timeout")}),p.timeout));try{u=!1,i.send(w,k)}catch(e){if(u)throw e;k(-1,e)}}else k(-1,"No Transport");function k(t,n,a,l){var h,d,m,w,E,C=n;u||(u=!0,s&&e.clearTimeout(s),i=void 0,o=l||"",S.readyState=t>0?4:0,h=t>=200&&t<300||304===t,a&&(w=function(e,t,n){for(var i,r,o,a,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(r in s)if(s[r]&&s[r].test(i)){l.unshift(r);break}if(l[0]in n)o=l[0];else{for(r in n){if(!l[0]||e.converters[r+" "+l[0]]){o=r;break}a||(a=r)}o=o||a}if(o)return o!==l[0]&&l.unshift(o),n[o]}(p,S,a)),!h&&b.inArray("script",p.dataTypes)>-1&&(p.converters["text script"]=function(){}),w=function(e,t,n,i){var r,o,a,s,l,u={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)u[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(a=u[l+" "+o]||u["* "+o]))for(r in u)if((s=r.split(" "))[1]===o&&(a=u[l+" "+s[0]]||u["* "+s[0]])){!0===a?a=u[r]:!0!==u[r]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}(p,w,S,h),h?(p.ifModified&&((E=S.getResponseHeader("Last-Modified"))&&(b.lastModified[r]=E),(E=S.getResponseHeader("etag"))&&(b.etag[r]=E)),204===t||"HEAD"===p.type?C="nocontent":304===t?C="notmodified":(C=w.state,d=w.data,h=!(m=w.error))):(m=C,!t&&C||(C="error",t<0&&(t=0))),S.status=t,S.statusText=(n||C)+"",h?v.resolveWith(f,[d,C,S]):v.rejectWith(f,[S,C,m]),S.statusCode(_),_=void 0,c&&g.trigger(h?"ajaxSuccess":"ajaxError",[S,p,h?d:m]),y.fireWith(f,[S,C]),c&&(g.trigger("ajaxComplete",[S,p]),--b.active||b.event.trigger("ajaxStop")))}return S},getJSON:function(e,t,n){return b.get(e,t,n,"json")},getScript:function(e,t){return b.get(e,void 0,t,"script")}}),b.each(["get","post"],(function(e,t){b[t]=function(e,n,i,r){return f(n)&&(r=r||i,i=n,n=void 0),b.ajax(b.extend({url:e,type:t,dataType:r,data:n,success:i},b.isPlainObject(e)&&e))}})),b.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),b._evalUrl=function(e,t,n){return b.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){b.globalEval(e,t,n)}})},b.fn.extend({wrapAll:function(e){var t;return this[0]&&(f(e)&&(e=e.call(this[0])),t=b(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return f(e)?this.each((function(t){b(this).wrapInner(e.call(this,t))})):this.each((function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)}))},wrap:function(e){var t=f(e);return this.each((function(n){b(this).wrapAll(t?e.call(this,n):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){b(this).replaceWith(this.childNodes)})),this}}),b.expr.pseudos.hidden=function(e){return!b.expr.pseudos.visible(e)},b.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},b.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var qt={0:200,1223:204},jt=b.ajaxSettings.xhr();p.cors=!!jt&&"withCredentials"in jt,p.ajax=jt=!!jt,b.ajaxTransport((function(t){var n,i;if(p.cors||jt&&!t.crossDomain)return{send:function(r,o){var a,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)s[a]=t.xhrFields[a];for(a in t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)s.setRequestHeader(a,r[a]);n=function(e){return function(){n&&(n=i=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o(qt[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),i=s.onerror=s.ontimeout=n("error"),void 0!==s.onabort?s.onabort=i:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout((function(){n&&i()}))},n=n("abort");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}})),b.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),b.ajaxTransport("script",(function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(i,r){t=b("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&r("error"===e.type?404:200,e.type)}),m.head.appendChild(t[0])},abort:function(){n&&n()}}}));var $t,Ht=[],Wt=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Ht.pop()||b.expando+"_"+Et.guid++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",(function(t,n,i){var r,o,a,s=!1!==t.jsonp&&(Wt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Wt.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return r=t.jsonpCallback=f(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Wt,"$1"+r):!1!==t.jsonp&&(t.url+=(Ct.test(t.url)?"&":"?")+t.jsonp+"="+r),t.converters["script json"]=function(){return a||b.error(r+" was not called"),a[0]},t.dataTypes[0]="json",o=e[r],e[r]=function(){a=arguments},i.always((function(){void 0===o?b(e).removeProp(r):e[r]=o,t[r]&&(t.jsonpCallback=n.jsonpCallback,Ht.push(r)),a&&f(o)&&o(a[0]),a=o=void 0})),"script"})),p.createHTMLDocument=(($t=m.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===$t.childNodes.length),b.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(p.createHTMLDocument?((i=(t=m.implementation.createHTMLDocument("")).createElement("base")).href=m.location.href,t.head.appendChild(i)):t=m),o=!n&&[],(r=x.exec(e))?[t.createElement(r[1])]:(r=_e([e],t,o),o&&o.length&&b(o).remove(),b.merge([],r.childNodes)));var i,r,o},b.fn.load=function(e,t,n){var i,r,o,a=this,s=e.indexOf(" ");return s>-1&&(i=gt(e.slice(s)),e=e.slice(0,s)),f(t)?(n=t,t=void 0):t&&"object"==typeof t&&(r="POST"),a.length>0&&b.ajax({url:e,type:r||"GET",dataType:"html",data:t}).done((function(e){o=arguments,a.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)})).always(n&&function(e,t){a.each((function(){n.apply(this,o||[e.responseText,t,e])}))}),this},b.expr.pseudos.animated=function(e){return b.grep(b.timers,(function(t){return e===t.elem})).length},b.offset={setOffset:function(e,t,n){var i,r,o,a,s,l,u=b.css(e,"position"),c=b(e),h={};"static"===u&&(e.style.position="relative"),s=c.offset(),o=b.css(e,"top"),l=b.css(e,"left"),("absolute"===u||"fixed"===u)&&(o+l).indexOf("auto")>-1?(a=(i=c.position()).top,r=i.left):(a=parseFloat(o)||0,r=parseFloat(l)||0),f(t)&&(t=t.call(e,n,b.extend({},s))),null!=t.top&&(h.top=t.top-s.top+a),null!=t.left&&(h.left=t.left-s.left+r),"using"in t?t.using.call(e,h):("number"==typeof h.top&&(h.top+="px"),"number"==typeof h.left&&(h.left+="px"),c.css(h))}},b.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){b.offset.setOffset(this,e,t)}));var t,n,i=this[0];return i?i.getClientRects().length?(t=i.getBoundingClientRect(),n=i.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,i=this[0],r={top:0,left:0};if("fixed"===b.css(i,"position"))t=i.getBoundingClientRect();else{for(t=this.offset(),n=i.ownerDocument,e=i.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===b.css(e,"position");)e=e.parentNode;e&&e!==i&&1===e.nodeType&&((r=b(e).offset()).top+=b.css(e,"borderTopWidth",!0),r.left+=b.css(e,"borderLeftWidth",!0))}return{top:t.top-r.top-b.css(i,"marginTop",!0),left:t.left-r.left-b.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===b.css(e,"position");)e=e.offsetParent;return e||ne}))}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var n="pageYOffset"===t;b.fn[e]=function(i){return V(this,(function(e,i,r){var o;if(g(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===r)return o?o[t]:e[i];o?o.scrollTo(n?o.pageXOffset:r,n?r:o.pageYOffset):e[i]=r}),e,i,arguments.length)}})),b.each(["top","left"],(function(e,t){b.cssHooks[t]=je(p.pixelPosition,(function(e,n){if(n)return n=qe(e,t),Ue.test(n)?b(e).position()[t]+"px":n}))})),b.each({Height:"height",Width:"width"},(function(e,t){b.each({padding:"inner"+e,content:t,"":"outer"+e},(function(n,i){b.fn[i]=function(r,o){var a=arguments.length&&(n||"boolean"!=typeof r),s=n||(!0===r||!0===o?"margin":"border");return V(this,(function(t,n,r){var o;return g(t)?0===i.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===r?b.css(t,n,s):b.style(t,n,r,s)}),t,a?r:void 0,a)}}))})),b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){b.fn[t]=function(e){return this.on(t,e)}})),b.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),b.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}));var Kt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;b.proxy=function(e,t){var n,i,o;if("string"==typeof t&&(n=e[t],t=e,e=n),f(e))return i=r.call(arguments,2),(o=function(){return e.apply(t||this,i.concat(r.call(arguments)))}).guid=e.guid=e.guid||b.guid++,o},b.holdReady=function(e){e?b.readyWait++:b.ready(!0)},b.isArray=Array.isArray,b.parseJSON=JSON.parse,b.nodeName=T,b.isFunction=f,b.isWindow=g,b.camelCase=H,b.type=_,b.now=Date.now,b.isNumeric=function(e){var t=b.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},b.trim=function(e){return null==e?"":(e+"").replace(Kt,"")};var Gt=e.jQuery,Zt=e.$;return b.noConflict=function(t){return e.$===b&&(e.$=Zt),t&&e.jQuery===b&&(e.jQuery=Gt),b},void 0===t&&(e.jQuery=e.$=b),b}))}));let x,I,A;function D(){return I=I||function(){for(const e in document.styleSheets)if(Object.prototype.hasOwnProperty.call(document.styleSheets,e)){const t=document.styleSheets[e];if("print"===t.media.mediaText)return t}return null}(),A=A||document.querySelector('link[media="print"]'),I.media.mediaText="all",A.setAttribute("media","all"),!!I}function N(){return/theme-.*grid.*/.test(document.querySelector("form.or").getAttribute("class"))}function P(e,t=0){const n=document.querySelector(".main");return n.style.width=function(e){let t;const n={Letter:[8.5,11],Legal:[8.5,14],Tabloid:[11,17],Ledger:[17,11],A0:[33.1,46.8],A1:[23.4,33.1],A2:[16.5,23.4],A3:[11.7,16.5],A4:[8.27,11.7],A5:[5.83,8.27],A6:[4.13,5.83]};e.landscape="boolean"==typeof e.landscape?e.landscape:"landscape"===e.orientation,delete e.orientation,void 0===e.margin?e.margin=.4:/^[\d.]+in$/.test(e.margin.trim())?e.margin=parseFloat(e.margin,10):/^[\d.]+cm$/.test(e.margin.trim())?e.margin=parseFloat(e.margin,10)/2.54:/^[\d.]+mm$/.test(e.margin.trim())&&(e.margin=parseFloat(e.margin,10)/25.4);return e.format="string"==typeof e.format&&void 0!==n[e.format]?e.format:"A4",t=!0===e.landscape?n[e.format][1]:n[e.format][0],(t-2*e.margin)*x+"px"}(e),n.classList.add("print-width-adjusted"),new Promise(e=>{setTimeout(()=>{let t,n=[];const i=document.querySelector("#form-title"),r=i?i.offsetWidth-1:null,o=document.querySelectorAll(".question:not(.draft), .trigger:not(.draft)");o.forEach((e,i)=>{const a=i===o.length-1,s=T(e).offset().top;t=t||0===t?t:s,s===t&&(n=n.concat(e)),a&&B(n,r),s>t?(B(n,r),a&&!n.includes(e)?B([e],r):(n=[e],t=T(e).offset().top)):t<s&&console.error("unexpected question top position: ",s,"for element:",e,"expected >=",t)}),window.dispatchEvent(new CustomEvent("printviewready")),e()},t)})}function B(e,t){const n=[];let i=0,r=0;if(e.forEach(e=>{const t=Number(T(e).css("width").replace("px",""));n.push(t),i+=t}),i<t){const r=t-i;e.forEach((e,o)=>{const a=n[o]+n[o]/i*r;e.style.width=Math.floor(100*a/t*100)/100+"%",e.classList.add("print-width-adjusted")})}e.forEach(e=>{const t=e.offsetHeight;r=t>r?t:r}),e.forEach(e=>{e.classList.add("print-height-adjusted"),e.style.height=r+"px"})}function R(){document.querySelectorAll("details.or-form-guidance.active").forEach(e=>{e.open?e.dataset.previousOpen=!0:e.open=!0})}function M(){document.querySelectorAll("details.or-form-guidance.active").forEach(e=>{e.dataset.previousOpen?delete e.dataset.previousOpen:e.open=!1})}function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){U(e,t,n[t])}))}return e}function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function q(e,t,n){return t&&V(e.prototype,t),n&&V(e,n),e}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?j(e):t}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}document.addEventListener("DOMContentLoaded",()=>function(){const e={},t=document.body.appendChild(document.createElement("DIV"));t.style.width="1in",t.style.padding="0",e.v=t.offsetWidth,t.parentNode.removeChild(t),x=e.v}());var G={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},Z=new(function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};F(this,e),this.init(t,n)}return q(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||G,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,n,i){return i&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(n).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,z({},{prefix:"".concat(this.prefix,":").concat(t,":")},this.options))}}]),e}()),Y=function(){function e(){F(this,e),this.observers={}}return q(e,[{key:"on",value:function(e,t){var n=this;return e.split(" ").forEach((function(e){n.observers[e]=n.observers[e]||[],n.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(this.observers[e]){var r=[].concat(this.observers[e]);r.forEach((function(e){e.apply(void 0,n)}))}if(this.observers["*"]){var o=[].concat(this.observers["*"]);o.forEach((function(t){t.apply(t,[e].concat(n))}))}}}]),e}();function X(){var e,t,n=new Promise((function(n,i){e=n,t=i}));return n.resolve=e,n.reject=t,n}function Q(e){return null==e?"":""+e}function J(e,t,n){e.forEach((function(e){t[e]&&(n[e]=t[e])}))}function ee(e,t,n){function i(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function r(){return!e||"string"==typeof e}for(var o="string"!=typeof t?[].concat(t):t.split(".");o.length>1;){if(r())return{};var a=i(o.shift());!e[a]&&n&&(e[a]=new n),e=e[a]}return r()?{}:{obj:e,k:i(o.shift())}}function te(e,t,n){var i=ee(e,t,Object);i.obj[i.k]=n}function ne(e,t){var n=ee(e,t),i=n.obj,r=n.k;if(i)return i[r]}function ie(e,t,n){var i=ne(e,n);return void 0!==i?i:ne(t,n)}function re(e,t,n){for(var i in t)"__proto__"!==i&&(i in e?"string"==typeof e[i]||e[i]instanceof String||"string"==typeof t[i]||t[i]instanceof String?n&&(e[i]=t[i]):re(e[i],t[i],n):e[i]=t[i]);return e}function oe(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var ae={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function se(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return ae[e]})):e}var le="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,ue=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return F(this,t),n=$(this,H(t).call(this)),le&&Y.call(j(n)),n.data=e||{},n.options=i,void 0===n.options.keySeparator&&(n.options.keySeparator="."),n}return K(t,e),q(t,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,o=[e,t];return n&&"string"!=typeof n&&(o=o.concat(n)),n&&"string"==typeof n&&(o=o.concat(r?n.split(r):n)),e.indexOf(".")>-1&&(o=e.split(".")),ne(this.data,o)}},{key:"addResource",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},o=this.options.keySeparator;void 0===o&&(o=".");var a=[e,t];n&&(a=a.concat(o?n.split(o):n)),e.indexOf(".")>-1&&(i=t,t=(a=e.split("."))[1]),this.addNamespaces(t),te(this.data,a,i),r.silent||this.emit("added",e,t,n,i)}},{key:"addResources",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var r in n)"string"!=typeof n[r]&&"[object Array]"!==Object.prototype.toString.apply(n[r])||this.addResource(e,t,r,n[r],{silent:!0});i.silent||this.emit("added",e,t,n)}},{key:"addResourceBundle",value:function(e,t,n,i,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},a=[e,t];e.indexOf(".")>-1&&(i=n,n=t,t=(a=e.split("."))[1]),this.addNamespaces(t);var s=ne(this.data,a)||{};i?re(s,n,r):s=z({},s,n),te(this.data,a,s),o.silent||this.emit("added",e,t,n)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?z({},{},this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"toJSON",value:function(){return this.data}}]),t}(Y),ce={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,n,i,r){var o=this;return e.forEach((function(e){o.processors[e]&&(t=o.processors[e].process(t,n,i,r))})),t}},he={},de=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return F(this,t),n=$(this,H(t).call(this)),le&&Y.call(j(n)),J(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,j(n)),n.options=i,void 0===n.options.keySeparator&&(n.options.keySeparator="."),n.logger=Z.create("translator"),n}return K(t,e),q(t,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}},n=this.resolve(e,t);return n&&void 0!==n.res}},{key:"extractFromKey",value:function(e,t){var n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");var i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,r=t.ns||this.options.defaultNS;if(n&&e.indexOf(n)>-1){var o=e.match(this.interpolator.nestingRegexp);if(o&&o.length>0)return{key:e,namespaces:r};var a=e.split(n);(n!==i||n===i&&this.options.ns.indexOf(a[0])>-1)&&(r=a.shift()),e=a.join(i)}return"string"==typeof r&&(r=[r]),{key:e,namespaces:r}}},{key:"translate",value:function(e,t,n){var i=this;if("object"!==O(t)&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,o=this.extractFromKey(e[e.length-1],t),a=o.key,s=o.namespaces,l=s[s.length-1],u=t.lng||this.language,c=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u&&"cimode"===u.toLowerCase()){if(c){var h=t.nsSeparator||this.options.nsSeparator;return l+h+a}return a}var d=this.resolve(e,t),p=d&&d.res,f=d&&d.usedKey||a,g=d&&d.exactUsedKey||a,m=Object.prototype.toString.apply(p),v=["[object Number]","[object Function]","[object RegExp]"],y=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,_=!this.i18nFormat||this.i18nFormat.handleAsObject,b="string"!=typeof p&&"boolean"!=typeof p&&"number"!=typeof p;if(_&&p&&b&&v.indexOf(m)<0&&("string"!=typeof y||"[object Array]"!==m)){if(!t.returnObjects&&!this.options.returnObjects)return this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(f,p,t):"key '".concat(a," (").concat(this.language,")' returned an object instead of string.");if(r){var w="[object Array]"===m,E=w?[]:{},C=w?g:f;for(var S in p)if(Object.prototype.hasOwnProperty.call(p,S)){var k="".concat(C).concat(r).concat(S);E[S]=this.translate(k,z({},t,{joinArrays:!1,ns:s})),E[S]===k&&(E[S]=p[S])}p=E}}else if(_&&"string"==typeof y&&"[object Array]"===m)(p=p.join(y))&&(p=this.extendTranslation(p,e,t,n));else{var T=!1,x=!1;if(!this.isValidLookup(p)&&void 0!==t.defaultValue){if(T=!0,void 0!==t.count){var L=this.pluralResolver.getSuffix(u,t.count);p=t["defaultValue".concat(L)]}p||(p=t.defaultValue)}this.isValidLookup(p)||(x=!0,p=a);var I=t.defaultValue&&t.defaultValue!==p&&this.options.updateMissing;if(x||T||I){if(this.logger.log(I?"updateKey":"missingKey",u,l,a,I?t.defaultValue:p),r){var A=this.resolve(a,z({},t,{keySeparator:!1}));A&&A.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var D=[],N=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&N&&N[0])for(var P=0;P<N.length;P++)D.push(N[P]);else"all"===this.options.saveMissingTo?D=this.languageUtils.toResolveHierarchy(t.lng||this.language):D.push(t.lng||this.language);var B=function(e,n){i.options.missingKeyHandler?i.options.missingKeyHandler(e,l,n,I?t.defaultValue:p,I,t):i.backendConnector&&i.backendConnector.saveMissing&&i.backendConnector.saveMissing(e,l,n,I?t.defaultValue:p,I,t),i.emit("missingKey",e,l,n,p)};if(this.options.saveMissing){var R=void 0!==t.count&&"string"!=typeof t.count;this.options.saveMissingPlurals&&R?D.forEach((function(e){i.pluralResolver.getPluralFormsOfKey(e,a).forEach((function(t){return B([e],t)}))})):B(D,a)}}p=this.extendTranslation(p,e,t,d,n),x&&p===a&&this.options.appendNamespaceToMissingKey&&(p="".concat(l,":").concat(a)),x&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(p))}return p}},{key:"extendTranslation",value:function(e,t,n,i,r){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,n,i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init(z({},n,{interpolation:z({},this.options.interpolation,n.interpolation)}));var a,s=n.interpolation&&n.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;if(s){var l=e.match(this.interpolator.nestingRegexp);a=l&&l.length}var u=n.replace&&"string"!=typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(u=z({},this.options.interpolation.defaultVariables,u)),e=this.interpolator.interpolate(e,u,n.lng||this.language,n),s){var c=e.match(this.interpolator.nestingRegexp);a<(c&&c.length)&&(n.nest=!1)}!1!==n.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r&&r[0]===n[0]?(o.logger.warn("It seems you are nesting recursively key: ".concat(n[0]," in key: ").concat(t[0])),null):o.translate.apply(o,n.concat([t]))}),n)),n.interpolation&&this.interpolator.reset()}var h=n.postProcess||this.options.postProcess,d="string"==typeof h?[h]:h;return null!=e&&d&&d.length&&!1!==n.applyPostProcessor&&(e=ce.handle(d,e,t,this.options&&this.options.postProcessPassResolved?z({i18nResolved:i},n):n,this)),e}},{key:"resolve",value:function(e){var t,n,i,r,o,a=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!a.isValidLookup(t)){var l=a.extractFromKey(e,s),u=l.key;n=u;var c=l.namespaces;a.options.fallbackNS&&(c=c.concat(a.options.fallbackNS));var h=void 0!==s.count&&"string"!=typeof s.count,d=void 0!==s.context&&"string"==typeof s.context&&""!==s.context,p=s.lngs?s.lngs:a.languageUtils.toResolveHierarchy(s.lng||a.language,s.fallbackLng);c.forEach((function(e){a.isValidLookup(t)||(o=e,!he["".concat(p[0],"-").concat(e)]&&a.utils&&a.utils.hasLoadedNamespace&&!a.utils.hasLoadedNamespace(o)&&(he["".concat(p[0],"-").concat(e)]=!0,a.logger.warn('key "'.concat(n,'" for languages "').concat(p.join(", "),'" won\'t get resolved as namespace "').concat(o,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach((function(n){if(!a.isValidLookup(t)){r=n;var o,l,c=u,p=[c];if(a.i18nFormat&&a.i18nFormat.addLookupKeys)a.i18nFormat.addLookupKeys(p,u,n,e,s);else h&&(o=a.pluralResolver.getSuffix(n,s.count)),h&&d&&p.push(c+o),d&&p.push(c+="".concat(a.options.contextSeparator).concat(s.context)),h&&p.push(c+=o);for(;l=p.pop();)a.isValidLookup(t)||(i=l,t=a.getResource(n,e,l,s))}})))}))}})),{res:t,usedKey:n,exactUsedKey:i,usedLng:r,usedNS:o}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,n,i):this.resourceStore.getResource(e,t,n,i)}}]),t}(Y);function pe(e){return e.charAt(0).toUpperCase()+e.slice(1)}var fe=function(){function e(t){F(this,e),this.options=t,this.whitelist=this.options.supportedLngs||!1,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Z.create("languageUtils")}return q(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],n=e.split("-");return this.options.lowerCaseLng?n=n.map((function(e){return e.toLowerCase()})):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=pe(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=pe(n[1].toLowerCase())),t.indexOf(n[2].toLowerCase())>-1&&(n[2]=pe(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isWhitelisted",value:function(e){return this.logger.deprecate("languageUtils.isWhitelisted",'function "isWhitelisted" will be renamed to "isSupportedCode" in the next major - please make sure to rename it\'s usage asap.'),this.isSupportedCode(e)}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,n=this;return e?(e.forEach((function(e){if(!t){var i=n.formatLanguageCode(e);n.options.supportedLngs&&!n.isSupportedCode(i)||(t=i)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var i=n.getLanguagePartFromCode(e);if(n.isSupportedCode(i))return t=i;t=n.options.supportedLngs.find((function(e){if(0===e.indexOf(i))return e}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}},{key:"toResolveHierarchy",value:function(e,t){var n=this,i=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],o=function(e){e&&(n.isSupportedCode(e)?r.push(e):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&o(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&o(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&o(this.getLanguagePartFromCode(e))):"string"==typeof e&&o(this.formatLanguageCode(e)),i.forEach((function(e){r.indexOf(e)<0&&o(n.formatLanguageCode(e))})),r}}]),e}(),ge=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","kk","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],me={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}};function ve(){var e={};return ge.forEach((function(t){t.lngs.forEach((function(n){e[n]={numbers:t.nr,plurals:me[t.fc]}}))})),e}var ye=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};F(this,e),this.languageUtils=t,this.options=n,this.logger=Z.create("pluralResolver"),this.rules=ve()}return q(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=this.getRule(e);return t&&t.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){var n=this,i=[],r=this.getRule(e);return r?(r.numbers.forEach((function(r){var o=n.getSuffix(e,r);i.push("".concat(t).concat(o))})),i):i}},{key:"getSuffix",value:function(e,t){var n=this,i=this.getRule(e);if(i){var r=i.noAbs?i.plurals(t):i.plurals(Math.abs(t)),o=i.numbers[r];this.options.simplifyPluralSuffix&&2===i.numbers.length&&1===i.numbers[0]&&(2===o?o="plural":1===o&&(o=""));var a=function(){return n.options.prepend&&o.toString()?n.options.prepend+o.toString():o.toString()};return"v1"===this.options.compatibilityJSON?1===o?"":"number"==typeof o?"_plural_".concat(o.toString()):a():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===i.numbers.length&&1===i.numbers[0]?a():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}return this.logger.warn("no plural rule found for: ".concat(e)),""}}]),e}(),_e=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};F(this,e),this.logger=Z.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return q(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:se,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?oe(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?oe(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?oe(t.nestingPrefix):t.nestingPrefixEscaped||oe("$t("),this.nestingSuffix=t.nestingSuffix?oe(t.nestingSuffix):t.nestingSuffixEscaped||oe(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function(e,t,n,i){var r,o,a,s=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function u(e){return e.replace(/\$/g,"$$$$")}var c=function(e){if(e.indexOf(s.formatSeparator)<0){var r=ie(t,l,e);return s.alwaysFormat?s.format(r,void 0,n):r}var o=e.split(s.formatSeparator),a=o.shift().trim(),u=o.join(s.formatSeparator).trim();return s.format(ie(t,l,a),u,n,i)};this.resetRegExp();var h=i&&i.missingInterpolationHandler||this.options.missingInterpolationHandler,d=i&&i.interpolation&&i.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return u(e)}},{regex:this.regexp,safeValue:function(e){return s.escapeValue?u(s.escape(e)):u(e)}}].forEach((function(t){for(a=0;r=t.regex.exec(e);){if(void 0===(o=c(r[1].trim())))if("function"==typeof h){var n=h(e,r,i);o="string"==typeof n?n:""}else{if(d){o=r[0];continue}s.logger.warn("missed to pass in variable ".concat(r[1]," for interpolating ").concat(e)),o=""}else"string"==typeof o||s.useRawValueToEscape||(o=Q(o));if(e=e.replace(r[0],t.safeValue(o)),t.regex.lastIndex=0,++a>=s.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var n,i,r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=z({},o);function s(e,t){var n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;var i=e.split(new RegExp("".concat(n,"[ ]*{"))),r="{".concat(i[1]);e=i[0],r=(r=this.interpolate(r,a)).replace(/'/g,'"');try{a=JSON.parse(r),t&&(a=z({},t,a))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(n).concat(r)}return delete a.defaultValue,e}for(a.applyPostProcessor=!1,delete a.defaultValue;n=this.nestingRegexp.exec(e);){var l=[],u=!1;if(n[0].includes(this.formatSeparator)&&!/{.*}/.test(n[1])){var c=n[1].split(this.formatSeparator).map((function(e){return e.trim()}));n[1]=c.shift(),l=c,u=!0}if((i=t(s.call(this,n[1].trim(),a),a))&&n[0]===e&&"string"!=typeof i)return i;"string"!=typeof i&&(i=Q(i)),i||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(e)),i=""),u&&(i=l.reduce((function(e,t){return r.format(e,t,o.lng,o)}),i.trim())),e=e.replace(n[0],i),this.regexp.lastIndex=0}return e}}]),e}();var be=function(e){function t(e,n,i){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return F(this,t),r=$(this,H(t).call(this)),le&&Y.call(j(r)),r.backend=e,r.store=n,r.services=i,r.languageUtils=i.languageUtils,r.options=o,r.logger=Z.create("backendConnector"),r.state={},r.queue=[],r.backend&&r.backend.init&&r.backend.init(i,o.backend,o),r}return K(t,e),q(t,[{key:"queueLoad",value:function(e,t,n,i){var r=this,o=[],a=[],s=[],l=[];return e.forEach((function(e){var i=!0;t.forEach((function(t){var s="".concat(e,"|").concat(t);!n.reload&&r.store.hasResourceBundle(e,t)?r.state[s]=2:r.state[s]<0||(1===r.state[s]?a.indexOf(s)<0&&a.push(s):(r.state[s]=1,i=!1,a.indexOf(s)<0&&a.push(s),o.indexOf(s)<0&&o.push(s),l.indexOf(t)<0&&l.push(t)))})),i||s.push(e)})),(o.length||a.length)&&this.queue.push({pending:a,loaded:{},errors:[],callback:i}),{toLoad:o,pending:a,toLoadLanguages:s,toLoadNamespaces:l}}},{key:"loaded",value:function(e,t,n){var i=e.split("|"),r=i[0],o=i[1];t&&this.emit("failedLoading",r,o,t),n&&this.store.addResourceBundle(r,o,n),this.state[e]=t?-1:2;var a={};this.queue.forEach((function(n){!function(e,t,n,i){var r=ee(e,t,Object),o=r.obj,a=r.k;o[a]=o[a]||[],i&&(o[a]=o[a].concat(n)),i||o[a].push(n)}(n.loaded,[r],o),function(e,t){for(var n=e.indexOf(t);-1!==n;)e.splice(n,1),n=e.indexOf(t)}(n.pending,e),t&&n.errors.push(t),0!==n.pending.length||n.done||(Object.keys(n.loaded).forEach((function(e){a[e]||(a[e]=[]),n.loaded[e].length&&n.loaded[e].forEach((function(t){a[e].indexOf(t)<0&&a[e].push(t)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",a),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:350,a=arguments.length>5?arguments[5]:void 0;return e.length?this.backend[n](e,t,(function(s,l){s&&l&&r<5?setTimeout((function(){i.read.call(i,e,t,n,r+1,2*o,a)}),o):a(s,l)})):a(null,{})}},{key:"prepareLoading",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var o=this.queueLoad(e,t,i,r);if(!o.toLoad.length)return o.pending.length||r(),null;o.toLoad.forEach((function(e){n.loadOne(e)}))}},{key:"load",value:function(e,t,n){this.prepareLoading(e,t,{},n)}},{key:"reload",value:function(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}},{key:"loadOne",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=e.split("|"),r=i[0],o=i[1];this.read(r,o,"read",void 0,void 0,(function(i,a){i&&t.logger.warn("".concat(n,"loading namespace ").concat(o," for language ").concat(r," failed"),i),!i&&a&&t.logger.log("".concat(n,"loaded namespace ").concat(o," for language ").concat(r),a),t.loaded(e,i,a)}))}},{key:"saveMissing",value:function(e,t,n,i,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)?this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):null!=n&&""!==n&&(this.backend&&this.backend.create&&this.backend.create(e,t,n,i,null,z({},o,{isUpdate:r})),e&&e[0]&&this.store.addResource(e[0],t,n,i))}}]),t}(Y);function we(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===O(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===O(e[2])||"object"===O(e[3])){var n=e[3]||e[2];Object.keys(n).forEach((function(e){t[e]=n[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,n,i){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!1}}}function Ee(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.whitelist&&(e.whitelist&&e.whitelist.indexOf("cimode")<0&&(e.whitelist=e.whitelist.concat(["cimode"])),e.supportedLngs=e.whitelist),e.nonExplicitWhitelist&&(e.nonExplicitSupportedLngs=e.nonExplicitWhitelist),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function Ce(){}var Se=new(function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;if(F(this,t),e=$(this,H(t).call(this)),le&&Y.call(j(e)),e.options=Ee(n),e.services={},e.logger=Z,e.modules={external:[]},i&&!e.isInitialized&&!n.isClone){if(!e.options.initImmediate)return e.init(n,i),$(e,j(e));setTimeout((function(){e.init(n,i)}),0)}return e}return K(t,e),q(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;function i(e){return e?"function"==typeof e?new e:e:null}if("function"==typeof t&&(n=t,t={}),t.whitelist&&!t.supportedLngs&&this.logger.deprecate("whitelist",'option "whitelist" will be renamed to "supportedLngs" in the next major - please make sure to rename this option asap.'),t.nonExplicitWhitelist&&!t.nonExplicitSupportedLngs&&this.logger.deprecate("whitelist",'options "nonExplicitWhitelist" will be renamed to "nonExplicitSupportedLngs" in the next major - please make sure to rename this option asap.'),this.options=z({},we(),this.options,Ee(t)),this.format=this.options.interpolation.format,n||(n=Ce),!this.options.isClone){this.modules.logger?Z.init(i(this.modules.logger),this.options):Z.init(null,this.options);var r=new fe(this.options);this.store=new ue(this.options.resources,this.options);var o=this.services;o.logger=Z,o.resourceStore=this.store,o.languageUtils=r,o.pluralResolver=new ye(r,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),o.interpolator=new _e(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new be(i(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",(function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.emit.apply(e,[t].concat(i))})),this.modules.languageDetector&&(o.languageDetector=i(this.modules.languageDetector),o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=i(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new de(this.services,this.options),this.translator.on("*",(function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.emit.apply(e,[t].concat(i))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}this.modules.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");var a=["getResource","addResource","addResources","addResourceBundle","removeResourceBundle","hasResourceBundle","getResourceBundle","getDataByLanguage"];a.forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments)}}));var s=X(),l=function(){e.changeLanguage(e.options.lng,(function(t,i){e.isInitialized=!0,e.logger.log("initialized",e.options),e.emit("initialized",e.options),s.resolve(i),n(t,i)}))};return this.options.resources||!this.options.initImmediate?l():setTimeout(l,0),s}},{key:"loadResources",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ce,i=n,r="string"==typeof e?e:this.language;if("function"==typeof e&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&"cimode"===r.toLowerCase())return i();var o=[],a=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){o.indexOf(e)<0&&o.push(e)}))};if(r)a(r);else{var s=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);s.forEach((function(e){return a(e)}))}this.options.preload&&this.options.preload.forEach((function(e){return a(e)})),this.services.backendConnector.load(o,this.options.ns,i)}else i(null)}},{key:"reloadResources",value:function(e,t,n){var i=X();return e||(e=this.languages),t||(t=this.options.ns),n||(n=Ce),this.services.backendConnector.reload(e,t,(function(e){i.resolve(),n(e)})),i}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&ce.addPostProcessor(e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"changeLanguage",value:function(e,t){var n=this;this.isLanguageChangingTo=e;var i=X();this.emit("languageChanging",e);var r=function(e){var r="string"==typeof e?e:n.services.languageUtils.getBestMatchFromCodes(e);r&&(n.language||(n.language=r,n.languages=n.services.languageUtils.toResolveHierarchy(r)),n.translator.language||n.translator.changeLanguage(r),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage(r)),n.loadResources(r,(function(e){!function(e,r){r?(n.language=r,n.languages=n.services.languageUtils.toResolveHierarchy(r),n.translator.changeLanguage(r),n.isLanguageChangingTo=void 0,n.emit("languageChanged",r),n.logger.log("languageChanged",r)):n.isLanguageChangingTo=void 0,i.resolve((function(){return n.t.apply(n,arguments)})),t&&t(e,(function(){return n.t.apply(n,arguments)}))}(e,r)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(r):r(e):r(this.services.languageDetector.detect()),i}},{key:"getFixedT",value:function(e,t){var n=this,i=function e(t,i){var r;if("object"!==O(i)){for(var o=arguments.length,a=new Array(o>2?o-2:0),s=2;s<o;s++)a[s-2]=arguments[s];r=n.options.overloadTranslationOptionHandler([t,i].concat(a))}else r=z({},i);return r.lng=r.lng||e.lng,r.lngs=r.lngs||e.lngs,r.ns=r.ns||e.ns,n.t(t,r)};return"string"==typeof e?i.lng=e:i.lngs=e,i.ns=t,i}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var i=this.languages[0],r=!!this.options&&this.options.fallbackLng,o=this.languages[this.languages.length-1];if("cimode"===i.toLowerCase())return!0;var a=function(e,n){var i=t.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===i||2===i};if(n.precheck){var s=n.precheck(this,a);if(void 0!==s)return s}return!!this.hasResourceBundle(i,e)||(!this.services.backendConnector.backend||!(!a(i,e)||r&&!a(o,e)))}},{key:"loadNamespaces",value:function(e,t){var n=this,i=X();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){n.options.ns.indexOf(e)<0&&n.options.ns.push(e)})),this.loadResources((function(e){i.resolve(),t&&t(e)})),i):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var n=X();"string"==typeof e&&(e=[e]);var i=this.options.preload||[],r=e.filter((function(e){return i.indexOf(e)<0}));return r.length?(this.options.preload=i.concat(r),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){if(e||(e=this.languages&&this.languages.length>0?this.languages[0]:this.language),!e)return"rtl";return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>=0?"rtl":"ltr"}},{key:"createInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return new t(e,n)}},{key:"cloneInstance",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ce,r=z({},this.options,n,{isClone:!0}),o=new t(r),a=["store","services","language"];return a.forEach((function(t){o[t]=e[t]})),o.services=z({},this.services),o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o.translator=new de(o.services,o.options),o.translator.on("*",(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];o.emit.apply(o,[e].concat(n))})),o.init(r,i),o.translator.options=o.options,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}}]),t}(Y)),ke=[],Te=ke.forEach,xe=ke.slice;function Le(e){return Te.call(xe.call(arguments,1),(function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])})),e}var Ie,Ae="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};if("function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?Ie=global.fetch:"undefined"!=typeof window&&window.fetch&&(Ie=window.fetch)),"undefined"!=typeof require&&("undefined"==typeof window||void 0===window.document)){var De=Ie||require("node-fetch");De.default&&(De=De.default),exports.default=De,module.exports=exports.default}var Ne,Pe,Be,Re=Object.freeze({__proto__:null});function Me(e){return(Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}"function"==typeof fetch&&(void 0!==Ae&&Ae.fetch?Ne=Ae.fetch:"undefined"!=typeof window&&window.fetch&&(Ne=window.fetch)),"function"==typeof XMLHttpRequest&&(void 0!==Ae&&Ae.XMLHttpRequest?Pe=Ae.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(Pe=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&(void 0!==Ae&&Ae.ActiveXObject?Be=Ae.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(Be=window.ActiveXObject)),Ne||!Re||Pe||Be||(Ne=Re),"function"!=typeof Ne&&(Ne=void 0);var Oe=function(e,t){if(t&&"object"===Me(t)){var n="";for(var i in t)n+="&"+encodeURIComponent(i)+"="+encodeURIComponent(t[i]);if(!n)return e;e=e+(-1!==e.indexOf("?")?"&":"?")+n.slice(1)}return e},Ue=function(e,t,n,i){return"function"==typeof n&&(i=n,n=void 0),i=i||function(){},Ne?function(e,t,n,i){e.queryStringParams&&(t=Oe(t,e.queryStringParams));var r=Le({},e.customHeaders);n&&(r["Content-Type"]="application/json"),Ne(t,Le({method:n?"POST":"GET",body:n?e.stringify(n):void 0,headers:r},"function"==typeof e.requestOptions?e.requestOptions(n):e.requestOptions)).then((function(e){if(!e.ok)return i(e.statusText||"Error",{status:e.status});e.text().then((function(t){i(null,{status:e.status,data:t})})).catch(i)})).catch(i)}(e,t,n,i):"function"==typeof XMLHttpRequest||"function"==typeof ActiveXObject?function(e,t,n,i){n&&"object"===Me(n)&&(n=Oe("",n).slice(1)),e.queryStringParams&&(t=Oe(t,e.queryStringParams));try{var r;(r=Pe?new Pe:new Be("MSXML2.XMLHTTP.3.0")).open(n?"POST":"GET",t,1),e.crossDomain||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.withCredentials=!!e.withCredentials,n&&r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.overrideMimeType&&r.overrideMimeType("application/json");var o=e.customHeaders;if(o="function"==typeof o?o():o)for(var a in o)r.setRequestHeader(a,o[a]);r.onreadystatechange=function(){r.readyState>3&&i(r.status>=400?r.statusText:null,{status:r.status,data:r.responseText})},r.send(n)}catch(e){console&&console.log(e)}}(e,t,n,i):void 0};function ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ve=function(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",allowMultiLoading:!1,parse:function(e){return JSON.parse(e)},stringify:JSON.stringify,parsePayload:function(e,t,n){return function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},t,n||"")},request:Ue,reloadInterval:!1,customHeaders:{},queryStringParams:{},crossDomain:!1,withCredentials:!1,overrideMimeType:!1,requestOptions:{mode:"cors",credentials:"same-origin",cache:"default"}}},qe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};ze(this,e),this.services=t,this.options=n,this.allOptions=i,this.type="backend",this.init(t,n,i)}var t,n,i;return t=e,(n=[{key:"init",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=Le(n,this.options||{},Ve()),this.allOptions=i,this.options.reloadInterval&&setInterval((function(){return t.reload()}),this.options.reloadInterval)}},{key:"readMulti",value:function(e,t,n){var i=this.options.loadPath;"function"==typeof this.options.loadPath&&(i=this.options.loadPath(e,t));var r=this.services.interpolator.interpolate(i,{lng:e.join("+"),ns:t.join("+")});this.loadUrl(r,n,e,t)}},{key:"read",value:function(e,t,n){var i=this.options.loadPath;"function"==typeof this.options.loadPath&&(i=this.options.loadPath([e],[t]));var r=this.services.interpolator.interpolate(i,{lng:e,ns:t});this.loadUrl(r,n,e,t)}},{key:"loadUrl",value:function(e,t,n,i){var r=this;this.options.request(this.options,e,void 0,(function(o,a){if(a&&(a.status>=500&&a.status<600||!a.status))return t("failed loading "+e,!0);if(a&&a.status>=400&&a.status<500)return t("failed loading "+e,!1);if(!a&&o&&o.message&&o.message.indexOf("Failed to fetch")>-1)return t("failed loading "+e,!0);if(o)return t(o,!1);var s,l;try{s="string"==typeof a.data?r.options.parse(a.data,n,i):a.data}catch(t){l="failed parsing "+e+" to json"}if(l)return t(l,!1);t(null,s)}))}},{key:"create",value:function(e,t,n,i){var r=this;if(this.options.addPath){"string"==typeof e&&(e=[e]);var o=this.options.parsePayload(t,n,i);e.forEach((function(e){var n=r.services.interpolator.interpolate(r.options.addPath,{lng:e,ns:t});r.options.request(r.options,n,o,(function(e,t){}))}))}}},{key:"reload",value:function(){var e=this,t=this.services,n=t.backendConnector,i=t.languageUtils,r=t.logger,o=n.language;if(!o||"cimode"!==o.toLowerCase()){var a=[],s=function(e){i.toResolveHierarchy(e).forEach((function(e){a.indexOf(e)<0&&a.push(e)}))};s(o),this.allOptions.preload&&this.allOptions.preload.forEach((function(e){return s(e)})),a.forEach((function(t){e.allOptions.ns.forEach((function(e){n.read(t,e,"read",null,null,(function(i,o){i&&r.warn("loading namespace ".concat(e," for language ").concat(t," failed"),i),!i&&o&&r.log("loaded namespace ".concat(e," for language ").concat(t),o),n.loaded("".concat(t,"|").concat(e),i,o)}))}))}))}}}])&&Fe(t.prototype,n),i&&Fe(t,i),e}();qe.type="backend";var je=[],$e=je.forEach,He=je.slice;function We(e){return $e.call(He.call(arguments,1),(function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])})),e}var Ke,Ge=function(e,t,n,i){var r,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/"};if(n){var a=new Date;a.setTime(a.getTime()+60*n*1e3),r="; expires="+a.toUTCString()}else r="";i=i?"domain="+i+";":"",o=Object.keys(o).reduce((function(e,t){return e+";"+t.replace(/([A-Z])/g,(function(e){return"-"+e.toLowerCase()}))+"="+o[t]}),""),document.cookie=e+"="+encodeURIComponent(t)+r+";"+i+o},Ze=function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null},Ye={name:"cookie",lookup:function(e){var t;if(e.lookupCookie&&"undefined"!=typeof document){var n=Ze(e.lookupCookie);n&&(t=n)}return t},cacheUserLanguage:function(e,t){t.lookupCookie&&"undefined"!=typeof document&&Ge(t.lookupCookie,e,t.cookieMinutes,t.cookieDomain,t.cookieOptions)}},Xe={name:"querystring",lookup:function(e){var t;if("undefined"!=typeof window)for(var n=window.location.search.substring(1).split("&"),i=0;i<n.length;i++){var r=n[i].indexOf("=");if(r>0)n[i].substring(0,r)===e.lookupQuerystring&&(t=n[i].substring(r+1))}return t}};try{Ke="undefined"!==window&&null!==window.localStorage;window.localStorage.setItem("i18next.translate.boo","foo"),window.localStorage.removeItem("i18next.translate.boo")}catch(e){Ke=!1}var Qe,Je={name:"localStorage",lookup:function(e){var t;if(e.lookupLocalStorage&&Ke){var n=window.localStorage.getItem(e.lookupLocalStorage);n&&(t=n)}return t},cacheUserLanguage:function(e,t){t.lookupLocalStorage&&Ke&&window.localStorage.setItem(t.lookupLocalStorage,e)}};try{Qe="undefined"!==window&&null!==window.sessionStorage;window.sessionStorage.setItem("i18next.translate.boo","foo"),window.sessionStorage.removeItem("i18next.translate.boo")}catch(e){Qe=!1}var et={name:"sessionStorage",lookup:function(e){var t;if(e.lookupsessionStorage&&Qe){var n=window.sessionStorage.getItem(e.lookupsessionStorage);n&&(t=n)}return t},cacheUserLanguage:function(e,t){t.lookupsessionStorage&&Qe&&window.sessionStorage.setItem(t.lookupsessionStorage,e)}},tt={name:"navigator",lookup:function(e){var t=[];if("undefined"!=typeof navigator){if(navigator.languages)for(var n=0;n<navigator.languages.length;n++)t.push(navigator.languages[n]);navigator.userLanguage&&t.push(navigator.userLanguage),navigator.language&&t.push(navigator.language)}return t.length>0?t:void 0}},nt={name:"htmlTag",lookup:function(e){var t,n=e.htmlTag||("undefined"!=typeof document?document.documentElement:null);return n&&"function"==typeof n.getAttribute&&(t=n.getAttribute("lang")),t}},it={name:"path",lookup:function(e){var t;if("undefined"!=typeof window){var n=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(n instanceof Array)if("number"==typeof e.lookupFromPathIndex){if("string"!=typeof n[e.lookupFromPathIndex])return;t=n[e.lookupFromPathIndex].replace("/","")}else t=n[0].replace("/","")}return t}},rt={name:"subdomain",lookup:function(e){var t;if("undefined"!=typeof window){var n=window.location.href.match(/(?:http[s]*\:\/\/)*(.*?)\.(?=[^\/]*\..{2,5})/gi);n instanceof Array&&(t="number"==typeof e.lookupFromSubdomainIndex?n[e.lookupFromSubdomainIndex].replace("http://","").replace("https://","").replace(".",""):n[0].replace("http://","").replace("https://","").replace(".",""))}return t}};var ot=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};F(this,e),this.type="languageDetector",this.detectors={},this.init(t,n)}return q(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=We(t,this.options||{},{order:["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],checkWhitelist:!0,checkForSimilarInWhitelist:!1}),this.options.checkForSimilarInWhitelist&&(this.options.checkWhitelist=!0),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(Ye),this.addDetector(Xe),this.addDetector(Je),this.addDetector(et),this.addDetector(tt),this.addDetector(nt),this.addDetector(it),this.addDetector(rt)}},{key:"addDetector",value:function(e){this.detectors[e.name]=e}},{key:"detect",value:function(e){var t=this;e||(e=this.options.order);var n,i=[];if(e.forEach((function(e){if(t.detectors[e]){var n=t.detectors[e].lookup(t.options);n&&"string"==typeof n&&(n=[n]),n&&(i=i.concat(n))}})),i.forEach((function(e){if(!n){var i=t.services.languageUtils.formatLanguageCode(e);t.options.checkWhitelist&&!t.services.languageUtils.isWhitelisted(i)||(n=i),!n&&t.options.checkForSimilarInWhitelist&&(n=t.getSimilarInWhitelist(i))}})),!n){var r=this.i18nOptions.fallbackLng;"string"==typeof r&&(r=[r]),r||(r=[]),n="[object Array]"===Object.prototype.toString.apply(r)?r[0]:r[0]||r.default&&r.default[0]}return n}},{key:"cacheUserLanguage",value:function(e,t){var n=this;t||(t=this.options.caches),t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach((function(t){n.detectors[t]&&n.detectors[t].cacheUserLanguage(e,n.options)})))}},{key:"getSimilarInWhitelist",value:function(e){var t=this;if(this.i18nOptions.whitelist){if(e.includes("-")){var n=e.split("-")[0],i=this.services.languageUtils.formatLanguageCode(n);if(this.services.languageUtils.isWhitelisted(i))return i;e=i}var r=this.i18nOptions.whitelist.find((function(n){var i=t.services.languageUtils.formatLanguageCode(n);if(i.startsWith(e))return i}));return r||void 0}}}]),e}();ot.type="languageDetector";const at=`${k.basePath}${k.offlinePath}/locales/build/__lng__/translation-combined.json`,st=/^[a-z]{2,3}/,lt=document.createRange(),ut={type:"postProcessor",name:"htmlParagraphsPostProcessor",process(e){const t=e.split("\n");return t.length>1?`<p>${t.join("</p><p>")}</p>`:e}},ct=e=>ht.then(()=>e),ht=new Promise((e,t)=>{Se.use(qe).use(ot).use(ut).init({whitelist:k.languagesSupported,fallbackLng:"en",joinArrays:"\n",backend:{loadPath:at},load:"languageOnly",lowerCaseLng:!0,detection:{order:["querystring","navigator"],lookupQuerystring:"lang",caches:!1},interpolation:{prefix:"__",suffix:"__"},postProcess:["htmlParagraphsPostProcessor"]},n=>{n?t(n):e()})}),dt=(e,t)=>Se.t(e,t),pt=(e,t)=>{const n={},i=e.querySelectorAll("[data-i18n]");return Promise.resolve().then(()=>{if(t)return Se.changeLanguage(t)}).then(()=>(i.forEach(e=>{const t=e.dataset.i18n;if(t){if(!n[t]){let i={};e.dataset.i18nIcon&&(i={icon:`<span class="icon ${e.dataset.i18nIcon}"> </span>`,interpolation:{escapeValue:!1}}),e.dataset.i18nNumber&&(i={number:e.dataset.i18nNumber}),n[t]=dt(t,i)}e.placeholder?e.placeholder=n[t]:e.dataset.i18nIcon?(e.textContent="",e.append(lt.createContextualFragment(n[t]))):e.textContent=n[t]}}),Se.dir()))},ft=()=>{const e=Se.language.match(st);return e.length?e[0]:null},gt=()=>{const e=(k.languageOverrideParameter?k.languageOverrideParameter.value:navigator.language).match(st);return e.length?e[0]:null},mt=navigator.userAgent;var vt={browser:{get chrome(){const e=/chrome|crios\/(\d+)/i.test(mt);return!/edge\//i.test(mt)&&e},get safari(){return/^((?!chrome|android|fxios|crios|ucbrowser).)*safari/i.test(mt)},get firefox(){return/firefox|fxios/i.test(mt)}},os:n};var yt={DataUpdate:function(e){return new CustomEvent("dataupdate",{detail:e})},FakeFocus:function(){return new CustomEvent("fakefocus",{bubbles:!0})},ApplyFocus:function(){return new CustomEvent("applyfocus")},PageFlip:function(){return new CustomEvent("pageflip",{bubbles:!0})},Removed:function(e){return new CustomEvent("removed",{detail:e,bubbles:!0})},InstanceFirstLoad:function(){return new CustomEvent("odk-instance-first-load",{bubbles:!0})},NewRepeat:function(e){return new CustomEvent("odk-new-repeat",{detail:e,bubbles:!0})},AddRepeat:function(e){return new CustomEvent("addrepeat",{detail:e,bubbles:!0})},RemoveRepeat:function(){return new CustomEvent("removerepeat",{bubbles:!0})},ChangeLanguage:function(){return new CustomEvent("changelanguage",{bubbles:!0})},Change:function(){return new Event("change",{bubbles:!0})},Input:function(){return new Event("input",{bubbles:!0})},InputUpdate:function(){return new CustomEvent("inputupdate",{bubbles:!0})},Edited:function(){return new CustomEvent("edited",{bubbles:!0})},BeforeSave:function(){return new CustomEvent("before-save",{bubbles:!0})},ValidationComplete:function(){return new CustomEvent("validation-complete",{bubbles:!0})},Invalidated:function(){return new CustomEvent("invalidated",{bubbles:!0})},ProgressUpdate:function(e){return new CustomEvent("progress-update",{detail:e,bubbles:!0})},GoToIrrelevant:function(){return new CustomEvent("goto-irrelevant",{bubbles:!0})},GoToInvisible:function(){return new CustomEvent("goto-invisible",{bubbles:!0})},XFormsValueChanged:function(e){return new CustomEvent("xforms-value-changed",{detail:e,bubbles:!0})},ChangeOption:function(){return new CustomEvent("change-option",{bubbles:!0})},Printify:function(){return new CustomEvent("printify",{bubbles:!0})},DePrintify:function(){return new CustomEvent("deprintify",{bubbles:!0})},UpdateMaxSize:function(){return new CustomEvent("update-max-size",{bubbles:!0})},QueueSubmissionSuccess:function(e){return new CustomEvent("queuesubmissionsuccess",{detail:e,bubbles:!0})},SubmissionSuccess:function(){return new CustomEvent("submissionsuccess",{bubbles:!0})},Close:function(){return new CustomEvent("close",{bubbles:!0})},OfflineLaunchCapable:function(e){return new CustomEvent("offlinelaunchcapable",{detail:e,bubbles:!0})},ApplicationUpdated:function(){return new CustomEvent("applicationupdated",{bubbles:!0})},FormUpdated:function(){return new CustomEvent("formupdated",{bubbles:!0})},FormReset:function(){return new CustomEvent("formreset",{bubbles:!0})}},_t=u((function(e,t){e.exports=function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){if(!s&&l)return l();if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,(function(e){var n=t[a][1][e];return r(n||e)}),c,c.exports,e,t,n,i)}return n[a].exports}for(var o=l,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */"document"in window.self&&((!("classList"in document.createElement("_"))||document.createElementNS&&!("classList"in document.createElementNS("http://www.w3.org/2000/svg","g")))&&function(e){if("Element"in e){var t=e.Element.prototype,n=Object,i=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},r=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},o=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(""===t)throw new o("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new o("INVALID_CHARACTER_ERR","String contains an invalid character");return r.call(e,t)},s=function(e){for(var t=i.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],r=0,o=n.length;r<o;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=s.prototype=[],u=function(){return new s(this)};if(o.prototype=Error.prototype,l.item=function(e){return this[e]||null},l.contains=function(e){return-1!==a(this,e+="")},l.add=function(){var e,t=arguments,n=0,i=t.length,r=!1;do{e=t[n]+"",-1===a(this,e)&&(this.push(e),r=!0)}while(++n<i);r&&this._updateClassName()},l.remove=function(){var e,t,n=arguments,i=0,r=n.length,o=!1;do{for(e=n[i]+"",t=a(this,e);-1!==t;)this.splice(t,1),o=!0,t=a(this,e)}while(++i<r);o&&this._updateClassName()},l.toggle=function(e,t){e+="";var n=this.contains(e),i=n?!0!==t&&"remove":!1!==t&&"add";return i&&this[i](e),!0===t||!1===t?t:!n},l.toString=function(){return this.join(" ")},n.defineProperty){var c={get:u,enumerable:!0,configurable:!0};try{n.defineProperty(t,"classList",c)}catch(e){void 0!==e.number&&-2146823252!==e.number||(c.enumerable=!1,n.defineProperty(t,"classList",c))}}else n.prototype.__defineGetter__&&t.__defineGetter__("classList",u)}}(window.self),function(){var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var n,i=arguments.length;for(n=0;n<i;n++)e=arguments[n],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:n.call(this,e)}}e=null}())},{}],2:[function(e,t,n){t.exports=function(e,t){if("string"!=typeof e)throw new TypeError("String expected");t||(t=document);var n=/<([\w:]+)/.exec(e);if(!n)return t.createTextNode(e);e=e.replace(/^\s+|\s+$/g,"");var i=n[1];if("body"==i)return(r=t.createElement("html")).innerHTML=e,r.removeChild(r.lastChild);var r,a=o[i]||o._default,s=a[0],l=a[1],u=a[2];for((r=t.createElement("div")).innerHTML=l+e+u;s--;)r=r.lastChild;if(r.firstChild==r.lastChild)return r.removeChild(r.firstChild);for(var c=t.createDocumentFragment();r.firstChild;)c.appendChild(r.removeChild(r.firstChild));return c};var i,r=!1;"undefined"!=typeof document&&((i=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',r=!i.getElementsByTagName("link").length,i=void 0);var o={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:r?[1,"X<div>","</div>"]:[0,"",""]};o.td=o.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],o.option=o.optgroup=[1,'<select multiple="multiple">',"</select>"],o.thead=o.tbody=o.colgroup=o.caption=o.tfoot=[1,"<table>","</table>"],o.polyline=o.ellipse=o.polygon=o.circle=o.text=o.line=o.path=o.rect=o.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},{}],3:[function(e,t,n){function i(e,t){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var o=Object.keys(Object(r)),a=0,s=o.length;a<s;a++){var l=o[a],u=Object.getOwnPropertyDescriptor(r,l);void 0!==u&&u.enumerable&&(n[l]=r[l])}}return n}t.exports={assign:i,polyfill:function(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:i})}}},{}],4:[function(e,t,n){e("classlist-polyfill"),e("es6-object-assign").polyfill();var i=e("domify"),r=function(e){if(void 0!==e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}return""},o=function(e,t){if("string"==typeof t&&0!==t.length)for(var n=t.split(" "),i=0;i<n.length;i++){var r=n[i];r.length&&e.classList.add(r)}},a=function(){var e=document.createElement("div"),t={animation:"animationend",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",OAnimation:"oanimationend",msAnimation:"MSAnimationEnd"};for(var n in t)if(void 0!==e.style[n])return t[n];return!1}(),s="vex",l="vex-content",u="vex-overlay",c="vex-close",h="vex-closing",d="vex-open",p={},f=1,g=!1,m={open:function(e){var t=function(e){console.warn('The "'+e+'" property is deprecated in vex 3. Use CSS classes and the appropriate "ClassName" options, instead.'),console.warn("See http://github.hubspot.com/vex/api/advanced/#options")};e.css&&t("css"),e.overlayCSS&&t("overlayCSS"),e.contentCSS&&t("contentCSS"),e.closeCSS&&t("closeCSS");var n={};n.id=f++,p[n.id]=n,n.isOpen=!0,n.close=function(){if(!this.isOpen)return!0;var e=this.options;if(g&&!e.escapeButtonCloses)return!1;if(!1===function(){return!e.beforeClose||e.beforeClose.call(this)}.bind(this)())return!1;this.isOpen=!1;var t=window.getComputedStyle(this.contentEl);function n(e){return"none"!==t.getPropertyValue(e+"animation-name")&&"0s"!==t.getPropertyValue(e+"animation-duration")}var i=n("")||n("-webkit-")||n("-moz-")||n("-o-"),r=function t(){this.rootEl.parentNode&&(this.rootEl.removeEventListener(a,t),this.overlayEl.removeEventListener(a,t),delete p[this.id],this.rootEl.parentNode.removeChild(this.rootEl),this.bodyEl.removeChild(this.overlayEl),e.afterClose&&e.afterClose.call(this),0===Object.keys(p).length&&document.body.classList.remove(d))}.bind(this);return a&&i?(this.rootEl.addEventListener(a,r),this.overlayEl.addEventListener(a,r),this.rootEl.classList.add(h),this.overlayEl.classList.add(h)):r(),!0},"string"==typeof e&&(e={content:e}),e.unsafeContent&&!e.content?e.content=e.unsafeContent:e.content&&(e.content=r(e.content));var v=n.options=Object.assign({},m.defaultOptions,e),y=n.bodyEl=document.getElementsByTagName("body")[0],_=n.rootEl=document.createElement("div");_.classList.add(s),o(_,v.className);var b=n.overlayEl=document.createElement("div");b.classList.add(u),o(b,v.overlayClassName),v.overlayClosesOnClick&&_.addEventListener("click",(function(e){e.target===_&&n.close()})),y.appendChild(b);var w=n.contentEl=document.createElement("div");if(w.classList.add(l),o(w,v.contentClassName),w.appendChild(v.content instanceof window.Node?v.content:i(v.content)),_.appendChild(w),v.showCloseButton){var E=n.closeEl=document.createElement("div");E.classList.add(c),o(E,v.closeClassName),E.addEventListener("click",n.close.bind(n)),w.appendChild(E)}return document.querySelector(v.appendLocation).appendChild(_),v.afterOpen&&v.afterOpen.call(n),document.body.classList.add(d),n},close:function(e){var t;if(e.id)t=e.id;else{if("string"!=typeof e)throw new TypeError("close requires a vex object or id string");t=e}return!!p[t]&&p[t].close()},closeTop:function(){var e=Object.keys(p);return!!e.length&&p[e[e.length-1]].close()},closeAll:function(){for(var e in p)this.close(e);return!0},getAll:function(){return p},getById:function(e){return p[e]}};window.addEventListener("keyup",(function(e){27===e.keyCode&&(g=!0,m.closeTop(),g=!1)})),window.addEventListener("popstate",(function(){m.defaultOptions.closeAllOnPopState&&m.closeAll()})),m.defaultOptions={content:"",showCloseButton:!0,escapeButtonCloses:!0,overlayClosesOnClick:!0,appendLocation:"body",className:"",overlayClassName:"",contentClassName:"",closeClassName:"",closeAllOnPopState:!0},Object.defineProperty(m,"_escapeHtml",{configurable:!1,enumerable:!1,writable:!1,value:r}),m.registerPlugin=function(e,t){var n=e(m),i=t||n.name;if(m[i])throw new Error("Plugin "+t+" is already registered.");m[i]=n},t.exports=m},{"classlist-polyfill":1,domify:2,"es6-object-assign":3}]},{},[4])(4)}));T.fn.capitalizeStart=function(e){e||(e=1);const t=this.contents().filter((function(){return 3===this.nodeType})).first(),n=t.text(),i=n.split(" ",e).join(" ");t.length&&(t[0].nodeValue=n.slice(i.length),t.before(`<span class="capitalize">${i}</span>`))},T.fn.btnBusyState=function(e){return this.each((function(){const t=T(this);let n=t.find(".temp").html();e&&!n?(n=t.html(),t.empty().append("<progress></progress>").append(T('<span class="temp" style="display: none;"/>').append(n)).attr("disabled",!0)):!e&&n&&t.empty().append(n).removeAttr("disabled")}))},T.fn.btnText=function(e){T(this).add(T(this).find("span")).last()[0].lastChild.textContent=e};var bt,wt=function(e,t){if("string"!=typeof e)throw new TypeError("String expected");t||(t=document);var n=/<([\w:]+)/.exec(e);if(!n)return t.createTextNode(e);e=e.replace(/^\s+|\s+$/g,"");var i=n[1];if("body"==i){return(r=t.createElement("html")).innerHTML=e,r.removeChild(r.lastChild)}var r,o=Ct[i]||Ct._default,a=o[0],s=o[1],l=o[2];(r=t.createElement("div")).innerHTML=s+e+l;for(;a--;)r=r.lastChild;if(r.firstChild==r.lastChild)return r.removeChild(r.firstChild);var u=t.createDocumentFragment();for(;r.firstChild;)u.appendChild(r.removeChild(r.firstChild));return u},Et=!1;"undefined"!=typeof document&&((bt=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',Et=!bt.getElementsByTagName("link").length,bt=void 0);var Ct={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:Et?[1,"X<div>","</div>"]:[0,"",""]};Ct.td=Ct.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],Ct.option=Ct.optgroup=[1,'<select multiple="multiple">',"</select>"],Ct.thead=Ct.tbody=Ct.colgroup=Ct.caption=Ct.tfoot=[1,"<table>","</table>"],Ct.polyline=Ct.ellipse=Ct.polygon=Ct.circle=Ct.text=Ct.line=Ct.path=Ct.rect=Ct.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];var St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i,Tt=/(\[[^\[\]]*\])/g;function xt(e,t,n){if(t.match(Tt)){!function e(t,n,i){if(0===n.length)return t=i;var r=n.shift(),o=r.match(/^\[(.+?)\]$/);if("[]"===r)return t=t||[],Array.isArray(t)?t.push(e(null,n,i)):(t._values=t._values||[],t._values.push(e(null,n,i))),t;if(o){var a=o[1],s=+a;isNaN(s)?(t=t||{})[a]=e(t[a],n,i):(t=t||[])[s]=e(t[s],n,i)}else t[r]=e(t[r],n,i);return t}(e,function(e){var t=[],n=new RegExp(Tt),i=/^([^\[\]]*)/.exec(e);for(i[1]&&t.push(i[1]);null!==(i=n.exec(e));)t.push(i[1]);return t}(t),n)}else{var i=e[t];i?(Array.isArray(i)||(e[t]=[i]),e[t].push(n)):e[t]=n}return e}function Lt(e,t,n){return n=n.replace(/(\r)?\n/g,"\r\n"),n=(n=encodeURIComponent(n)).replace(/%20/g,"+"),e+(e?"&":"")+encodeURIComponent(t)+"="+n}var It=function(e,t){"object"!=typeof t?t={hash:!!t}:void 0===t.hash&&(t.hash=!0);for(var n=t.hash?{}:"",i=t.serializer||(t.hash?xt:Lt),r=e&&e.elements?e.elements:[],o=Object.create(null),a=0;a<r.length;++a){var s=r[a];if((t.disabled||!s.disabled)&&s.name&&(kt.test(s.nodeName)&&!St.test(s.type))){var l=s.name,u=s.value;if("checkbox"!==s.type&&"radio"!==s.type||s.checked||(u=void 0),t.empty){if("checkbox"!==s.type||s.checked||(u=""),"radio"===s.type&&(o[s.name]||s.checked?s.checked&&(o[s.name]=!0):o[s.name]=!1),!u&&"radio"==s.type)continue}else if(!u)continue;if("select-multiple"!==s.type)n=i(n,l,u);else{u=[];for(var c=s.options,h=!1,d=0;d<c.length;++d){var p=c[d],f=t.empty&&!p.value,g=p.value||f;p.selected&&g&&(h=!0,n=t.hash&&"[]"!==l.slice(l.length-2)?i(n,l+"[]",p.value):i(n,l,p.value))}!h&&t.empty&&(n=i(n,l,""))}}}if(t.empty)for(var l in o)o[l]||(n=i(n,l,""));return n};function At(e){if(!e||"object"!=typeof e)return e;if("[object Date]"==Object.prototype.toString.call(e))return new Date(e.getTime());if(Array.isArray(e))return e.map(At);var t={};return Object.keys(e).forEach((function(n){t[n]=At(e[n])})),t}var Dt=function(e){var t=document.createElement("div");t.classList.add("vex-dialog-buttons");for(var n=0;n<e.length;n++){var i=e[n],r=document.createElement("button");r.type=i.type,r.textContent=i.text,r.className=i.className,r.classList.add("vex-dialog-button"),0===n?r.classList.add("vex-first"):n===e.length-1&&r.classList.add("vex-last"),function(e){r.addEventListener("click",function(t){e.click&&e.click.call(this,t)}.bind(this))}.bind(this)(i),t.appendChild(r)}return t},Nt=function(e){var t={name:"dialog",open:function(t){var n=Object.assign({},At(this.defaultOptions),t);n.unsafeMessage&&!n.message?n.message=n.unsafeMessage:n.message&&(n.message=e._escapeHtml(n.message));var i=n.unsafeContent=function(e){var t=document.createElement("form");t.classList.add("vex-dialog-form");var n=document.createElement("h3");n.classList.add("vex-dialog-title"),n.appendChild(e.title instanceof window.Node?e.title:wt(e.title));var i=document.createElement("div");i.classList.add("vex-dialog-message"),"string"==typeof e.messageClassName&&e.messageClassName.split(/\s+/).forEach((function(e){e&&i.classList.add(e)})),i.appendChild(e.message instanceof window.Node?e.message:wt(e.message));var r=document.createElement("div");r.classList.add("vex-dialog-input"),r.appendChild(e.input instanceof window.Node?e.input:wt(e.input));var o=document.createElement("div");return o.classList.add("vex-auto-close-timer"),t.appendChild(n),t.appendChild(i),t.appendChild(r),t.appendChild(o),t}(n),r=e.open(n);""!==n.yesText&&(n.buttons[0].text=n.yesText),""!==n.noText&&(n.buttons[1].text=n.noText);var o=n.beforeClose&&n.beforeClose.bind(r);if(r.options.beforeClose=function(){var e=!o||o();return e&&n.callback(this.value||!1),e}.bind(r),i.appendChild(Dt.call(r,n.buttons)),r.form=i,i.addEventListener("submit",n.onSubmit.bind(r)),this.addAutoCloseTimer(r,n),n.focusFirstInput){var a=r.contentEl.querySelector("button, input, select, textarea");a&&a.focus()}return r},alert:function(e){return"string"==typeof e&&(e={message:e}),e=Object.assign({},At(this.defaultOptions),At(this.defaultAlertOptions),e),this.open(e)},confirm:function(e){if("object"!=typeof e||"function"!=typeof e.callback)throw new Error("dialog.confirm(options) requires options.callback.");return e=Object.assign({},At(this.defaultOptions),At(this.defaultConfirmOptions),e),this.open(e)},prompt:function(t){if("object"!=typeof t||"function"!=typeof t.callback)throw new Error("dialog.prompt(options) requires options.callback.");var n=Object.assign({},At(this.defaultOptions),At(this.defaultPromptOptions)),i={unsafeMessage:'<label for="vex">'+e._escapeHtml(t.label||n.label)+"</label>",input:'<input name="vex" type="text" class="vex-dialog-prompt-input" placeholder="'+e._escapeHtml(t.placeholder||n.placeholder)+'" value="'+e._escapeHtml(t.value||n.value)+'" />'},r=(t=Object.assign(n,i,t)).callback;return t.callback=function(e){r(e)},this.open(t)},addAutoCloseTimer:function(e,t){if(t.autoClose&&"number"==typeof t.autoClose){var n=e.form.querySelector(".vex-auto-close-timer"),i=t.autoClose;n.textContent=i--;var r=window.setInterval((function(){i||(e.close(),clearInterval(r)),n.textContent=i--}),1e3)}},buttons:{YES:{text:"OK",type:"submit",className:"vex-dialog-button-primary",click:function(){this.value=!0}},NO:{text:"Cancel",type:"button",className:"vex-dialog-button-secondary",click:function(){this.value=!1,this.close()}}}};return t.defaultOptions={callback:function(){},afterOpen:function(){},title:"",message:"",messageClassName:"",input:"",yesText:"",noText:"",buttons:[t.buttons.YES,t.buttons.NO],showCloseButton:!1,onSubmit:function(e){return e.preventDefault(),this.options.input&&(this.value=It(this.form,{hash:!0})),this.close()},focusFirstInput:!0},t.defaultAlertOptions={buttons:[t.buttons.YES]},t.defaultPromptOptions={label:"Prompt:",placeholder:"",value:""},t.defaultConfirmOptions={},t};let Pt,Bt,Rt,Mt;function Ot(){const e=T(document);e.on("click","#feedback-bar .close, .touch #feedback-bar",()=>(Rt.hide(),!1)),e.on("click",".side-slider .close, .slider-overlay",()=>{T("body").removeClass("show-side-slider")}),T(".form-header__button--print").on("click",$t),T(".side-slider__toggle, .offline-enabled__queue-length").on("click",()=>{const e=T("body");window.scrollTo(0,0),e.toggleClass("show-side-slider")}),T(".offline-enabled__icon").on("click",()=>{Ut(dt("alert.offlinesupported.msg"),dt("alert.offlinesupported.heading"),"normal")}),T("#save-draft").on("click",".save-draft-info",()=>{const e=document.querySelector(".side-slider__toggle").cloneNode(!0);e.removeAttribute("aria-label"),e.style.position="static",e.style.margin="10px auto",e.style.display="block",e.disabled=!0;Ut(dt("alert.savedraftinfo.msg",{icon:e.outerHTML,interpolation:{escapeValue:!1}}),dt("alert.savedraftinfo.heading"),"normal")}),T("a.branding").on("click",(function(){const e=this.getAttribute("href");return!(!e||"#"===e)})),qt()&&T(".form-header__button--homescreen").removeClass("hide").on("click",Vt),e.on("xpatherror",(e,t)=>{const n=k.supportEmail,i=`<a href="mailto:${n}?subject=xpath errors for: ${encodeURIComponent(location.href)}&body=${encodeURIComponent(t)}" target="_blank" >${n}</a>`;Ut(`${dt("alert.xpatherror.msg",{emailLink:i,interpolation:{escapeValue:!1}})}<ul class="error-list"><li>${t}</li></ul>`,dt("alert.xpatherror.heading"))}),T(".side-slider__app-version").on("click",()=>{T(".side-slider__advanced").toggleClass("hide")})}function Ut(e,t,n,i){return n=n||"error",_t.closeAll(),_t.dialog.alert({unsafeMessage:e,title:t||dt("alert.default.heading"),messageClassName:"normal"===n?"":"alert-box "+n,buttons:[{text:dt("alert.validationsuccess.heading"),type:"submit",className:"btn btn-primary small"}],autoClose:i,showCloseButton:!0}),Promise.resolve()}function zt(e,t){let n="";const i="string"==typeof e?e:e.msg;return e.errorMsg&&(n=`<p class="alert-box error">${e.errorMsg}</p>`),new Promise(r=>{(t=t||{}).allowAlternativeClose=void 0===t.allowAlternativeClose||t.allowAlternativeClose,_t.closeAll(),_t.dialog.confirm({unsafeMessage:n+(i||dt("confirm.default.msg")),title:e.heading||dt("confirm.default.heading"),buttons:[T.extend({},_t.dialog.buttons.YES,{text:t.posButton||dt("confirm.default.posButton"),className:"btn btn-primary small"}),T.extend({},_t.dialog.buttons.NO,{text:t.negButton||dt("confirm.default.negButton"),className:"btn btn-default small"})],callback:r,afterClose:r,showCloseButton:t.allowAlternativeClose,escapeButtonCloses:t.allowAlternativeClose,overlayClosesOnClick:t.allowAlternativeClose})})}function Ft(e,t,n){let i="";const r="string"==typeof e?e:e.msg;return e.errorMsg&&(i=`<p class="alert-box error">${e.errorMsg}</p>`),new Promise(o=>{t=t||{},_t.closeAll(),_t.dialog.prompt({unsafeMessage:i+(r||""),title:e.heading||dt("prompt.default.heading"),buttons:[T.extend({},_t.dialog.buttons.YES,{text:t.posButton||dt("confirm.default.posButton"),className:"btn btn-primary small"}),T.extend({},_t.dialog.buttons.NO,{text:t.negButton||dt("confirm.default.negButton"),className:"btn btn-default small"})],input:n,callback:o,showCloseButton:!0})})}function Vt(){Ut(qt(),dt("alert.addtohomescreen.heading"),"normal")}function qt(){let e;const t=vt.browser,n=vt.os;return Pt||(n.ios&&t.safari?(e="ios-safari",Pt=dt("alert.addtohomescreen.iossafari.msg",jt(e))):n.android&&t.chrome?(e="android-chrome",Pt=dt("alert.addtohomescreen.androidchrome.msg",jt(e))):n.android&&t.firefox&&(Pt=dt("alert.addtohomescreen.androidfirefox.msg",jt()))),Pt}function jt(e,t){return{image1:e?`<span class="${e}"/>`:"",image2:t?`<span class="${t}"/>`:"",interpolation:{escapeValue:!1}}}function $t(){const e=Ht(),t={heading:e.heading,msg:e.msg},n={posButton:e.posButton,negButton:e.negButton},i=e.gridInputs+e.gridWarning,r=document.querySelectorAll(".question");return R(),r.forEach(e=>e.dispatchEvent(yt.Printify())),"grid"===Mt||!Mt&&N()?Ft(t,n,i).then(e=>{if(e)return function(e){const t=D();return P(e,800).then(Wt).then(window.print).catch(console.error).then(()=>{if(t)return new Promise(e=>{setTimeout(()=>{I.media.mediaText="print",A.setAttribute("media","print"),document.querySelectorAll(".print-height-adjusted, .print-width-adjusted, .main").forEach(e=>{e.removeAttribute("style"),e.classList.remove("print-height-adjusted","print-width-adjusted")}),T(".back-to-screen-view").off("click").remove(),e()},500)})})}(e)}).then(()=>{M(),r.forEach(e=>e.dispatchEvent(yt.DePrintify()))}):(window.print(),M(),r.forEach(e=>e.dispatchEvent(yt.DePrintify())),Promise.resolve())}function Ht(){return{heading:dt("confirm.print.heading"),msg:dt("confirm.print.msg"),posButton:dt("confirm.print.posButton"),negButton:dt("alert.default.button"),gridInputs:`<fieldset><legend>${dt("confirm.print.psize")}</legend><label><input name="format" type="radio" value="A4" required checked/><span>${dt("confirm.print.a4")}</span></label><label><input name="format" type="radio" value="Letter" required/><span>${dt("confirm.print.letter")}</span></label></fieldset><fieldset><legend>${dt("confirm.print.orientation")}</legend><label><input name="orientation" type="radio" value="portrait" required checked/><span>${dt("confirm.print.portrait")}</span></label><label><input name="orientation" type="radio" value="landscape" required/><span>${dt("confirm.print.landscape")}</span></label></fieldset>`,gridWarning:`<p class="alert-box info" >${dt("confirm.print.reminder")}</p>`}}function Wt(e=400){return new Promise(t=>{setTimeout(t,e)})}_t.registerPlugin(Nt),_t.defaultOptions.className="vex-theme-plain",Rt={show(e,t){let n;const i=T("#feedback-bar");t=t?1e3*t:1e4,i.addClass("feedback-bar--show").find("p").eq(1).remove(),i.find("p").html()!==e&&(n=T("<p></p>").append(e),i.prepend(n)),setTimeout(()=>{let e;void 0!==n&&(e=n.siblings("p").length,n.remove(),0===e&&Rt.hide())},t)},hide(){T("#feedback-bar").removeClass("feedback-bar--show").find("p").remove()}},Bt={offlineCapable(e){e?T(".offline-enabled__icon.not-enabled").removeClass("not-enabled"):T(".offline-enabled__icon").addClass("not-enabled")},applicationVersion(e){T(".side-slider__app-version__value").text(e)}},T(document).ready(()=>{ct().then(Ot),void 0===window.console&&(window.console={log(){}}),void 0===window.console.debug&&(console.debug=console.log),k.touch?(o.touch=!0,T("html").addClass("touch")):!1===k.touch&&(o.touch=!1,T("html").removeClass("touch"))});var Kt={alert:Ut,confirm:zt,prompt:Ft,feedback:function(e,t){o.touch?Ut(e,dt("feedback.header"),"info",t):Rt.show(e,t)},updateStatus:Bt,pages:void 0,swapTheme:function(e){const t=e.theme,n=T("link[rel=stylesheet][href*=theme-]"),i=/\/theme-([A-z]+)(\.print)?\.css/.exec(n.eq(0).attr("href"));return Mt=null!==i?i[1]:null,new Promise(i=>{if(t&&t!==Mt&&k.themesSupported.some(e=>t===e)){const r=[];n.each((function(){r.push(T(this.outerHTML.replace(/(href=.*\/theme-)[A-z]+((\.print)?\.css)/,`$1${t}$2`)))})),console.log("Swapping theme to",t),r[0].on("load",()=>{Mt=t,i(e)}),n.each((function(e){T(this).replaceWith(r[e])}))}else console.log("Keeping default theme."),delete e.theme,i(e)})},confirmLogin:function(e){zt({msg:e=e||dt("confirm.login.msg"),heading:dt("confirm.login.heading")},{posButton:dt("confirm.login.posButton"),negButton:dt("confirm.login.negButton")}).then(e=>{if(!e)return;let t="?return_url="+encodeURIComponent(location.href);t+=k.touch?"&touch="+k.touch:"",t+=k.debug?"&debug="+k.debug:"",location.href=`${location.protocol}//${location.host}${k.loginUrl}${t}`})},alertLoadErrors:function(e,t){const n=`<ul class="error-list"><li>${e.join("</li><li>")}</li></ul>`,i="* "+e.join("\n* "),r=k.supportEmail,o={emailLink:`<a href="mailto:${r}?subject=loading errors for: ${encodeURIComponent(location.href)}&body=${encodeURIComponent(i)}" target="_blank" >${r}</a>`,count:e.length,interpolation:{escapeValue:!1}};t=t||"",Ut(`<p>${dt("alert.loaderror.msg1",o)} ${t}</p><p>${dt("alert.loaderror.msg2",o)}</p>${n}`,dt("alert.loaderror.heading",o))},alertCacheUnsupported:function(){const e=dt("alert.offlineunsupported.msg"),t={posButton:dt("alert.offlineunsupported.posButton"),negButton:dt("alert.offlineunsupported.negButton")};zt({msg:e,heading:dt("alert.offlineunsupported.heading")},t).then(e=>{e&&(window.location=k.modernBrowsersURL)})},getErrorResponseMsg:function(e){let t;const n={supportEmail:k.supportEmail},i=dt("contact.support",n),r=dt("contact.admin"),o={0:dt("submission.http0"),200:`${dt("submission.http2xx")}<br/>${i}`,"2xx":`${dt("submission.http2xx")}<br/>${i}`,400:`${dt("submission.http400")}<br/>${r}`,401:dt("submission.http401"),403:`${dt("submission.http403")}<br/>${r}`,404:dt("submission.http404"),408:dt("submission.http408"),"4xx":dt("submission.http4xx"),413:`${dt("submission.http413")}<br/>${i}`,500:dt("submission.http500",n),503:dt("submission.http500",n),504:dt("submission.http504",n),"5xx":dt("submission.http500",n)};return t=o[e=void 0!==e?e.toString():"undefined"]?`${o[e]} (${e})`:o[e.replace(e.substring(1),"xx")]?`${o[e.replace(e.substring(1),"xx")]} (${e})`:`${dt("error.unknown")} (${e})`,t},applyPrintStyle:function(){new Promise(e=>{let t=[...document.images];const n=setInterval(()=>{t=t.filter(e=>!e.complete),0===t.length&&(clearInterval(n),e())},150)}).then(()=>{if(R(),document.querySelectorAll(".question").forEach(e=>e.dispatchEvent(yt.Printify())),"grid"===Mt||!Mt&&N()){return P({format:k.format,landscape:k.landscape,scale:k.scale,margin:k.margin},800)}}).then(Wt).then(()=>{window.printReady=!0}).catch(console.error)},getPrintDialogComponents:Ht,printForm:$t};const Gt=new DOMParser,Zt=k.basePath+"/connection",Yt=`${k.basePath}/transform/xform${k.enketoId?"/"+k.enketoId:""}`,Xt=`${k.basePath}/transform/xform/hash/${k.enketoId}`,Qt=k.enketoId?`${k.basePath}/submission/${k.enketoId}`:null,Jt=k.enketoId?`${k.basePath}/submission/max-size/${k.enketoId}`:`${k.basePath}/submission/max-size/?xformUrl=${encodeURIComponent(k.xformUrl)}`;function en(){return C.getQueryString([k.languageOverrideParameter,k.submissionParameter])}var tn={uploadRecord:function(e){let t;try{t=function(e){const t=Gt.parseFromString(e.xml,"text/xml"),n=Array.prototype.slice.call(t.querySelectorAll('[type="file"]')).map(e=>(e.removeAttribute("type"),e)),i=(new XMLSerializer).serializeToString(t.documentElement),r=new Blob([i],{type:"text/xml"}),o=e.files||[],a=[],s=[],l=[];let u=[[]];const c=[],h=k.maxSize;n.forEach(e=>{let t;const n=e.nodeName,i=e.textContent;o.some(e=>e.name===i&&(t=e,!0)),t?(l.push({nodeName:n,file:t}),a.push(t.size)):(s.push(i),console.error("Error occured when trying to retrieve "+i))}),l.length>0&&(u=function(e,t){let n,i,r,o;const a=[],s=[];for(n=0;n<e.length;n++)a.push({index:n,size:e[n]});for(;a.length>0;){if(r=[a[0].index],o=a[0].size,a[0].size<t)for(n=1;n<a.length;n++)o+a[n].size<t&&(r.push(a[n].index),o+=a[n].size);for(s.push(r),n=0;n<a.length;n++)for(i=0;i<r.length;i++)a[n].index===r[i]&&a.splice(n,1)}return s}(a,h));return console.log(`splitting record into ${u.length} batches to reduce submission size `,u),u.forEach(e=>{let t;const n=new FormData;n.append("xml_submission_file",r,"xml_submission_file");const i=(document.cookie.split("; ").find(e=>e.startsWith("__csrf"))||"").split("=")[1];i&&n.append("__csrf",i),t={formData:n,failedFiles:s},e.forEach(e=>{t.formData.append(l[e].file.name,l[e].file,l[e].file.name)}),c.push(t)}),c}(e)}catch(e){return Promise.reject(e)}return t.forEach(t=>{t.instanceId=e.instanceId,t.deprecatedId=e.deprecatedId}),t.reduce((e,t)=>e.then(()=>{return e=t,new Promise((t,n)=>{const i=k.enketoId?`${k.basePath}/submission/${k.enketoId}${en()}`:null;T.ajax(i,{type:"POST",data:e.formData,cache:!1,contentType:!1,processData:!1,headers:{"X-OpenRosa-Version":"1.0","X-OpenRosa-Deprecated-Id":e.deprecatedId,"X-OpenRosa-Instance-Id":e.instanceId},timeout:k.timeout}).done((i,r,o)=>{const a={status:o.status,failedFiles:e.failedFiles?e.failedFiles:void 0};201===a.status||202===a.status?t(a):n(a)}).fail(e=>{let t=null,i=null;400===e.status&&e.responseXML&&(t=e.responseXML.querySelector("OpenRosaResponse > message"),t&&(i=t.textContent)),n({status:e.status,message:i})})});var e}),Promise.resolve()).then(e=>(console.log("results of all batches submitted",e),e[0]))},getMaximumSubmissionSize:function(){let e;return new Promise(t=>{Jt?T.ajax(Jt,{type:"GET",timeout:5e3,dataType:"json"}).done(n=>{n&&n.maxSize&&!isNaN(n.maxSize)?(e=Number(n.maxSize)>104857600?104857600:Number(n.maxSize),t(e)):(console.error("Error retrieving maximum submission size. Unexpected response: ",n),t(null))}).fail(()=>{t(null)}):t(null)})},getOnlineStatus:function(){return fetch(Zt,{cache:"no-cache",headers:{"Content-Type":"text/plain"}}).then(e=>e.text()).then(e=>/connected/.test(e)).catch(()=>!1)},getFormParts:function(e){let t;return new Promise((n,i)=>{T.ajax(Yt+en(),{type:"POST",data:{serverUrl:e.serverUrl,xformId:e.xformId,xformUrl:e.xformUrl}}).done(t=>{t.enketoId=e.enketoId,t.theme=t.theme||C.getThemeFromFormStr(t.form)||k.defaultTheme,function(e){let t;const n=[];try{t=T.parseXML(e.model),e.externalData=T(t).find("instance[id][src]").map((e,t)=>({id:T(t).attr("id"),src:T(t).attr("src")})).get(),e.externalData.forEach((t,i)=>{n.push(function(e,t){let n;return fetch(e).then(e=>(n=e.headers.get("Content-Type").split(";")[0],e.text())).then(e=>{let i;switch(n){case"text/csv":i=C.csvToXml(e,t);break;case"text/xml":i=(new DOMParser).parseFromString(e,n);break;default:console.error("External data not served with expected Content-Type.",n),i=(new DOMParser).parseFromString(e,"text/xml")}return i&&i.querySelector("parsererror")&&"text/csv"!==n&&(console.log("Failed to parse external data as XML, am going to try as CSV"),i=C.csvToXml(e,t)),i}).catch(t=>{const n=t.msg||dt("error.dataloadfailed",{url:e});throw new Error(n)})}(t.src,e.languageMap).then(e=>(t.xml=e,t)).catch(t=>{e.externalData.splice(i,1),console.error(t)}))})}catch(e){return Promise.reject(e)}return Promise.all(n).then(()=>e)}(t).then(n).catch(i)}).fail((e,n,r)=>{e.responseJSON&&e.responseJSON.message&&/ENOTFOUND/.test(e.responseJSON.message)&&(e.responseJSON.message="Form could not be retrieved from server."),t=e.responseJSON||new Error(r),t.status=e.status,i(t)})})},getFormPartsHash:function(){let e;return new Promise((t,n)=>{T.ajax(Xt+en(),{type:"POST"}).done(e=>{t(e.hash)}).fail((t,i,r)=>{e=new Error(r),e.status=t.status,n(e)})})},getMediaFile:function(e){let t;const n=new XMLHttpRequest;return new Promise((i,r)=>{n.onreadystatechange=function(){4===this.readyState&&(this.status>=200&&this.status<300?i({url:e,item:this.response}):(t=new Error(this.statusText||dt("error.loadfailed",{resource:e})),t.status=this.status,r(t)))},n.open("GET",e),n.responseType="blob",n.send()})},getExistingInstance:function(e){let t;return new Promise((n,i)=>{T.ajax(Qt,{type:"GET",data:e}).done(e=>{n(e)}).fail((e,n,r)=>{t=e.responseJSON||new Error(r),i(t)})})},getServiceWorkerVersion:function(e){return fetch(e).then(e=>e.text()).then(e=>{const t=e.match(/version\s?=\s?'([^\n]+)'/);return t?t[1]:"unknown"})}};function nn(){throw new Error("setTimeout has not been defined")}function rn(){throw new Error("clearTimeout has not been defined")}var on=nn,an=rn;function sn(e){if(on===setTimeout)return setTimeout(e,0);if((on===nn||!on)&&setTimeout)return on=setTimeout,setTimeout(e,0);try{return on(e,0)}catch(t){try{return on.call(null,e,0)}catch(t){return on.call(this,e,0)}}}"function"==typeof Ae.setTimeout&&(on=setTimeout),"function"==typeof Ae.clearTimeout&&(an=clearTimeout);var ln,un=[],cn=!1,hn=-1;function dn(){cn&&ln&&(cn=!1,ln.length?un=ln.concat(un):hn=-1,un.length&&pn())}function pn(){if(!cn){var e=sn(dn);cn=!0;for(var t=un.length;t;){for(ln=un,un=[];++hn<t;)ln&&ln[hn].run();hn=-1,t=un.length}ln=null,cn=!1,function(e){if(an===clearTimeout)return clearTimeout(e);if((an===rn||!an)&&clearTimeout)return an=clearTimeout,clearTimeout(e);try{an(e)}catch(t){try{return an.call(null,e)}catch(t){return an.call(this,e)}}}(e)}}function fn(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];un.push(new gn(e,t)),1!==un.length||cn||sn(pn)}function gn(e,t){this.fun=e,this.array=t}gn.prototype.run=function(){this.fun.apply(null,this.array)};function mn(){}var vn=mn,yn=mn,_n=mn,bn=mn,wn=mn,En=mn,Cn=mn;var Sn=Ae.performance||{},kn=Sn.now||Sn.mozNow||Sn.msNow||Sn.oNow||Sn.webkitNow||function(){return(new Date).getTime()};var Tn=new Date;var xn={nextTick:fn,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:vn,addListener:yn,once:_n,off:bn,removeListener:wn,removeAllListeners:En,emit:Cn,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*kn.call(Sn),n=Math.floor(t),i=Math.floor(t%1*1e9);return e&&(n-=e[0],(i-=e[1])<0&&(n--,i+=1e9)),[n,i]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Tn)/1e3}},Ln=u((function(e,t){e.exports=function(e){var t,n,i,r,o,a,u,c,h,d,p={pfx:"_",psr:"http://www.w3.org/1999/xhtml",xpe:"http://www.w3.org/2000/xmlns/"},f=this,g=function(){for(var e,t,a=!1,l=["MSXML2.DOMDocument.6.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","Microsoft.XmlDom"],c=l.length,h=0;h<c;h++)try{var d=new ActiveXObject(l[h]);if(d.async=!1,a=!0,d.loadXML("<x></x>")&&d.selectSingleNode("/"))break}catch(e){}return a?h<c?(n=l[h],e=1):e="nox":("undefined"!=typeof window?(t=window,e=2):void 0!==s?(t=s,e=3):t={},t.DOMParser?t.XMLSerializer?t.XPathEvaluator?2===e?(i=new t.DOMParser,r=new t.XPathEvaluator,o=t.XPathResult,a=i.parseFromString("<invalid","text/xml"),p.psr=a.getElementsByTagName("parsererror")[0].namespaceURI):(i=new t.DOMParser({xmlns:p.psr,errorHandler:function(){u=!0}}),r=t.XPathEvaluator,o=t.XPathEvaluator.XPathResult,p.xpe=r.XPath.XMLNS_NAMESPACE_URI):e="nox":e="nos":e="nod"),"string"==typeof e?S(e):e};f.Init=function(e){return"object"!=typeof e&&(e={}),void 0===e.stay?void 0===c&&(c=["all"]):c=e.stay?"object"==typeof e.stay&&e.stay instanceof Array?e.stay:[e.stay]:[],void 0===e.join?void 0===h&&(h=["root"]):h=e.join?[String(e.join)]:[!1],h[1]=!1,void 0!==e.updn?d=e.updn:void 0===d&&(d=!0),f.dom=null,f.nsp={},f.count=0,t&&(f.error={code:"",text:""}),t},f.AddFile=function(e){return t?e&&e.target?e.target.result?f.AddSource(e.target.result):S("emf"):S("nof"):t},f.AddSource=function(e){var n,i;if(t)if("object"==typeof e)(i=!!f.Get(1,e)&&e)&&(t>1&&!DOMParser||1===t&&!i.selectSingleNode("/"))&&(i=null);else try{i=m(e)}catch(e){i=!1}if(t)if(null===i)n=S("nob");else if(!1===i)n=S("inv");else if(!0===i)f.nsp=w(f.dom.documentElement),f.count=1,n=f.dom;else if(y(i)){if(_(i,"/"),!0===h[1]){var r=f.dom.createTextNode("\r\n");f.dom.documentElement.appendChild(r)}f.count++,n=f.dom}else n=!1;else n=t;return n};var m=function(e){var r,o;return t>1?(u=!1,f.dom?(o=i.parseFromString(e,"text/xml"),r=!!v(o)&&o):(f.dom=i.parseFromString(e,"text/xml"),r=!!v(f.dom))):f.dom?((o=new ActiveXObject(n)).async=!1,r=!!o.loadXML(e)&&o):(f.dom=new ActiveXObject(n),f.dom.async=!1,f.dom.setProperty("SelectionLanguage","XPath"),r=!!f.dom.loadXML(e)),r},v=function(e){return!u&&!e.getElementsByTagNameNS(p.psr,"parsererror").length},y=function(e){var n=!0,i=f.dom.characterSet||f.dom.inputEncoding||f.dom.xmlEncoding;if((e.characterSet||e.inputEncoding||e.xmlEncoding)!==i)n=S("enc");else if(e.documentElement.namespaceURI!==f.dom.documentElement.namespaceURI)n=S("nse");else if(e.documentElement.nodeName!==f.dom.documentElement.nodeName)if(h[0]){if(!h[1]){var r=void 0!==i?i:"UTF-8",o='<?xml version="'+(f.dom.xmlVersion?f.dom.xmlVersion:"1.0")+'" encoding="'+r+'"?>\r\n<'+h[0]+">\r\n</"+h[0]+">",s=m(o);if(s){var l=f.dom.documentElement.cloneNode(!0);s.documentElement.appendChild(l),l=s.createTextNode("\r\n"),s.documentElement.appendChild(l),f.dom=s,h[1]=!0}else n=S("jne"),h[1]=null}}else n=S("dif");if(n){var u=w(e.documentElement);for(var c in u)f.nsp[c]||(void 0!==f.dom.documentElement.setAttributeNS?f.dom.documentElement.setAttributeNS(p.xpe,"xmlns:"+c,u[c]):f.dom.documentElement.setAttribute("xmlns:"+c,u[c]),f.nsp[c]=u[c]);d?1===t?E():a=3===t?f:f.lookupNamespaceURI:a=null}return n},_=function e(t,n){for(var i=0;i<t.childNodes.length;i++){var r,o=t.childNodes[i],a=b(t.childNodes,o,n,i),s=f.Query(a);if(1===o.nodeType){var l=!0;if(null===s||s.namespaceURI!==o.namespaceURI)r=o.cloneNode(!0),(s=f.Query(n)).appendChild(r);else if(!1!==C(s.getAttribute("stay"),c)&&(l=!1),l)try{for(var u=0;u<o.attributes.length;u++)o.attributes[u].namespaceURI&&void 0!==o.setAttributeNS?s.setAttributeNS(o.attributes[u].namespaceURI,o.attributes[u].nodeName,o.attributes[u].nodeValue):s.setAttribute(o.attributes[u].nodeName,o.attributes[u].nodeValue)}catch(e){}o.hasChildNodes()&&l&&e(o,a)}else 3!==o.nodeType&&8!==o.nodeType||(null===s||s.nodeType!==o.nodeType?(s=f.Query(n),r=3===o.nodeType?f.dom.createTextNode(o.nodeValue):f.dom.createComment(o.nodeValue),s.appendChild(r)):(s.nodeValue=o.nodeValue,s.data=o.data))}},b=function(e,n,i,r){var o,a,s=0;if(1===n.nodeType){for(a=0;a<=r;a++)(d&&e[a].nodeType===n.nodeType&&e[a].nodeName===n.nodeName||!d&&7!==e[a].nodeType)&&s++;if(d){var l=!1,u=w(n);for(var c in u)c!==p.pfx&&(f.nsp[c]=u[c],l=1===t);l&&E(),o=n.prefix?n.prefix+":":f.nsp[p.pfx]?p.pfx+":":"",o+=n.localName?n.localName:n.baseName}else o="node()"}else if(3===n.nodeType||8===n.nodeType){for(a=0;a<=r;a++)e[a].nodeType===n.nodeType&&s++;o=3===n.nodeType?"text()":"comment()"}else o=i;return s&&(o=i+("/"===i.slice(-1)?"":"/")+o+"["+s+"]"),o},w=function(e){for(var t={},n=e.attributes,i=0;i<n.length;++i){var r=n[i].name.split(":");"xmlns"===r[0]&&(t[r[1]?r[1]:p.pfx]=n[i].value)}return t};f.Query=function(e){if(!t)return null;var n;h[1]&&(e="/"+f.dom.documentElement.nodeName+("/"===e?"":e));try{n=t>1?(n=r.evaluate(e,f.dom,a,o.FIRST_ORDERED_NODE_TYPE,null)).singleNodeValue:f.dom.selectSingleNode(e)}catch(e){n=null}return n},f.lookupNamespaceURI=function(e){return f.nsp[e]||null};var E=function(){var e="";for(var t in f.nsp)e+=" xmlns:"+t+"='"+f.nsp[t]+"'";e&&f.dom.setProperty("SelectionNamespaces",e.substr(1))},C=function(e,t){var n=!1;for(var i in t)if(t[i]===e){n=i;break}return n};f.Get=function(e,n){var i;if(e&&!n&&(n=f.dom),t)if(e)if(n)if(n.xml)i=n.xml;else try{i=(new XMLSerializer).serializeToString(n)}catch(t){i=t.message,e=null}else i="";else i=f.dom;else i=f.error.text;if(i&&2===e){if(h[1]){var r=i.indexOf("<"+h[0]);i=i.substr(0,r)+"\r\n"+i.substr(r)}i=(i=i.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ |\t/g,"&nbsp;")).replace(/(\r\n|\n|\r)/g,"<br>")}return i};var S=function(e){var t={nod:"XML DOM is not supported",nos:"Serializer is not supported",nox:"xPath is not supported",nob:"Incompatible source object",nof:"File not found",emf:"File is empty",inv:"Invalid XML source",enc:"Different encoding",dif:"Different root nodes",jne:"Invalid join parameter",nse:"Namespace incompatibility",und:"Undefined error"};return f.error.code=t[e]?e:"und",f.error.text=t[f.error.code],!1};!function(){if(f.error={},void 0!==xn&&xn.versions&&xn.versions.node){"object"==typeof e&&"string"==typeof e.path&&e.path;try{s.XPathEvaluator=l(),s.DOMParser=l().DOMParser,s.XMLSerializer=l().XMLSerializer}catch(e){console.log(e.message)}}t=g(),f.Init(e)}()}}));function In(e,t){return Dn(e,t,[e])}function An(e,t){return Dn(e,t)}function Dn(e,t="*",n=[]){const i=n;let r=e.previousElementSibling,o=e.nextElementSibling;for(;r;)r.matches(t)&&i.unshift(r),r=r.previousElementSibling;for(;o;)o.matches(t)&&i.push(o),o=o.nextElementSibling;return i}function Nn(e,t="*",n){const i=[];let r=e.parentElement;for(;r;)r.matches(t)&&i.unshift(r),r=n&&r.matches(n)?null:r.parentElement;return i}function Pn(e,t="*",n){let i=e.parentElement,r=null;for(;i&&!r;)i.matches(t)&&(r=i),i=n&&i.matches(n)?null:i.parentElement;return r}function Bn(e,t="*"){return[...e.children].filter(e=>e.matches(t))}function Rn(e,t="#document",n=!1){let i;const r=[];let o="";if(!e||1!==e.nodeType)return null;const a=e.nodeName;let s=e.parentElement,l=s?s.nodeName:null;for(n&&(i=Mn(e),i>0&&(o=`[${i+1}]`)),r.push(a+o);s&&l!==t&&"#document"!==l;)n&&(i=Mn(s),o=i>0?`[${i+1}]`:""),r.push(l+o),s=s.parentElement,l=s?s.nodeName:null;return"/"+r.reverse().join("/")}function Mn(e){let t=0;const n=e.nodeName;let i=e.previousSibling;for(;i;)i.nodeName&&i.nodeName===n&&t++,i=i.previousSibling;return t}const On={_storage:new WeakMap,put:function(e,t,n){this._storage.has(e)||this._storage.set(e,new Map),this._storage.get(e).set(t,n)},get:function(e,t){const n=this._storage.get(e);return n?n.get(t):n},has:function(e,t){const n=this._storage.get(e);return n&&n.has(t)},remove:function(e,t){var n=this._storage.get(e).delete(t);return 0===!this._storage.get(t).size&&this._storage.delete(e),n}};function Un(e){this.message=e||"unknown",this.name="FormLogicError",this.stack=(new Error).stack}Un.prototype=Object.create(Error.prototype),Un.prototype.constructor=Un;let zn=navigator.language;const Fn=new RegExp("^([:0-9٠-٩]+ ?([^: 0-9٠-٩]+))|(([^: 0-9٠-٩]+) ?[:0-9٠-٩]+)$");function Vn(e){return qn((e=void 0===e?new Date:e).toLocaleTimeString(zn))}function qn(e){return e.replace(/[\u200E\u200F]/g,"")}const jn={get hour12(){return this.hasMeridian(Vn())},get pmNotation(){return this.meridianNotation(new Date(2e3,1,1,23,0,0))},get amNotation(){return this.meridianNotation(new Date(2e3,1,1,1,0,0))},meridianNotation(e){let t=Vn(e).match(Fn);return t&&t.length?(t=t.filter(e=>!!e),t[t.length-1].trim()):null},hasMeridian:e=>Fn.test(qn(e))},$n={string:{convert:e=>e.replace(/^\s+$/,""),validate:()=>!0},select:{validate:()=>!0},select1:{validate:()=>!0},decimal:{convert(e){const t=Number(e);return isNaN(t)||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY?"":t},validate(e){const t=Number(e);return!isNaN(t)&&t!==Number.POSITIVE_INFINITY&&t!==Number.NEGATIVE_INFINITY}},int:{convert(e){const t=Number(e);return isNaN(t)||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY?"":t>=0?Math.floor(t):-Math.floor(Math.abs(t))},validate(e){const t=Number(e);return!isNaN(t)&&t!==Number.POSITIVE_INFINITY&&t!==Number.NEGATIVE_INFINITY&&Math.round(t)===t&&t.toString()===e.toString()}},date:{validate(e){const t=/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/.exec(e);if(t&&4===t.length){const e=Number(t[1]),n=Number(t[2])-1,i=Number(t[3]),r=new Date(e,n,i);return r.getFullYear()===e&&r.getMonth()===n&&r.getDate()===i}return!1},convert(e){if(g(e)){const t=new Date(24*e*60*60*1e3);return"Invalid Date"===t.toString()?"":`${t.getFullYear().toString().pad(4)}-${(t.getMonth()+1).toString().pad(2)}-${t.getDate().toString().pad(2)}`}return/[0-9]T[0-9]/.test(e)&&(e=e.split("T")[0]),this.validate(e)?e:""}},datetime:{validate(e){const t=e.split("T");return 2===t.length?$n.date.validate(t[0])&&$n.time.validate(t[1],!1):$n.date.validate(t[0])},convert(e){let t="Invalid Date";const n=e.split("T");if(g(e))t=new Date(24*e*60*60*1e3);else if(/[0-9]T[0-9]/.test(e)&&2===n.length){const e=$n.date.convert(n[0]),t=$n.time.convert(n[1],!1);if(e&&t)return`${e}T${t}`}else{const e=$n.date.convert(n[0]);if(e)return`${e}T00:00:00.000${(new Date).getTimezoneOffsetAsTime()}`}return"Invalid Date"!==t.toString()?t.toISOLocalString():""}},time:{validate(e,t){let n=e.match(/^(\d\d):(\d\d):(\d\d)\.\d\d\d(\+|-)(\d\d):(\d\d)$/);return t="boolean"!=typeof t||t,n||t||(n=e.match(/^(\d\d):(\d\d):(\d\d)(\+|-)(\d\d):(\d\d)$/)),!!n&&(n[1]<24&&n[1]>=0&&n[2]<60&&n[2]>=0&&n[3]<60&&n[3]>=0&&n[5]<24&&n[5]>=0&&n[6]<60&&n[6]>=0)},convert(e,t){let n;const i={};let r,o,a,s,l;if(t="boolean"!=typeof t||t,!/^[0-9]{1,2}:[0-9]{1,2}(:[0-9.]*)?/.test(e)){if(n=new Date(e),"Invalid Date"===n.toString())return"";e=`${n.getHours()}:${n.getMinutes()}:${n.getSeconds()}.${n.getMilliseconds()}${n.getTimezoneOffsetAsTime()}`}return r=e.toString().split(/(\+|-|Z)/),r.length<1?"":(o=r[0].split(":"),s=r[2]?[r[1]].concat(r[2].split(":")):"Z"===r[1]?["+","00","00"]:[],i.hours=o[0].pad(2),i.minutes=o[1].pad(2),a=o[2]?o[2].split("."):["00"],i.seconds=a[0],i.milliseconds=a[1]||(t?"000":void 0),l=0===s.length?(new Date).getTimezoneOffsetAsTime():`${s[0]+s[1].pad(2)}:${s[2]?s[2].pad(2):"00"}`,e=`${i.hours}:${i.minutes}:${i.seconds}${i.milliseconds?"."+i.milliseconds:""}${l}`,this.validate(e,t)?e:"")},convertMeridian(e){if(e=e.trim(),jn.hasMeridian(e)){const t=e.split(" "),n=t[0].split(":");t.length>0&&(t[1]===jn.pmNotation?n[0]=(Number(n[0])%12+12).toString().pad(2):t[1]===jn.amNotation&&(n[0]=(Number(n[0])%12).toString().pad(2)),e=n.join(":"))}return e}},barcode:{validate:()=>!0},geopoint:{validate(e){const t=e.toString().trim().split(" ");return""!==t[0]&&t[0]>=-90&&t[0]<=90&&""!==t[1]&&t[1]>=-360&&t[1]<=360&&(void 0===t[2]||!isNaN(t[2]))&&(void 0===t[3]||!isNaN(t[3])&&t[3]>=0)},convert:e=>e.toString().trim()},geotrace:{validate(e){const t=e.toString().split(";");return t.length>=2&&t.every(e=>$n.geopoint.validate(e))},convert:e=>e.toString().trim()},geoshape:{validate(e){const t=e.toString().split(";");return t.length>=4&&t[0]===t[t.length-1]&&t.every(e=>$n.geopoint.validate(e))},convert:e=>e.toString().trim()},binary:{validate:()=>!0}};Date.prototype.toISOLocalString=function(){if("Invalid Date"===this.toString())return this.toString();var e=new Date(this.getTime()-60*this.getTimezoneOffset()*1e3).toISOString().replace("Z",this.getTimezoneOffsetAsTime());return e.indexOf("T00:00:00.000")>0?e.split("T")[0]:e},Date.prototype.getTimezoneOffsetAsTime=function(){var e,t=function(e){return e<10?"0"+e:e};return"Invalid Date"===this.toString()?this.toString():((e=this.getTimezoneOffset())<0?"+":"-")+t(Math.floor(Math.abs(e)/60))+":"+t(Math.floor(Math.abs(e)%60))},String.prototype.pad=function(e){let t=this;for(;t.length<e;)t="0"+t;return t},void 0===console.deprecate&&(console.deprecate=(e,t)=>{console.warn(`${e} is deprecated. Use ${t} instead.`)});var Hn=function(){function e(t,n,i,r){this.message=t,this.expected=n,this.found=i,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),{SyntaxError:e,parse:function(t){var n,i=arguments.length>1?arguments[1]:{},r={},o={XPath:Sn},a=Sn,s=function(e){return{tree:e,nsPrefixes:gi}},l="/",u={type:"literal",value:"/",description:'"/"'},c=function(e){return{type:"/",args:[null,e?e[1]:null]}},h="//",d={type:"literal",value:"//",description:'"//"'},p=function(e,t){var n;for(n=0;n<t.length;n++)e=yi(t[n][1],e,t[n][3]);return e},f=function(e,t,n){return fi({type:"step",args:[e,t]},e,n,1)},g="::",m={type:"literal",value:"::",description:'"::"'},v=function(e){return e},y=function(e){return e.length?e:"child"},_="ancestor-or-self",b={type:"literal",value:"ancestor-or-self",description:'"ancestor-or-self"'},w="ancestor",E={type:"literal",value:"ancestor",description:'"ancestor"'},C="attribute",S={type:"literal",value:"attribute",description:'"attribute"'},k="child",T={type:"literal",value:"child",description:'"child"'},x="descendant-or-self",L={type:"literal",value:"descendant-or-self",description:'"descendant-or-self"'},I="descendant",A={type:"literal",value:"descendant",description:'"descendant"'},D="following-sibling",N={type:"literal",value:"following-sibling",description:'"following-sibling"'},P="following",B={type:"literal",value:"following",description:'"following"'},R="namespace",M={type:"literal",value:"namespace",description:'"namespace"'},O="parent",U={type:"literal",value:"parent",description:'"parent"'},z="preceding-sibling",F={type:"literal",value:"preceding-sibling",description:'"preceding-sibling"'},V="preceding",q={type:"literal",value:"preceding",description:'"preceding"'},j="self",$={type:"literal",value:"self",description:'"self"'},H="(",W={type:"literal",value:"(",description:'"("'},K=")",G={type:"literal",value:")",description:'")"'},Z=function(e){return{type:"nodeType",args:[e,[]]}},Y="processing-instruction",X={type:"literal",value:"processing-instruction",description:'"processing-instruction"'},Q=function(e,t){return{type:"nodeType",args:[e,[t]]}},J=function(e){return e},ee="[",te={type:"literal",value:"[",description:'"["'},ne="]",ie={type:"literal",value:"]",description:'"]"'},re=function(e){return e},oe=function(e){return yi("//",null,e)},ae="..",se={type:"literal",value:"..",description:'".."'},le=".",ue={type:"literal",value:".",description:'"."'},ce=function(e){var t={type:"step",args:["self",{type:"nodeType",args:["node",[]]}]};return".."==e&&(t.args[0]="parent"),t},he="@",de={type:"literal",value:"@",description:'"@"'},pe=function(e){return e?"attribute":""},fe=function(e){return e},ge=function(e){return e},me=function(e){return e},ve=",",ye={type:"literal",value:",",description:'","'},_e=function(e,t){var n,i=[];if(t)for(i.push(t[1]),n=0;n<t[2].length;n++)i.push(t[2][n][3]);return{type:"function",args:[e,i]}},be="|",we={type:"literal",value:"|",description:'"|"'},Ee=function(e,t){return pi(e,t,1,3)},Ce=function(e,t){return t?yi(t[1],e,t[3]):e},Se=function(e){return e},ke=function(e,t){return fi(e,"child",t,1)},Te="or",xe={type:"literal",value:"or",description:'"or"'},Le="and",Ie={type:"literal",value:"and",description:'"and"'},Ae="=",De={type:"literal",value:"=",description:'"="'},Ne="!=",Pe={type:"literal",value:"!=",description:'"!="'},Be="<=",Re={type:"literal",value:"<=",description:'"<="'},Me="<",Oe={type:"literal",value:"<",description:'"<"'},Ue=">=",ze={type:"literal",value:">=",description:'">="'},Fe=">",Ve={type:"literal",value:">",description:'">"'},qe="+",je={type:"literal",value:"+",description:'"+"'},$e="-",He={type:"literal",value:"-",description:'"-"'},We="div",Ke={type:"literal",value:"div",description:'"div"'},Ge="mod",Ze={type:"literal",value:"mod",description:'"mod"'},Ye=function(e){return{type:"*",args:[{type:"number",args:[-1]},e]}},Xe='"',Qe={type:"literal",value:'"',description:'"\\""'},Je=/^[^"]/,et={type:"class",value:'[^"]',description:'[^"]'},tt=function(e){return{type:"string",args:[e.join("")]}},nt="'",it={type:"literal",value:"'",description:'"\'"'},rt=/^[^']/,ot={type:"class",value:"[^']",description:"[^']"},at=function(e,t){return{type:"number",args:[t?parseFloat(e+"."+t[1]):parseInt(e)]}},st=function(e){return{type:"number",args:[parseFloat("."+e)]}},lt=/^[0-9]/,ut={type:"class",value:"[0-9]",description:"[0-9]"},ct=function(e){return e.join("")},ht="*",dt={type:"literal",value:"*",description:'"*"'},pt=function(e){var t;if(null===di.args[0])for(t=0;t<vi.length;t++)if(di.args[1]==vi[t])return!1;return!0},ft=function(e){return""===e.args[0]?e={type:e.type,args:[null,e.args[1]]}:mi(e.args[0]),e},gt="$",mt={type:"literal",value:"$",description:'"$"'},vt=function(e){return mi(e.args[0]),{type:"$",args:[e]}},yt=function(){return{type:"name",args:[null,null]}},_t=":",bt={type:"literal",value:":",description:'":"'},wt=function(e){return mi(e),{type:"name",args:[e,null]}},Et=function(e){return mi(e.args[0]),e},Ct="comment",St={type:"literal",value:"comment",description:'"comment"'},kt="text",Tt={type:"literal",value:"text",description:'"text"'},xt="node",Lt={type:"literal",value:"node",description:'"node"'},It=/^[ \t\r\n]/,At={type:"class",value:"[\\u0020\\u0009\\u000D\\u000A]",description:"[\\u0020\\u0009\\u000D\\u000A]"},Dt=function(e){return di=e,e},Nt=function(e,t){return{type:"name",args:[e,t]}},Pt=function(e){return{type:"name",args:[null,e]}},Bt=/^[A-Z]/,Rt={type:"class",value:"[A-Z]",description:"[A-Z]"},Mt="_",Ot={type:"literal",value:"_",description:'"_"'},Ut=/^[a-z]/,zt={type:"class",value:"[a-z]",description:"[a-z]"},Ft=/^[\xC0-\xD6]/,Vt={type:"class",value:"[\\u00C0-\\u00D6]",description:"[\\u00C0-\\u00D6]"},qt=/^[\xD8-\xF6]/,jt={type:"class",value:"[\\u00D8-\\u00F6]",description:"[\\u00D8-\\u00F6]"},$t=/^[\xF8-\u02FF]/,Ht={type:"class",value:"[\\u00F8-\\u02FF]",description:"[\\u00F8-\\u02FF]"},Wt=/^[\u0370-\u037D]/,Kt={type:"class",value:"[\\u0370-\\u037D]",description:"[\\u0370-\\u037D]"},Gt=/^[\u037F-\u1FFF]/,Zt={type:"class",value:"[\\u037F-\\u1FFF]",description:"[\\u037F-\\u1FFF]"},Yt=/^[\u200C-\u200D]/,Xt={type:"class",value:"[\\u200C-\\u200D]",description:"[\\u200C-\\u200D]"},Qt=/^[\u2070-\u218F]/,Jt={type:"class",value:"[\\u2070-\\u218F]",description:"[\\u2070-\\u218F]"},en=/^[\u2C00-\u2FEF]/,tn={type:"class",value:"[\\u2C00-\\u2FEF]",description:"[\\u2C00-\\u2FEF]"},nn=/^[\u3001-\uD7FF]/,rn={type:"class",value:"[\\u3001-\\uD7FF]",description:"[\\u3001-\\uD7FF]"},on=/^[\uF900-\uFDCF]/,an={type:"class",value:"[\\uF900-\\uFDCF]",description:"[\\uF900-\\uFDCF]"},sn=/^[\uFDF0-\uFFFD]/,ln={type:"class",value:"[\\uFDF0-\\uFFFD]",description:"[\\uFDF0-\\uFFFD]"},un=/^[\xB7]/,cn={type:"class",value:"[\\u00B7]",description:"[\\u00B7]"},hn=/^[\u0300-\u036F]/,dn={type:"class",value:"[\\u0300-\\u036F]",description:"[\\u0300-\\u036F]"},pn=/^[\u203F-\u2040]/,fn={type:"class",value:"[\\u203F-\\u2040]",description:"[\\u203F-\\u2040]"},gn=function(e,t){return e+t.join("")},mn=0,vn=[{line:1,column:1,seenCR:!1}],yn=0,_n=[];if("startRule"in i){if(!(i.startRule in o))throw new Error("Can't start parsing from rule \""+i.startRule+'".');a=o[i.startRule]}function bn(e){var n,i,r=vn[e];if(r)return r;for(n=e-1;!vn[n];)n--;for(r={line:(r=vn[n]).line,column:r.column,seenCR:r.seenCR};n<e;)"\n"===(i=t.charAt(n))?(r.seenCR||r.line++,r.column=1,r.seenCR=!1):"\r"===i||"\u2028"===i||"\u2029"===i?(r.line++,r.column=1,r.seenCR=!0):(r.column++,r.seenCR=!1),n++;return vn[e]=r,r}function wn(e,t){var n=bn(e),i=bn(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:i.line,column:i.column}}}function En(e){mn<yn||(mn>yn&&(yn=mn,_n=[]),_n.push(e))}function Cn(t,n,i,r){return null!==n&&function(e){var t=1;for(e.sort((function(e,t){return e.description<t.description?-1:e.description>t.description?1:0}));t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(n),new e(null!==t?t:function(e,t){var n,i=new Array(e.length);for(n=0;n<e.length;n++)i[n]=e[n].description;return"Expected "+(e.length>1?i.slice(0,-1).join(", ")+" or "+i[e.length-1]:i[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,(function(e){return"\\x0"+t(e)})).replace(/[\x10-\x1F\x80-\xFF]/g,(function(e){return"\\x"+t(e)})).replace(/[\u0100-\u0FFF]/g,(function(e){return"\\u0"+t(e)})).replace(/[\u1000-\uFFFF]/g,(function(e){return"\\u"+t(e)}))}(t)+'"':"end of input")+" found."}(n,i),n,i,r)}function Sn(){var e,t;return e=mn,ri()!==r&&(t=Mn())!==r&&ri()!==r?e=s(t):(mn=e,e=r),e}function kn(){var e;return(e=xn())===r&&(e=Tn()),e}function Tn(){var e,n,i,o,a;return(e=Pn())===r&&(e=mn,47===t.charCodeAt(mn)?(n=l,mn++):(n=r,En(u)),n!==r?(i=mn,(o=ri())!==r&&(a=xn())!==r?i=o=[o,a]:(mn=i,i=r),i===r&&(i=null),i!==r?e=n=c(i):(mn=e,e=r)):(mn=e,e=r)),e}function xn(){var e,n,i,o,a,s,c,f;if(e=mn,(n=Ln())!==r){for(i=[],o=mn,(a=ri())!==r?(t.substr(mn,2)===h?(s=h,mn+=2):(s=r,En(d)),s===r&&(47===t.charCodeAt(mn)?(s=l,mn++):(s=r,En(u))),s!==r&&(c=ri())!==r&&(f=Ln())!==r?o=a=[a,s,c,f]:(mn=o,o=r)):(mn=o,o=r);o!==r;)i.push(o),o=mn,(a=ri())!==r?(t.substr(mn,2)===h?(s=h,mn+=2):(s=r,En(d)),s===r&&(47===t.charCodeAt(mn)?(s=l,mn++):(s=r,En(u))),s!==r&&(c=ri())!==r&&(f=Ln())!==r?o=a=[a,s,c,f]:(mn=o,o=r)):(mn=o,o=r);i!==r?e=n=p(n,i):(mn=e,e=r)}else mn=e,e=r;return e}function Ln(){var e,t,n,i,o,a,s;if(e=mn,(t=In())!==r)if(ri()!==r)if((n=Dn())!==r){for(i=[],o=mn,(a=ri())!==r&&(s=Nn())!==r?o=a=[a,s]:(mn=o,o=r);o!==r;)i.push(o),o=mn,(a=ri())!==r&&(s=Nn())!==r?o=a=[a,s]:(mn=o,o=r);i!==r?e=t=f(t,n,i):(mn=e,e=r)}else mn=e,e=r;else mn=e,e=r;else mn=e,e=r;return e===r&&(e=Bn()),e}function In(){var e,n,i;return e=mn,(n=An())!==r&&ri()!==r?(t.substr(mn,2)===g?(i=g,mn+=2):(i=r,En(m)),i!==r?e=n=v(n):(mn=e,e=r)):(mn=e,e=r),e===r&&(e=mn,(n=Rn())!==r&&(n=y(n)),e=n),e}function An(){var e;return t.substr(mn,16)===_?(e=_,mn+=16):(e=r,En(b)),e===r&&(t.substr(mn,8)===w?(e=w,mn+=8):(e=r,En(E)),e===r&&(t.substr(mn,9)===C?(e=C,mn+=9):(e=r,En(S)),e===r&&(t.substr(mn,5)===k?(e=k,mn+=5):(e=r,En(T)),e===r&&(t.substr(mn,18)===x?(e=x,mn+=18):(e=r,En(L)),e===r&&(t.substr(mn,10)===I?(e=I,mn+=10):(e=r,En(A)),e===r&&(t.substr(mn,17)===D?(e=D,mn+=17):(e=r,En(N)),e===r&&(t.substr(mn,9)===P?(e=P,mn+=9):(e=r,En(B)),e===r&&(t.substr(mn,9)===R?(e=R,mn+=9):(e=r,En(M)),e===r&&(t.substr(mn,6)===O?(e=O,mn+=6):(e=r,En(U)),e===r&&(t.substr(mn,17)===z?(e=z,mn+=17):(e=r,En(F)),e===r&&(t.substr(mn,9)===V?(e=V,mn+=9):(e=r,En(q)),e===r&&(t.substr(mn,4)===j?(e=j,mn+=4):(e=r,En($)))))))))))))),e}function Dn(){var e,n,i,o,a;return e=mn,(n=ni())!==r&&ri()!==r?(40===t.charCodeAt(mn)?(i=H,mn++):(i=r,En(W)),i!==r&&ri()!==r?(41===t.charCodeAt(mn)?(o=K,mn++):(o=r,En(G)),o!==r?e=n=Z(n):(mn=e,e=r)):(mn=e,e=r)):(mn=e,e=r),e===r&&(e=mn,t.substr(mn,22)===Y?(n=Y,mn+=22):(n=r,En(X)),n!==r&&ri()!==r?(40===t.charCodeAt(mn)?(i=H,mn++):(i=r,En(W)),i!==r&&ri()!==r&&(o=Zn())!==r&&ri()!==r?(41===t.charCodeAt(mn)?(a=K,mn++):(a=r,En(G)),a!==r?e=n=Q(n,o):(mn=e,e=r)):(mn=e,e=r)):(mn=e,e=r),e===r&&(e=mn,(n=ti())!==r&&(n=J(n)),e=n)),e}function Nn(){var e,n,i,o;return e=mn,91===t.charCodeAt(mn)?(n=ee,mn++):(n=r,En(te)),n!==r&&ri()!==r&&(i=Mn())!==r&&ri()!==r?(93===t.charCodeAt(mn)?(o=ne,mn++):(o=r,En(ie)),o!==r?e=n=re(i):(mn=e,e=r)):(mn=e,e=r),e}function Pn(){var e,n,i;return e=mn,t.substr(mn,2)===h?(n=h,mn+=2):(n=r,En(d)),n!==r&&ri()!==r&&(i=xn())!==r?e=n=oe(i):(mn=e,e=r),e}function Bn(){var e;return mn,t.substr(mn,2)===ae?(e=ae,mn+=2):(e=r,En(se)),e===r&&(46===t.charCodeAt(mn)?(e=le,mn++):(e=r,En(ue))),e!==r&&(e=ce(e)),e}function Rn(){var e;return mn,64===t.charCodeAt(mn)?(e=he,mn++):(e=r,En(de)),e===r&&(e=null),e!==r&&(e=pe(e)),e}function Mn(){var e;return mn,(e=qn())!==r&&(e=re(e)),e}function On(){var e,n,i,o;return e=mn,(n=ei())!==r&&(n=fe(n)),(e=n)===r&&(e=mn,40===t.charCodeAt(mn)?(n=H,mn++):(n=r,En(W)),n!==r&&ri()!==r&&(i=Mn())!==r&&ri()!==r?(41===t.charCodeAt(mn)?(o=K,mn++):(o=r,En(G)),o!==r?e=n=re(i):(mn=e,e=r)):(mn=e,e=r),e===r&&(e=mn,(n=Zn())!==r&&(n=ge(n)),(e=n)===r&&(e=mn,(n=Yn())!==r&&(n=me(n)),(e=n)===r&&(e=Un())))),e}function Un(){var e,n,i,o,a,s,l,u,c,h,d,p;if(e=mn,(n=Jn())!==r)if(ri()!==r)if(40===t.charCodeAt(mn)?(i=H,mn++):(i=r,En(W)),i!==r){if(o=mn,(a=ri())!==r)if((s=Mn())!==r){for(l=[],u=mn,(c=ri())!==r?(44===t.charCodeAt(mn)?(h=ve,mn++):(h=r,En(ye)),h!==r&&(d=ri())!==r&&(p=Mn())!==r?u=c=[c,h,d,p]:(mn=u,u=r)):(mn=u,u=r);u!==r;)l.push(u),u=mn,(c=ri())!==r?(44===t.charCodeAt(mn)?(h=ve,mn++):(h=r,En(ye)),h!==r&&(d=ri())!==r&&(p=Mn())!==r?u=c=[c,h,d,p]:(mn=u,u=r)):(mn=u,u=r);l!==r?o=a=[a,s,l]:(mn=o,o=r)}else mn=o,o=r;else mn=o,o=r;o===r&&(o=null),o!==r&&(a=ri())!==r?(41===t.charCodeAt(mn)?(s=K,mn++):(s=r,En(G)),s!==r?e=n=_e(n,o):(mn=e,e=r)):(mn=e,e=r)}else mn=e,e=r;else mn=e,e=r;else mn=e,e=r;return e}function zn(){var e,n,i,o,a,s,l,u;if(e=mn,(n=Fn())!==r){for(i=[],o=mn,(a=ri())!==r?(124===t.charCodeAt(mn)?(s=be,mn++):(s=r,En(we)),s!==r&&(l=ri())!==r&&(u=Fn())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);o!==r;)i.push(o),o=mn,(a=ri())!==r?(124===t.charCodeAt(mn)?(s=be,mn++):(s=r,En(we)),s!==r&&(l=ri())!==r&&(u=Fn())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);i!==r?e=n=Ee(n,i):(mn=e,e=r)}else mn=e,e=r;return e}function Fn(){var e,n,i,o,a,s,c;return e=mn,(n=Vn())!==r?(i=mn,(o=ri())!==r?(t.substr(mn,2)===h?(a=h,mn+=2):(a=r,En(d)),a===r&&(47===t.charCodeAt(mn)?(a=l,mn++):(a=r,En(u))),a!==r&&(s=ri())!==r&&(c=xn())!==r?i=o=[o,a,s,c]:(mn=i,i=r)):(mn=i,i=r),i===r&&(i=null),i!==r?e=n=Ce(n,i):(mn=e,e=r)):(mn=e,e=r),e===r&&(e=mn,(n=kn())!==r&&(n=Se(n)),e=n),e}function Vn(){var e,t,n,i,o,a;if(e=mn,(t=On())!==r){for(n=[],i=mn,(o=ri())!==r&&(a=Nn())!==r?i=o=[o,a]:(mn=i,i=r);i!==r;)n.push(i),i=mn,(o=ri())!==r&&(a=Nn())!==r?i=o=[o,a]:(mn=i,i=r);n!==r?e=t=ke(t,n):(mn=e,e=r)}else mn=e,e=r;return e}function qn(){var e,n,i,o,a,s,l,u;if(e=mn,(n=jn())!==r){for(i=[],o=mn,(a=ri())!==r?(t.substr(mn,2)===Te?(s=Te,mn+=2):(s=r,En(xe)),s!==r&&(l=ri())!==r&&(u=jn())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);o!==r;)i.push(o),o=mn,(a=ri())!==r?(t.substr(mn,2)===Te?(s=Te,mn+=2):(s=r,En(xe)),s!==r&&(l=ri())!==r&&(u=jn())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);i!==r?e=n=Ee(n,i):(mn=e,e=r)}else mn=e,e=r;return e}function jn(){var e,n,i,o,a,s,l,u;if(e=mn,(n=$n())!==r){for(i=[],o=mn,(a=ri())!==r?(t.substr(mn,3)===Le?(s=Le,mn+=3):(s=r,En(Ie)),s!==r&&(l=ri())!==r&&(u=$n())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);o!==r;)i.push(o),o=mn,(a=ri())!==r?(t.substr(mn,3)===Le?(s=Le,mn+=3):(s=r,En(Ie)),s!==r&&(l=ri())!==r&&(u=$n())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);i!==r?e=n=Ee(n,i):(mn=e,e=r)}else mn=e,e=r;return e}function $n(){var e,n,i,o,a,s,l,u;if(e=mn,(n=Hn())!==r){for(i=[],o=mn,(a=ri())!==r?(61===t.charCodeAt(mn)?(s=Ae,mn++):(s=r,En(De)),s===r&&(t.substr(mn,2)===Ne?(s=Ne,mn+=2):(s=r,En(Pe))),s!==r&&(l=ri())!==r&&(u=Hn())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);o!==r;)i.push(o),o=mn,(a=ri())!==r?(61===t.charCodeAt(mn)?(s=Ae,mn++):(s=r,En(De)),s===r&&(t.substr(mn,2)===Ne?(s=Ne,mn+=2):(s=r,En(Pe))),s!==r&&(l=ri())!==r&&(u=Hn())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);i!==r?e=n=Ee(n,i):(mn=e,e=r)}else mn=e,e=r;return e}function Hn(){var e,n,i,o,a,s,l,u;if(e=mn,(n=Wn())!==r){for(i=[],o=mn,(a=ri())!==r?(t.substr(mn,2)===Be?(s=Be,mn+=2):(s=r,En(Re)),s===r&&(60===t.charCodeAt(mn)?(s=Me,mn++):(s=r,En(Oe)),s===r&&(t.substr(mn,2)===Ue?(s=Ue,mn+=2):(s=r,En(ze)),s===r&&(62===t.charCodeAt(mn)?(s=Fe,mn++):(s=r,En(Ve))))),s!==r&&(l=ri())!==r&&(u=Wn())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);o!==r;)i.push(o),o=mn,(a=ri())!==r?(t.substr(mn,2)===Be?(s=Be,mn+=2):(s=r,En(Re)),s===r&&(60===t.charCodeAt(mn)?(s=Me,mn++):(s=r,En(Oe)),s===r&&(t.substr(mn,2)===Ue?(s=Ue,mn+=2):(s=r,En(ze)),s===r&&(62===t.charCodeAt(mn)?(s=Fe,mn++):(s=r,En(Ve))))),s!==r&&(l=ri())!==r&&(u=Wn())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);i!==r?e=n=Ee(n,i):(mn=e,e=r)}else mn=e,e=r;return e}function Wn(){var e,n,i,o,a,s,l,u;if(e=mn,(n=Kn())!==r){for(i=[],o=mn,(a=ri())!==r?(43===t.charCodeAt(mn)?(s=qe,mn++):(s=r,En(je)),s===r&&(45===t.charCodeAt(mn)?(s=$e,mn++):(s=r,En(He))),s!==r&&(l=ri())!==r&&(u=Kn())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);o!==r;)i.push(o),o=mn,(a=ri())!==r?(43===t.charCodeAt(mn)?(s=qe,mn++):(s=r,En(je)),s===r&&(45===t.charCodeAt(mn)?(s=$e,mn++):(s=r,En(He))),s!==r&&(l=ri())!==r&&(u=Kn())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);i!==r?e=n=Ee(n,i):(mn=e,e=r)}else mn=e,e=r;return e}function Kn(){var e,n,i,o,a,s,l,u;if(e=mn,(n=Gn())!==r){for(i=[],o=mn,(a=ri())!==r?((s=Qn())===r&&(t.substr(mn,3)===We?(s=We,mn+=3):(s=r,En(Ke)),s===r&&(t.substr(mn,3)===Ge?(s=Ge,mn+=3):(s=r,En(Ze)))),s!==r&&(l=ri())!==r&&(u=Gn())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);o!==r;)i.push(o),o=mn,(a=ri())!==r?((s=Qn())===r&&(t.substr(mn,3)===We?(s=We,mn+=3):(s=r,En(Ke)),s===r&&(t.substr(mn,3)===Ge?(s=Ge,mn+=3):(s=r,En(Ze)))),s!==r&&(l=ri())!==r&&(u=Gn())!==r?o=a=[a,s,l,u]:(mn=o,o=r)):(mn=o,o=r);i!==r?e=n=Ee(n,i):(mn=e,e=r)}else mn=e,e=r;return e}function Gn(){var e,n,i;return e=mn,(n=zn())!==r&&(n=re(n)),(e=n)===r&&(e=mn,45===t.charCodeAt(mn)?(n=$e,mn++):(n=r,En(He)),n!==r&&ri()!==r&&(i=Gn())!==r?e=n=Ye(i):(mn=e,e=r)),e}function Zn(){var e,n,i,o;if(e=mn,34===t.charCodeAt(mn)?(n=Xe,mn++):(n=r,En(Qe)),n!==r){for(i=[],Je.test(t.charAt(mn))?(o=t.charAt(mn),mn++):(o=r,En(et));o!==r;)i.push(o),Je.test(t.charAt(mn))?(o=t.charAt(mn),mn++):(o=r,En(et));i!==r?(34===t.charCodeAt(mn)?(o=Xe,mn++):(o=r,En(Qe)),o!==r?e=n=tt(i):(mn=e,e=r)):(mn=e,e=r)}else mn=e,e=r;if(e===r)if(e=mn,39===t.charCodeAt(mn)?(n=nt,mn++):(n=r,En(it)),n!==r){for(i=[],rt.test(t.charAt(mn))?(o=t.charAt(mn),mn++):(o=r,En(ot));o!==r;)i.push(o),rt.test(t.charAt(mn))?(o=t.charAt(mn),mn++):(o=r,En(ot));i!==r?(39===t.charCodeAt(mn)?(o=nt,mn++):(o=r,En(it)),o!==r?e=n=tt(i):(mn=e,e=r)):(mn=e,e=r)}else mn=e,e=r;return e}function Yn(){var e,n,i,o,a;return e=mn,(n=Xn())!==r?(i=mn,46===t.charCodeAt(mn)?(o=le,mn++):(o=r,En(ue)),o!==r?((a=Xn())===r&&(a=null),a!==r?i=o=[o,a]:(mn=i,i=r)):(mn=i,i=r),i===r&&(i=null),i!==r?e=n=at(n,i):(mn=e,e=r)):(mn=e,e=r),e===r&&(e=mn,46===t.charCodeAt(mn)?(n=le,mn++):(n=r,En(ue)),n!==r&&(i=Xn())!==r?e=n=st(i):(mn=e,e=r)),e}function Xn(){var e,n;if(mn,e=[],lt.test(t.charAt(mn))?(n=t.charAt(mn),mn++):(n=r,En(ut)),n!==r)for(;n!==r;)e.push(n),lt.test(t.charAt(mn))?(n=t.charAt(mn),mn++):(n=r,En(ut));else e=r;return e!==r&&(e=ct(e)),e}function Qn(){var e;return 42===t.charCodeAt(mn)?(e=ht,mn++):(e=r,En(dt)),e}function Jn(){var e,t;return e=mn,(t=oi())!==r&&(pt()?void 0:r)!==r?e=t=ft(t):(mn=e,e=r),e}function ei(){var e,n,i;return e=mn,36===t.charCodeAt(mn)?(n=gt,mn++):(n=r,En(mt)),n!==r&&(i=oi())!==r?e=n=vt(i):(mn=e,e=r),e}function ti(){var e,n,i,o;return e=mn,42===t.charCodeAt(mn)?(n=ht,mn++):(n=r,En(dt)),n!==r&&(n=yt()),(e=n)===r&&(e=mn,(n=li())!==r?(58===t.charCodeAt(mn)?(i=_t,mn++):(i=r,En(bt)),i!==r?(42===t.charCodeAt(mn)?(o=ht,mn++):(o=r,En(dt)),o!==r?e=n=wt(n):(mn=e,e=r)):(mn=e,e=r)):(mn=e,e=r),e===r&&(e=mn,(n=oi())!==r&&(n=Et(n)),e=n)),e}function ni(){var e;return t.substr(mn,7)===Ct?(e=Ct,mn+=7):(e=r,En(St)),e===r&&(t.substr(mn,4)===kt?(e=kt,mn+=4):(e=r,En(Tt)),e===r&&(t.substr(mn,22)===Y?(e=Y,mn+=22):(e=r,En(X)),e===r&&(t.substr(mn,4)===xt?(e=xt,mn+=4):(e=r,En(Lt))))),e}function ii(){var e,n;if(e=[],It.test(t.charAt(mn))?(n=t.charAt(mn),mn++):(n=r,En(At)),n!==r)for(;n!==r;)e.push(n),It.test(t.charAt(mn))?(n=t.charAt(mn),mn++):(n=r,En(At));else e=r;return e}function ri(){var e;return(e=ii())===r&&(e=null),e}function oi(){var e;return mn,(e=ai())===r&&(e=si()),e!==r&&(e=Dt(e)),e}function ai(){var e,n,i,o;return e=mn,(n=li())!==r?(58===t.charCodeAt(mn)?(i=_t,mn++):(i=r,En(bt)),i!==r&&(o=li())!==r?e=n=Nt(n,o):(mn=e,e=r)):(mn=e,e=r),e}function si(){var e;return mn,(e=li())!==r&&(e=Pt(e)),e}function li(){return hi()}function ui(){var e;return Bt.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(Rt)),e===r&&(95===t.charCodeAt(mn)?(e=Mt,mn++):(e=r,En(Ot)),e===r&&(Ut.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(zt)),e===r&&(Ft.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(Vt)),e===r&&(qt.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(jt)),e===r&&($t.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(Ht)),e===r&&(Wt.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(Kt)),e===r&&(Gt.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(Zt)),e===r&&(Yt.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(Xt)),e===r&&(Qt.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(Jt)),e===r&&(en.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(tn)),e===r&&(nn.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(rn)),e===r&&(on.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(an)),e===r&&(sn.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(ln))))))))))))))),e}function ci(){var e;return(e=ui())===r&&(45===t.charCodeAt(mn)?(e=$e,mn++):(e=r,En(He)),e===r&&(46===t.charCodeAt(mn)?(e=le,mn++):(e=r,En(ue)),e===r&&(lt.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(ut)),e===r&&(un.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(cn)),e===r&&(hn.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(dn)),e===r&&(pn.test(t.charAt(mn))?(e=t.charAt(mn),mn++):(e=r,En(fn)))))))),e}function hi(){var e,t,n,i;if(e=mn,(t=ui())!==r){for(n=[],i=ci();i!==r;)n.push(i),i=ci();n!==r?e=t=gn(t,n):(mn=e,e=r)}else mn=e,e=r;return e}var di,pi=function(e,t,n,i){var r,o,a={type:"",args:[]};for(a.args.push(e),r=0;r<t.length;r++){switch(typeof n){case"string":a.type=n;break;case"object":for(a.type=t[r][n[0]],o=1;o<n.length;o++)a.type=a.type[n[o]];break;default:a.type=t[r][n]}a.args.push(void 0===i?t[r]:t[r][i]),a={type:"",args:[a]}}return a.args[0]},fi=function(e,t,n,i){var r,o=[];if(n.length<1)return e;for(r=0;r<n.length;r++)o.push(n[r][i]);return{type:"predicate",args:[t,e,o]}},gi=[],mi=function(e){var t,n=!1;if(null!==e){for(t=0;t<gi.length;t++)if(gi[t]===e){n=!0;break}n||gi.push(e)}},vi=["comment","text","processing-instruction","node"],yi=function(e,t,n){return"/"==e?{type:"/",args:[t,n]}:{type:"/",args:[{type:"/",args:[t,{type:"step",args:["descendant-or-self",{type:"nodeType",args:["node",[]]}]}]},n]}};if((n=a())!==r&&mn===t.length)return n;throw n!==r&&mn<t.length&&En({type:"end",description:"end of input"}),Cn(null,_n,yn<t.length?t.charAt(yn):null,yn<t.length?wn(yn,yn+1):wn(yn,yn))}}}();function Wn(e){this._seed=e%2147483647,this._seed<=0&&(this._seed+=2147483646)}Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},Wn.prototype.next=function(){return this._seed=16807*this._seed%2147483647},Wn.prototype.nextFloat=function(){return(this.next()-1)/2147483646};var Kn=function(e,t){var n,i=[];if(void 0!==t){if(!Number.isInteger(t))throw new Error("Invalid seed argument. Integer required.");var r=new Wn(t);n=r.nextFloat.bind(r)}else n=Math.random;for(var o=0;o<e.length;++o){var a=Math.floor(n()*(o+1));a!==o&&(i[o]=i[a]),i[a]=e[o]}return i};function Gn(e){return e.map((function(e){return e.trim().split(" ")}))}function Zn(e){return e*Math.PI/180}function Yn(e){return e.every((function(e){return""!==e[0]&&e[0]>=-90&&e[0]<=90&&""!==e[1]&&e[1]>=-180&&e[1]<=180&&(void 0===e[2]||!isNaN(e[2]))&&(void 0===e[3]||!isNaN(e[3])&&e[3]>=0)}))}function Xn(e,t){var n=Zn(e.lng-t.lng),i=Zn(e.lat),r=Zn(t.lat);return 6378100*Math.acos(Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos(n))}var Qn={area:function(e){var t=Gn(e);if(!Yn(t))return Number.NaN;var n=t.length,i=0;if(n>2){for(var r=0;r<n;r++){var o={lat:t[r][0],lng:t[r][1]},a={lat:t[(r+1)%n][0],lng:t[(r+1)%n][1]};i+=Zn(a.lng-o.lng)*(2+Math.sin(Zn(o.lat))+Math.sin(Zn(a.lat)))}i=6378100*i*6378100/2}return Math.abs(Math.round(100*i))/100},distance:function(e){var t=Gn(e);if(!Yn(t))return Number.NaN;var n=t.length,i=0;if(n>1)for(var r=1;r<n;r++){i+=Xn({lat:t[r-1][0],lng:t[r-1][1]},{lat:t[r][0],lng:t[r][1]})}return Math.abs(Math.round(100*i))/100}},Jn=function(){var e,t,n,i,r,o,a,s,l,u,c,h,d,p,f,g,m,v,y=[],_="http://www.w3.org/XML/1998/namespace",b=function(e){var t=[],n=function(e,t){var n,i,r=[];for(i=0;i<e.length;i++)n=e.item(i),!1!==U(n.nodeType,t)&&r.push(n);return r};switch(e.nodeType){case 1:t=n(e.childNodes,[1,3,4,7,8]);break;case 9:t=n(e.childNodes,[1,7,8]);break;case 2:case 3:case 4:case 7:case 8:case 13:break;default:throw new Error("Internal Error: nodeChildren - unsupported node type: "+e.nodeType)}return t},w=function e(t){var n,i,r=[];for(n=b(t),i=0;i<n.length;i++)r.push(n[i]),r.push.apply(r,e(n[i]));return r},E=function(e){switch(e.nodeType){case 1:case 3:case 4:case 7:case 8:case 9:return e.parentNode;case 2:return e.ownerElement?e.ownerElement:B(e.ownerDocument,!0,(function(t,n){if(n===e)return!0}));case 13:return e.ownerElement;default:throw new Error("Internal Error: nodeParent - node type not supported: "+e.type)}},C=function(e){for(var t,n=[];t=E(e);)n.push(t),e=t;return n},S=function(e){return T(e,"nextSibling")},k=function(e){return T(e,"previousSibling")},T=function(e,t){for(var n,i=[];n=e[t];){switch(n.nodeType){case 1:case 3:case 4:case 7:case 8:case 9:i.push(n)}e=n}return i},x=function(e){switch(e.nodeType){case 9:return e;default:return e.ownerDocument}},L=function(e){var t,n=[];if(1===e.nodeType)for(t=0;t<e.attributes.length;t++)e.attributes[t].specified&&n.push(e.attributes[t]);return n.length>1&&n[0].compareDocumentPosition&&n.sort((function(e,t){var n=e.compareDocumentPosition(t);return 2==(2&n)?1:4==(4&n)?-1:0})),n},I=function(e){var t,n=L(e),i=[];for(t=0;t<n.length;t++)!1===N(n[t])&&i.push(n[t]);return i},A=function e(t,n){var i,r,o,a,s=n||[];if(1===t.nodeType){if(t.ownerDocument.documentElement===t&&"object"==typeof t.ownerDocument.namespaces)for(r=t.ownerDocument.namespaces.length-1;r>=0;r--)a=t.ownerDocument.namespaces.item(r),D.call(this,s,a.name,a.urn,t);for(r=(i=L(t)).length-1;r>=0;r--)!1!==(o=N(i[r]))&&(1!==o.length?D.call(this,s,o[1],i[r].nodeValue,t):D.call(this,s,"",i[r].nodeValue,t));if(e.call(this,t.parentNode,s),void 0===n&&(D.call(this,s,"xml",_,t),s[0]&&""===s[0].prefix&&""===s[0].namespaceURI&&s.shift()),void 0===n)for(r=0;r<s.length;r++)s[r].ownerElement!==t&&(s[r]=$(s[r].prefix,s[r].nodeValue,t))}return s},D=function(e,t,n,i){var r,o;for(this.opts["case-sensitive"]||(t=t.toLowerCase()),r=0;r<e.length;r++)if(e[r].prefix===t)return!1;return o=$(t,n,i),""===t&&null!==n?e.unshift(o):e.push(o),!0},N=function(e){var t=e.nodeName.split(":");return"xmlns"===t[0]&&t},P=function(e,t){var n,i,r,o,a,s;if(1===e.nodeType)for(r=t?[t]:I(e),o=A.call(this,e),n=0;n<r.length;n++){for(1===(s=r[n].nodeName.split(":")).length&&(s[1]=s[0],s[0]=""),a=null,i=0;i<o.length;i++)if(o[i].prefix===s[0]){a=o[i].namespaceURI;break}if(null===a&&(a=""),this.opts["unique-ids"][a]===s[1])return r[n]}return null},B=function(e,t,n){var i,r,o,a,s=[];for(o=e.getElementsByTagName("*"),i=0;i<o.length;i++)if(1==(a=o.item(i)).nodeType)for(r=0;r<a.attributes.length;r++)if(a.attributes[r].specified&&!0===n(a,a.attributes[r])){if(t)return a;s.push(a);break}return t?null:s},R=function(e){var t,n,i,r;switch(e.nodeType){case 1:for(r=void 0===e.scopeName||document.addEventListener?1==(t=e.nodeName.split(":")).length?{prefix:"",name:t[0]}:{prefix:t[0],name:t[1]}:{prefix:"HTML"==e.scopeName?"":e.scopeName,name:e.nodeName},this.opts["case-sensitive"]||(r.prefix=r.prefix.toLowerCase(),r.name=r.name.toLowerCase()),n=A.call(this,e),i=0;i<n.length;i++)if(n[i].prefix===r.prefix)return r.ns=n[i].namespaceURI,r;if(""===r.prefix)return r.ns=null,r;throw new Error('Internal Error: nodeExpandedName - Failed to expand namespace prefix "'+r.prefix+'" on element: '+e.nodeName);case 2:if(1==(t=e.nodeName.split(":")).length)return{prefix:"",ns:null,name:t[0]};for(r={prefix:t[0],name:t[1]},this.opts["case-sensitive"]||(r.prefix=r.prefix.toLowerCase(),r.name=r.name.toLowerCase()),n=A.call(this,E(e)),i=0;i<n.length;i++)if(n[i].prefix===r.prefix)return r.ns=n[i].namespaceURI,r;throw new Error('Internal Error: nodeExpandedName - Failed to expand namespace prefix "'+r.prefix+'" on attribute: '+e.nodeName);case 13:return{prefix:null,ns:null,name:this.opts["case-sensitive"]?e.prefix.toLowerCase():e.prefix};case 7:return{prefix:null,ns:null,name:this.opts["case-sensitive"]?e.target.toLowerCase():e.target};default:return!1}},M=function(e){var t,n,i="";switch(e.nodeType){case 9:case 1:for((n=s(new c(e,1,1,{},{},{}),{type:"step",args:["descendant",{type:"nodeType",args:["text",[]]}]})).sortDocumentOrder(),t=0;t<n.value.length;t++)i+=n.value[t].data;return i;case 2:return e.nodeValue;case 13:return e.namespaceURI;case 7:case 8:case 3:case 4:return e.data;default:throw new Error("Internal Error: nodeStringValue does not support node type: "+e.nodeType)}},O=function(e,t,n){var i=new Error(n);return i.name=t,i.code=e,i},U=function(e,t){for(var n=t.length;n--;)if(t[n]===e)return n;return!1},z=function e(t,n,i,r){var o,a,s,l,u;if(t instanceof g)if(n instanceof g){for(l=n.stringValues(),s=t.stringValues(),o=0;o<s.length;o++)for(a=0;a<l.length;a++)if((u=e(s[o],l[a],i,r)).toBoolean())return u}else if(n instanceof f){for(s=t.stringValues(),o=0;o<s.length;o++)if((u=e(new f(s[o].toNumber()),n,i,r)).toBoolean())return u}else if(n instanceof m||n instanceof p&&n.isDateString()){for(n instanceof p&&(n=new m(n)),s=t.stringValues(),o=0;o<s.length;o++)if((u=e(new m(s[o].toDate()),n,i,r)).toBoolean())return u}else{if(!(n instanceof p))return e(new d(t.toBoolean()),n,i,r);for(s=t.stringValues(),o=0;o<s.length;o++)if((u=e(s[o],n,i,r)).toBoolean())return u}else if(n instanceof g)if(t instanceof f){for(l=n.stringValues(),o=0;o<l.length;o++)if((u=e(t,new f(l[o].toNumber()),i,r)).toBoolean())return u}else if(t instanceof m||t instanceof p&&t.isDateString()){for(t instanceof p&&(t=new m(t)),l=n.stringValues(),o=0;o<l.length;o++)if((u=e(t,new m(l[o].toDate()),i,r)).toBoolean())return u}else{if(!(t instanceof p))return e(t,new d(n.toBoolean()),i,r);for(l=n.stringValues(),o=0;o<l.length;o++)if((u=e(t,l[o],i,r)).toBoolean())return u}else switch(i){case"=":case"!=":return t instanceof d||n instanceof d?new d(r(t.toBoolean(),n.toBoolean())):t instanceof f||n instanceof f||t instanceof m||n instanceof m||t instanceof p&&t.isDateString()||n instanceof p&&n.isDateString()?new d(r(t.toNumber(),n.toNumber())):new d(r(t.toString(),n.toString()));default:return new d(r(t.toNumber(),n.toNumber()))}return new d(!1)},F=function(e){switch(e.nodeType){case 2:case 3:case 4:case 7:case 8:return E(e);case 1:case 9:return e;case 13:default:throw new Error("Internal Error: getComparableNode - Node type not supported: "+e.nodeType)}},V=function(e,t){var n,i,r;if(13==e.nodeType&&13==t.nodeType&&e.ownerElement==t.ownerElement){if(e===t)return 0;for(i=A.call(v,e.ownerElement),r=0;r<i.length;r++){if(i[r]===e){n=4;break}if(i[r]===t){n=2;break}}}else 13==e.nodeType&&(e=e.ownerElement),13==t.nodeType&&(t=t.ownerElement),n=q(e,t);return n},q=function(e,t){var n,i,r,o,a,s=function(e,t,n,i,r,o,a,s,l){return 0===r||(r&o)===o?s+o:(r&a)===a?l:r};if(e.compareDocumentPosition)return e.compareDocumentPosition(t);if(e===t)return 0;if(n=F(e),i=F(t),9===n.nodeType)if(9===i.nodeType){if(n!==i)return 1;r=0}else{if(n!==i.ownerDocument)return 1;r=20}else if(9===i.nodeType){if(i!==n.ownerDocument)return 1;r=10}else{if(n.ownerDocument!==i.ownerDocument)return 1;if(!n.contains||void 0===n.sourceIndex||!i.contains||void 0===i.sourceIndex)throw new Error('Cannot compare elements. Neither "compareDocumentPosition" nor "contains" available.');r=(n!=i&&n.contains(i)&&16)+(n!=i&&i.contains(n)&&8)+(n.sourceIndex>=0&&i.sourceIndex>=0?(n.sourceIndex<i.sourceIndex&&4)+(n.sourceIndex>i.sourceIndex&&2):1)+0}if(e===n&&t===i)return r;if(e===n)return s(0,0,0,0,r,16,8,4,2);if(t===i)return s(0,0,0,0,r,8,16,2,4);if(16==(16&r))return 4;if(8==(8&r))return 2;if(0===r){for(o=0;o<n.attributes.length;o++)if((a=n.attributes[o]).specified){if(a===t)return 2;if(a===e)return 4}throw new Error("Internal Error: compareDocumentPosition failed to sort attributes.")}return r},j=function(e){if(!e)throw O(9,"NOT_SUPPORTED_ERR","Context node was not supplied.");if(9!=e.nodeType&&1!=e.nodeType&&2!=e.nodeType&&3!=e.nodeType&&4!=e.nodeType&&8!=e.nodeType&&7!=e.nodeType&&13!=e.nodeType)throw O(9,"NOT_SUPPORTED_ERR","The supplied node type is not supported. (nodeType: "+e.nodeType+")");if(2==e.nodeType&&!e.specified)throw O(9,"NOT_SUPPORTED_ERR","The supplied node is a non-specified attribute node. Only specified attribute nodes are supported.")},$=function(e,t,n){var i,r;for(i=0;i<y.length;i++)if((r=y[i]).prefix===e&&r.nodeValue===t&&r.ownerElement===n)return r;return r=new o(e,t,n),y.push(r),r};return(h=function(e,t,n){this.value=e,this.type=t,this.supports=n}).prototype={value:null,type:null,supports:[],toBoolean:function(){throw new Error('Unable to convert "'+this.type+'" to "boolean".')},toString:function(){throw new Error('Unable to convert "'+this.type+'" to "string".')},toNumber:function(){throw new Error('Unable to convert "'+this.type+'" to "number".')},toNodeSet:function(){throw new Error('Unable to convert "'+this.type+'" to "node-set".')},toDate:function(){throw new Error('Unable to convert "'+this.type+'" to "date".')},canConvertTo:function(e){return!1!==U(e,this.supports)}},(d=function(e){h.call(this,e,"boolean",["boolean","string","number","date"])}).prototype=new h,d.constructor=d,d.prototype.toBoolean=function(){return this.value},d.prototype.toString=function(){return!0===this.value?"true":"false"},d.prototype.toNumber=function(){return this.value?1:0},d.prototype.toDate=function(){return null},(g=function(e,t){h.call(this,e,"node-set",["boolean","string","number","node-set","date"]),this.docOrder=t||"unsorted"}).prototype=new h,g.constructor=g,g.prototype.toBoolean=function(){return this.value.length>0},g.prototype.toString=function(){return this.value.length<1?"":(this.sortDocumentOrder(),M(this.value[0]))},g.prototype.toNumber=function(){return new p(this.toString()).toNumber()},g.prototype.toNodeSet=function(){return this.value},g.prototype.toDate=function(){return new p(this.toString()).toDate()},g.prototype.sortDocumentOrder=function(){switch(this.docOrder){case"document-order":break;case"reverse-document-order":this.value.reverse();break;default:this.value.sort((function(e,t){var n=V(e,t);if(4==(4&n))return-1;if(2==(2&n))return 1;throw new Error("NodeSetType.sortDocumentOrder - unexpected compare result: "+n)}))}this.docOrder="document-order"},g.prototype.sortReverseDocumentOrder=function(){switch(this.docOrder){case"document-order":this.value.reverse();break;case"reverse-document-order":break;default:this.sortDocumentOrder(),this.value.reverse()}this.docOrder="reverse-document-order"},g.prototype.append=function(e){var t,n=0,i=0;if(!(e instanceof g))throw new Error("NodeSetType can be passed into NodeSetType.append method");for(this.sortDocumentOrder(),e.sortDocumentOrder();n<this.value.length&&i<e.value.length;)if(0==(t=V(this.value[n],e.value[i])))i++;else if(4==(4&t))n++;else{if(2!=(2&t))throw new Error("Internal Error: NodeSetType.append - unable to sort nodes. (result: "+t+")");this.value.splice(n,0,e.value[i]),n++,i++}for(;i<e.value.length;i++)this.value.push(e.value[i]);this.docOrder="document-order"},g.prototype.stringValues=function(){var e,t,n=[];for(e=0;e<this.value.length;e++)(t=new p(M(this.value[e]))).isDateString()&&(t=new m(t.value)),n.push(t);return n},(p=function(e){h.call(this,e,"string",["boolean","string","number","date"])}).prototype=new h,p.constructor=p,p.prototype.toBoolean=function(){return this.value.length>0},p.prototype.toString=function(){return this.value},p.prototype.toNumber=function(){var e;return this.isDateString(this.value)?new m(this.value).toNumber():null!==(e=this.value.match(/^[ \t\r\n]*(-?[0-9]+(?:[.][0-9]*)?)[ \t\r\n]*$/))||null!==(e=this.value.match(/^[ \t\r\n]*(-?[.][0-9]+)[ \t\r\n]*$/))?parseFloat(e[1]):Number.NaN},p.prototype.toDate=function(){return new m(this.value).toDate()},p.prototype.isDateString=function(){return!!isNaN(this.value)&&(!isNaN(Date.parse(this.value))&&!!/('|")?[0-9]{4}(-|\/)[0-9]{2}(-|\/)[0-9]{2}('|")?/.test(this.value))},(f=function(e){h.call(this,e,"number",["boolean","string","number","date"])}).prototype=new h,f.constructor=f,f.prototype.toBoolean=function(){return 0!==this.value&&!isNaN(this.value)},f.prototype.toString=function(){return this.value.toString()},f.prototype.toNumber=function(){return this.value},f.prototype.toDate=function(){return new Date(864e5*this.value)},(m=function(e){/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(e)&&(e+="T00:00:00.000"+new Date(e).getTimezoneOffsetAsTime()),h.call(this,e,"date",["date","string","number","boolean"])}).prototype=new h,m.constructor=m,m.prototype.toDate=function(){return new Date(this.value)},m.prototype.toString=function(){return new Date(this.value).toISOLocalString()},m.prototype.toNumber=function(){return new Date(this.value).getTime()/864e5},m.prototype.toBoolean=function(){return!isNaN(new Date(this.value).getTime())},(e=function(t,n){var i;switch(this.code=t,this.code){case e.INVALID_EXPRESSION_ERR:this.name="INVALID_EXPRESSION_ERR";break;case e.TYPE_ERR:this.name="TYPE_ERR";break;default:throw(i=new Error("Unsupported XPathException code: "+this.code)).name="XPathExceptionInternalError",i}this.message=n||""}).prototype.toString=function(){return'XPathException: "'+this.message+'", code: "'+this.code+'", name: "'+this.name+'"'},e.INVALID_EXPRESSION_ERR=51,e.TYPE_ERR=52,(t=function(e){var t,n,i;for(t in e){for(n in i=!1,this.opts)if(t===n){this.opts[t]=e[t],i=!0;break}if(!i)throw new Error("Unsupported option: "+t)}this.opts["unique-ids"][_]="id",this.opts["unique-ids"]["http://www.w3.org/1999/xhtml"]="id"}).prototype={opts:{"unique-ids":{},"case-sensitive":!1},createExpression:function(t,i){var r,o,a,s,l={};try{r=Hn.parse(t)}catch(t){throw o="The expression is not a legal expression.",t instanceof Hn.SyntaxError?o+=" (line: "+t.line+", character: "+t.column+")":o+=" ("+t.message+")",new e(e.INVALID_EXPRESSION_ERR,o)}if(r.nsPrefixes.length>0){if("object"!=typeof i||void 0===i.lookupNamespaceURI)throw new e(e.INVALID_EXPRESSION_ERR,"No namespace resolver provided or lookupNamespaceURI function not supported.");for(a=0;a<r.nsPrefixes.length;a++)if(l[s=r.nsPrefixes[a]]=i.lookupNamespaceURI(s),null===l[s])throw O(14,"NAMESPACE_ERR",'Undefined namespace prefix "'+s+'" in the context of the given resolver.')}return new n(r,l,this.opts)},createNSResolver:function(e){return new i(e)},evaluate:function(e,t,n,i,r){return(e=this.createExpression(e,n)).evaluate(t,i,r)}},(n=function(e,t,n){this.parsedExpression=e,this.namespaceMapping=t,this.opts=n||{}}).prototype={parsedExpression:null,namespaceMapping:null,opts:{},evaluate:function(e,t){var n;return v=this,j(e),n=new c(e,1,1,{},u,this.namespaceMapping,this.opts),r.factory(n,t,s(n,this.parsedExpression.tree))}},(c=function(e,t,n,i,r,o,a){this.node=e,this.pos=t,this.size=n,this.vars=i,this.fns=r,this.nsMap=o,this.opts=a||{}}).prototype={node:null,pos:null,size:null,vars:null,fns:null,nsMap:null,opts:null,clone:function(e,t,n){return new c(e||this.node,void 0!==t?t:this.pos,void 0!==n?n:this.size,this.vars,this.fns,this.nsMap,this.opts)}},(i=function(e){j(e),this.node=e}).prototype={node:null,lookupNamespaceURI:function(e){var t,n,i,r=this.node;switch(e){case"xml":return _;case"xmlns":return"http://www.w3.org/2000/xmlns/";default:switch(this.node.nodeType){case 9:r=r.documentElement;break;case 1:break;default:r=E(r)}if(null!=r&&1==r.nodeType){if(""==e){if(null!==(n=r.getAttribute("xmlns")))return n}else{if(r.ownerDocument.documentElement===r&&"object"==typeof r.ownerDocument.namespaces)for(t=0;t<r.ownerDocument.namespaces.length;t++)if((n=r.ownerDocument.namespaces.item(t)).name==e)return n.urn;for(t=0;t<r.attributes.length;t++)if(r.attributes[t].specified&&"xmlns:"+e==r.attributes[t].nodeName)return r.attributes[t].nodeValue}if(r.ownerDocument.documentElement!==r&&r.parentNode)return i=this.node,this.node=r.parentNode,n=this.lookupNamespaceURI(e),this.node=i,n}return null}}},l={"/":function(e,t){var n,i,r,o,a;if(null===e)i=new g([x(this.node)],"document-order");else if(!((i=s(this,e))instanceof g))throw new Error("Left side of path separator (/) must be of node-set type. (type: "+i.type+")");if(null===t)o=i;else for(o=new g([],"document-order"),n=0;n<i.value.length;n++){if(a=this.clone(i.value[n]),!((r=s(a,t))instanceof g))throw new Error("Right side of path separator (/) must be of node-set type. (type: "+r.type+")");o.append(r)}return o},step:function(e,t){var n,i,r,o,a,l,u;switch(e){case"child":n=new g(b(this.node),"document-order");break;case"descendant":n=new g(w(this.node),"document-order");break;case"parent":r=E(this.node),n=new g(r?[r]:[],"document-order");break;case"ancestor":n=new g(C(this.node),"reverse-document-order");break;case"following-sibling":n=new g(S(this.node),"document-order");break;case"preceding-sibling":n=new g(k(this.node),"reverse-document-order");break;case"following":n=new g(function(e){var t,n,i,r,o=[];for((t=C(e)).unshift(e),n=0;n<t.length;n++)for(i=S(t[n]),r=0;r<i.length;r++)o.push(i[r]),o.push.apply(o,w(i[r]));return o}(this.node),"document-order");break;case"preceding":n=new g(function(e){var t,n,i,r,o=[];for((t=C(e)).unshift(e),n=0;n<t.length;n++)for(i=k(t[n]),r=0;r<i.length;r++)o.push.apply(o,w(i[r]).reverse()),o.push(i[r]);return o}(this.node),"reverse-document-order");break;case"attribute":n=new g(I(this.node),"document-order");break;case"namespace":n=new g(A.call(this,this.node),"document-order");break;case"self":n=new g([this.node],"document-order");break;case"descendant-or-self":(o=w(this.node)).unshift(this.node),n=new g(o,"document-order");break;case"ancestor-or-self":(o=C(this.node)).unshift(this.node),n=new g(o,"reverse-document-order");break;default:throw new Error("Axis type not supported: "+e)}switch(t.type){case"nodeType":if("node"==t.args[0])break;for(i=n.value.length-1;i>=0;i--)switch(t.args[0]){case"text":3!=n.value[i].nodeType&&4!=n.value[i].nodeType&&n.value.splice(i,1);break;case"comment":8!=n.value[i].nodeType&&n.value.splice(i,1);break;case"processing-instruction":(7!=n.value[i].nodeType||t.args[1].length>0&&s(this,t.args[1][0])!=n.value[i].nodeName)&&n.value.splice(i,1)}break;case"name":switch(a=s(this,t),e){case"attribute":l=2;break;case"namespace":l=13;break;default:l=1}for(i=n.value.length-1;i>=0;i--)n.value[i].nodeType==l?null===a.ns&&null===a.name||(!1!==(u=R.call(this,n.value[i]))&&u.ns===a.ns?null!==a.name&&u.name.toLowerCase()!=a.name.toLowerCase()&&n.value.splice(i,1):n.value.splice(i,1)):n.value.splice(i,1);break;default:throw new Error("NodeTest type not supported in step: "+t.type)}return n},predicate:function(e,t,n){var i,r,o,a,l,u;if(!((i=s(this,t))instanceof g))throw new Error('Expected "node-set", got: '+i.type);switch(e){case"ancestor":case"ancestor-or-self":case"preceding":case"preceding-sibling":i.sortReverseDocumentOrder();break;default:i.sortDocumentOrder()}for(a=0;a<n.length;a++)for(r=0,l=1,u=i.value.length;r<i.value.length;l++){if((o=s(this.clone(i.value[r],l,u),n[a]))instanceof f){if(o.value!=l){i.value.splice(r,1);continue}}else if(!o.toBoolean()){i.value.splice(r,1);continue}r++}return i},function:function(e,t){var n,i,r,o,a=[],l=function(e){return(null!==e.ns?"{"+e.ns+"}":"{}")+e.name},u=function(e){var t,n,i=[];for(t=0;t<e.length;t++)n=void 0===e[t].t?"object":e[t].t,!1!==e[t].r?!0===e[t].rep&&(n+="+"):!0===e[t].rep?n+="*":n+="?",i.push(n);return"("+i.join(", ")+")"},c=0,d=[];if(null===(n=s(this,e)).ns&&(n.ns=""),!this.fns[n.ns]||!this.fns[n.ns][n.name])throw new Error('Function "'+l(n)+'" does not exist.');for((i=this.fns[n.ns][n.name]).args||(i.args=[]),r=0,c=0;r<i.args.length;c++,r++){if(void 0===t[c]){if(!1!==i.args[r].r)throw new Error('Function "'+l(n)+'" expects '+u(i.args)+".")}else d.push(void 0===i.args[r].t?"object":i.args[r].t);if(!0===i.args[r].rep){for(;c<t.length;c++)d.push(void 0===i.args[r].t?"object":i.args[r].t);break}}if(d.length<t.length)throw new Error('Function "'+l(n)+'" expects '+u(i.args)+".");for(r=0;r<t.length;r++){if(o=s(this,t[r]),"object"!==d[r]&&!o.canConvertTo(d[r]))throw new Error('Function "'+l(n)+'" expects '+u(i.args)+'.Cannot convert "'+o.type+'" to "'+d[r]+'".');a.push(o)}var p=i.fn.apply(this,a);if(!(p instanceof h))throw new Error('Function "'+l(n)+'" did not return a value that inherits from BaseType.');if("object"!==i.ret&&!p.canConvertTo(i.ret))throw new Error('Function "'+l(n)+'" return "'+p.type+'" type that cannot be converted to "'+i.ret+'".');return p},"|":function(e,t){if(e=s(this,e),t=s(this,t),!(void 0!==e&&void 0!==t&&e instanceof g&&t instanceof g))throw new Error('Unable to perform union on non-"node-set" types.');return e.append(t),e},or:function(e,t){return s(this,e).toBoolean()?new d(!0):new d(s(this,t).toBoolean())},and:function(e,t){return s(this,e).toBoolean()?new d(s(this,t).toBoolean()):new d(!1)},"=":function(e,t){return z.call(this,s(this,e),s(this,t),"=",(function(e,t){return e==t}))},"!=":function(e,t){return z.call(this,s(this,e),s(this,t),"!=",(function(e,t){return e!=t}))},"<=":function(e,t){return z.call(this,s(this,e),s(this,t),"<=",(function(e,t){return e<=t}))},"<":function(e,t){return z.call(this,s(this,e),s(this,t),"<",(function(e,t){return e<t}))},">=":function(e,t){return z.call(this,s(this,e),s(this,t),">=",(function(e,t){return e>=t}))},">":function(e,t){return z.call(this,s(this,e),s(this,t),">",(function(e,t){return e>t}))},"+":function(e,t){return new f(s(this,e).toNumber()+s(this,t).toNumber())},"-":function(e,t){return new f(s(this,e).toNumber()-s(this,t).toNumber())},div:function(e,t){return new f(s(this,e).toNumber()/s(this,t).toNumber())},mod:function(e,t){return new f(s(this,e).toNumber()%s(this,t).toNumber())},"*":function(e,t){return new f(s(this,e).toNumber()*s(this,t).toNumber())},string:function(e){return new p(e)},number:function(e){return new f(e)},$:function(){throw new Error("TODO: Not implemented.16")},name:function(e,t){var n=null;if(null!==e&&!(n=this.nsMap[e]))throw new Error('Namespace prefix "'+e+'" is not mapped to a namespace.');return{ns:n,name:t}}},(u={"":{last:{fn:function(){return new f(this.size)},ret:"number"},count:{fn:function(e){return new f(e.toNodeSet().length)},args:[{t:"node-set"}],ret:"number"},id:{fn:function(e){var t,n,i,r=this,o=[],a=[],s=function(e){var t,n=e.split(/[\u0020\u0009\u000D\u000A]+/);for(t=n.length-1;t>=0;t--)0==n[t].length&&n.splice(t,1);return n};if(e instanceof g)for(t=0;t<e.value.length;t++)o.push.apply(o,s(M(e.value[t])));else e=e.toString(),o=s(e);for(t=o.length-1;t>=0;t--)for(n=t-1;n>=0;n--)if(o[t]==o[n]&&t!=n){o.splice(t,1);break}for(t=0;t<o.length;t++)(i=x(this.node).getElementById(o[t]))&&P.call(this,i)?a.push(i):B(x(this.node),!0,(function(e,n){var i=P.call(r,e,n);if(i&&i.nodeValue==o[t])return a.push(e),!0}));return new g(a)},args:[{}],ret:"node-set"},"local-name":{fn:function(e){var t,n="";return 0==arguments.length&&(e=new g([this.node])),e.toNodeSet().length>0&&(e.sortDocumentOrder(),!1!==(t=R.call(this,e.value[0]))&&(n=t.name)),new p(n)},args:[{t:"node-set",r:!1}],ret:"string"},"namespace-uri":{fn:function(e){var t,n="";return 0==arguments.length&&(e=new g([this.node])),e.toNodeSet().length>0&&(e.sortDocumentOrder(),!1!==(t=R.call(this,e.value[0]))&&null!==t.ns&&(n=t.ns)),new p(n)},args:[{t:"node-set",r:!1}],ret:"string"},name:{fn:function(e){var t,n="";return 0==arguments.length&&(e=new g([this.node])),e.toNodeSet().length>0&&(e.sortDocumentOrder(),!1!==(t=R.call(this,e.value[0]))&&(n=t.prefix&&t.prefix.length>0?t.prefix+":"+t.name:t.name)),new p(n)},args:[{t:"node-set",r:!1}],ret:"string"},string:{fn:function(e){return 0==arguments.length&&(e=new g([this.node],"document-order")),new p(e.toString())},args:[{t:"object",r:!1}],ret:"string"},"starts-with":{fn:function(e,t){return new d(e.toString().substr(0,(t=t.toString()).length)==t)},args:[{t:"string"},{t:"string"}],ret:"string"},contains:{fn:function(e,t){return new d(-1!=e.toString().indexOf(t=t.toString()))},args:[{t:"string"},{t:"string"}],ret:"string"},"substring-before":{fn:function(e,t){return t=(e=e.toString()).indexOf(t.toString()),new p(-1==t?"":e.substr(0,t))},args:[{t:"string"},{t:"string"}],ret:"string"},"substring-after":{fn:function(e,t){var n;return e=e.toString(),t=t.toString(),n=e.indexOf(t),new p(-1==n?"":e.substr(n+t.length))},args:[{t:"string"},{t:"string"}],ret:"string"},substring:{fn:function(e,t,n){return e=e.toString(),t=Math.round(t.toNumber())-1,new p(isNaN(t)?"":2==arguments.length?e.substring(t<0?0:t):e.substring(t<0?0:t,t+Math.round(n.toNumber())))},args:[{t:"string"},{t:"number"},{t:"number",r:!1}],ret:"string"},"string-length":{fn:function(e){return e=0==arguments.length?M(this.node):e.toString(),new f(e.length)},args:[{t:"string",r:!1}],ret:"number"},"normalize-space":{fn:function(e){return e=0==arguments.length?M(this.node):e.toString(),new p(e.replace(/^[\u0020\u0009\u000D\u000A]+/,"").replace(/[\u0020\u0009\u000D\u000A]+$/,"").replace(/[\u0020\u0009\u000D\u000A]+/g," "))},args:[{t:"string",r:!1}],ret:"string"},translate:{fn:function(e,t,n){var i,r,o,a="";for(e=e.toString(),t=t.toString(),n=n.toString(),i=0;i<e.length;i++)(-1==(r=t.indexOf(o=e.charAt(i)))||(o=n.charAt(r)))&&(a+=o);return new p(a)},args:[{t:"string"},{t:"string"},{t:"string"}],ret:"string"},boolean:{fn:function(e){return new d(e.toBoolean())},args:[{r:!0}],ret:"boolean"},not:{fn:function(e){return new d(!e.toBoolean())},args:[{t:"boolean"}],ret:"boolean"},true:{fn:function(){return new d(!0)},ret:"boolean"},false:{fn:function(){return new d(!1)},ret:"boolean"},lang:{fn:function(e){for(var t,n,i,r,o,a,s,l=this.node,u=e.toString().toLowerCase().split("-");9!=l.nodeType;l=E(l))for(t=I(l),o=0;o<t.length;o++)if(1===(n=t[o].nodeName.split(":")).length&&(n[1]=n[0],n[0]=""),"lang"==n[1]){if((i=t[o].nodeValue.toLowerCase().split("-")).length<u.length)continue;for(s=!0,a=0;a<u.length;a++)if(u[a]!=i[a]){s=!1;break}if(s)for(r=A.call(this,l),a=0;a<r.length;a++)if(r[a].prefix==n[0]&&r[a].nodeValue==_)return new d(!0)}return new d(!1)},args:[{t:"string"}],ret:"boolean"},number:{fn:function(e){return 0==arguments.length&&(e=new g([this.node],"document-order")),new f(e.toNumber())},args:[{t:"object",r:!1}],ret:"number"},sum:{fn:function(e){var t,n=0;for(e=e.toNodeSet(),t=0;t<e.length;t++)n+=new p(M(e[t])).toNumber();return new f(n)},args:[{t:"node-set"}],ret:"number"},floor:{fn:function(e){return new f(Math.floor(e))},args:[{t:"number"}],ret:"number"},ceiling:{fn:function(e){return new f(Math.ceil(e))},args:[{t:"number"}],ret:"number"},"count-non-empty":{fn:function(e){var t,n=0;for(e=e.toNodeSet(),t=0;t<e.length;t++)new p(M(e[t])).toString().length>0&&n++;return new f(n)},args:[{t:"node-set"}],ret:"number"},position:{fn:function(e){if(e){var t,n,i;if(1===(e=e.toNodeSet()).length){for(i=1,n=(t=e[0]).tagName;t.previousElementSibling&&t.previousElementSibling.tagName===n;)t=t.previousElementSibling,i++;return new f(i)}throw new Error("nodeset provided to position() contained multiple nodes")}return new f(this.pos)},args:[{t:"node-set",r:!1}],ret:"number"},concat:{fn:function(){var e,t="";for(e=0;e<arguments.length;e++)t+=arguments[e]instanceof g?arguments[e].stringValues().join(""):arguments[e].toString();return new p(t)},args:[{t:"object",r:!1,rep:!0}],ret:"string"},round:{fn:function(e,t){return t=Math.round(t)||0,new f(Math.round(e*Math.pow(10,t))/Math.pow(10,t))},args:[{t:"number"},{t:"number",r:!1}],ret:"number"},selected:{fn:function(e,t){var n;return t=t.toString().trim(),n=e.toString(),new d(-1!=(" "+n+" ").indexOf(" "+t+" "))},args:[{t:"object"},{t:"string"}],ret:"boolean"},"selected-at":{fn:function(e,t){var n,i;return t=Math.round(t.toNumber()),n=e.toString().split(" "),i=t>=0&&t<n.length?n[t]:"",new p(i)},args:[{t:"object"},{t:"number"}],ret:"string"},"count-selected":{fn:function(e){var t=[];return(e=e.toNodeSet()).length>0?1==(t=M(e[0]).trim().split(" ")).length&&""===t[0]?new f(0):new f(t.length):new f(0)},args:[{t:"node-set"}],ret:"number"},checklist:{fn:function(e,t){var n,i,r=0;for(e=e.toNumber(),t=t.toNumber(),n=2;n<arguments.length;n++)if(arguments[n]instanceof g)for(i=0;i<arguments[n].stringValues().length;i++)!0===arguments[n].stringValues()[i].toBoolean()&&r++;else!0===arguments[n].toBoolean()&&r++;return new d((e<0||r>=e)&&(t<0||r<=t))},args:[{t:"number"},{t:"number"},{t:"object"},{t:"object",r:!1,rep:!0}],ret:"boolean"},"weighted-checklist":{fn:function(e,t){var n,i=[],r=[],o=0;for(e=e.toNumber(),t=t.toNumber(),n=2;n<arguments.length;n+=2){var a=arguments[n],s=arguments[n+1];a&&s&&(a instanceof g?i=i.concat(a.stringValues()):i.push(a),s instanceof g?r=r.concat(s.stringValues()):r.push(s))}for(n=0;n<i.length;n++)!0===i[n].toBoolean()&&(o+=r[n].toNumber());return new d((e<0||o>=e)&&(t<0||o<=t))},args:[{t:"number"},{t:"number"},{t:"object"},{t:"object"},{t:"object",r:!1,rep:!0}],ret:"boolean"},"boolean-from-string":{fn:function(e){return new d("true"===e.toString().toLowerCase()||"1"===String(e))},args:[{t:"string"}],ret:"boolean"},if:{fn:function(e,t,n){return e.toBoolean()?t:n},args:[{t:"object"},{t:"object"},{t:"object"}],ret:"object"},date:{fn:function(e){return new m(e.toDate())},args:[{t:"object"}],ret:"string"},"date-time":{fn:function(e){return new m(e.toDate())},args:[{t:"object"}],ret:"string"},"decimal-date-time":{fn:function(e){var t,n=e.toDate();return t="Invalid Date"!==n.toString()?n.getTime()/864e5:Number.NaN,new f(t)},args:[{t:"object"}],ret:"number"},"decimal-time":{fn:function(e){var t,n=e.toString().match(/^(\d\d):(\d\d):(\d\d)(\.\d\d?\d?)?(\+|-)(\d\d):(\d\d)$/);if(n&&n[1]<24&&n[1]>=0&&n[2]<60&&n[2]>=0&&n[3]<60&&n[3]>=0&&n[6]<24&&n[6]>=0&&n[7]<60&&n[7]>=0){var i=function(e){return e<10?"0"+e:e},r=new Date,o=new Date(r.getFullYear()+"-"+i(r.getMonth()+1)+"-"+i(r.getDate())+"T"+e);t="Invalid Date"===o.toString()?Number.NaN:(o.getSeconds()/3600+o.getMinutes()/60+o.getHours())/24}else t=Number.NaN;return new f(t)},args:[{t:"string"}],ret:"number"},today:{fn:function(){var e=new Date;return new m(new Date(e.getFullYear(),e.getMonth(),e.getDate()))},ret:"string"},now:{fn:function(){return new m(new Date)},ret:"string"},regex:{fn:function(e,t){var n,i;return n=e.toString(),i=new RegExp(t),new d(i.test(n))},args:[{t:"object"},{t:"string"}],ret:"boolean"},uuid:{fn:function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}));return new p(e)},ret:"string"},int:{fn:function(e){return new f(e.toNumber()>=0?Math.floor(e.toNumber()):-Math.floor(Math.abs(e.toNumber())))},args:[{t:"string"}],ret:"number"},substr:{fn:function(e,t,n){var i=(e=e.toString()).length;return t=Math.round(t.toNumber()),n=n?Math.round(n.toNumber()):i,new p(isNaN(t)?"":e.substring(t<0?i+t:t,n<0?i+n:n))},args:[{t:"string"},{t:"number"},{t:"number",r:!1}],ret:"string"},random:{fn:function(){return new f(Math.random().toFixed(15))},ret:"number"},min:{fn:function(){var e,t,n,i,r;for(e=0;e<arguments.length;e++)if(arguments[e]instanceof g){for(r=arguments[e].toNodeSet(),t=0;t<r.length;t++)(i=new p(M(r[t])))&&(n=void 0!==n?Math.min(n,i.toNumber()):i.toNumber());0===r.length&&(n=NaN)}else(i=new p(arguments[e].toString()))&&(n=void 0!==n?Math.min(n,i.toNumber()):i.toNumber());return new f(n)},args:[{t:"object"},{t:"object",r:!1,rep:!0}],ret:"number"},max:{fn:function(){var e,t,n,i,r;for(e=0;e<arguments.length;e++)if(arguments[e]instanceof g){for(r=arguments[e].toNodeSet(),t=0;t<r.length;t++)(i=new p(M(r[t])))&&(n=void 0!==n?Math.max(n,i.toNumber()):i.toNumber());0===r.length&&(n=NaN)}else(i=new p(arguments[e].toString()))&&(n=void 0!==n?Math.max(n,i.toNumber()):i.toNumber());return new f(n)},args:[{t:"object"},{t:"object",r:!1,rep:!0}],ret:"number"},join:{fn:function(e){var t,n=[];for(t=1;t<arguments.length;t++)arguments[t]instanceof g?n=n.concat(arguments[t].stringValues()):n.push(arguments[t].toString());var i=n[0]||"";for(t=1;t<n.length;t++)i+=e.toString()+n[t];return new p(i)},args:[{t:"string"},{t:"object",r:!1,rep:!0}],ret:"string"},coalesce:{fn:function(e,t){return e.toString().length>0?e:t},args:[{t:"object"},{t:"object"}],ret:"string"},"format-date":{fn:function(e,t){var n,i=(e=new m(e)).toDate(),r=t.toString(),o=function(e,t){var i=e.toString(),r=t-i.length;for(n=0;n<r;n++)i="0"+i;return i},a=window?window.enketoFormLocale:void 0;if(!e.toBoolean())return new p(i.toString());var s={Y:i.getFullYear(),y:i.getFullYear().toString().substring(2,4),m:o(i.getMonth()+1,2),n:i.getMonth()+1,b:i.toLocaleDateString(a,{month:"short"}),d:o(i.getDate(),2),e:i.getDate(),H:o(i.getHours(),2),h:i.getHours(),M:o(i.getMinutes(),2),S:o(i.getSeconds(),2),3:o(i.getMilliseconds(),3),a:i.toLocaleDateString(a,{weekday:"short"})};for(var l in s)r=r.replace("%"+l,s[l]);return new p(r)},args:[{t:"date"},{t:"string"}],ret:"string"},pow:{fn:function(e,t){return new f(Math.pow(e,t))},args:[{t:"number"},{t:"number"}],ret:"number"},sin:{fn:function(e){return new f(Math.sin(e))},args:[{t:"number"}],ret:"number"},cos:{fn:function(e){return new f(Math.cos(e))},args:[{t:"number"}],ret:"number"},tan:{fn:function(e){return new f(Math.tan(e))},args:[{t:"number"}],ret:"number"},acos:{fn:function(e){return new f(Math.acos(e))},args:[{t:"number"}],ret:"number"},asin:{fn:function(e){return new f(Math.asin(e))},args:[{t:"number"}],ret:"number"},atan:{fn:function(e){return new f(Math.atan(e))},args:[{t:"number"}],ret:"number"},atan2:{fn:function(e,t){return new f(Math.atan2(e,t))},args:[{t:"number"},{t:"number"}],ret:"number"},log10:{fn:function(e){return void 0!==Math.log10?new f(Math.log10(e)):new f(Math.log(e)/Math.LN10)},args:[{t:"number"}],ret:"number"},log:{fn:function(e){return new f(Math.log(e))},args:[{t:"number"}],ret:"number"},pi:{fn:function(){return new f(Math.PI)},args:[],ret:"number"},exp:{fn:function(e){return new f(Math.exp(e))},args:[{t:"number"}],ret:"number"},exp10:{fn:function(e){return new f(Math.pow(10,e))},args:[{t:"number"}],ret:"number"},sqrt:{fn:function(e){return new f(Math.sqrt(e))},args:[{t:"number"}],ret:"number"},once:{fn:function(e){var t=M(this.node),n=e.toString();return n="NaN"===n?"":n,new p(""!==t?t:n)},args:[{t:"string"}],ret:"string"},area:{fn:function(e){var t=[];return e instanceof g&&e.value.length>1?e.value.forEach((function(e){t.push(M(e))})):e instanceof g?t=M(e.value[0]).split(";"):e instanceof p&&(t=e.value.split(";")),new f(Qn.area(t))},args:[{t:"string"}],ret:"number"},distance:{fn:function(e){var t=[];return e instanceof g&&e.value.length>1?e.value.forEach((function(e){t.push(M(e))})):e instanceof g?t=M(e.value[0]).split(";"):e instanceof p&&(t=e.value.split(";")),new f(Qn.distance(t))},args:[{t:"string"}],ret:"number"},"ends-with":{fn:function(e,t){return new d(e.toString().substr(e.toString().length-t.toString().length)===t.toString())},args:[{t:"string"},{t:"string"}],ret:"string"},abs:{fn:function(e){return new f(Math.abs(e))},args:[{t:"number"}],ret:"number"},randomize:{fn:function(e,t){var n=t?t.toNumber():void 0;return new g(Kn(e.toNodeSet(),n),"document-order")},args:[{t:"node-set"},{t:"number",r:!1}],ret:"node-set"}}})[""]["format-date-time"]=u[""]["format-date"],s=function(e,t){if("function"!=typeof l[t.type])throw new Error("Internal Error: Expression type does not exist: "+t.type);return l[t.type].apply(e,t.args)},(r=function(t,n,i){switch(n){case r.NUMBER_TYPE:this.resultType=r.NUMBER_TYPE,this.numberValue=i.toNumber();break;case r.STRING_TYPE:this.resultType=r.STRING_TYPE,this.stringValue=i.toString();break;case r.BOOLEAN_TYPE:this.resultType=r.BOOLEAN_TYPE,this.booleanValue=i.toBoolean();break;case r.UNORDERED_NODE_ITERATOR_TYPE:case r.ORDERED_NODE_ITERATOR_TYPE:case r.UNORDERED_NODE_SNAPSHOT_TYPE:case r.ORDERED_NODE_SNAPSHOT_TYPE:case r.ANY_UNORDERED_NODE_TYPE:case r.FIRST_ORDERED_NODE_TYPE:if(!(i instanceof g))throw new Error('Expected result of type "node-set", got: "'+i.type+'"');switch(this.resultType=n,n){case r.UNORDERED_NODE_ITERATOR_TYPE:case r.UNORDERED_NODE_SNAPSHOT_TYPE:this._value=i.toNodeSet(),this.snapshotLength=this._value.length;break;case r.ORDERED_NODE_ITERATOR_TYPE:case r.ORDERED_NODE_SNAPSHOT_TYPE:i.sortDocumentOrder(),this._value=i.toNodeSet(),this.snapshotLength=this._value.length;break;case r.ANY_UNORDERED_NODE_TYPE:i=i.toNodeSet(),this.singleNodeValue=i.length?i[0]:null;break;case r.FIRST_ORDERED_NODE_TYPE:i.sortDocumentOrder(),i=i.toNodeSet(),this.singleNodeValue=i.length?i[0]:null;break;default:throw new e(e.TYPE_ERR,"XPath result type not supported. (type: "+n+")")}break;default:throw new e(e.TYPE_ERR,"XPath result type not supported. (type: "+n+")")}}).factory=function(t,n,i){var o;if(n!==r.ANY_TYPE)return new r(t,n,i);if(i instanceof g)o=new r(t,r.UNORDERED_NODE_ITERATOR_TYPE,i);else if(i instanceof f)o=new r(t,r.NUMBER_TYPE,i);else if(i instanceof d)o=new r(t,r.BOOLEAN_TYPE,i);else{if(!(i instanceof p))throw new e(e.TYPE_ERR,"Internal Error: Unsupported value type: "+typeof i);o=new r(t,r.STRING_TYPE,i)}return o},r.prototype={resultType:null,numberValue:null,stringValue:null,booleanValue:null,singleNodeValue:null,invalidIteratorState:null,snapshotLength:null,_iteratorIndex:0,iterateNext:function(){if(this.resultType!=r.UNORDERED_NODE_ITERATOR_TYPE&&this.resultType!=r.ORDERED_NODE_ITERATOR_TYPE)throw new e(e.TYPE_ERR,"iterateNext() method may only be used with results of type UNORDERED_NODE_ITERATOR_TYPE or ORDERED_NODE_ITERATOR_TYPE");return this._iteratorIndex<this._value.length?this._value[this._iteratorIndex++]:null},snapshotItem:function(t){if(this.resultType!=r.UNORDERED_NODE_SNAPSHOT_TYPE&&this.resultType!=r.ORDERED_NODE_SNAPSHOT_TYPE)throw new e(e.TYPE_ERR,"snapshotItem() method may only be used with results of type UNORDERED_NODE_SNAPSHOT_TYPE or ORDERED_NODE_SNAPSHOT_TYPE");return this._value[t]}},r.ANY_TYPE=0,r.NUMBER_TYPE=1,r.STRING_TYPE=2,r.BOOLEAN_TYPE=3,r.UNORDERED_NODE_ITERATOR_TYPE=4,r.ORDERED_NODE_ITERATOR_TYPE=5,r.UNORDERED_NODE_SNAPSHOT_TYPE=6,r.ORDERED_NODE_SNAPSHOT_TYPE=7,r.ANY_UNORDERED_NODE_TYPE=8,r.FIRST_ORDERED_NODE_TYPE=9,(o=function(e,t,n){if(1!=n.nodeType)throw new Error("Internal Error: XPathNamespace owner element must be an Element node.");this.ownerElement=n,this.ownerDocument=n.ownerDocument,this.nodeName="#namespace",this.prefix=e,this.localName=e,this.nodeType=o.XPATH_NAMESPACE_NODE,this.namespaceURI=t,this.nodeValue=t}).XPATH_NAMESPACE_NODE=13,a={XPathException:e,XPathEvaluator:t,XPathNSResolver:i,XPathExpression:n,XPathResult:r,XPathNamespace:o,customXPathFunction:{type:{StringType:p,NumberType:f,NodeSetType:g,BooleanType:d},add:function(e,t){u[""][e]=t},remove:function(e){delete u[""][e]}},getCurrentDomLevel3XPathBindings:function(){return{window:{XPathException:window.XPathException,XPathExpression:window.XPathExpression,XPathNSResolver:window.XPathNSResolver,XPathResult:window.XPathResult,XPathNamespace:window.XPathNamespace},document:{createExpression:document.createExpression,createNSResolver:document.createNSResolver,evaluate:document.evaluate}}},createDomLevel3XPathBindings:function(a){var s=new t(a);return{window:{XPathException:e,XPathExpression:n,XPathNSResolver:i,XPathResult:r,XPathNamespace:o},document:{createExpression:function(){return s.createExpression.apply(s,arguments)},createNSResolver:function(){return s.createNSResolver.apply(s,arguments)},evaluate:function(){return s.evaluate.apply(s,arguments)}}}},bindDomLevel3XPath:function(e,t){var n,i=t||a.createDomLevel3XPathBindings(),r=a.getCurrentDomLevel3XPathBindings();for(n in e=e||document,i.window)window[n]=i.window[n];for(n in i.document)e[n]=i.document[n];return r}}}();const ei=/instance\(\s*(["'])((?:(?!\1)[A-z0-9.\-_]+))\1\s*\)/g,ti=/(decimal-date-time\(|pow\(|indexed-repeat\(|format-date\(|coalesce\(|join\(|max\(|min\(|random\(|substr\(|int\(|uuid\(|regex\(|now\(|today\(|date\(|if\(|boolean-from-string\(|checklist\(|selected\(|selected-at\(|round\(|area\(|position\([^)])/,ni="http://openrosa.org/xforms",ii="http://openrosa.org/javarosa",ri="http://enketo.org/xforms",oi="http://www.opendatakit.org/xforms",ai=new DOMParser;let si,li;si=function(e,t){"string"==typeof e&&(e={modelStr:e}),e.external=e.external||[],e.submitted=void 0===e.submitted||e.submitted,(t=t||{}).full=void 0===t.full||t.full,this.events=document.createElement("div"),this.convertedExpressions={},this.templates={},this.loadErrors=[],this.data=e,this.options=t,this.namespaces={}},(si.prototype={get version(){return this.evaluate("/node()/@version","string",null,null,!0)},get instanceID(){return this.getMetaNode("instanceID").getVal()},get deprecatedID(){return this.getMetaNode("deprecatedID").getVal()||""},get instanceName(){return this.getMetaNode("instanceName").getVal()}}).init=function(){let e,t,n,i;const r=this;this.data.modelStr=this.data.modelStr.replace(/\s(xmlns=("|')[^\s>]+("|'))/g," data-$1"),this.options.full||(this.data.modelStr=this.data.modelStr.replace(/^(<model\s*><instance((?!<instance).)+<\/instance\s*>\s*)(<instance.+<\/instance\s*>)*/,"$1"));try{e="model",this.xml=ai.parseFromString(this.data.modelStr,"text/xml"),this.throwParserErrors(this.xml,this.data.modelStr),this.data.external.forEach(o=>{for(e=`instance "${o.id}"`||"instance unknown",n=r.getSecondaryInstance(o.id),i=n.children,t=i.length-1;t>=0;t--)n.removeChild(i[t]);let a;o.xml instanceof XMLDocument&&(a=window.navigator.userAgent.indexOf("Trident/")>=0?r.importNode(o.xml.documentElement,!0):r.xml.importNode(o.xml.documentElement,!0)),a&&n.appendChild(a)}),this.createSession("__session",this.data.session)}catch(t){console.error("parseXML error"),this.loadErrors.push(`Error trying to parse XML ${e}. ${t.message}`)}if(this.xml){try{this.hasInstance=!!this.xml.querySelector("model > instance"),this.rootElement=this.xml.querySelector("instance > *")||this.xml.documentElement,this.setNamespaces(),this.noRepeatRefErrorExpected=this.evaluate(`/model/@${this.getNamespacePrefix(oi)}:xforms-version`,"boolean",null,null,!0),this.getMetaNode("instanceID").getElement()||r.loadErrors.push("Invalid primary instance. Missing instanceID node."),Array.prototype.slice.call(this.xml.querySelectorAll("model > instance[src]:empty")).forEach(e=>{r.loadErrors.push(`External instance "${e.id}" is empty.`)}),this.trimValues(),this.extractTemplates()}catch(e){console.error(e),this.loadErrors.push(`${e.name}: ${e.message}`)}try{e="record",this.data.instanceStr&&this.mergeXml(this.data.instanceStr),this.setInstanceIdAndDeprecatedId(),this.data.instanceStr||this.events.dispatchEvent(yt.InstanceFirstLoad())}catch(t){console.error(t),this.loadErrors.push(`Error trying to parse XML ${e}. ${t.message}`)}}return this.loadErrors},si.prototype.throwParserErrors=(e,t)=>{if(!e||e.querySelector("parsererror"))throw new Error("Invalid XML: "+t)},si.prototype.createSession=function(e,t){let n,i;const r=this.xml.querySelector("model"),o=["deviceid","username","email","phonenumber","simserial","subscriberid"];r&&(t="object"==typeof t?t:{},n=r.querySelector(`instance[id="${e}"]`),n||(n=ai.parseFromString(`<instance id="${e}"/>`,"text/xml").documentElement,this.xml.adoptNode(n),r.appendChild(n)),o.forEach(e=>{t[e]=t[e]||function(e){if(h)return h[e];try{const t=document.cookie.split("; ");h={};for(let e=t.length-1;e>=0;e--){const n=t[e].split("=");n[1]=decodeURIComponent(n[1]),"s:"===n[1].substr(0,2)&&(n[1]=n[1].slice(2),n[1]=n[1].slice(0,n[1].lastIndexOf("."))),h[n[0]]=decodeURIComponent(n[1])}return h[e]}catch(e){return console.error("Cookie error",e),null}}("__enketo_meta_"+e)||e+" not found"}),i=ai.parseFromString(`<session><context>${o.map(e=>`<${e}>${t[e]}</${e}>`).join("")}</context></session>`,"text/xml").documentElement,this.xml.adoptNode(i),n.appendChild(i))},si.prototype.getSecondaryInstance=function(e){let t;return[...this.xml.querySelectorAll("model > instance")].some(n=>n.getAttribute("id")===e&&(t=n,!0)),t},si.prototype.node=function(e,t,n){return new li(e,t,n,this)},si.prototype.importNode=function(e,t){let n,i;switch(e.nodeType){case document.ELEMENT_NODE:{const r=document.createElementNS(e.namespaceURI,e.nodeName);if(e.attributes&&e.attributes.length>0)for(n=0,i=e.attributes.length;n<i;n++){const t=e.attributes[n];t.namespaceURI?r.setAttributeNS(t.namespaceURI,t.nodeName,e.getAttributeNS(t.namespaceURI,t.localName)):r.setAttribute(t.nodeName,e.getAttribute(t.nodeName))}if(t&&e.children.length)for(n=0,i=e.children.length;n<i;n++)r.appendChild(this.importNode(e.children[n],t));return!e.children.length&&e.textContent&&(r.textContent=e.textContent),r}case document.TEXT_NODE:case document.CDATA_SECTION_NODE:case document.COMMENT_NODE:return document.createTextNode(e.nodeValue)}},si.prototype.mergeXml=function(e){let t,n,i,r,o;const a=this;let s,l;if(e){if(i=this.xml.querySelector("instance"),r=this.xml.querySelector("instance > *"),!r)throw new Error("Model is corrupt. It does not contain a childnode of instance");e=(e=e.replace(/\s(xmlns=("|')[^\s>]+("|'))/g,"")).replace(/<!--[^>]*-->/g,""),l=ai.parseFromString(e,"text/xml"),s=l.querySelectorAll("[*|template]");for(let e=0;e<s.length;e++)s[e].remove();if(Array.prototype.slice.call(l.querySelectorAll("*")).forEach(e=>{let t,n,i,r=0;try{t=Rn(e,"instance",!1),(void 0!==a.templates[t]||Mn(e)>0)&&(n=Rn(e,"instance",!0),a.evaluate(n,"node",null,null,!0)||(i=n.match(/([^[]+)\[(\d+)\]\//g),i&&i.length>0&&(r=i[i.length-1].match(/\[(\d+)\]/)[1]-1),a.addRepeat(t,r,!0)))}catch(e){console.warn("Ignored error:",e)}}),Array.prototype.slice.call(l.querySelectorAll("*")).filter(e=>{const t=e.textContent;return 0===e.children.length&&0===t.trim().length}).forEach(e=>{const t=Rn(e,"instance",!0);a.node(t,0).getElement()&&(0===a.evaluate("./*","nodes",t,0,!0).length?a.evaluate("./text()","nodes",t,0,!0).forEach(e=>{e.textContent=""}):a.evaluate(".//*[not(*)]","nodes",t,0,!0).forEach(e=>{e.textContent=""}))}),n=new Ln({join:!1}),t=(new XMLSerializer).serializeToString(r),e=(new XMLSerializer).serializeToString(l),n.AddSource(t),n.AddSource(e),n.error.code)throw new Error(n.error.text);o=ai.parseFromString(n.Get(1),"text/xml"),this.xml.querySelector("instance").removeChild(r),r=window.navigator.userAgent.indexOf("Trident/")>=0?this.importNode(o.documentElement,!0):this.xml.adoptNode(o.documentElement,!0),i.appendChild(r),this.rootElement=r}},si.prototype.trimValues=function(){this.node(null,null,{noEmpty:!0}).getElements().forEach(e=>{e.textContent=e.textContent.trim()})},si.prototype.setInstanceIdAndDeprecatedId=function(){let e,t,n,i,r;e=this.getMetaNode("instanceID"),t=e.getElement(),r=e.getVal(),t?(this.data.instanceStr&&this.data.submitted&&(n=this.getMetaNode("deprecatedID").getElement(),t.textContent="",n||(n=ai.parseFromString("<deprecatedID/>","text/xml").documentElement,this.xml.adoptNode(n),i=this.xml.querySelector("* > meta"),i.appendChild(n))),e.getVal()||e.setVal(this.evaluate('concat("uuid:", uuid())',"string")),n&&this.getMetaNode("deprecatedID").setVal(r)):console.warn("Model has no instanceID element")},si.prototype.bindJsEvaluator=function(e){const t=new Jn.XPathEvaluator;"function"==typeof e&&e(Jn),Jn.bindDomLevel3XPath(this.xml,{window:{JsXPathException:!0,JsXPathExpression:!0,JsXPathNSResolver:!0,JsXPathResult:!0,JsXPathNamespace:!0},document:{jsCreateExpression:(...e)=>t.createExpression(...e),jsCreateNSResolver:(...e)=>t.createNSResolver(...e),jsEvaluate:(...e)=>t.evaluate(...e)}})},si.prototype.getMetaNode=function(e){const t=this.getNamespacePrefix(ni);let n=this.node(`/*/${t}:meta/${t}:${e}`);return n.getElement()||(n=this.node("/*/meta/"+e)),n},si.prototype.getRepeatCommentText=e=>"repeat:/"+(e=e.trim()),si.prototype.getRepeatCommentSelector=function(e){return`//comment()[self::comment()="${this.getRepeatCommentText(e)}"]`},si.prototype.getRepeatCommentEl=function(e,t){return this.evaluate(this.getRepeatCommentSelector(e),"nodes",null,null,!0)[t]},si.prototype.addRepeat=function(e,t,n){let i;const r=this;this.templates[e]||this.extractFakeTemplates([e]);const o=this.templates[e],a=this.getRepeatSeries(e,t),s=a.length?a[a.length-1]:this.getRepeatCommentEl(e,t);n||a.forEach(e=>{r.addOrdinalAttribute(e,a[0])}),o&&s?(i=o.cloneNode(!0),s.after(i),this.removeOrdinalAttributes(i),n||this.addOrdinalAttribute(i,a[0]),n&&Array.prototype.slice.call(i.querySelectorAll("*")).filter(e=>0===e.children.length).forEach(e=>{e.textContent=""})):console.error("Could not find template node and/or node to insert the clone after")},si.prototype.addOrdinalAttribute=function(e,t){let n,i;const r=this.getNamespacePrefix(ri);t=t||e,!0!==a.repeatOrdinals||e.getAttributeNS(ri,"ordinal")||(n=t.getAttributeNS(ri,"last-used-ordinal")||0,i=Number(n)+1,t.setAttributeNS(ri,r+":last-used-ordinal",i),e.setAttributeNS(ri,r+":ordinal",i))},si.prototype.removeOrdinalAttributes=e=>{if(!0===a.repeatOrdinals){const t=Array.prototype.slice.call(e.querySelectorAll("[*|ordinal]"));t.push(e);for(let e=0;e<t.length;e++)t[e].removeAttributeNS(ri,"last-used-ordinal"),t[e].removeAttributeNS(ri,"ordinal")}},si.prototype.getRepeatSeries=function(e,t){let n,i,r;const o=this.getRepeatCommentEl(e,t),a=[];if(o)for(n=o.textContent.substr("repeat:/".length).split("/"),i=n[n.length-1],r=o.nextSibling;r;)r.nodeName&&r.nodeName===i&&a.push(r),r=r.nextSibling;return a},si.prototype.determineIndex=function(e){if(e){const t=e.nodeName,n=Rn(e,"instance"),i=Array.prototype.slice.call(this.xml.querySelectorAll(t.replace(/\./g,"\\."))).filter(e=>n===Rn(e,"instance"));return 1===i.length?null:i.indexOf(e)}return console.error("no node, or multiple nodes, provided to determineIndex function"),-1},si.prototype.extractTemplates=function(){const e=this;this.getTemplateNodes().reverse().forEach(t=>{const n=Rn(t,"instance");e.addTemplate(n,t),t.remove()})},si.prototype.extractFakeTemplates=function(e){const t=this;let n;e.forEach(e=>{n=t.evaluate(e,"node",null,null,!0),n&&t.addTemplate(e,n,!0)})},si.prototype.addRepeatComments=function(e){const t=this.getRepeatCommentText(e);this.evaluate(e,"nodes",null,null,!0).forEach(e=>{(function(e){let t=!1;const n=e.nodeName;for(e=e.previousSibling;e;){if(e.nodeName&&e.nodeName===n){t=!0;break}e=e.previousSibling}return t})(e)||function(e,t){let n=!1;for(e=e.previousSibling;e;){if(e.nodeType===Node.COMMENT_NODE&&e.textContent===t){n=!0;break}e=e.previousSibling}return n}(e,t)||e.before(document.createComment(t))})},si.prototype.addTemplate=function(e,t,n){if(this.addRepeatComments(e),!this.templates[e]){const i=t.cloneNode(!0);i.removeAttribute("template"),i.removeAttribute("jr:template"),n&&Array.prototype.slice.call(i.querySelectorAll("*")).filter(e=>0===e.children.length).forEach(e=>{e.textContent=""}),this.templates[e]=i}},si.prototype.getTemplateNodes=function(){const e=this.getNamespacePrefix(ii);return this.evaluate(`/model/instance[1]/*//*[@${e}:template]`,"nodes",null,null,!0)},si.prototype.getStr=function(){let e=(new XMLSerializer).serializeToString(this.xml.querySelector("instance > *")||this.xml.documentElement,"text/xml");return e=e.replace(/\s(data-)(xmlns=("|')[^\s>]+("|'))/g," $2"),e=e.replace(new RegExp("\x3c!--repeat:/\\/[^>]+--\x3e","g"),""),-1===navigator.userAgent.indexOf("Trident/")&&(e=this.removeDuplicateEnketoNsDeclarations(e)),e},si.prototype.removeDuplicateEnketoNsDeclarations=function(e){let t=0;const n=new RegExp(`( xmlns:${this.getNamespacePrefix(ri)}="${ri}")`,"g");return e.replace(n,e=>(t++,t>1?"":e))},si.prototype.makeBugCompliant=function(e,t,n){if(this.noRepeatRefErrorExpected)return e;let i=this.node(t,n).getElement();if(!i)return e;const r=[i];for(;i&&i.parentElement&&"instance"!==i.nodeName.toLowerCase();)i=i.parentElement,r.push(i);return r.forEach(t=>{const n=t.nodeName.replace(/\./g,"\\."),i=In(t,n+":not([template])");if(i.length>1){const n=Rn(t,"instance"),r=i.indexOf(t);e=e.replace(new RegExp(n+"/","g"),`${n}[${r+1}]/`)}}),e},si.prototype.setNamespaces=function(){const e=this.hasInstance?"/model/instance":"",t=this.evaluate(e+"/*","nodes",null,null,!0),n=this;let i;t.forEach(e=>{e.hasAttributes()&&Array.from(e.attributes).forEach(e=>{0===e.name.indexOf("xmlns:")&&(n.namespaces[e.name.substring(6)]=e.value)}),[["orx",ni,!1],["jr",ii,!1],["enk",ri,!0===a.repeatOrdinals],["odk",oi,!1]].forEach(t=>{n.getNamespacePrefix(t[1])||(i=n.namespaces[t[0]]?"__"+t[0]:t[0],n.namespaces[i]=t[1],t[2]&&e.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:"+i,t[1]))})})},si.prototype.getNamespacePrefix=function(e){const t=Object.entries(this.namespaces).find(t=>t[1]===e);return t?t[0]:void 0},si.prototype.getNsResolver=function(){const e=void 0===this.namespaces?{}:this.namespaces;return{lookupNamespaceURI:t=>e[t]||null}},si.prototype.shiftRoot=function(e){const t=/"([^"]*)(")|'([^']*)(')/g;return this.hasInstance&&(e=(e=(e=(e=e.replace(t,(e,t,n,i,r)=>{const o=n||r;return o+(void 0!==t?encodeURIComponent(t):encodeURIComponent(i))+o})).replace(/^(\/(?!model\/)[^/][^/\s,"']*\/)/g,"/model/instance[1]$1")).replace(/([^a-zA-Z0-9.\])/*_-])(\/(?!model\/)[^/][^/\s,"']*\/)/g,"$1/model/instance[1]$2")).replace(t,(e,t,n,i,r)=>{const o=n||r;return o+(void 0!==t?decodeURIComponent(t):decodeURIComponent(i))+o})),e},si.prototype.replaceInstanceFn=function(e){let t;const n=this;return e.replace(ei,(e,i,r)=>{if(t=`/model/instance[@id="${r}"]`,n.evaluate(t,"nodes",null,null,!0).length)return t;throw new Un(`instance "${r}" does not exist in model`)})},si.prototype.replaceCurrentFn=(e,t)=>e.replace(/current\(\)/g,""+t),si.prototype.replaceIndexedRepeatFn=function(e,t,n){const i=this;return d(e,"indexed-repeat").forEach(r=>{let o,a,s;const l=r[1];if(l.length%2!=1)throw new Un("indexed repeat with incorrect number of parameters found: "+r[0]);for(a=l[0],o=l.length-1;o>1;o-=2)s=isNaN(l[o])?i.evaluate(l[o],"number",t,n,!0):l[o],a=a.replace(l[o-1],`${l[o-1]}[position() = ${s}]`);e=e.replace(r[0],a)}),e},si.prototype.replaceVersionFn=function(e){const t=this;let n;return d(e,"version").forEach(i=>{n=n||t.evaluate("/node()/@version","string",null,0,!0),e=e.replace(i[0],`"${n}"`)}),e},si.prototype.replacePullDataFn=function(e,t,n){let i;const r=this,o=this.convertPullDataFn(e,t,n);for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&(i=r.evaluate(o[a],"string",t,n,!0),e=e.replace(a,`"${i}"`));return e},si.prototype.convertPullDataFn=function(e,t,n){const i=this,r=d(e,"pulldata"),o={};return r.length?(r.forEach(e=>{let r,a;const s=e[1];if(4!==s.length)throw new Un("pulldata with incorrect number of parameters found: "+e[0]);s[1]=p(s[1]),s[2]=p(s[2]),r=`'${i.evaluate(s[3],"string",t,n,!0)}'`,a=`instance(${s[0]})/root/item[${s[2]} = ${r}]/${s[1]}`,o[e[0]]=a}),o):o},si.prototype.evaluate=function(e,t,n,i,r){let o,a,s,l,u,c,h,d,p,f,g,m;for(l in g=e,r=r||!1,t=t||"any",i=i||0,s=this.xml,p=null,n?(h=this.node(n).getElements(),p=h.length,a=h[i]):a=this.rootElement,a||console.error("no context element found",n,i),f=[e,n,i,p].join("|"),e=this.replaceIndexedRepeatFn(e,n,i),m=g===(e=this.replacePullDataFn(e,n,i)),this.convertedExpressions[f]?e=this.convertedExpressions[f]:(e=e.trim(),e=this.replaceInstanceFn(e),e=this.replaceVersionFn(e),e=this.replaceCurrentFn(e,Rn(a,"instance",!0)),e=this.shiftRoot(e),p&&p>1&&(e=this.makeBugCompliant(e,n,i)),e=(e=(e=e.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&quot;/g,'"'),m&&(this.convertedExpressions[f]=e)),u={0:["any","ANY_TYPE"],1:["number","NUMBER_TYPE","numberValue"],2:["string","STRING_TYPE","stringValue"],3:["boolean","BOOLEAN_TYPE","booleanValue"],7:["nodes","ORDERED_NODE_SNAPSHOT_TYPE"],9:["node","FIRST_ORDERED_NODE_TYPE","singleNodeValue"]},u)if(Object.prototype.hasOwnProperty.call(u,l)){if(l=Number(l),u[l][0]===t)break;l=0}if(r&&void 0!==s.evaluate&&!ti.test(e))try{c=s.evaluate(e,a,this.getNsResolver(),l,null)}catch(e){}if(!c)try{void 0===s.jsEvaluate&&this.bindJsEvaluator(),c=s.jsEvaluate(e,a,this.getNsResolver(),l,null)}catch(t){throw new Un(`Could not evaluate: ${e}, message: ${t.message}`)}if(c){if(0===l){for(l in u)if(Object.prototype.hasOwnProperty.call(u,l)&&(l=Number(l),l===Number(c.resultType)&&l>0&&l<4)){d=c[u[l][2]];break}d||console.error(`Expression: ${e} did not return any boolean, string or number value as expected`)}else if(7===l)for(d=[],o=0;o<c.snapshotLength;o++)d.push(c.snapshotItem(o));else d=c[u[l][2]];return d}},li=function(e,t,n,i){const r=i.hasInstance?"/model/instance[1]//*":"//*";this.model=i,this.originalSelector=e,this.selector="string"==typeof e&&e.length>0?e:r,n=null!=n?n:{},this.filter=n,this.filter.onlyLeaf=void 0!==n.onlyLeaf&&n.onlyLeaf,this.filter.noEmpty=void 0!==n.noEmpty&&n.noEmpty,this.index=t},li.prototype.getElement=function(){return this.getElements()[0]},li.prototype.getElements=function(){let e,t;return this._nodes||(this._nodes=this.model.evaluate(this.selector,"nodes",null,null,!0),!0===this.filter.noEmpty?this._nodes=this._nodes.filter(e=>(t=e.textContent,0===e.children.length&&t.trim().length>0)):!0===this.filter.onlyLeaf&&(this._nodes=this._nodes.filter(e=>0===e.children.length))),e=this._nodes,void 0!==this.index&&null!==this.index&&(e=void 0===e[this.index]?[]:[e[this.index]]),e},li.prototype.setIndex=function(e){this.index=e},li.prototype.setVal=function(e,t){let n,i,r;const o=this.getVal();n=null!=e?Array.isArray(e)?e.join(" "):e.toString():"",n=this.convert(n,t);const a=this.getElements();if(1===a.length&&n.toString()!==o.toString()){const e=a[0];return e.textContent=n.toString(),i=this.getClosestRepeat(),i.nodes=[e.nodeName],r=this.model.getUpdateEventData(e,t),i=r?T.extend({},i,r):i,this.model.events.dispatchEvent(yt.DataUpdate(i)),"binary"===t&&(n.length>0?(e.setAttribute("type","file"),e.removeAttribute("src")):e.removeAttribute("type")),i}return a.length>1?(console.error("nodeset.setVal expected nodeset with one node, but received multiple"),null):0===a.length?(console.warn(`Data node: ${this.selector} with null-based index: ${this.index} not found. Ignored.`),null):null},li.prototype.getVal=function(){const e=this.getElements();return e.length?e[0].textContent:void 0},li.prototype.getClosestRepeat=function(){let e=this.getElement(),t=e.nodeName;for(;t&&"instance"!==t&&(!e.nextElementSibling||e.nextElementSibling.nodeName!==t)&&(!e.previousElementSibling||e.previousElementSibling.nodeName!==t);)e=e.parentElement,t=e?e.nodeName:null;return t&&"instance"!==t?{repeatPath:Rn(e,"instance"),repeatIndex:this.model.determineIndex(e)}:{}},li.prototype.remove=function(){const e=this.getElement();if(e){const t=e.nodeName,n=Rn(e,"instance");let i=this.model.determineIndex(e);const r=this.model.getRemovalEventData(e);this.model.templates[n]||this.model.extractFakeTemplates([n]);let o=e.nextElementSibling;for(e.remove(),this._nodes=null,this.model.events.dispatchEvent(yt.DataUpdate({nodes:null,repeatPath:n,repeatIndex:i}));o&&o.nodeName==t;)o=o.nextElementSibling,this.model.events.dispatchEvent(yt.DataUpdate({nodes:null,repeatPath:n,repeatIndex:i++}));this.model.events.dispatchEvent(yt.Removed(r))}else console.error(`could not find node ${this.selector} with index ${this.index} to remove `)},li.prototype.convert=(e,t)=>""===e.toString()?e:null!=t&&void 0!==$n[t.toLowerCase()]&&void 0!==$n[t.toLowerCase()].convert?$n[t.toLowerCase()].convert(e):e,li.prototype.validate=function(e,t,n){const i=this,r={};return this.validateRequired(t).then(t=>(r.requiredValid=t,!1===t?null:i.validateConstraintAndType(e,n))).then(e=>(r.constraintValid=e,r))},li.prototype.validateConstraintAndType=function(e,t){const n=this;let i;return t&&void 0!==$n[t.toLowerCase()]||(t="string"),e||"string"!==t&&"select"!==t&&"select1"!==t&&"binary"!==t?(i=n.getVal(),""===i.toString()?Promise.resolve(!0):Promise.resolve().then(()=>$n[t.toLowerCase()].validate(i)).then(t=>{const i=!(null!=e&&e.length>0)||n.model.evaluate(e,"boolean",n.originalSelector,n.index);return t&&i})):Promise.resolve(!0)},li.prototype.isRequired=function(e){return!(!e||"false()"===e.trim())&&("true()"===e.trim()||this.model.evaluate(e,"boolean",this.originalSelector,this.index))},li.prototype.validateRequired=function(e){const t=this;return!e||this.getVal()?Promise.resolve(!0):Promise.resolve().then(()=>!t.isRequired(e))},si.prototype.getUpdateEventData=()=>{},si.prototype.getRemovalEventData=()=>{},si.prototype.types=$n;var ui={getWrapNode:e=>e.closest(".question, .calculation, .setvalue"),getWrapNodes(e){const t=[];return e.forEach(e=>{const n=this.getWrapNode(e);t.includes(n)||t.push(n)}),t},getProps(e){return{path:this.getName(e),ind:this.getIndex(e),inputType:this.getInputType(e),xmlType:this.getXmlType(e),constraint:this.getConstraint(e),calculation:this.getCalculation(e),relevant:this.getRelevant(e),readonly:this.getReadonly(e),val:this.getVal(e),required:this.getRequired(e),enabled:this.isEnabled(e),multiple:this.isMultiple(e)}},getInputType(e){const t=e.nodeName.toLowerCase();return"input"===t?e.dataset.drawing?"drawing":e.type?"text"===e.type&&"date"===this.getXmlType(e)?"date":"text"===e.type&&"datetime"===this.getXmlType(e)?"datetime-local":e.type.toLowerCase():console.error("<input> node has no type"):"select"===t?"select":"textarea"===t?"textarea":"fieldset"===t||"section"===t?"fieldset":console.error("unexpected input node type provided")},getConstraint:e=>e.dataset.constraint,getRequired(e){if(!Pn(e,".or-appearance-label",".or"))return e.dataset.required},getRelevant:e=>e.dataset.relevant,getReadonly:e=>e.matches("[readonly]"),getCalculation:e=>e.dataset.calculate,getXmlType:e=>(e.dataset.typeXml||"string").toLowerCase(),getName(e){const t=e.dataset.name||e.getAttribute("name");return t||console.error("input node has no name"),t},getIndex(e){return this.form.repeats.getIndex(e.closest(".or-repeat"))},isMultiple(e){return"checkbox"===this.getInputType(e)||e.multiple},isEnabled:e=>!(e.disabled||Pn(e,".disabled",".or")),getVal(e){let t="";const n=this.getInputType(e),i=this.getName(e);switch(n){case"radio":{const n=this.getWrapNode(e).querySelector(`input[type="radio"][data-name="${i}"]:checked`);t=n?n.value:"";break}case"checkbox":t=[...this.getWrapNode(e).querySelectorAll(`input[type="checkbox"][name="${i}"]:checked`)].map(e=>e.value);break;case"select":if(this.isMultiple(e))t=[...e.querySelectorAll("option:checked")].map(e=>e.value);else{const n=e.querySelector("option:checked");t=n?n.value:""}break;case"datetime-local":if(e.value){const n=5===e.value.split("T")[1].length?e.value+":00":e.value;t=n+new Date(n).getTimezoneOffsetAsTime()}break;default:t=e.value}return t||""},find(e,t=0){let n="name";this.form.view.html.querySelector(`input[type="radio"][data-name="${e}"]:not(.ignore)`)&&(n="data-name");const i=`[${n}="${e}"]:not([data-event="xforms-value-changed"])`,r=this.getWrapNodes(this.form.view.html.querySelectorAll(i))[t];return r?r.querySelector(`[${n}="${e}"]:not(.ignore)`):null},setVal(e,t,n=yt.InputUpdate()){let i;const r=this.getInputType(e),o=this.getXmlType(e),a=this.getWrapNode(e),s=this.getName(e);if("radio"===r)i=a.querySelectorAll(`[data-name="${s}"]:not(.ignore)`);else{if(i=a.querySelectorAll(`[name="${s}"]:not(.ignore)`),"file"===r&&t)return e.setAttribute("data-loaded-file-name",t),!1;if(("date"===o||"datetime"===o)&&t&&(t=$n[o.toLowerCase()].convert(t),"datetime"===o)){const e=(t=new Date(t).toISOLocalString()).split("T"),n=e[0],i=e&&e[1]?e[1].split(/[Z\-+]/)[0]:"00:00";t=`${n}T${i}`}if("time"===r&&/(\+|-)/.test(t)){const e=`${(new Date).toLocaleDateString("en",{month:"short",day:"numeric",year:"numeric"}).replace(/\u200E/g,"")} ${t.replace(/(\d\d:\d\d:\d\d)(\.\d{1,3})(\s?((\+|-)\d\d))(:)?(\d\d)?/,"$1 GMT$3$7")}`,n=new Date(e);"Invalid Date"!==n.toString()?t=`${n.getHours().toString().pad(2)}:${n.getMinutes().toString().pad(2)}`:console.error("could not parse time:",t)}}if(!0===this.isMultiple(e)?t=t.split(" "):"radio"===r&&(t=[t]),i.length){const o=this.getVal(e);if(void 0===o||o.toString()!==t.toString()){switch(r){case"radio":{const n=this.getWrapNode(e).querySelector(`input[type="radio"][data-name="${s}"][value="${t}"]`);n&&(n.checked=!0);break}case"checkbox":this.getWrapNode(e).querySelectorAll(`input[type="checkbox"][name="${s}"]`).forEach(e=>e.checked=t.includes(e.value));break;case"select":if(this.isMultiple(e))e.querySelectorAll("option").forEach(e=>e.selected=t.includes(e.value));else{const n=e.querySelector(`option[value="${t}"]`);n?n.selected=!0:e.querySelectorAll("option").forEach(e=>e.selected=!1)}break;default:e.value=t}n&&i[0].dispatchEvent(n)}}return i[0]},validate(e){return this.form.validateInput(e)}};function ci(e){if(!/^\s*instance\(.+\)/.test(e))return!1;if(!/\[.+\]/.test(e))return!0;return/\[\d+\]/.test(e)}var hi={update(e={}){const t=this,n={};let i;if(!this.form)throw new Error("Output module not correctly instantiated with form property.");i=e.relevantPath?this.form.getRelatedNodes("data-items-path",".itemset-template").get().filter(t=>t.querySelector(`[type="checkbox"][name^="${e.relevantPath}/"]`)||t.querySelector(`[type="radio"][data-name^="${e.relevantPath}/"]`)||t.parentElement.matches(`select[name^="${e.relevantPath}/"]`)||t.parentElement.parentElement.querySelector(`input[list][name^="${e.relevantPath}/"]`)||t.querySelector(`[type="checkbox"][name="${e.relevantPath}"]`)||t.querySelector(`[type="radio"][data-name="${e.relevantPath}"]`)||t.parentElement.matches(`select[name="${e.relevantPath}"]`)||t.parentElement.parentElement.querySelector(`input[list][name="${e.relevantPath}"]`)):this.form.getRelatedNodes("data-items-path",".itemset-template",e).get();const r=this.form.repeatsPresent&&this.form.view.html.querySelector(".or-repeat.clone"),o=[];i.forEach(e=>{const i=e.parentElement.parentElement.matches(".or-repeat-info"),a={};if(Pn(e,".disabled",".or"))return;const s={},l=On.get(e,"items")||{},u=e.nodeName.toLowerCase(),c=e.parentElement.matches("select, datalist")?e.parentElement:null;let h;if("label"===u){const t=Bn(e,"input")[0];[].slice.call(t.attributes).forEach(e=>{a[e.name]=e.value}),h=t.classList.contains("ignore")?An(t.closest(".option-wrapper"),"input.rank")[0]:t}else c&&"select"===c.nodeName.toLowerCase()?h=c:c&&"datalist"===c.nodeName.toLowerCase()&&(h=i?t.form.view.html.querySelector(`input[name="${c.dataset.name}"]`):An(c,"input:not(.widget)")[0]);const p=An(e.closest("label, select, datalist"),".itemset-labels")[0],f=e.dataset.itemsPath;let g=p.dataset.labelType,m=p.dataset.labelRef;const v=d(m,"translate");v.length&&(m=v[0][1][0],g="langs");const y=p.dataset.valueRef,_=t.form.input.getName(h),b=!i&&r&&Pn(h,".or-repeat.clone",".or")?t.form.input.getIndex(h):0,w=this.form.model.evaluate(f,"nodes",_,b,!0);if(s.length=w.length,s.text=w.map(e=>e.textContent).join(""),s.length===l.length&&s.text===l.text)return;On.put(e,"items",s);const E=e.closest(".question, datalist");[...E.querySelectorAll(u)].filter(t=>t!==e).forEach(e=>e.remove());const C=E.nextElementSibling,S=C&&C.matches(".or-option-translations")?C:E.querySelector(".or-option-translations");S&&[...S.children].forEach(e=>e.remove());let k=document.createDocumentFragment(),T=document.createDocumentFragment(),x=[];const L=`${_}:${f}`;n[L]?(k=n[L].optionsFragment.cloneNode(!0),T=n[L].optionsTranslationsFragment.cloneNode(!0)):(w.forEach(e=>{const n=t.getNodesFromItem(m,e);if(n&&n.length)switch(g){case"itext":x=[...p.querySelectorAll(`[data-itext-id="${n[0].textContent}"]`)].map(e=>{const t=e.getAttribute("lang"),n=e.nodeName,i=e.src;return{language:t,type:n,text:e.textContent,active:e.classList.contains("active"),src:i,alt:e.alt}});break;case"langs":x=n.map(e=>{const n=e.getAttribute("lang"),i=!n&&!t.form.langs.currentLang||n===t.form.langs.currentLang;return{language:n,type:"span",text:e.textContent,active:i}});break;default:x=[{language:"",type:"span",text:n&&n.length?n[0].textContent:"error",active:!0}]}else x=[{language:"",label:"error",active:!0}];const i=t.getNodeFromItem(y,e).textContent;if(("select"==a["data-type-xml"]&&"checkbox"==a.type||c&&c.multiple)&&i.indexOf(" ")>-1&&(o[o.length]=dt("alert.valuehasspaces.multiple",{value:i})),"label"===u)k.appendChild(t.createInput(a,x,i));else if("option"===u){let e="";x.length>1?x.forEach(n=>{n.active&&(e=n.text),T.appendChild(t.createOptionTranslation(n,i))}):e=x[0].text,k.appendChild(t.createOption(e,i))}}),ci(f)&&(n[L]={optionsFragment:k.cloneNode(!0),optionsTranslationsFragment:T.cloneNode(!0)})),e.parentNode.appendChild(k),S&&S.appendChild(T);let I=t.form.model.node(_,b).getVal();""!==I&&(h.classList.contains("rank")&&(I=""),t.form.input.setVal(h,I,yt.Change())),(c||h.classList.contains("rank"))&&h.dispatchEvent(yt.ChangeOption())}),o.length>0&&Kt.alert(o.join("<br>"))},getNodesFromItem(e,t,n){if(!e)throw new Error("Error: could not query instance item, no expression provided");const i=n?9:7,r=void 0!==this.form.model.xml.evaluate?"evaluate":"jsEvaluate",o=this.form.model.xml[r](e,t,this.form.model.getNsResolver(),i,null),a=[];if(n)a.push(o.singleNodeValue);else for(let e=0;e<o.snapshotLength;e++)a.push(o.snapshotItem(e));return a},getNodeFromItem(e,t){const n=this.getNodesFromItem(e,t,!0);return n.length?n[0]:null},createOption(e,t){const n=document.createElement("option");return n.textContent=e,n.value=t,n},createOptionTranslation(e,t){const n=document.createElement(e.type||"span");return e.text&&(n.textContent=e.text,n.classList.add("option-label")),n.classList.toggle("active",e.active),e.language&&(n.lang=e.language),n.dataset.optionValue=t,e.src&&(n.src=e.src,n.alt=e.alt),n},createInput(e,t,n){const i=this,r=document.createElement("label"),o=document.createElement("input");return Object.getOwnPropertyNames(e).forEach(t=>{o.setAttribute(t,e[t])}),o.value=n,r.appendChild(o),t.forEach(e=>{r.appendChild(i.createOptionTranslation(e,n))}),r}};const di=!0===a.repeatOrdinals;var pi={init(){const e=this;let t;if(this.staticLists=[],!this.form)throw new Error("Repeat module not correctly instantiated with form property.");return t=this.form.view.$.find(".or-repeat-info"),this.templates={},t.siblings(".or-repeat").prepend('<span class="repeat-number"></span>').addBack().filter((function(){return this.firstChild&&3===this.firstChild.nodeType&&(this.firstChild.textContent=""),!this.querySelector(".question")})).addClass("empty"),t.filter("*:not([data-repeat-fixed]):not([data-repeat-count])").append('<button type="button" class="btn btn-default add-repeat-btn"><i class="icon icon-plus"> </i></button>').siblings(".or-repeat").append(`<div class="repeat-buttons"><button type="button" ${di?" disabled ":" "}class="btn btn-default remove"><i class="icon icon-minus"> </i></button></div>`),this.form.model.extractFakeTemplates(t.map((function(){return this.dataset.name})).get()),t.siblings(".or-repeat").reverse().each((function(){const t=this.cloneNode(!0),n=t.getAttribute("name");this.remove(),T(t).removeClass("contains-current current").find(".current").removeClass("current"),e.templates[n]=t})),t.reverse().each((function(){T(this).closest(".or-repeat").length||e.updateDefaultFirstRepeatInstance(this)})).get().forEach(e.updateViewInstancesFromModel.bind(this)),this.form.view.$.on("click","button.add-repeat-btn:enabled",(function(){return e.add(T(this).closest(".or-repeat-info")[0]),!1})),this.form.view.$.on("click","button.remove:enabled",(function(){return e.confirmDelete(this.closest(".or-repeat")),!1})),this.countUpdate(),!0},confirmDelete(e){const t=this;Kt.confirm({heading:dt("confirm.repeatremove.heading"),msg:dt("confirm.repeatremove.msg")}).then(n=>{n&&t.remove(T(e))}).catch(console.error)},getIndex(e){if(!e||!this.form.repeatsPresent)return 0;let t=e.parentElement.closest(".or-repeat");const n=e.classList.contains("or-repeat-info");let i,r=n?1:Number(e.querySelector(".repeat-number").textContent);for(;t;){for(;t.previousElementSibling&&t.previousElementSibling.matches(".or-repeat");)t=t.previousElementSibling,n?r++:(i=i||e.getAttribute("name"),r+=t.querySelectorAll(`.or-repeat[name="${i}"]`).length);const o=t.parentElement;t=o?o.closest(".or-repeat"):null}return r-1},getInfoIndex(e){if(!this.form.repeatsPresent)return 0;if(!e||!e.classList.contains("or-repeat-info"))return null;const t=e.dataset.name;return[...e.closest("form.or").querySelectorAll(`.or-repeat-info[data-name="${t}"]`)].indexOf(e)},updateViewInstancesFromModel(e){const t=e.dataset.name,n=this.getIndex(e),i=this.form.model.getRepeatSeries(t,n),r=An(e,".or-repeat");return i.length>r.length&&(this.add(e,i.length-r.length,"model"),An(e,".or-repeat").reduce((e,t)=>e.concat([...t.querySelectorAll(".or-repeat-info:not([data-repeat-count])")]),[]).forEach(this.updateViewInstancesFromModel.bind(this))),i.length},updateDefaultFirstRepeatInstance(e){const t=e.dataset.name;if(!this.form.model.data.instanceStr&&!this.templates[t].classList.contains("or-appearance-minimal")){const n=this.getIndex(e);0===this.form.model.getRepeatSeries(t,n).length&&this.add(e,1,"magic"),An(e,".or-repeat").reduce((e,t)=>e.concat([...t.querySelectorAll(".or-repeat-info:not([data-repeat-count])")]),[]).forEach(this.updateDefaultFirstRepeatInstance.bind(this))}},updateRepeatInstancesFromCount(e){const t=e.dataset.repeatCount||"";if(!t)return;const n=e.dataset.name;let i=this.form.model.evaluate(t,"number",this.form.model.getRepeatCommentSelector(n),this.getInfoIndex(e),!0);i=isNaN(i)?0:i;const r=An(e,`.or-repeat[name="${n}"]`).length;let o=i-r;if(o>0)this.add(e,o,"count");else if(o<0)for(o=Math.abs(o)>=r?(di?1:0)-r:o;o<0;o++){const t=T(e).siblings(".or-repeat").last();this.remove(t)}In(e,".or-repeat").reduce((e,t)=>e.concat(Bn(t,".or-group, .or-group-data")),[]).reduce((e,t)=>e.concat(Bn(t,".or-repeat-info[data-repeat-count]")),[]).forEach(this.updateRepeatInstancesFromCount.bind(this))},countUpdate(e={}){this.form.getRelatedNodes("data-repeat-count",".or-repeat-info",e).get().forEach(this.updateRepeatInstancesFromCount.bind(this))},add(e,t=1,n="user"){if(!e)return console.error("Nothing to clone"),!1;let i;const r=e.dataset.name;let o=An(e,".or-repeat"),a=this.templates[r].cloneNode(!0),s=this.getIndex(e),l=this.form.model.getRepeatSeries(r,s).length;const u=e.previousElementSibling;let c=u&&u.classList.contains("or-repeat")?Number(u.querySelector(".repeat-number").textContent):0;for(let u=0;u<t;u++){a.querySelectorAll(".option-wrapper").forEach(this.fixRadioName),this.processDatalists(a.querySelectorAll("datalist"),e),e.parentElement.insertBefore(a,e),c>0&&a.classList.add("clone"),a.querySelector(".repeat-number").textContent=c+1,o.push(a),o.length>l&&(this.form.model.addRepeat(r,s),l++),i=i||this.getIndex(a);const t={repeatIndex:i,repeatPath:r,trigger:n,cloned:!0};"user"!==n&&"count"!==n||a.dispatchEvent(yt.NewRepeat(t)),a.dispatchEvent(yt.AddRepeat(t)),this.form.widgetsInitialized&&this.form.widgets.init(T(a),this.form.options),a.querySelectorAll(".or-repeat-info:not([data-repeat-count])").forEach(this.updateDefaultFirstRepeatInstance.bind(this)),a=this.templates[r].cloneNode(!0),i++,c++}return this.toggleButtons(e),!0},remove(e){const t=e.next(".or-repeat, .or-repeat-info"),n=e.attr("name"),i=this.getIndex(e[0]),r=e.siblings(".or-repeat-info")[0];e.remove(),this.numberRepeats(r),this.toggleButtons(r),t[0].dispatchEvent(yt.RemoveRepeat()),this.form.model.node(n,i).remove()},fixRadioName(e){const t=Math.floor(1e7*Math.random()+1);e.querySelectorAll('input[type="radio"]').forEach(e=>{e.setAttribute("name",t)})},fixDatalistId(e){const t=e.id+Math.floor(1e7*Math.random()+1);e.parentNode.querySelector(`input[list="${e.id}"]`).setAttribute("list",t),e.id=t},processDatalists(e,t){e.forEach(e=>{const n=e.querySelector(".itemset-template[data-items-path]");if(ci(n?n.dataset.itemsPath:null)){const n=e.id,i=An(e,"input[list]"),r=i.length?i[0]:null;if(r)if(this.staticLists.includes(n))e.remove();else{const i=e.parentElement,o=r.name,a=i.querySelector("datalist"),s=i.removeChild(a);s.setAttribute("data-name",o),t.appendChild(s);const l=i.querySelector(".or-option-translations"),u=i.removeChild(l);u.setAttribute("data-name",o),t.appendChild(u);const c=i.querySelector(".itemset-labels"),h=i.removeChild(c);h.setAttribute("data-name",o),t.appendChild(h),this.staticLists.push(n)}}else this.fixDatalistId(e)})},toggleButtons(e){T(e).siblings(".or-repeat").children(".repeat-buttons").find("button.remove").prop("disabled",!1).first().prop("disabled",di)},numberRepeats(e){T(e).siblings(".or-repeat").each((e,t)=>{T(t).children(".repeat-number").text(e+1)})}},fi={tocItems:[],_maxTocLevel:[],generateTocItems(){this.tocItems=[];[...this.form.view.$[0].querySelectorAll('.question:not([role="comment"]), .or-group')].filter(e=>!e.closest(".disabled")&&(e.matches(".question")||e.querySelector(".question:not(.disabled)")||e.matches(".or-repeat-info")&&0===An(e,".or-repeat").length)).filter(e=>!e.classList.contains("or-repeat-info")).forEach((e,t)=>{const n=Nn(e,".or-group");this.tocItems.push({element:e,level:n.length,parent:n.length>0?n[n.length-1]:null,tocId:t,tocParentId:null})}),this._maxTocLevel=Math.max.apply(Math,this.tocItems.map(e=>e.level));const e=this.tocItems.filter(e=>e.level<this._maxTocLevel&&e.element.classList.contains("or-group"));this.tocItems.forEach(t=>{const n=e.find(e=>t.parent===e.element);n&&(t.tocParentId=n.tocId)})},getHtmlFragment(){this.generateTocItems();const e=document.createDocumentFragment();let t=0;do{const n=this.tocItems.filter(e=>e.level===t);if(0===t)this._buildTocHtmlList(n,e);else{[...new Set(n.map(e=>e.tocParentId))].forEach(t=>{const i=document.createElement("ul"),r=n.filter(e=>e.tocParentId===t);this._buildTocHtmlList(r,i);e.querySelectorAll('[tocId="'+t+'"]')[0].appendChild(i)})}t++}while(t<=this._maxTocLevel);return e},_getTitle(e){let t;const n=e.querySelector(".question-label.active");if(n)t=n.textContent;else{const n=e.querySelector(".or-hint.active");n&&(t=n.textContent)}return t=t&&t.length>20?t.substring(0,20)+"...":t,t},_buildTocHtmlList(e,t){e.length>0&&e.forEach(e=>{const n=document.createElement("li");if(e.element.classList.contains("or-group")){const t=document.createElement("summary");t.textContent=this._getTitle(e.element)||`[${e.tocId+1}]`;const i=document.createElement("details");i.setAttribute("tocId",e.tocId),null!==e.tocParentId&&i.setAttribute("tocParentId",e.tocParentId),i.append(t),n.append(i)}else{const t=document.createElement("a");t.textContent=this._getTitle(e.element)||`[${e.tocId+1}]`,n.setAttribute("tocId",e.tocId),n.setAttribute("role","pageLink"),null!==e.tocParentId&&n.setAttribute("tocParentId",e.tocParentId),n.append(t)}t.append(n)})}},gi=(u((function(e){
/*!
     * @fileOverview TouchSwipe - jQuery Plugin
     * @version 1.6.18
     *
     * @author Matt Bryson http://www.github.com/mattbryson
     * @see https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
     * @see http://labs.rampinteractive.co.uk/touchSwipe/
     * @see http://plugins.jquery.com/project/touchSwipe
     * @license
     * Copyright (c) 2010-2015 Matt Bryson
     * Dual licensed under the MIT or GPL Version 2 licenses.
     *
     */
!function(e){function t(t){return!t||void 0!==t.allowPageScroll||void 0===t.swipe&&void 0===t.swipeStatus||(t.allowPageScroll=u),void 0!==t.click&&void 0===t.tap&&(t.tap=t.click),t||(t={}),t=e.extend({},e.fn.swipe.defaults,t),this.each((function(){var i=e(this),r=i.data(x);r||(r=new n(this,t),i.data(x,r))}))}function n(t,n){function L(t){if(!(!0===Ee.data(x+"_intouch")||e(t.target).closest(n.excludedElements,Ee).length>0)){var s=t.originalEvent?t.originalEvent:t;if(!s.pointerType||"mouse"!=s.pointerType||0!=n.fallbackToMouseEvents){var l,u=s.touches,c=u?u[0]:s;return Ce=b,u?Se=u.length:!1!==n.preventDefaultEvents&&t.preventDefault(),de=0,pe=null,fe=null,be=null,ge=0,me=0,ve=0,ye=1,_e=0,(h={})[i]=te(i),h[r]=te(r),h[o]=te(o),h[a]=te(a),we=h,Z(),Q(0,c),!u||Se===n.fingers||n.fingers===y||V()?(Te=oe(),2==Se&&(Q(1,u[1]),me=ve=ie(ke[0].start,ke[1].start)),(n.swipeStatus||n.pinchStatus)&&(l=R(s,Ce))):l=!1,!1===l?(R(s,Ce=C),l):(n.hold&&(Ne=setTimeout(e.proxy((function(){Ee.trigger("hold",[s.target]),n.hold&&(l=n.hold.call(Ee,s,s.target))}),this),n.longTapThreshold)),X(!0),null)}}var h}function I(t){var h,d,p,f,g=t.originalEvent?t.originalEvent:t;if(Ce!==E&&Ce!==C&&!Y()){var _,b=g.touches,S=J(b?b[0]:g);if(xe=oe(),b&&(Se=b.length),n.hold&&clearTimeout(Ne),Ce=w,2==Se&&(0==me?(Q(1,b[1]),me=ve=ie(ke[0].start,ke[1].start)):(J(b[1]),ve=ie(ke[0].end,ke[1].end),ke[0].end,ke[1].end,be=1>ye?l:s),ye=(ve/me*1).toFixed(2),_e=Math.abs(me-ve)),Se===n.fingers||n.fingers===y||!b||V()){if(pe=re(S.start,S.end),function(e,t){if(!1!==n.preventDefaultEvents)if(n.allowPageScroll===u)e.preventDefault();else{var s=n.allowPageScroll===c;switch(t){case i:(n.swipeLeft&&s||!s&&n.allowPageScroll!=m)&&e.preventDefault();break;case r:(n.swipeRight&&s||!s&&n.allowPageScroll!=m)&&e.preventDefault();break;case o:(n.swipeUp&&s||!s&&n.allowPageScroll!=v)&&e.preventDefault();break;case a:(n.swipeDown&&s||!s&&n.allowPageScroll!=v)&&e.preventDefault()}}}(t,fe=re(S.last,S.end)),p=S.start,f=S.end,de=Math.round(Math.sqrt(Math.pow(f.x-p.x,2)+Math.pow(f.y-p.y,2))),ge=ne(),function(e,t){e!=u&&(t=Math.max(t,ee(e)),we[e].distance=t)}(pe,de),_=R(g,Ce),!n.triggerOnTouchEnd||n.triggerOnTouchLeave){var k=!0;if(n.triggerOnTouchLeave){var T={left:(d=(h=e(h=this)).offset()).left,right:d.left+h.outerWidth(),top:d.top,bottom:d.top+h.outerHeight()};k=function(e,t){return e.x>t.left&&e.x<t.right&&e.y>t.top&&e.y<t.bottom}(S.end,T)}!n.triggerOnTouchEnd&&k?Ce=B(w):n.triggerOnTouchLeave&&!k&&(Ce=B(E)),Ce!=C&&Ce!=E||R(g,Ce)}}else R(g,Ce=C);!1===_&&R(g,Ce=C)}}function A(e){var t=e.originalEvent?e.originalEvent:e,i=t.touches;if(i){if(i.length&&!Y())return function(e){Le=oe(),Ie=e.touches.length+1}(t),!0;if(i.length&&Y())return!0}return Y()&&(Se=Ie),xe=oe(),ge=ne(),U()||!O()?R(t,Ce=C):n.triggerOnTouchEnd||!1===n.triggerOnTouchEnd&&Ce===w?(!1!==n.preventDefaultEvents&&!1!==e.cancelable&&e.preventDefault(),R(t,Ce=E)):!n.triggerOnTouchEnd&&W()?M(t,Ce=E,p):Ce===w&&R(t,Ce=C),X(!1),null}function D(){Se=0,xe=0,Te=0,me=0,ve=0,ye=1,Z(),X(!1)}function N(e){var t=e.originalEvent?e.originalEvent:e;n.triggerOnTouchLeave&&R(t,Ce=B(E))}function P(){Ee.off(se,L),Ee.off(he,D),Ee.off(le,I),Ee.off(ue,A),ce&&Ee.off(ce,N),X(!1)}function B(e){var t=e,i=z(),r=O(),o=U();return!i||o?t=C:!r||e!=w||n.triggerOnTouchEnd&&!n.triggerOnTouchLeave?!r&&e==E&&n.triggerOnTouchLeave&&(t=C):t=E,t}function R(e,t){var i,r=e.touches;return(!(!q()||!j())||j())&&(i=M(e,t,h)),(!(!F()||!V())||V())&&!1!==i&&(i=M(e,t,d)),G()&&K()&&!1!==i?i=M(e,t,f):ge>n.longTapThreshold&&_>de&&n.longTap&&!1!==i?i=M(e,t,g):!(1!==Se&&S||!(isNaN(de)||de<n.threshold)||!W())&&!1!==i&&(i=M(e,t,p)),t===C&&D(),t===E&&(r&&r.length||D()),i}function M(t,u,c){var m;if(c==h){if(Ee.trigger("swipeStatus",[u,pe||null,de||0,ge||0,Se,ke,fe]),n.swipeStatus&&!1===(m=n.swipeStatus.call(Ee,t,u,pe||null,de||0,ge||0,Se,ke,fe)))return!1;if(u==E&&q()){if(clearTimeout(De),clearTimeout(Ne),Ee.trigger("swipe",[pe,de,ge,Se,ke,fe]),n.swipe&&!1===(m=n.swipe.call(Ee,t,pe,de,ge,Se,ke,fe)))return!1;switch(pe){case i:Ee.trigger("swipeLeft",[pe,de,ge,Se,ke,fe]),n.swipeLeft&&(m=n.swipeLeft.call(Ee,t,pe,de,ge,Se,ke,fe));break;case r:Ee.trigger("swipeRight",[pe,de,ge,Se,ke,fe]),n.swipeRight&&(m=n.swipeRight.call(Ee,t,pe,de,ge,Se,ke,fe));break;case o:Ee.trigger("swipeUp",[pe,de,ge,Se,ke,fe]),n.swipeUp&&(m=n.swipeUp.call(Ee,t,pe,de,ge,Se,ke,fe));break;case a:Ee.trigger("swipeDown",[pe,de,ge,Se,ke,fe]),n.swipeDown&&(m=n.swipeDown.call(Ee,t,pe,de,ge,Se,ke,fe))}}}if(c==d){if(Ee.trigger("pinchStatus",[u,be||null,_e||0,ge||0,Se,ye,ke]),n.pinchStatus&&!1===(m=n.pinchStatus.call(Ee,t,u,be||null,_e||0,ge||0,Se,ye,ke)))return!1;if(u==E&&F())switch(be){case s:Ee.trigger("pinchIn",[be||null,_e||0,ge||0,Se,ye,ke]),n.pinchIn&&(m=n.pinchIn.call(Ee,t,be||null,_e||0,ge||0,Se,ye,ke));break;case l:Ee.trigger("pinchOut",[be||null,_e||0,ge||0,Se,ye,ke]),n.pinchOut&&(m=n.pinchOut.call(Ee,t,be||null,_e||0,ge||0,Se,ye,ke))}}return c==p?u!==C&&u!==E||(clearTimeout(De),clearTimeout(Ne),K()&&!G()?(Ae=oe(),De=setTimeout(e.proxy((function(){Ae=null,Ee.trigger("tap",[t.target]),n.tap&&(m=n.tap.call(Ee,t,t.target))}),this),n.doubleTapThreshold)):(Ae=null,Ee.trigger("tap",[t.target]),n.tap&&(m=n.tap.call(Ee,t,t.target)))):c==f?u!==C&&u!==E||(clearTimeout(De),clearTimeout(Ne),Ae=null,Ee.trigger("doubletap",[t.target]),n.doubleTap&&(m=n.doubleTap.call(Ee,t,t.target))):c==g&&(u!==C&&u!==E||(clearTimeout(De),Ae=null,Ee.trigger("longtap",[t.target]),n.longTap&&(m=n.longTap.call(Ee,t,t.target)))),m}function O(){var e=!0;return null!==n.threshold&&(e=de>=n.threshold),e}function U(){var e=!1;return null!==n.cancelThreshold&&null!==pe&&(e=ee(pe)-de>=n.cancelThreshold),e}function z(){return!(n.maxTimeThreshold&&ge>=n.maxTimeThreshold)}function F(){var e=$(),t=H(),i=null===n.pinchThreshold||_e>=n.pinchThreshold;return e&&t&&i}function V(){return!!(n.pinchStatus||n.pinchIn||n.pinchOut)}function q(){var e=z(),t=O(),n=$(),i=H();return!U()&&i&&n&&t&&e}function j(){return!!(n.swipe||n.swipeStatus||n.swipeLeft||n.swipeRight||n.swipeUp||n.swipeDown)}function $(){return Se===n.fingers||n.fingers===y||!S}function H(){return 0!==ke[0].end.x}function W(){return!!n.tap}function K(){return!!n.doubleTap}function G(){if(null==Ae)return!1;var e=oe();return K()&&e-Ae<=n.doubleTapThreshold}function Z(){Le=0,Ie=0}function Y(){var e=!1;return Le&&oe()-Le<=n.fingerReleaseThreshold&&(e=!0),e}function X(e){Ee&&(!0===e?(Ee.on(le,I),Ee.on(ue,A),ce&&Ee.on(ce,N)):(Ee.off(le,I,!1),Ee.off(ue,A,!1),ce&&Ee.off(ce,N,!1)),Ee.data(x+"_intouch",!0===e))}function Q(e,t){var n={start:{x:0,y:0},last:{x:0,y:0},end:{x:0,y:0}};return n.start.x=n.last.x=n.end.x=t.pageX||t.clientX,n.start.y=n.last.y=n.end.y=t.pageY||t.clientY,ke[e]=n,n}function J(e){var t=void 0!==e.identifier?e.identifier:0,n=function(e){return ke[e]||null}(t);return null===n&&(n=Q(t,e)),n.last.x=n.end.x,n.last.y=n.end.y,n.end.x=e.pageX||e.clientX,n.end.y=e.pageY||e.clientY,n}function ee(e){return we[e]?we[e].distance:void 0}function te(e){return{direction:e,distance:0}}function ne(){return xe-Te}function ie(e,t){var n=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return Math.round(Math.sqrt(n*n+i*i))}function re(e,t){if(s=t,(n=e).x==s.x&&n.y==s.y)return u;var n,s,l=function(e,t){var n=e.x-t.x,i=t.y-e.y,r=Math.atan2(i,n),o=Math.round(180*r/Math.PI);return 0>o&&(o=360-Math.abs(o)),o}(e,t);return 45>=l&&l>=0||360>=l&&l>=315?i:l>=135&&225>=l?r:l>45&&135>l?a:o}function oe(){return(new Date).getTime()}n=e.extend({},n);var ae=S||T||!n.fallbackToMouseEvents,se=ae?T?k?"MSPointerDown":"pointerdown":"touchstart":"mousedown",le=ae?T?k?"MSPointerMove":"pointermove":"touchmove":"mousemove",ue=ae?T?k?"MSPointerUp":"pointerup":"touchend":"mouseup",ce=ae?T?"mouseleave":null:"mouseleave",he=T?k?"MSPointerCancel":"pointercancel":"touchcancel",de=0,pe=null,fe=null,ge=0,me=0,ve=0,ye=1,_e=0,be=0,we=null,Ee=e(t),Ce="start",Se=0,ke={},Te=0,xe=0,Le=0,Ie=0,Ae=0,De=null,Ne=null;try{Ee.on(se,L),Ee.on(he,D)}catch(t){e.error("events not supported "+se+","+he+" on jQuery.swipe")}this.enable=function(){return this.disable(),Ee.on(se,L),Ee.on(he,D),Ee},this.disable=function(){return P(),Ee},this.destroy=function(){P(),Ee.data(x,null),Ee=null},this.option=function(t,i){if("object"==typeof t)n=e.extend(n,t);else if(void 0!==n[t]){if(void 0===i)return n[t];n[t]=i}else{if(!t)return n;e.error("Option "+t+" does not exist on jQuery.swipe.options")}return null}}var i="left",r="right",o="up",a="down",s="in",l="out",u="none",c="auto",h="swipe",d="pinch",p="tap",f="doubletap",g="longtap",m="horizontal",v="vertical",y="all",_=10,b="start",w="move",E="end",C="cancel",S="ontouchstart"in window,k=window.navigator.msPointerEnabled&&!window.PointerEvent&&!S,T=(window.PointerEvent||window.navigator.msPointerEnabled)&&!S,x="TouchSwipe";e.fn.swipe=function(n){var i=e(this),r=i.data(x);if(r&&"string"==typeof n){if(r[n])return r[n].apply(r,Array.prototype.slice.call(arguments,1));e.error("Method "+n+" does not exist on jQuery.swipe")}else if(r&&"object"==typeof n)r.option.apply(r,arguments);else if(!(r||"object"!=typeof n&&n))return t.apply(this,arguments);return i},e.fn.swipe.version="1.6.18",e.fn.swipe.defaults={fingers:1,threshold:75,cancelThreshold:null,pinchThreshold:20,maxTimeThreshold:null,fingerReleaseThreshold:250,longTapThreshold:500,doubleTapThreshold:200,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,click:null,tap:null,doubleTap:null,longTap:null,hold:null,triggerOnTouchEnd:!0,triggerOnTouchLeave:!1,allowPageScroll:"auto",fallbackToMouseEvents:!0,excludedElements:".noSwipe",preventDefaultEvents:!0},e.fn.swipe.phases={PHASE_START:b,PHASE_MOVE:w,PHASE_END:E,PHASE_CANCEL:C},e.fn.swipe.directions={LEFT:i,RIGHT:r,UP:o,DOWN:a,IN:s,OUT:l},e.fn.swipe.pageScroll={NONE:u,HORIZONTAL:m,VERTICAL:v,AUTO:c},e.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,ALL:y}}(e.exports?T:jQuery)})),{active:!1,current:null,activePages:[],init(){if(!this.form)throw new Error("Repeats module not correctly instantiated with form property.");if(this.form.view.html.classList.contains("pages")){const e=[...this.form.view.html.querySelectorAll(".question, .or-appearance-field-list")].concat([...this.form.view.html.querySelectorAll(".or-repeat.or-appearance-field-list + .or-repeat-info")]).filter(e=>!(e.parentElement.closest(".or-appearance-field-list")||e.matches(".question")&&e.querySelector("[data-for]"))).map(e=>(e.setAttribute("role","page"),e));if(e.length>0||e[0].classList.contains("or-repeat")){const t=this.form.view.html.parentNode;this.$formFooter=T(t.querySelector(".form-footer")),this.$btnFirst=this.$formFooter.find(".first-page"),this.$btnPrev=this.$formFooter.find(".previous-page"),this.$btnNext=this.$formFooter.find(".next-page"),this.$btnLast=this.$formFooter.find(".last-page"),this.$toc=T(t.querySelector(".pages-toc__list")),this._updateAllActive(e),this._updateToc(),this._toggleButtons(0),this._setButtonHandlers(),this._setRepeatHandlers(),this._setBranchHandlers(),this._setSwipeHandlers(),this._setTocHandlers(),this._setLangChangeHandlers(),this.active=!0,this._flipToFirst()}}},flipToPageContaining(e){let t;t=e.closest('[role="page"]'),t=0===t.length?e.find('[role="page"]'):t,t.length&&this._flipTo(t[0]),this.$toc.parent().find(".pages-toc__overlay").click()},_setButtonHandlers(){const e=this;this.$btnFirst.off(".pagemode").on("click.pagemode",()=>(e.form.pageNavigationBlocked||e._flipToFirst(),!1)),this.$btnPrev.off(".pagemode").on("click.pagemode",()=>(e.form.pageNavigationBlocked||e._prev(),!1)),this.$btnNext.off(".pagemode").on("click.pagemode",()=>(e.form.pageNavigationBlocked||e._next(),!1)),this.$btnLast.off(".pagemode").on("click.pagemode",()=>(e.form.pageNavigationBlocked||e._flipToLast(),!1))},_setSwipeHandlers(){if(!1===a.swipePage)return;const e=this,t=this.form.view.$.closest(".main");t.swipe("destroy"),t.swipe({allowPageScroll:"vertical",threshold:250,preventDefaultEvents:!1,swipeLeft(){e.$btnNext.click()},swipeRight(){e.$btnPrev.click()},swipeStatus(t,n){if("start"===n){const t=e._getCurrent()?e._getCurrent().querySelector(":focus"):null;t&&t.blur()}}})},_setTocHandlers(){const e=this;this.$toc.on("click","a",(function(){if(!e.form.pageNavigationBlocked&&this.parentElement&&this.parentElement.getAttribute("tocId")){const t=parseInt(this.parentElement.getAttribute("tocId"),10),n=e.form.toc.tocItems.find(e=>e.tocId===t);if(n&&n.element){const t=n.element;e.form.goToTarget(t)}}return!1})).parent().find(".pages-toc__overlay").on("click",()=>{e.$toc.parent().find("#toc-toggle").prop("checked",!1)})},_setRepeatHandlers(){this.form.view.html.addEventListener(yt.AddRepeat().type,e=>{this._updateAllActive(),"user"===e.detail.trigger||this.activePages[0]===e.target||Nn(this.activePages[0],".or-repeat").includes(e.target)?this.flipToPageContaining(T(e.target)):this._toggleButtons()}),this.form.view.html.addEventListener(yt.RemoveRepeat().type,e=>{if(this.current&&!this.current.closest("html")){this._updateAllActive();let t=T(e.target).prev();0===t.length&&(t=T(e.target)),this.flipToPageContaining(t)}})},_setBranchHandlers(){const e=this;this.form.view.$.on("changebranch.pagemode",()=>{e._updateAllActive(),e.activePages.includes(e.current)||e._next(),e._toggleButtons()})},_setLangChangeHandlers(){this.form.view.html.addEventListener(yt.ChangeLanguage().type,()=>{this._updateToc()})},_getCurrent(){return this.current},_updateAllActive(e){e=e||[...this.form.view.html.querySelectorAll('[role="page"]')],this.activePages=e.filter(e=>!e.closest(".disabled")&&(e.matches(".question")||e.querySelector(".question:not(.disabled)")||e.matches(".or-repeat-info")&&0===An(e,".or-repeat").length)),this._updateToc()},_getPrev(e){return this.activePages[e-1]},_getNext(e){return this.activePages[e+1]},_getCurrentIndex(){return this.activePages.findIndex(e=>e===this.current)},_next(){const e=this;let t,n;return t=this._getCurrentIndex(),n=!1!==a.validatePage&&this.current?this.form.validateContent(T(this.current)):Promise.resolve(!0),n.then(n=>{let i,r;return!!n&&(i=e._getNext(t),i&&(r=t+1,e._flipTo(i,r)),!0)})},_prev(){const e=this._getCurrentIndex(),t=this._getPrev(e);t&&this._flipTo(t,e-1)},_setToCurrent(e){e.classList.add("current","hidden"),e.classList.remove("hidden"),Nn(e,".or-group, .or-group-data, .or-repeat",".or").forEach(e=>e.classList.add("contains-current")),this.current=e},_flipTo(e,t){this.current&&this.current.closest("html")?this.current!==e&&(this.current.classList.remove("current","fade-out"),Nn(this.current,".or-group, .or-group-data, .or-repeat",".or").forEach(e=>e.classList.remove("contains-current")),this._setToCurrent(e),this._focusOnFirstQuestion(e),this._toggleButtons(t),e.dispatchEvent(yt.PageFlip())):e&&(this._setToCurrent(e),this._focusOnFirstQuestion(e),this._toggleButtons(t),e.dispatchEvent(yt.PageFlip()))},_flipToFirst(){this._flipTo(this.activePages[0])},_flipToLast(){this._flipTo(this.activePages[this.activePages.length-1])},_focusOnFirstQuestion(e){T(e).find(".question:not(.disabled)").addBack(".question:not(.disabled)").filter((function(){return 0===T(this).parentsUntil(".or",".disabled").length})).eq(0).find("input, select, textarea").eq(0).trigger("fakefocus"),e.scrollIntoView()},_toggleButtons(e=this._getCurrentIndex()){const t=this._getNext(e),n=this._getPrev(e);this.$btnNext.add(this.$btnLast).toggleClass("disabled",!t),this.$btnPrev.add(this.$btnFirst).toggleClass("disabled",!n),this.$formFooter.toggleClass("end",!t)},_updateToc(){this.$toc.length&&(this.$toc.empty()[0].append(this.form.toc.getHtmlFragment()),this.$toc.closest(".pages-toc").removeClass("hide"))}}),mi={update(e,t){let n;if(!this.form)throw new Error("Branch module not correctly instantiated with form property.");n=this.form.getRelatedNodes("data-relevant","",e),this.updateNodes(n,t)},updateNodes(e,t){let n,i,r,o,a,s;const l={},u=[];let c=!1;const h=this,d=this.form.repeatsPresent&&this.form.view.html.querySelector(".or-repeat.clone");e.each((function(){const e=T(this);let p,f,g,m;-1===u.indexOf(e.attr("name"))&&(i=e.closest(".or-branch"),n={},s=null,n.relevant=h.form.input.getRelevant(this),n.path=h.form.input.getName(this),1===i.length?(g=n.path.split("/"),g.length>3&&(m=g.splice(0,g.length-1).join("/"),f=h.form.view.$.find(`.or-group[name="${m}"],.or-group-data[name="${m}"]`).filter((function(){const e=T(this);return e.children(".or-repeat").length>0||0===e.children(".or-repeat-info").length})),0===f.length)||(o=d&&i.parentsUntil(".or",".or-repeat").length>0,a=d&&i.parentsUntil(".or",".or-repeat.clone").length>0,p=e.children(`.or-repeat-info[data-name="${n.path}"]`).length&&!e.children(`.or-repeat[name="${n.path}"]`).length?null:n.path,n.ind=p&&a?h.form.input.getIndex(this):0,-1===n.relevant.indexOf("..")&&(s=o?`${n.relevant}__${n.path.substring(0,n.path.lastIndexOf("/"))}__${n.ind}`:n.relevant),s&&void 0!==l[s]?r=l[s]:(r=h.evaluate(n.relevant,p,n.ind),l[s]=r),o||u.push(this.getAttribute("name")),!0===h.process(i,n.path,r,t)&&(c=!0))):0===e.parentsUntil(".or","#or-calculated-items").length&&console.error("could not find branch node for ",this))})),c&&this.form.view.$.trigger("changebranch")},evaluate(e,t,n){return this.form.model.evaluate(e,"boolean",t,n)},process(e,t,n,i){return!0===n?this.enable(e,t):this.disable(e,t,i)},selfRelevant:e=>!e.hasClass("disabled")&&!e.hasClass("pre-init"),enable(e,t){let n=!1;return this.selfRelevant(e)||(n=!0,e.removeClass("disabled pre-init"),this.form.calc.update({relevantPath:t}),this.form.itemset.update({relevantPath:t}),this.form.output.update(),this.form.widgets.enable(e[0]),this.activate(e)),n},disable(e,t,n){const i=e.hasClass("pre-init");let r=!1;return(i||this.selfRelevant(e)||n)&&(r=!0,i?e.removeClass("pre-init"):n&&this.clear(e,t),this.deactivate(e)),r},clear(e,t){e.clearInputs("change",yt.InputUpdate().type),e.is(".or-group, .or-group-data")&&this.form.calc.update({relevantPath:t})},setDisabledProperty(e,t){const n=e.prop("nodeName").toLowerCase();"label"===n?e.children("input, select, textarea").prop("disabled",t):"fieldset"===n||"section"===n?e.prop("disabled",t):e.find("fieldset, input, select, textarea").prop("disabled",t)},activate(e){this.setDisabledProperty(e,!1)},deactivate(e){e.addClass("disabled"),this.form.widgets.disable(e[0]),this.setDisabledProperty(e,!0)}},vi={status:0,lastChanged:null,all:null,updateTotal(){this.all=[...this.form.view.html.querySelectorAll(".question:not(.disabled):not(.or-appearance-comment):not(.or-appearance-dn):not(.readonly)")].filter(e=>!e.closest(".disabled"))},update(e){let t;this.all&&e||this.updateTotal(),this.lastChanged=e||this.lastChanged,this.lastChanged&&(t=Math.round(100*(this.all.indexOf(this.lastChanged.closest(".question"))+1)/this.all.length)),t>0&&t!==this.status&&(this.status=t,this.form.view.html.dispatchEvent(yt.ProgressUpdate(t)))},get(){return this.status}};const yi=document.createRange();class Widget{constructor(e,t){return this.element=e,this.options=t||{},this.question=e.closest(".question"),this._props=this._getProps(),this._init()||this}_init(){this.value=this.originalInputValue}_getProps(){const e=this;return{get readonly(){return"select"===e.element.nodeName.toLowerCase()?e.element.hasAttribute("readonly"):!!e.element.readOnly},appearances:[...this.element.closest(".question, form.or").classList].filter(e=>0===e.indexOf("or-appearance-")).map(e=>e.substring(14)),multiple:!!this.element.multiple,disabled:!!this.element.disabled,type:this.element.getAttribute("data-type-xml")}}disable(){}enable(){}update(){}get props(){return this._props}get resetButtonHtml(){return yi.createContextualFragment('<button\n                type="button"\n                class="btn-icon-only btn-reset"\n                aria-label="reset">\n                <i class="icon icon-refresh"> </i>\n            </button>')}get downloadButtonHtml(){return yi.createContextualFragment('<a\n                class="btn-icon-only btn-download"\n                aria-label="download"\n                download\n                href=""><i class="icon icon-download"> </i></a>')}get value(){}set value(e){}get originalInputValue(){return ui.getVal(this.element)}set originalInputValue(e){ui.setVal(this.element,e,null),this.element.dispatchEvent(yt.Change())}static get name(){return this.constructor.name}static get list(){return!1}static condition(){return!0}}const _i="[data-toggle=dropdown]",bi=function(e){T(e).on("click.bs.dropdown",this.toggle)};function wi(e){T(".dropdown-backdrop").remove(),T(_i).each((function(){const t=Ei(T(this)),n={relatedTarget:this};t.hasClass("open")&&(t.trigger(e=T.Event("hide.bs.dropdown",n)),e.isDefaultPrevented()||t.removeClass("open").trigger("hidden.bs.dropdown",n))}))}function Ei(e){let t=e.attr("data-target");t||(t=e.attr("href"),t=t&&/#[A-Za-z]/.test(t)&&t.replace(/.*(?=#[^\s]*$)/,""));const n=t&&T(t);return n&&n.length?n:e.parent()}bi.prototype.toggle=function(e){const t=T(this);if(t.is(".disabled, :disabled"))return;const n=Ei(t),i=n.hasClass("open");if(wi(),!i){"ontouchstart"in document.documentElement&&!n.closest(".navbar-nav").length&&T('<div class="dropdown-backdrop"/>').insertAfter(T(this)).on("click",wi);const i={relatedTarget:this};if(n.trigger(e=T.Event("show.bs.dropdown",i)),e.isDefaultPrevented())return;n.toggleClass("open").trigger("shown.bs.dropdown",i),t.focus()}return!1},bi.prototype.keydown=function(e){if(!/^(38|40|27)$/.test(e.keyCode))return;const t=T(this);if(e.preventDefault(),e.stopPropagation(),t.is(".disabled, :disabled"))return;const n=Ei(t),i=n.hasClass("open");if(!i||i&&27===e.keyCode)return 27===e.which&&n.find(_i).focus(),t.click();const r=" li:not(.divider):visible a",o=n.find(`[role=menu]${r}, [role=listbox]${r}`);if(!o.length)return;let a=o.index(o.filter(":focus"));38===e.keyCode&&a>0&&a--,40===e.keyCode&&a<o.length-1&&a++,~a||(a=0),o.eq(a).focus()};const Ci=T.fn.dropdown;T.fn.dropdown=function(e){return this.each((function(){const t=T(this),n=t.data("bs.dropdown");n||t.data("bs.dropdown",new bi(this)),"string"==typeof e&&n[e].call(t)}))},T.fn.dropdown.Constructor=bi,T.fn.dropdown.noConflict=function(){return T.fn.dropdown=Ci,this},T(document).on("click.bs.dropdown.data-api",wi).on("click.bs.dropdown.data-api",".dropdown form",e=>{e.stopPropagation()}).on("click.bs.dropdown.data-api",_i,bi.prototype.toggle).on("keydown.bs.dropdown.data-api",_i+", [role=menu], [role=listbox]",bi.prototype.keydown);const Si=document.createRange();const ki="relevantDropdown";function Ti(e,t,n){this.namespace=ki,this.element=e,this.options=T.extend({fadeOutSpeed:"normal",change:null},t),n&&(n.stopPropagation(),n.preventDefault()),this._init()}T.expr[":"].RD_contains=T.expr.createPseudo(e=>t=>T(t).text().toUpperCase().indexOf(e.toUpperCase())>=0),Ti.prototype._init=function(){const e=T(this.element);this.listId=e.attr("list"),this.$fakeDatalist=T("<ul />",{class:"datalist widget",id:this.listId}).appendTo(e.parent()),this._updateFakeDatalist(),this._setEventListeners()},Ti.prototype._updateFakeDatalist=function(){const e=T("#"+this.listId),t=document.createDocumentFragment();this.$fakeDatalist.empty(),e.find("option").each((function(){const e=T("<li />",{text:T(this).val()})[0];t.appendChild(e)})),this.$fakeDatalist.append(t),this.$fakeDatalistItems=this.$fakeDatalist.find("li")},Ti.prototype._setEventListeners=function(){const e=this,t=T(this.element);let n,i=0;t.on("focus",()=>{e.$fakeDatalist.scrollTop(0),i=0}).on("blur",()=>{setTimeout(()=>{e.$fakeDatalist.fadeOut(e.options.fadeOutSpeed),e.$fakeDatalistItems.removeClass("active")},500)}).on("keyup",(function(i){n=t.position(),e.$fakeDatalist.show().css({top:n.top+T(this).outerHeight(),left:n.left,width:t.outerWidth()}),e.$fakeDatalistItems.hide(),e.$fakeDatalist.find(`li:RD_contains("${t.val()}")`).show()})),this.$fakeDatalist.on("mouseenter","li",(function(){T(this).addClass("active").siblings().removeClass("active")})).on("mouseleave","li",(function(){T(this).removeClass("active")})),T(window).resize((function(){n=t.position(),e.$fakeDatalist.css({top:n.top+T(this).outerHeight(),left:n.left,width:t.outerWidth()})})),t.on("keydown",n=>{const r=e.$fakeDatalist.find("li.active"),o=e.$fakeDatalist.outerHeight(),a=e.$fakeDatalistItems.outerHeight();if(38==n.keyCode&&r.length&&(prevAll=r.prevAll("li:visible"),prevAll.length>0&&(r.removeClass("active"),prevAll.eq(0).addClass("active")),prevAll.length&&prevAll.position().top<0&&i>0&&e.$fakeDatalist.scrollTop(i-=a)),40==n.keyCode)if(r.length){const t=r.nextAll("li:visible");t.length>0&&(r.removeClass("active"),t.eq(0).addClass("active")),t.length&&t.position().top+a>=o&&e.$fakeDatalist.stop().animate({scrollTop:i+=a},200)}else e.$fakeDatalistItems.removeClass("active"),e.$fakeDatalist.find("li:visible:first").addClass("active");13!=n.keyCode&&9!=n.keyCode||(r.length&&t.val(r.text()).trigger("input"),e.$fakeDatalist.fadeOut(e.options.fadeOutSpeed),e.$fakeDatalistItems.removeClass("active")),13!=n.keyCode&&38!=n.keyCode&&40!=n.keyCode&&(e.$fakeDatalistItems.removeClass("active"),e.$fakeDatalist.find("li:visible:first").addClass("active"),e.$fakeDatalist.scrollTop(0),i=0)}),this.$fakeDatalist.on("click","li",(function(){T("li.active").length&&t.val(T(this).text()).trigger("input"),e.$fakeDatalist.fadeOut(e.options.fadeOutSpeed),e.$fakeDatalistItems.removeClass("active")}))},Ti.prototype.update=function(){this._updateFakeDatalist()},T.fn[ki]=function(e,t){return e=e||{},this.each((function(){const n=T(this);let i=n.data(ki);i||"object"!=typeof e?i&&"string"==typeof e&&i[e](this):n.data(ki,i=new Ti(this,e,t))}))};const xi=!("list"in document.createElement("input")&&"options"in document.createElement("datalist")&&void 0!==window.HTMLDataListElement);var Li=u((function(e,t){
/* @preserve
     * Leaflet 1.6.0, a JS library for interactive maps. http://leafletjs.com
     * (c) 2010-2019 Vladimir Agafonkin, (c) 2010-2011 CloudMade
     */
!function(e){var t=Object.freeze;function n(e){var t,n,i,r;for(n=1,i=arguments.length;n<i;n++)for(t in r=arguments[n])e[t]=r[t];return e}Object.freeze=function(e){return e};var i=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}();function r(e,t){var n=Array.prototype.slice;if(e.bind)return e.bind.apply(e,n.call(arguments,1));var i=n.call(arguments,2);return function(){return e.apply(t,i.length?i.concat(n.call(arguments)):arguments)}}var o=0;function a(e){return e._leaflet_id=e._leaflet_id||++o,e._leaflet_id}function s(e,t,n){var i,r,o,a;return a=function(){i=!1,r&&(o.apply(n,r),r=!1)},o=function(){i?r=arguments:(e.apply(n,arguments),setTimeout(a,t),i=!0)}}function l(e,t,n){var i=t[1],r=t[0],o=i-r;return e===i&&n?e:((e-r)%o+o)%o+r}function u(){return!1}function c(e,t){var n=Math.pow(10,void 0===t?6:t);return Math.round(e*n)/n}function h(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function d(e){return h(e).split(/\s+/)}function p(e,t){for(var n in e.hasOwnProperty("options")||(e.options=e.options?i(e.options):{}),t)e.options[n]=t[n];return e.options}function f(e,t,n){var i=[];for(var r in e)i.push(encodeURIComponent(n?r.toUpperCase():r)+"="+encodeURIComponent(e[r]));return(t&&-1!==t.indexOf("?")?"&":"?")+i.join("&")}var g=/\{ *([\w_-]+) *\}/g;function m(e,t){return e.replace(g,(function(e,n){var i=t[n];if(void 0===i)throw new Error("No value provided for variable "+e);return"function"==typeof i&&(i=i(t)),i}))}var v=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function y(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}var _="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function b(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var w=0;function E(e){var t=+new Date,n=Math.max(0,16-(t-w));return w=t+n,window.setTimeout(e,n)}var C=window.requestAnimationFrame||b("RequestAnimationFrame")||E,S=window.cancelAnimationFrame||b("CancelAnimationFrame")||b("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function k(e,t,n){if(!n||C!==E)return C.call(window,r(e,t));e.call(t)}function T(e){e&&S.call(window,e)}var x=(Object.freeze||Object)({freeze:t,extend:n,create:i,bind:r,lastId:o,stamp:a,throttle:s,wrapNum:l,falseFn:u,formatNum:c,trim:h,splitWords:d,setOptions:p,getParamString:f,template:m,isArray:v,indexOf:y,emptyImageUrl:_,requestFn:C,cancelFn:S,requestAnimFrame:k,cancelAnimFrame:T});function I(){}I.extend=function(e){var t=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},r=t.__super__=this.prototype,o=i(r);for(var a in o.constructor=t,t.prototype=o,this)this.hasOwnProperty(a)&&"prototype"!==a&&"__super__"!==a&&(t[a]=this[a]);return e.statics&&(n(t,e.statics),delete e.statics),e.includes&&(function(e){if("undefined"!=typeof L&&L&&L.Mixin){e=v(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(e.includes),n.apply(null,[o].concat(e.includes)),delete e.includes),o.options&&(e.options=n(i(o.options),e.options)),n(o,e),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){r.callInitHooks&&r.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=o._initHooks.length;e<t;e++)o._initHooks[e].call(this)}},t},I.include=function(e){return n(this.prototype,e),this},I.mergeOptions=function(e){return n(this.prototype.options,e),this},I.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),n="function"==typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};var A={on:function(e,t,n){if("object"==typeof e)for(var i in e)this._on(i,e[i],t);else for(var r=0,o=(e=d(e)).length;r<o;r++)this._on(e[r],t,n);return this},off:function(e,t,n){if(e)if("object"==typeof e)for(var i in e)this._off(i,e[i],t);else for(var r=0,o=(e=d(e)).length;r<o;r++)this._off(e[r],t,n);else delete this._events;return this},_on:function(e,t,n){this._events=this._events||{};var i=this._events[e];i||(i=[],this._events[e]=i),n===this&&(n=void 0);for(var r={fn:t,ctx:n},o=i,a=0,s=o.length;a<s;a++)if(o[a].fn===t&&o[a].ctx===n)return;o.push(r)},_off:function(e,t,n){var i,r,o;if(this._events&&(i=this._events[e]))if(t){if(n===this&&(n=void 0),i)for(r=0,o=i.length;r<o;r++){var a=i[r];if(a.ctx===n&&a.fn===t)return a.fn=u,this._firingCount&&(this._events[e]=i=i.slice()),void i.splice(r,1)}}else{for(r=0,o=i.length;r<o;r++)i[r].fn=u;delete this._events[e]}},fire:function(e,t,i){if(!this.listens(e,i))return this;var r=n({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var o=this._events[e];if(o){this._firingCount=this._firingCount+1||1;for(var a=0,s=o.length;a<s;a++){var l=o[a];l.fn.call(l.ctx||this,r)}this._firingCount--}}return i&&this._propagateEvent(r),this},listens:function(e,t){var n=this._events&&this._events[e];if(n&&n.length)return!0;if(t)for(var i in this._eventParents)if(this._eventParents[i].listens(e,t))return!0;return!1},once:function(e,t,n){if("object"==typeof e){for(var i in e)this.once(i,e[i],t);return this}var o=r((function(){this.off(e,t,n).off(e,o,n)}),this);return this.on(e,t,n).on(e,o,n)},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[a(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[a(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,n({layer:e.target,propagatedFrom:e.target},e),!0)}};A.addEventListener=A.on,A.removeEventListener=A.clearAllEventListeners=A.off,A.addOneTimeEventListener=A.once,A.fireEvent=A.fire,A.hasEventListeners=A.listens;var D=I.extend(A);function N(e,t,n){this.x=n?Math.round(e):e,this.y=n?Math.round(t):t}var P=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};function B(e,t,n){return e instanceof N?e:v(e)?new N(e[0],e[1]):null==e?e:"object"==typeof e&&"x"in e&&"y"in e?new N(e.x,e.y):new N(e,t,n)}function R(e,t){if(e)for(var n=t?[e,t]:e,i=0,r=n.length;i<r;i++)this.extend(n[i])}function M(e,t){return!e||e instanceof R?e:new R(e,t)}function O(e,t){if(e)for(var n=t?[e,t]:e,i=0,r=n.length;i<r;i++)this.extend(n[i])}function U(e,t){return e instanceof O?e:new O(e,t)}function z(e,t,n){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,void 0!==n&&(this.alt=+n)}function F(e,t,n){return e instanceof z?e:v(e)&&"object"!=typeof e[0]?3===e.length?new z(e[0],e[1],e[2]):2===e.length?new z(e[0],e[1]):null:null==e?e:"object"==typeof e&&"lat"in e?new z(e.lat,"lng"in e?e.lng:e.lon,e.alt):void 0===t?null:new z(e,t,n)}N.prototype={clone:function(){return new N(this.x,this.y)},add:function(e){return this.clone()._add(B(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(B(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new N(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new N(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=P(this.x),this.y=P(this.y),this},distanceTo:function(e){var t=(e=B(e)).x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},equals:function(e){return(e=B(e)).x===this.x&&e.y===this.y},contains:function(e){return e=B(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+c(this.x)+", "+c(this.y)+")"}},R.prototype={extend:function(e){return e=B(e),this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(e.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(e.y,this.max.y)):(this.min=e.clone(),this.max=e.clone()),this},getCenter:function(e){return new N((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return new N(this.min.x,this.max.y)},getTopRight:function(){return new N(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,n;return(e="number"==typeof e[0]||e instanceof N?B(e):M(e))instanceof R?(t=e.min,n=e.max):t=n=e,t.x>=this.min.x&&n.x<=this.max.x&&t.y>=this.min.y&&n.y<=this.max.y},intersects:function(e){e=M(e);var t=this.min,n=this.max,i=e.min,r=e.max,o=r.x>=t.x&&i.x<=n.x,a=r.y>=t.y&&i.y<=n.y;return o&&a},overlaps:function(e){e=M(e);var t=this.min,n=this.max,i=e.min,r=e.max,o=r.x>t.x&&i.x<n.x,a=r.y>t.y&&i.y<n.y;return o&&a},isValid:function(){return!(!this.min||!this.max)}},O.prototype={extend:function(e){var t,n,i=this._southWest,r=this._northEast;if(e instanceof z)t=e,n=e;else{if(!(e instanceof O))return e?this.extend(F(e)||U(e)):this;if(t=e._southWest,n=e._northEast,!t||!n)return this}return i||r?(i.lat=Math.min(t.lat,i.lat),i.lng=Math.min(t.lng,i.lng),r.lat=Math.max(n.lat,r.lat),r.lng=Math.max(n.lng,r.lng)):(this._southWest=new z(t.lat,t.lng),this._northEast=new z(n.lat,n.lng)),this},pad:function(e){var t=this._southWest,n=this._northEast,i=Math.abs(t.lat-n.lat)*e,r=Math.abs(t.lng-n.lng)*e;return new O(new z(t.lat-i,t.lng-r),new z(n.lat+i,n.lng+r))},getCenter:function(){return new z((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new z(this.getNorth(),this.getWest())},getSouthEast:function(){return new z(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){e="number"==typeof e[0]||e instanceof z||"lat"in e?F(e):U(e);var t,n,i=this._southWest,r=this._northEast;return e instanceof O?(t=e.getSouthWest(),n=e.getNorthEast()):t=n=e,t.lat>=i.lat&&n.lat<=r.lat&&t.lng>=i.lng&&n.lng<=r.lng},intersects:function(e){e=U(e);var t=this._southWest,n=this._northEast,i=e.getSouthWest(),r=e.getNorthEast(),o=r.lat>=t.lat&&i.lat<=n.lat,a=r.lng>=t.lng&&i.lng<=n.lng;return o&&a},overlaps:function(e){e=U(e);var t=this._southWest,n=this._northEast,i=e.getSouthWest(),r=e.getNorthEast(),o=r.lat>t.lat&&i.lat<n.lat,a=r.lng>t.lng&&i.lng<n.lng;return o&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return!!e&&(e=U(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t))},isValid:function(){return!(!this._southWest||!this._northEast)}},z.prototype={equals:function(e,t){return!!e&&(e=F(e),Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng))<=(void 0===t?1e-9:t))},toString:function(e){return"LatLng("+c(this.lat,e)+", "+c(this.lng,e)+")"},distanceTo:function(e){return j.distance(this,F(e))},wrap:function(){return j.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return U([this.lat-t,this.lng-n],[this.lat+t,this.lng+n])},clone:function(){return new z(this.lat,this.lng,this.alt)}};var V,q={latLngToPoint:function(e,t){var n=this.projection.project(e),i=this.scale(t);return this.transformation._transform(n,i)},pointToLatLng:function(e,t){var n=this.scale(t),i=this.transformation.untransform(e,n);return this.projection.unproject(i)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,n=this.scale(e);return new R(this.transformation.transform(t.min,n),this.transformation.transform(t.max,n))},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?l(e.lng,this.wrapLng,!0):e.lng;return new z(this.wrapLat?l(e.lat,this.wrapLat,!0):e.lat,t,e.alt)},wrapLatLngBounds:function(e){var t=e.getCenter(),n=this.wrapLatLng(t),i=t.lat-n.lat,r=t.lng-n.lng;if(0===i&&0===r)return e;var o=e.getSouthWest(),a=e.getNorthEast();return new O(new z(o.lat-i,o.lng-r),new z(a.lat-i,a.lng-r))}},j=n({},q,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var n=Math.PI/180,i=e.lat*n,r=t.lat*n,o=Math.sin((t.lat-e.lat)*n/2),a=Math.sin((t.lng-e.lng)*n/2),s=o*o+Math.cos(i)*Math.cos(r)*a*a,l=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*l}}),$={R:6378137,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,n=this.MAX_LATITUDE,i=Math.max(Math.min(n,e.lat),-n),r=Math.sin(i*t);return new N(this.R*e.lng*t,this.R*Math.log((1+r)/(1-r))/2)},unproject:function(e){var t=180/Math.PI;return new z((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:(V=6378137*Math.PI,new R([-V,-V],[V,V]))};function H(e,t,n,i){if(v(e))return this._a=e[0],this._b=e[1],this._c=e[2],void(this._d=e[3]);this._a=e,this._b=t,this._c=n,this._d=i}function W(e,t,n,i){return new H(e,t,n,i)}H.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new N((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};var K=n({},j,{code:"EPSG:3857",projection:$,transformation:function(){var e=.5/(Math.PI*$.R);return W(e,.5,-e,.5)}()}),G=n({},K,{code:"EPSG:900913"});function Z(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Y(e,t){var n,i,r,o,a,s,l="";for(n=0,r=e.length;n<r;n++){for(i=0,o=(a=e[n]).length;i<o;i++)l+=(i?"L":"M")+(s=a[i]).x+" "+s.y;l+=t?Le?"z":"x":""}return l||"M0 0"}var X=document.documentElement.style,Q="ActiveXObject"in window,J=Q&&!document.addEventListener,ee="msLaunchUri"in navigator&&!("documentMode"in document),te=Ae("webkit"),ne=Ae("android"),ie=Ae("android 2")||Ae("android 3"),re=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),oe=ne&&Ae("Google")&&re<537&&!("AudioNode"in window),ae=!!window.opera,se=Ae("chrome"),le=Ae("gecko")&&!te&&!ae&&!Q,ue=!se&&Ae("safari"),ce=Ae("phantom"),he="OTransition"in X,de=0===navigator.platform.indexOf("Win"),pe=Q&&"transition"in X,fe="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ie,ge="MozPerspective"in X,me=!window.L_DISABLE_3D&&(pe||fe||ge)&&!he&&!ce,ve="undefined"!=typeof orientation||Ae("mobile"),ye=ve&&te,_e=ve&&fe,be=!window.PointerEvent&&window.MSPointerEvent,we=!(te||!window.PointerEvent&&!be),Ee=!window.L_NO_TOUCH&&(we||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),Ce=ve&&ae,Se=ve&&le,ke=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Te=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",u,t),window.removeEventListener("testPassiveEventSupport",u,t)}catch(e){}return e},xe=!!document.createElement("canvas").getContext,Le=!(!document.createElementNS||!Z("svg").createSVGRect),Ie=!Le&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"==typeof t.adj}catch(e){return!1}}();function Ae(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var De=(Object.freeze||Object)({ie:Q,ielt9:J,edge:ee,webkit:te,android:ne,android23:ie,androidStock:oe,opera:ae,chrome:se,gecko:le,safari:ue,phantom:ce,opera12:he,win:de,ie3d:pe,webkit3d:fe,gecko3d:ge,any3d:me,mobile:ve,mobileWebkit:ye,mobileWebkit3d:_e,msPointer:be,pointer:we,touch:Ee,mobileOpera:Ce,mobileGecko:Se,retina:ke,passiveEvents:Te,canvas:xe,svg:Le,vml:Ie}),Ne=be?"MSPointerDown":"pointerdown",Pe=be?"MSPointerMove":"pointermove",Be=be?"MSPointerUp":"pointerup",Re=be?"MSPointerCancel":"pointercancel",Me=["INPUT","SELECT","OPTION"],Oe={},Ue=!1,ze=0;function Fe(e,t,n,i){return"touchstart"===t?function(e,t,n){var i=r((function(e){if("mouse"!==e.pointerType&&e.MSPOINTER_TYPE_MOUSE&&e.pointerType!==e.MSPOINTER_TYPE_MOUSE){if(!(Me.indexOf(e.target.tagName)<0))return;Ot(e)}$e(e,t)}));e["_leaflet_touchstart"+n]=i,e.addEventListener(Ne,i,!1),Ue||(document.documentElement.addEventListener(Ne,Ve,!0),document.documentElement.addEventListener(Pe,qe,!0),document.documentElement.addEventListener(Be,je,!0),document.documentElement.addEventListener(Re,je,!0),Ue=!0)}(e,n,i):"touchmove"===t?function(e,t,n){var i=function(e){(e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType||0!==e.buttons)&&$e(e,t)};e["_leaflet_touchmove"+n]=i,e.addEventListener(Pe,i,!1)}(e,n,i):"touchend"===t&&function(e,t,n){var i=function(e){$e(e,t)};e["_leaflet_touchend"+n]=i,e.addEventListener(Be,i,!1),e.addEventListener(Re,i,!1)}(e,n,i),this}function Ve(e){Oe[e.pointerId]=e,ze++}function qe(e){Oe[e.pointerId]&&(Oe[e.pointerId]=e)}function je(e){delete Oe[e.pointerId],ze--}function $e(e,t){for(var n in e.touches=[],Oe)e.touches.push(Oe[n]);e.changedTouches=[e],t(e)}var He=be?"MSPointerDown":we?"pointerdown":"touchstart",We=be?"MSPointerUp":we?"pointerup":"touchend",Ke="_leaflet_";function Ge(e,t,n){var i,r,o=!1;function a(e){var t;if(we){if(!ee||"mouse"===e.pointerType)return;t=ze}else t=e.touches.length;if(!(t>1)){var n=Date.now(),a=n-(i||n);r=e.touches?e.touches[0]:e,o=a>0&&a<=250,i=n}}function s(e){if(o&&!r.cancelBubble){if(we){if(!ee||"mouse"===e.pointerType)return;var n,a,s={};for(a in r)n=r[a],s[a]=n&&n.bind?n.bind(r):n;r=s}r.type="dblclick",r.button=0,t(r),i=null}}return e[Ke+He+n]=a,e[Ke+We+n]=s,e[Ke+"dblclick"+n]=t,e.addEventListener(He,a,!!Te&&{passive:!1}),e.addEventListener(We,s,!!Te&&{passive:!1}),e.addEventListener("dblclick",t,!1),this}function Ze(e,t){var n=e[Ke+He+t],i=e[Ke+We+t],r=e[Ke+"dblclick"+t];return e.removeEventListener(He,n,!!Te&&{passive:!1}),e.removeEventListener(We,i,!!Te&&{passive:!1}),ee||e.removeEventListener("dblclick",r,!1),this}var Ye,Xe,Qe,Je,et,tt=vt(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),nt=vt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),it="webkitTransition"===nt||"OTransition"===nt?nt+"End":"transitionend";function rt(e){return"string"==typeof e?document.getElementById(e):e}function ot(e,t){var n=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!n||"auto"===n)&&document.defaultView){var i=document.defaultView.getComputedStyle(e,null);n=i?i[t]:null}return"auto"===n?null:n}function at(e,t,n){var i=document.createElement(e);return i.className=t||"",n&&n.appendChild(i),i}function st(e){var t=e.parentNode;t&&t.removeChild(e)}function lt(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function ut(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function ct(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function ht(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=gt(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function dt(e,t){if(void 0!==e.classList)for(var n=d(t),i=0,r=n.length;i<r;i++)e.classList.add(n[i]);else if(!ht(e,t)){var o=gt(e);ft(e,(o?o+" ":"")+t)}}function pt(e,t){void 0!==e.classList?e.classList.remove(t):ft(e,h((" "+gt(e)+" ").replace(" "+t+" "," ")))}function ft(e,t){void 0===e.className.baseVal?e.className=t:e.className.baseVal=t}function gt(e){return e.correspondingElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function mt(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&function(e,t){var n=!1,i="DXImageTransform.Microsoft.Alpha";try{n=e.filters.item(i)}catch(e){if(1===t)return}t=Math.round(100*t),n?(n.Enabled=100!==t,n.Opacity=t):e.style.filter+=" progid:"+i+"(opacity="+t+")"}(e,t)}function vt(e){for(var t=document.documentElement.style,n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1}function yt(e,t,n){var i=t||new N(0,0);e.style[tt]=(pe?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(n?" scale("+n+")":"")}function _t(e,t){e._leaflet_pos=t,me?yt(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function bt(e){return e._leaflet_pos||new N(0,0)}if("onselectstart"in document)Ye=function(){It(window,"selectstart",Ot)},Xe=function(){Dt(window,"selectstart",Ot)};else{var wt=vt(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Ye=function(){if(wt){var e=document.documentElement.style;Qe=e[wt],e[wt]="none"}},Xe=function(){wt&&(document.documentElement.style[wt]=Qe,Qe=void 0)}}function Et(){It(window,"dragstart",Ot)}function Ct(){Dt(window,"dragstart",Ot)}function St(e){for(;-1===e.tabIndex;)e=e.parentNode;e.style&&(kt(),Je=e,et=e.style.outline,e.style.outline="none",It(window,"keydown",kt))}function kt(){Je&&(Je.style.outline=et,Je=void 0,et=void 0,Dt(window,"keydown",kt))}function Tt(e){do{e=e.parentNode}while(!(e.offsetWidth&&e.offsetHeight||e===document.body));return e}function xt(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var Lt=(Object.freeze||Object)({TRANSFORM:tt,TRANSITION:nt,TRANSITION_END:it,get:rt,getStyle:ot,create:at,remove:st,empty:lt,toFront:ut,toBack:ct,hasClass:ht,addClass:dt,removeClass:pt,setClass:ft,getClass:gt,setOpacity:mt,testProp:vt,setTransform:yt,setPosition:_t,getPosition:bt,disableTextSelection:Ye,enableTextSelection:Xe,disableImageDrag:Et,enableImageDrag:Ct,preventOutline:St,restoreOutline:kt,getSizedParentNode:Tt,getScale:xt});function It(e,t,n,i){if("object"==typeof t)for(var r in t)Nt(e,r,t[r],n);else for(var o=0,a=(t=d(t)).length;o<a;o++)Nt(e,t[o],n,i);return this}var At="_leaflet_events";function Dt(e,t,n,i){if("object"==typeof t)for(var r in t)Pt(e,r,t[r],n);else if(t)for(var o=0,a=(t=d(t)).length;o<a;o++)Pt(e,t[o],n,i);else{for(var s in e[At])Pt(e,s,e[At][s]);delete e[At]}return this}function Nt(e,t,n,i){var r=t+a(n)+(i?"_"+a(i):"");if(e[At]&&e[At][r])return this;var o=function(t){return n.call(i||e,t||window.event)},s=o;we&&0===t.indexOf("touch")?Fe(e,t,o,r):!Ee||"dblclick"!==t||!Ge||we&&se?"addEventListener"in e?"mousewheel"===t?e.addEventListener("onwheel"in e?"wheel":"mousewheel",o,!!Te&&{passive:!1}):"mouseenter"===t||"mouseleave"===t?(o=function(t){t=t||window.event,Wt(e,t)&&s(t)},e.addEventListener("mouseenter"===t?"mouseover":"mouseout",o,!1)):("click"===t&&ne&&(o=function(e){!function(e,t){var n=e.timeStamp||e.originalEvent&&e.originalEvent.timeStamp,i=qt&&n-qt;i&&i>100&&i<500||e.target._simulatedClick&&!e._simulated?Ut(e):(qt=n,t(e))}(e,s)}),e.addEventListener(t,o,!1)):"attachEvent"in e&&e.attachEvent("on"+t,o):Ge(e,o,r),e[At]=e[At]||{},e[At][r]=o}function Pt(e,t,n,i){var r=t+a(n)+(i?"_"+a(i):""),o=e[At]&&e[At][r];if(!o)return this;we&&0===t.indexOf("touch")?function(e,t,n){var i=e["_leaflet_"+t+n];"touchstart"===t?e.removeEventListener(Ne,i,!1):"touchmove"===t?e.removeEventListener(Pe,i,!1):"touchend"===t&&(e.removeEventListener(Be,i,!1),e.removeEventListener(Re,i,!1))}(e,t,r):!Ee||"dblclick"!==t||!Ze||we&&se?"removeEventListener"in e?"mousewheel"===t?e.removeEventListener("onwheel"in e?"wheel":"mousewheel",o,!!Te&&{passive:!1}):e.removeEventListener("mouseenter"===t?"mouseover":"mouseleave"===t?"mouseout":t,o,!1):"detachEvent"in e&&e.detachEvent("on"+t,o):Ze(e,r),e[At][r]=null}function Bt(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,Ht(e),this}function Rt(e){return Nt(e,"mousewheel",Bt),this}function Mt(e){return It(e,"mousedown touchstart dblclick",Bt),Nt(e,"click",$t),this}function Ot(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Ut(e){return Ot(e),Bt(e),this}function zt(e,t){if(!t)return new N(e.clientX,e.clientY);var n=xt(t),i=n.boundingClientRect;return new N((e.clientX-i.left)/n.x-t.clientLeft,(e.clientY-i.top)/n.y-t.clientTop)}var Ft=de&&se?2*window.devicePixelRatio:le?window.devicePixelRatio:1;function Vt(e){return ee?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/Ft:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0}var qt,jt={};function $t(e){jt[e.type]=!0}function Ht(e){var t=jt[e.type];return jt[e.type]=!1,t}function Wt(e,t){var n=t.relatedTarget;if(!n)return!0;try{for(;n&&n!==e;)n=n.parentNode}catch(e){return!1}return n!==e}var Kt=(Object.freeze||Object)({on:It,off:Dt,stopPropagation:Bt,disableScrollPropagation:Rt,disableClickPropagation:Mt,preventDefault:Ot,stop:Ut,getMousePosition:zt,getWheelDelta:Vt,fakeStop:$t,skipped:Ht,isExternalTarget:Wt,addListener:It,removeListener:Dt}),Gt=D.extend({run:function(e,t,n,i){this.stop(),this._el=e,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=bt(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=k(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,n=1e3*this._duration;t<n?this._runFrame(this._easeOut(t/n),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var n=this._startPos.add(this._offset.multiplyBy(e));t&&n._round(),_t(this._el,n),this.fire("step")},_complete:function(){T(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),Zt=D.extend({options:{crs:K,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=p(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=r(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),void 0!==t.zoom&&(this._zoom=this._limitZoom(t.zoom)),t.center&&void 0!==t.zoom&&this.setView(F(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=nt&&me&&!Ce&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),It(this._proxy,it,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,i){return t=void 0===t?this._zoom:this._limitZoom(t),e=this._limitCenter(F(e),t,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&!0!==i&&(void 0!==i.animate&&(i.zoom=n({animate:i.animate},i.zoom),i.pan=n({animate:i.animate,duration:i.duration},i.pan)),this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,i.zoom):this._tryAnimatedPan(e,i.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(e,t),this)},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e=e||(me?this.options.zoomDelta:1),this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e=e||(me?this.options.zoomDelta:1),this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,n){var i=this.getZoomScale(t),r=this.getSize().divideBy(2),o=(e instanceof N?e:this.latLngToContainerPoint(e)).subtract(r).multiplyBy(1-1/i),a=this.containerPointToLatLng(r.add(o));return this.setView(a,t,{zoom:n})},_getBoundsCenterZoom:function(e,t){t=t||{},e=e.getBounds?e.getBounds():U(e);var n=B(t.paddingTopLeft||t.padding||[0,0]),i=B(t.paddingBottomRight||t.padding||[0,0]),r=this.getBoundsZoom(e,!1,n.add(i));if((r="number"==typeof t.maxZoom?Math.min(t.maxZoom,r):r)===1/0)return{center:e.getCenter(),zoom:r};var o=i.subtract(n).divideBy(2),a=this.project(e.getSouthWest(),r),s=this.project(e.getNorthEast(),r);return{center:this.unproject(a.add(s).divideBy(2).add(o),r),zoom:r}},fitBounds:function(e,t){if(!(e=U(e)).isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(e,t);return this.setView(n.center,n.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(t=t||{},!(e=B(e).round()).x&&!e.y)return this.fire("moveend");if(!0!==t.animate&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Gt,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),!1!==t.animate){dt(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,n,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,t,n){if(!1===(n=n||{}).animate||!me)return this.setView(e,t,n);this._stop();var i=this.project(this.getCenter()),r=this.project(e),o=this.getSize(),a=this._zoom;e=F(e),t=void 0===t?a:t;var s=Math.max(o.x,o.y),l=s*this.getZoomScale(a,t),u=r.distanceTo(i)||1;function c(e){var t=(l*l-s*s+2.0164*(e?-1:1)*2.0164*u*u)/(2*(e?l:s)*2.0164*u),n=Math.sqrt(t*t+1)-t;return n<1e-9?-18:Math.log(n)}function h(e){return(Math.exp(e)-Math.exp(-e))/2}function d(e){return(Math.exp(e)+Math.exp(-e))/2}var p=c(0);function f(e){return s*(d(p)*(h(t=p+1.42*e)/d(t))-h(p))/2.0164;var t}var g=Date.now(),m=(c(1)-p)/1.42,v=n.duration?1e3*n.duration:1e3*m*.8;return this._moveStart(!0,n.noMoveStart),function n(){var o=(Date.now()-g)/v,l=function(e){return 1-Math.pow(1-e,1.5)}(o)*m;o<=1?(this._flyToFrame=k(n,this),this._move(this.unproject(i.add(r.subtract(i).multiplyBy(f(l)/u)),a),this.getScaleZoom(s/function(e){return s*(d(p)/d(p+1.42*e))}(l),a),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}.call(this),this},flyToBounds:function(e,t){var n=this._getBoundsCenterZoom(e,t);return this.flyTo(n.center,n.zoom,t)},setMaxBounds:function(e){return(e=U(e)).isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var n=this.getCenter(),i=this._limitCenter(n,this._zoom,U(e));return n.equals(i)||this.panTo(i,t),this._enforcingBounds=!1,this},panInside:function(e,t){var n=B((t=t||{}).paddingTopLeft||t.padding||[0,0]),i=B(t.paddingBottomRight||t.padding||[0,0]),r=this.getCenter(),o=this.project(r),a=this.project(e),s=this.getPixelBounds(),l=s.getSize().divideBy(2),u=M([s.min.add(n),s.max.subtract(i)]);if(!u.contains(a)){this._enforcingBounds=!0;var c=o.subtract(a),h=B(a.x+c.x,a.y+c.y);(a.x<u.min.x||a.x>u.max.x)&&(h.x=o.x-c.x,c.x>0?h.x+=l.x-n.x:h.x-=l.x-i.x),(a.y<u.min.y||a.y>u.max.y)&&(h.y=o.y-c.y,c.y>0?h.y+=l.y-n.y:h.y-=l.y-i.y),this.panTo(this.unproject(h),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=n({animate:!1,pan:!0},!0===e?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),o=t.divideBy(2).round(),a=i.divideBy(2).round(),s=o.subtract(a);return s.x||s.y?(e.animate&&e.pan?this.panBy(s):(e.pan&&this._rawPanBy(s),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(r(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:i})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=n({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=r(this._handleGeolocationResponse,this),i=r(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,i,e):navigator.geolocation.getCurrentPosition(t,i,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){var t=e.code,n=e.message||(1===t?"permission denied":2===t?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+n+"."})},_handleGeolocationResponse:function(e){var t=new z(e.coords.latitude,e.coords.longitude),n=t.toBounds(2*e.coords.accuracy),i=this._locateOptions;if(i.setView){var r=this.getBoundsZoom(n);this.setView(t,i.maxZoom?Math.min(r,i.maxZoom):r)}var o={latlng:t,bounds:n,timestamp:e.timestamp};for(var a in e.coords)"number"==typeof e.coords[a]&&(o[a]=e.coords[a]);this.fire("locationfound",o)},addHandler:function(e,t){if(!t)return this;var n=this[e]=new t(this);return this._handlers.push(n),this.options[e]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(e){this._container._leaflet_id=void 0,this._containerId=void 0}var e;for(e in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),st(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(T(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[e].remove();for(e in this._panes)st(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var n=at("div","leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),t||this._mapPane);return e&&(this._panes[e]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds();return new O(this.unproject(e.getBottomLeft()),this.unproject(e.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,n){e=U(e),n=B(n||[0,0]);var i=this.getZoom()||0,r=this.getMinZoom(),o=this.getMaxZoom(),a=e.getNorthWest(),s=e.getSouthEast(),l=this.getSize().subtract(n),u=M(this.project(s,i),this.project(a,i)).getSize(),c=me?this.options.zoomSnap:1,h=l.x/u.x,d=l.y/u.y,p=t?Math.max(h,d):Math.min(h,d);return i=this.getScaleZoom(p,i),c&&(i=Math.round(i/(c/100))*(c/100),i=t?Math.ceil(i/c)*c:Math.floor(i/c)*c),Math.max(r,Math.min(o,i))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new N(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var n=this._getTopLeftPoint(e,t);return new R(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(void 0===e?this.getZoom():e)},getPane:function(e){return"string"==typeof e?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var n=this.options.crs;return t=void 0===t?this._zoom:t,n.scale(e)/n.scale(t)},getScaleZoom:function(e,t){var n=this.options.crs;t=void 0===t?this._zoom:t;var i=n.zoom(e*n.scale(t));return isNaN(i)?1/0:i},project:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.latLngToPoint(F(e),t)},unproject:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.pointToLatLng(B(e),t)},layerPointToLatLng:function(e){var t=B(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){return this.project(F(e))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(F(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(U(e))},distance:function(e,t){return this.options.crs.distance(F(e),F(t))},containerPointToLayerPoint:function(e){return B(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return B(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(B(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(F(e)))},mouseEventToContainerPoint:function(e){return zt(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=rt(e);if(!t)throw new Error("Map container not found.");if(t._leaflet_id)throw new Error("Map container is already initialized.");It(t,"scroll",this._onScroll,this),this._containerId=a(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&me,dt(e,"leaflet-container"+(Ee?" leaflet-touch":"")+(ke?" leaflet-retina":"")+(J?" leaflet-oldie":"")+(ue?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=ot(e,"position");"absolute"!==t&&"relative"!==t&&"fixed"!==t&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),_t(this._mapPane,new N(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(dt(e.markerPane,"leaflet-zoom-hide"),dt(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t){_t(this._mapPane,new N(0,0));var n=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var i=this._zoom!==t;this._moveStart(i,!1)._move(e,t)._moveEnd(i),this.fire("viewreset"),n&&this.fire("load")},_moveStart:function(e,t){return e&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(e,t,n){void 0===t&&(t=this._zoom);var i=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),(i||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return T(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){_t(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[a(this._container)]=this;var t=e?Dt:It;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),me&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){T(this._resizeRequest),this._resizeRequest=k((function(){this.invalidateSize({debounceMoveend:!0})}),this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var n,i=[],r="mouseout"===t||"mouseover"===t,o=e.target||e.srcElement,s=!1;o;){if((n=this._targets[a(o)])&&("click"===t||"preclick"===t)&&!e._simulated&&this._draggableMoved(n)){s=!0;break}if(n&&n.listens(t,!0)){if(r&&!Wt(o,e))break;if(i.push(n),r)break}if(o===this._container)break;o=o.parentNode}return i.length||s||r||!Wt(o,e)||(i=[this]),i},_handleDOMEvent:function(e){if(this._loaded&&!Ht(e)){var t=e.type;"mousedown"!==t&&"keypress"!==t&&"keyup"!==t&&"keydown"!==t||St(e.target||e.srcElement),this._fireDOMEvent(e,t)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,t,i){if("click"===e.type){var r=n({},e);r.type="preclick",this._fireDOMEvent(r,r.type,i)}if(!e._stopped&&(i=(i||[]).concat(this._findEventTargets(e,t))).length){var o=i[0];"contextmenu"===t&&o.listens(t,!0)&&Ot(e);var a={originalEvent:e};if("keypress"!==e.type&&"keydown"!==e.type&&"keyup"!==e.type){var s=o.getLatLng&&(!o._radius||o._radius<=10);a.containerPoint=s?this.latLngToContainerPoint(o.getLatLng()):this.mouseEventToContainerPoint(e),a.layerPoint=this.containerPointToLayerPoint(a.containerPoint),a.latlng=s?o.getLatLng():this.layerPointToLatLng(a.layerPoint)}for(var l=0;l<i.length;l++)if(i[l].fire(t,a,!0),a.originalEvent._stopped||!1===i[l].options.bubblingMouseEvents&&-1!==y(this._mouseEvents,t))return}},_draggableMoved:function(e){return(e=e.dragging&&e.dragging.enabled()?e:this).dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return bt(this._mapPane)||new N(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){return(e&&void 0!==t?this._getNewPixelOrigin(e,t):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var n=this.getSize()._divideBy(2);return this.project(e,t)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,n){var i=this._getNewPixelOrigin(n,t);return this.project(e,t)._subtract(i)},_latLngBoundsToNewLayerBounds:function(e,t,n){var i=this._getNewPixelOrigin(n,t);return M([this.project(e.getSouthWest(),t)._subtract(i),this.project(e.getNorthWest(),t)._subtract(i),this.project(e.getSouthEast(),t)._subtract(i),this.project(e.getNorthEast(),t)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,n){if(!n)return e;var i=this.project(e,t),r=this.getSize().divideBy(2),o=new R(i.subtract(r),i.add(r)),a=this._getBoundsOffset(o,n,t);return a.round().equals([0,0])?e:this.unproject(i.add(a),t)},_limitOffset:function(e,t){if(!t)return e;var n=this.getPixelBounds(),i=new R(n.min.add(e),n.max.add(e));return e.add(this._getBoundsOffset(i,t))},_getBoundsOffset:function(e,t,n){var i=M(this.project(t.getNorthEast(),n),this.project(t.getSouthWest(),n)),r=i.min.subtract(e.min),o=i.max.subtract(e.max);return new N(this._rebound(r.x,-o.x),this._rebound(r.y,-o.y))},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),n=this.getMaxZoom(),i=me?this.options.zoomSnap:1;return i&&(e=Math.round(e/i)*i),Math.max(t,Math.min(n,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){pt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var n=this._getCenterOffset(e)._trunc();return!(!0!==(t&&t.animate)&&!this.getSize().contains(n)||(this.panBy(n,t),0))},_createAnimProxy:function(){var e=this._proxy=at("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",(function(e){var t=tt,n=this._proxy.style[t];yt(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===this._proxy.style[t]&&this._animatingZoom&&this._onZoomTransitionEnd()}),this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){st(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();yt(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(t),r=this._getCenterOffset(e)._divideBy(1-1/i);return!(!0!==n.animate&&!this.getSize().contains(r)||(k((function(){this._moveStart(!0,!1)._animateZoom(e,t,!0)}),this),0))},_animateZoom:function(e,t,n,i){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,dt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:t,noUpdate:i}),setTimeout(r(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&pt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),k((function(){this._moveEnd(!0)}),this))}}),Yt=I.extend({options:{position:"topright"},initialize:function(e){p(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),n=this.getPosition(),i=e._controlCorners[n];return dt(t,"leaflet-control"),-1!==n.indexOf("bottom")?i.insertBefore(t,i.firstChild):i.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(st(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),Xt=function(e){return new Yt(e)};Zt.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t="leaflet-",n=this._controlContainer=at("div",t+"control-container",this._container);function i(i,r){var o=t+i+" "+t+r;e[i+r]=at("div",o,n)}i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)st(this._controlCorners[e]);st(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Qt=Yt.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,n,i){return n<i?-1:i<n?1:0}},initialize:function(e,t,n){for(var i in p(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,e)this._addLayer(e[i],i);for(i in t)this._addLayer(t[i],i,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return Yt.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(a(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){dt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(dt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):pt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return pt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=at("div",e),n=this.options.collapsed;t.setAttribute("aria-haspopup",!0),Mt(t),Rt(t);var i=this._section=at("section",e+"-list");n&&(this._map.on("click",this.collapse,this),ne||It(t,{mouseenter:this.expand,mouseleave:this.collapse},this));var r=this._layersLink=at("a",e+"-toggle",t);r.href="#",r.title="Layers",Ee?(It(r,"click",Ut),It(r,"click",this.expand,this)):It(r,"focus",this.expand,this),n||this.expand(),this._baseLayersList=at("div",e+"-base",i),this._separator=at("div",e+"-separator",i),this._overlaysList=at("div",e+"-overlays",i),t.appendChild(i)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&a(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,n){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:n}),this.options.sortLayers&&this._layers.sort(r((function(e,t){return this.options.sortFunction(e.layer,t.layer,e.name,t.name)}),this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;lt(this._baseLayersList),lt(this._overlaysList),this._layerControlInputs=[];var e,t,n,i,r=0;for(n=0;n<this._layers.length;n++)i=this._layers[n],this._addItem(i),t=t||i.overlay,e=e||!i.overlay,r+=i.overlay?0:1;return this.options.hideSingleBase&&(e=e&&r>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(a(e.target)),n=t.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;n&&this._map.fire(n,t)},_createRadioElement:function(e,t){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=n,i.firstChild},_addItem:function(e){var t,n=document.createElement("label"),i=this._map.hasLayer(e.layer);e.overlay?((t=document.createElement("input")).type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=i):t=this._createRadioElement("leaflet-base-layers_"+a(this),i),this._layerControlInputs.push(t),t.layerId=a(e.layer),It(t,"click",this._onInputClick,this);var r=document.createElement("span");r.innerHTML=" "+e.name;var o=document.createElement("div");return n.appendChild(o),o.appendChild(t),o.appendChild(r),(e.overlay?this._overlaysList:this._baseLayersList).appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){var e,t,n=this._layerControlInputs,i=[],r=[];this._handlingClick=!0;for(var o=n.length-1;o>=0;o--)e=n[o],t=this._getLayer(e.layerId).layer,e.checked?i.push(t):e.checked||r.push(t);for(o=0;o<r.length;o++)this._map.hasLayer(r[o])&&this._map.removeLayer(r[o]);for(o=0;o<i.length;o++)this._map.hasLayer(i[o])||this._map.addLayer(i[o]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var e,t,n=this._layerControlInputs,i=this._map.getZoom(),r=n.length-1;r>=0;r--)e=n[r],t=this._getLayer(e.layerId).layer,e.disabled=void 0!==t.options.minZoom&&i<t.options.minZoom||void 0!==t.options.maxZoom&&i>t.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),Jt=Yt.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",n=at("div",t+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,t+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,t+"-out",n,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,n,i,r){var o=at("a",n,i);return o.innerHTML=e,o.href="#",o.title=t,o.setAttribute("role","button"),o.setAttribute("aria-label",t),Mt(o),It(o,"click",Ut),It(o,"click",r,this),It(o,"click",this._refocusOnMap,this),o},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";pt(this._zoomInButton,t),pt(this._zoomOutButton,t),(this._disabled||e._zoom===e.getMinZoom())&&dt(this._zoomOutButton,t),(this._disabled||e._zoom===e.getMaxZoom())&&dt(this._zoomInButton,t)}});Zt.mergeOptions({zoomControl:!0}),Zt.addInitHook((function(){this.options.zoomControl&&(this.zoomControl=new Jt,this.addControl(this.zoomControl))}));var en=Yt.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t=at("div","leaflet-control-scale"),n=this.options;return this._addScales(n,"leaflet-control-scale-line",t),e.on(n.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),t},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,n){e.metric&&(this._mScale=at("div",t,n)),e.imperial&&(this._iScale=at("div",t,n))},_update:function(){var e=this._map,t=e.getSize().y/2,n=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(n)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,n,t/e)},_updateImperial:function(e){var t,n,i,r=3.2808399*e;r>5280?(t=r/5280,n=this._getRoundNum(t),this._updateScale(this._iScale,n+" mi",n/t)):(i=this._getRoundNum(r),this._updateScale(this._iScale,i+" ft",i/r))},_updateScale:function(e,t,n){e.style.width=Math.round(this.options.maxWidth*n)+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}}),tn=Yt.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(e){p(this,e),this._attributions={}},onAdd:function(e){for(var t in e.attributionControl=this,this._container=at("div","leaflet-control-attribution"),Mt(this._container),e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),this._container},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var n=[];this.options.prefix&&n.push(this.options.prefix),e.length&&n.push(e.join(", ")),this._container.innerHTML=n.join(" | ")}}});Zt.mergeOptions({attributionControl:!0}),Zt.addInitHook((function(){this.options.attributionControl&&(new tn).addTo(this)})),Yt.Layers=Qt,Yt.Zoom=Jt,Yt.Scale=en,Yt.Attribution=tn,Xt.layers=function(e,t,n){return new Qt(e,t,n)},Xt.zoom=function(e){return new Jt(e)},Xt.scale=function(e){return new en(e)},Xt.attribution=function(e){return new tn(e)};var nn=I.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});nn.addTo=function(e,t){return e.addHandler(t,this),this};var rn,on={Events:A},an=Ee?"touchstart mousedown":"mousedown",sn={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},ln={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},un=D.extend({options:{clickTolerance:3},initialize:function(e,t,n,i){p(this,i),this._element=e,this._dragStartTarget=t||e,this._preventOutline=n},enable:function(){this._enabled||(It(this._dragStartTarget,an,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(un._dragging===this&&this.finishDrag(),Dt(this._dragStartTarget,an,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(!e._simulated&&this._enabled&&(this._moved=!1,!ht(this._element,"leaflet-zoom-anim")&&!(un._dragging||e.shiftKey||1!==e.which&&1!==e.button&&!e.touches||(un._dragging=this,this._preventOutline&&St(this._element),Et(),Ye(),this._moving)))){this.fire("down");var t=e.touches?e.touches[0]:e,n=Tt(this._element);this._startPoint=new N(t.clientX,t.clientY),this._parentScale=xt(n),It(document,ln[e.type],this._onMove,this),It(document,sn[e.type],this._onUp,this)}},_onMove:function(e){if(!e._simulated&&this._enabled)if(e.touches&&e.touches.length>1)this._moved=!0;else{var t=e.touches&&1===e.touches.length?e.touches[0]:e,n=new N(t.clientX,t.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,Ot(e),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=bt(this._element).subtract(n),dt(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),dt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,T(this._animRequest),this._lastEvent=e,this._animRequest=k(this._updatePosition,this,!0)))}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),_t(this._element,this._newPos),this.fire("drag",e)},_onUp:function(e){!e._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){for(var e in pt(document.body,"leaflet-dragging"),this._lastTarget&&(pt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),ln)Dt(document,ln[e],this._onMove,this),Dt(document,sn[e],this._onUp,this);Ct(),Xe(),this._moved&&this._moving&&(T(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,un._dragging=!1}});function cn(e,t){if(!t||!e.length)return e.slice();var n=t*t;return e=function(e,t){var n=e.length,i=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(n);i[0]=i[n-1]=1,function e(t,n,i,r,o){var a,s,l,u=0;for(s=r+1;s<=o-1;s++)(l=gn(t[s],t[r],t[o],!0))>u&&(a=s,u=l);u>i&&(n[a]=1,e(t,n,i,r,a),e(t,n,i,a,o))}(e,i,t,0,n-1);var r,o=[];for(r=0;r<n;r++)i[r]&&o.push(e[r]);return o}(e=function(e,t){for(var n=[e[0]],i=1,r=0,o=e.length;i<o;i++)a=e[i],s=e[r],l=void 0,u=void 0,l=s.x-a.x,u=s.y-a.y,l*l+u*u>t&&(n.push(e[i]),r=i);var a,s,l,u;return r<o-1&&n.push(e[o-1]),n}(e,n),n)}function hn(e,t,n){return Math.sqrt(gn(e,t,n,!0))}function dn(e,t,n,i,r){var o,a,s,l=i?rn:fn(e,n),u=fn(t,n);for(rn=u;;){if(!(l|u))return[e,t];if(l&u)return!1;s=fn(a=pn(e,t,o=l||u,n,r),n),o===l?(e=a,l=s):(t=a,u=s)}}function pn(e,t,n,i,r){var o,a,s=t.x-e.x,l=t.y-e.y,u=i.min,c=i.max;return 8&n?(o=e.x+s*(c.y-e.y)/l,a=c.y):4&n?(o=e.x+s*(u.y-e.y)/l,a=u.y):2&n?(o=c.x,a=e.y+l*(c.x-e.x)/s):1&n&&(o=u.x,a=e.y+l*(u.x-e.x)/s),new N(o,a,r)}function fn(e,t){var n=0;return e.x<t.min.x?n|=1:e.x>t.max.x&&(n|=2),e.y<t.min.y?n|=4:e.y>t.max.y&&(n|=8),n}function gn(e,t,n,i){var r,o=t.x,a=t.y,s=n.x-o,l=n.y-a,u=s*s+l*l;return u>0&&((r=((e.x-o)*s+(e.y-a)*l)/u)>1?(o=n.x,a=n.y):r>0&&(o+=s*r,a+=l*r)),s=e.x-o,l=e.y-a,i?s*s+l*l:new N(o,a)}function mn(e){return!v(e[0])||"object"!=typeof e[0][0]&&void 0!==e[0][0]}function vn(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),mn(e)}var yn=(Object.freeze||Object)({simplify:cn,pointToSegmentDistance:hn,closestPointOnSegment:function(e,t,n){return gn(e,t,n)},clipSegment:dn,_getEdgeIntersection:pn,_getBitCode:fn,_sqClosestPointOnSegment:gn,isFlat:mn,_flat:vn});function _n(e,t,n){var i,r,o,a,s,l,u,c,h,d=[1,4,2,8];for(r=0,u=e.length;r<u;r++)e[r]._code=fn(e[r],t);for(a=0;a<4;a++){for(c=d[a],i=[],r=0,o=(u=e.length)-1;r<u;o=r++)s=e[r],l=e[o],s._code&c?l._code&c||((h=pn(l,s,c,t,n))._code=fn(h,t),i.push(h)):(l._code&c&&((h=pn(l,s,c,t,n))._code=fn(h,t),i.push(h)),i.push(s));e=i}return e}var bn=(Object.freeze||Object)({clipPolygon:_n}),wn={project:function(e){return new N(e.lng,e.lat)},unproject:function(e){return new z(e.y,e.x)},bounds:new R([-180,-90],[180,90])},En={R:6378137,R_MINOR:6356752.314245179,bounds:new R([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var t=Math.PI/180,n=this.R,i=e.lat*t,r=this.R_MINOR/n,o=Math.sqrt(1-r*r),a=o*Math.sin(i),s=Math.tan(Math.PI/4-i/2)/Math.pow((1-a)/(1+a),o/2);return i=-n*Math.log(Math.max(s,1e-10)),new N(e.lng*t*n,i)},unproject:function(e){for(var t,n=180/Math.PI,i=this.R,r=this.R_MINOR/i,o=Math.sqrt(1-r*r),a=Math.exp(-e.y/i),s=Math.PI/2-2*Math.atan(a),l=0,u=.1;l<15&&Math.abs(u)>1e-7;l++)t=o*Math.sin(s),t=Math.pow((1-t)/(1+t),o/2),s+=u=Math.PI/2-2*Math.atan(a*t)-s;return new z(s*n,e.x*n/i)}},Cn=(Object.freeze||Object)({LonLat:wn,Mercator:En,SphericalMercator:$}),Sn=n({},j,{code:"EPSG:3395",projection:En,transformation:function(){var e=.5/(Math.PI*En.R);return W(e,.5,-e,.5)}()}),kn=n({},j,{code:"EPSG:4326",projection:wn,transformation:W(1/180,1,-1/180,.5)}),Tn=n({},q,{projection:wn,transformation:W(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var n=t.lng-e.lng,i=t.lat-e.lat;return Math.sqrt(n*n+i*i)},infinite:!0});q.Earth=j,q.EPSG3395=Sn,q.EPSG3857=K,q.EPSG900913=G,q.EPSG4326=kn,q.Simple=Tn;var xn=D.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[a(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[a(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var n=this.getEvents();t.on(n,this),this.once("remove",(function(){t.off(n,this)}),this)}this.onAdd(t),this.getAttribution&&t.attributionControl&&t.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),t.fire("layeradd",{layer:this})}}});Zt.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var t=a(e);return this._layers[t]||(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e)),this},removeLayer:function(e){var t=a(e);return this._layers[t]?(this._loaded&&e.onRemove(this),e.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(e.getAttribution()),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return!!e&&a(e)in this._layers},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},_addLayers:function(e){for(var t=0,n=(e=e?v(e)?e:[e]:[]).length;t<n;t++)this.addLayer(e[t])},_addZoomLimit:function(e){!isNaN(e.options.maxZoom)&&isNaN(e.options.minZoom)||(this._zoomBoundLayers[a(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=a(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,n=this._getZoomSpan();for(var i in this._zoomBoundLayers){var r=this._zoomBoundLayers[i].options;e=void 0===r.minZoom?e:Math.min(e,r.minZoom),t=void 0===r.maxZoom?t:Math.max(t,r.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ln=xn.extend({initialize:function(e,t){var n,i;if(p(this,t),this._layers={},e)for(n=0,i=e.length;n<i;n++)this.addLayer(e[n])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){return!!e&&(e in this._layers||this.getLayerId(e)in this._layers)},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t,n,i=Array.prototype.slice.call(arguments,1);for(t in this._layers)(n=this._layers[t])[e]&&n[e].apply(n,i);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return a(e)}}),In=Ln.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),Ln.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),Ln.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new O;for(var t in this._layers){var n=this._layers[t];e.extend(n.getBounds?n.getBounds():n.getLatLng())}return e}}),An=I.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0]},initialize:function(e){p(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var n=this._getIconUrl(e);if(!n){if("icon"===e)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(n,t&&"IMG"===t.tagName?t:null);return this._setIconStyles(i,e),i},_setIconStyles:function(e,t){var n=this.options,i=n[t+"Size"];"number"==typeof i&&(i=[i,i]);var r=B(i),o=B("shadow"===t&&n.shadowAnchor||n.iconAnchor||r&&r.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(n.className||""),o&&(e.style.marginLeft=-o.x+"px",e.style.marginTop=-o.y+"px"),r&&(e.style.width=r.x+"px",e.style.height=r.y+"px")},_createImg:function(e,t){return(t=t||document.createElement("img")).src=e,t},_getIconUrl:function(e){return ke&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}}),Dn=An.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return Dn.imagePath||(Dn.imagePath=this._detectIconPath()),(this.options.imagePath||Dn.imagePath)+An.prototype._getIconUrl.call(this,e)},_detectIconPath:function(){var e=at("div","leaflet-default-icon-path",document.body),t=ot(e,"background-image")||ot(e,"backgroundImage");return document.body.removeChild(e),t=null===t||0!==t.indexOf("url")?"":t.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")}}),Nn=nn.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new un(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),dt(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&pt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,n=t._map,i=this._marker.options.autoPanSpeed,r=this._marker.options.autoPanPadding,o=bt(t._icon),a=n.getPixelBounds(),s=n.getPixelOrigin(),l=M(a.min._subtract(s).add(r),a.max._subtract(s).subtract(r));if(!l.contains(o)){var u=B((Math.max(l.max.x,o.x)-l.max.x)/(a.max.x-l.max.x)-(Math.min(l.min.x,o.x)-l.min.x)/(a.min.x-l.min.x),(Math.max(l.max.y,o.y)-l.max.y)/(a.max.y-l.max.y)-(Math.min(l.min.y,o.y)-l.min.y)/(a.min.y-l.min.y)).multiplyBy(i);n.panBy(u,{animate:!1}),this._draggable._newPos._add(u),this._draggable._startPos._add(u),_t(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=k(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(T(this._panRequest),this._panRequest=k(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,n=t._shadow,i=bt(t._icon),r=t._map.layerPointToLatLng(i);n&&_t(n,i),t._latlng=r,e.latlng=r,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){T(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),Pn=xn.extend({options:{icon:new Dn,interactive:!0,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){p(this,t),this._latlng=F(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=F(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=e.icon.createIcon(this._icon),i=!1;n!==this._icon&&(this._icon&&this._removeIcon(),i=!0,e.title&&(n.title=e.title),"IMG"===n.tagName&&(n.alt=e.alt||"")),dt(n,t),e.keyboard&&(n.tabIndex="0"),this._icon=n,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var r=e.icon.createShadow(this._shadow),o=!1;r!==this._shadow&&(this._removeShadow(),o=!0),r&&(dt(r,t),r.alt=""),this._shadow=r,e.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),r&&o&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),st(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&st(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&_t(this._icon,e),this._shadow&&_t(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(dt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Nn)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Nn(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&mt(this._icon,e),this._shadow&&mt(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),Bn=xn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return p(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&e.hasOwnProperty("weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+this._renderer.options.tolerance}}),Rn=Bn.extend({options:{fill:!0,radius:10},initialize:function(e,t){p(this,t),this._latlng=F(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=F(e),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return Bn.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,n=this._clickTolerance(),i=[e+n,t+n];this._pxBounds=new R(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),Mn=Rn.extend({initialize:function(e,t,i){if("number"==typeof t&&(t=n({},i,{radius:t})),p(this,t),this._latlng=F(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new O(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:Bn.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,n=this._map,i=n.options.crs;if(i.distance===j.distance){var r=Math.PI/180,o=this._mRadius/j.R/r,a=n.project([t+o,e]),s=n.project([t-o,e]),l=a.add(s).divideBy(2),u=n.unproject(l).lat,c=Math.acos((Math.cos(o*r)-Math.sin(t*r)*Math.sin(u*r))/(Math.cos(t*r)*Math.cos(u*r)))/r;(isNaN(c)||0===c)&&(c=o/Math.cos(Math.PI/180*t)),this._point=l.subtract(n.getPixelOrigin()),this._radius=isNaN(c)?0:l.x-n.project([u,e-c]).x,this._radiusY=l.y-a.y}else{var h=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(h).x}this._updateBounds()}}),On=Bn.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){p(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t,n,i=1/0,r=null,o=gn,a=0,s=this._parts.length;a<s;a++)for(var l=this._parts[a],u=1,c=l.length;u<c;u++){var h=o(e,t=l[u-1],n=l[u],!0);h<i&&(i=h,r=o(e,t,n))}return r&&(r.distance=Math.sqrt(i)),r},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var e,t,n,i,r,o,a,s=this._rings[0],l=s.length;if(!l)return null;for(e=0,t=0;e<l-1;e++)t+=s[e].distanceTo(s[e+1])/2;if(0===t)return this._map.layerPointToLatLng(s[0]);for(e=0,i=0;e<l-1;e++)if(r=s[e],o=s[e+1],(i+=n=r.distanceTo(o))>t)return a=(i-t)/n,this._map.layerPointToLatLng([o.x-a*(o.x-r.x),o.y-a*(o.y-r.y)])},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=F(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new O,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return mn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],n=mn(e),i=0,r=e.length;i<r;i++)n?(t[i]=F(e[i]),this._bounds.extend(t[i])):t[i]=this._convertLatLngs(e[i]);return t},_project:function(){var e=new R;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new N(e,e);this._pxBounds=new R([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)])},_projectLatlngs:function(e,t,n){var i,r,o=e[0]instanceof z,a=e.length;if(o){for(r=[],i=0;i<a;i++)r[i]=this._map.latLngToLayerPoint(e[i]),n.extend(r[i]);t.push(r)}else for(i=0;i<a;i++)this._projectLatlngs(e[i],t,n)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else{var t,n,i,r,o,a,s,l=this._parts;for(t=0,i=0,r=this._rings.length;t<r;t++)for(n=0,o=(s=this._rings[t]).length;n<o-1;n++)(a=dn(s[n],s[n+1],e,n,!0))&&(l[i]=l[i]||[],l[i].push(a[0]),a[1]===s[n+1]&&n!==o-2||(l[i].push(a[1]),i++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,n=0,i=e.length;n<i;n++)e[n]=cn(e[n],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var n,i,r,o,a,s,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(n=0,o=this._parts.length;n<o;n++)for(i=0,r=(a=(s=this._parts[n]).length)-1;i<a;r=i++)if((t||0!==i)&&hn(e,s[r],s[i])<=l)return!0;return!1}});On._flat=vn;var Un=On.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var e,t,n,i,r,o,a,s,l,u=this._rings[0],c=u.length;if(!c)return null;for(o=a=s=0,e=0,t=c-1;e<c;t=e++)n=u[e],i=u[t],r=n.y*i.x-i.y*n.x,a+=(n.x+i.x)*r,s+=(n.y+i.y)*r,o+=3*r;return l=0===o?u[0]:[a/o,s/o],this._map.layerPointToLatLng(l)},_convertLatLngs:function(e){var t=On.prototype._convertLatLngs.call(this,e),n=t.length;return n>=2&&t[0]instanceof z&&t[0].equals(t[n-1])&&t.pop(),t},_setLatLngs:function(e){On.prototype._setLatLngs.call(this,e),mn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return mn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,n=new N(t,t);if(e=new R(e.min.subtract(n),e.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else for(var i,r=0,o=this._rings.length;r<o;r++)(i=_n(this._rings[r],e,!0)).length&&this._parts.push(i)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t,n,i,r,o,a,s,l,u=!1;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(r=0,s=this._parts.length;r<s;r++)for(o=0,a=(l=(t=this._parts[r]).length)-1;o<l;a=o++)n=t[o],i=t[a],n.y>e.y!=i.y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(u=!u);return u||On.prototype._containsPoint.call(this,e,!0)}}),zn=In.extend({initialize:function(e,t){p(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t,n,i,r=v(e)?e:e.features;if(r){for(t=0,n=r.length;t<n;t++)((i=r[t]).geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var o=this.options;if(o.filter&&!o.filter(e))return this;var a=Fn(e,o);return a?(a.feature=Kn(e),a.defaultOptions=a.options,this.resetStyle(a),o.onEachFeature&&o.onEachFeature(e,a),this.addLayer(a)):this},resetStyle:function(e){return void 0===e?this.eachLayer(this.resetStyle,this):(e.options=n({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer((function(t){this._setLayerStyle(t,e)}),this)},_setLayerStyle:function(e,t){e.setStyle&&("function"==typeof t&&(t=t(e.feature)),e.setStyle(t))}});function Fn(e,t){var n,i,r,o,a="Feature"===e.type?e.geometry:e,s=a?a.coordinates:null,l=[],u=t&&t.pointToLayer,c=t&&t.coordsToLatLng||qn;if(!s&&!a)return null;switch(a.type){case"Point":return Vn(u,e,n=c(s),t);case"MultiPoint":for(r=0,o=s.length;r<o;r++)n=c(s[r]),l.push(Vn(u,e,n,t));return new In(l);case"LineString":case"MultiLineString":return i=jn(s,"LineString"===a.type?0:1,c),new On(i,t);case"Polygon":case"MultiPolygon":return i=jn(s,"Polygon"===a.type?1:2,c),new Un(i,t);case"GeometryCollection":for(r=0,o=a.geometries.length;r<o;r++){var h=Fn({geometry:a.geometries[r],type:"Feature",properties:e.properties},t);h&&l.push(h)}return new In(l);default:throw new Error("Invalid GeoJSON object.")}}function Vn(e,t,n,i){return e?e(t,n):new Pn(n,i&&i.markersInheritOptions&&i)}function qn(e){return new z(e[1],e[0],e[2])}function jn(e,t,n){for(var i,r=[],o=0,a=e.length;o<a;o++)i=t?jn(e[o],t-1,n):(n||qn)(e[o]),r.push(i);return r}function $n(e,t){return t="number"==typeof t?t:6,void 0!==e.alt?[c(e.lng,t),c(e.lat,t),c(e.alt,t)]:[c(e.lng,t),c(e.lat,t)]}function Hn(e,t,n,i){for(var r=[],o=0,a=e.length;o<a;o++)r.push(t?Hn(e[o],t-1,n,i):$n(e[o],i));return!t&&n&&r.push(r[0]),r}function Wn(e,t){return e.feature?n({},e.feature,{geometry:t}):Kn(t)}function Kn(e){return"Feature"===e.type||"FeatureCollection"===e.type?e:{type:"Feature",properties:{},geometry:e}}var Gn={toGeoJSON:function(e){return Wn(this,{type:"Point",coordinates:$n(this.getLatLng(),e)})}};function Zn(e,t){return new zn(e,t)}Pn.include(Gn),Mn.include(Gn),Rn.include(Gn),On.include({toGeoJSON:function(e){var t=!mn(this._latlngs);return Wn(this,{type:(t?"Multi":"")+"LineString",coordinates:Hn(this._latlngs,t?1:0,!1,e)})}}),Un.include({toGeoJSON:function(e){var t=!mn(this._latlngs),n=t&&!mn(this._latlngs[0]),i=Hn(this._latlngs,n?2:t?1:0,!0,e);return t||(i=[i]),Wn(this,{type:(n?"Multi":"")+"Polygon",coordinates:i})}}),Ln.include({toMultiPoint:function(e){var t=[];return this.eachLayer((function(n){t.push(n.toGeoJSON(e).geometry.coordinates)})),Wn(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint(e);var n="GeometryCollection"===t,i=[];return this.eachLayer((function(t){if(t.toGeoJSON){var r=t.toGeoJSON(e);if(n)i.push(r.geometry);else{var o=Kn(r);"FeatureCollection"===o.type?i.push.apply(i,o.features):i.push(o)}}})),n?Wn(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}});var Yn=Zn,Xn=xn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,t,n){this._url=e,this._bounds=U(t),p(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(dt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){st(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&ut(this._image),this},bringToBack:function(){return this._map&&ct(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=U(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e="IMG"===this._url.tagName,t=this._image=e?this._url:at("img");dt(t,"leaflet-image-layer"),this._zoomAnimated&&dt(t,"leaflet-zoom-animated"),this.options.className&&dt(t,this.options.className),t.onselectstart=u,t.onmousemove=u,t.onload=r(this.fire,this,"load"),t.onerror=r(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(t.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e?this._url=t.src:(t.src=this._url,t.alt=this.options.alt)},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;yt(this._image,n,t)},_reset:function(){var e=this._image,t=new R(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=t.getSize();_t(e,t.min),e.style.width=n.x+"px",e.style.height=n.y+"px"},_updateOpacity:function(){mt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)}}),Qn=Xn.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0},_initImage:function(){var e="VIDEO"===this._url.tagName,t=this._image=e?this._url:at("video");if(dt(t,"leaflet-image-layer"),this._zoomAnimated&&dt(t,"leaflet-zoom-animated"),this.options.className&&dt(t,this.options.className),t.onselectstart=u,t.onmousemove=u,t.onloadeddata=r(this.fire,this,"load"),e){for(var n=t.getElementsByTagName("source"),i=[],o=0;o<n.length;o++)i.push(n[o].src);this._url=n.length>0?i:[t.src]}else{v(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&t.style.hasOwnProperty("objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop;for(var a=0;a<this._url.length;a++){var s=at("source");s.src=this._url[a],t.appendChild(s)}}}}),Jn=Xn.extend({_initImage:function(){var e=this._image=this._url;dt(e,"leaflet-image-layer"),this._zoomAnimated&&dt(e,"leaflet-zoom-animated"),this.options.className&&dt(e,this.options.className),e.onselectstart=u,e.onmousemove=u}}),ei=xn.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(e,t){p(this,e),this._source=t},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&mt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&mt(this._container,1),this.bringToFront()},onRemove:function(e){e._fadeAnimated?(mt(this._container,0),this._removeTimeout=setTimeout(r(st,void 0,this._container),200)):st(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=F(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ut(this._container),this},bringToBack:function(){return this._map&&ct(this._container),this},_prepareOpen:function(e,t,n){if(t instanceof xn||(n=t,t=e),t instanceof In)for(var i in e._layers){t=e._layers[i];break}if(!n)if(t.getCenter)n=t.getCenter();else{if(!t.getLatLng)throw new Error("Unable to get source layer LatLng.");n=t.getLatLng()}return this._source=t,this.update(),n},_updateContent:function(){if(this._content){var e=this._contentNode,t="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof t)e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=B(this.options.offset),n=this._getAnchor();this._zoomAnimated?_t(this._container,e.add(n)):t=t.add(e).add(n);var i=this._containerBottom=-t.y,r=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=i+"px",this._container.style.left=r+"px"}},_getAnchor:function(){return[0,0]}}),ti=ei.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return e.openPopup(this),this},onAdd:function(e){ei.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Bn||this._source.on("preclick",Bt))},onRemove:function(e){ei.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Bn||this._source.off("preclick",Bt))},getEvents:function(){var e=ei.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this._close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var e="leaflet-popup",t=this._container=at("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=at("div",e+"-content-wrapper",t);if(this._contentNode=at("div",e+"-content",n),Mt(n),Rt(this._contentNode),It(n,"contextmenu",Bt),this._tipContainer=at("div",e+"-tip-container",t),this._tip=at("div",e+"-tip",this._tipContainer),this.options.closeButton){var i=this._closeButton=at("a",e+"-close-button",t);i.href="#close",i.innerHTML="&#215;",It(i,"click",this._onCloseButtonClick,this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var n=e.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),t.width=n+1+"px",t.whiteSpace="",t.height="";var i=e.offsetHeight,r=this.options.maxHeight;r&&i>r?(t.height=r+"px",dt(e,"leaflet-popup-scrolled")):pt(e,"leaflet-popup-scrolled"),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),n=this._getAnchor();_t(this._container,t.add(n))},_adjustPan:function(){if(this.options.autoPan){this._map._panAnim&&this._map._panAnim.stop();var e=this._map,t=parseInt(ot(this._container,"marginBottom"),10)||0,n=this._container.offsetHeight+t,i=this._containerWidth,r=new N(this._containerLeft,-n-this._containerBottom);r._add(bt(this._container));var o=e.layerPointToContainerPoint(r),a=B(this.options.autoPanPadding),s=B(this.options.autoPanPaddingTopLeft||a),l=B(this.options.autoPanPaddingBottomRight||a),u=e.getSize(),c=0,h=0;o.x+i+l.x>u.x&&(c=o.x+i-u.x+l.x),o.x-c-s.x<0&&(c=o.x-s.x),o.y+n+l.y>u.y&&(h=o.y+n-u.y+l.y),o.y-h-s.y<0&&(h=o.y-s.y),(c||h)&&e.fire("autopanstart").panBy([c,h])}},_onCloseButtonClick:function(e){this._close(),Ut(e)},_getAnchor:function(){return B(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});Zt.mergeOptions({closePopupOnClick:!0}),Zt.include({openPopup:function(e,t,n){return e instanceof ti||(e=new ti(n).setContent(e)),t&&e.setLatLng(t),this.hasLayer(e)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=e,this.addLayer(e))},closePopup:function(e){return e&&e!==this._popup||(e=this._popup,this._popup=null),e&&this.removeLayer(e),this}}),xn.include({bindPopup:function(e,t){return e instanceof ti?(p(e,t),this._popup=e,e._source=this):(this._popup&&!t||(this._popup=new ti(t,this)),this._popup.setContent(e)),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e,t){return this._popup&&this._map&&(t=this._popup._prepareOpen(this,e,t),this._map.openPopup(this._popup,t)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(e){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(e)),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){var t=e.layer||e.target;this._popup&&this._map&&(Ut(e),t instanceof Bn?this.openPopup(e.layer||e.target,e.latlng):this._map.hasLayer(this._popup)&&this._popup._source===t?this.closePopup():this.openPopup(t,e.latlng))},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){13===e.originalEvent.keyCode&&this._openPopup(e)}});var ni=ei.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(e){ei.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(e){ei.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var e=ei.prototype.getEvents.call(this);return Ee&&!this.options.permanent&&(e.preclick=this._close),e},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var e="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=at("div",e)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t=this._map,n=this._container,i=t.latLngToContainerPoint(t.getCenter()),r=t.layerPointToContainerPoint(e),o=this.options.direction,a=n.offsetWidth,s=n.offsetHeight,l=B(this.options.offset),u=this._getAnchor();"top"===o?e=e.add(B(-a/2+l.x,-s+l.y+u.y,!0)):"bottom"===o?e=e.subtract(B(a/2-l.x,-l.y,!0)):"center"===o?e=e.subtract(B(a/2+l.x,s/2-u.y+l.y,!0)):"right"===o||"auto"===o&&r.x<i.x?(o="right",e=e.add(B(l.x+u.x,u.y-s/2+l.y,!0))):(o="left",e=e.subtract(B(a+u.x-l.x,s/2-u.y-l.y,!0))),pt(n,"leaflet-tooltip-right"),pt(n,"leaflet-tooltip-left"),pt(n,"leaflet-tooltip-top"),pt(n,"leaflet-tooltip-bottom"),dt(n,"leaflet-tooltip-"+o),_t(n,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&mt(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return B(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});Zt.include({openTooltip:function(e,t,n){return e instanceof ni||(e=new ni(n).setContent(e)),t&&e.setLatLng(t),this.hasLayer(e)?this:this.addLayer(e)},closeTooltip:function(e){return e&&this.removeLayer(e),this}}),xn.include({bindTooltip:function(e,t){return e instanceof ni?(p(e,t),this._tooltip=e,e._source=this):(this._tooltip&&!t||(this._tooltip=new ni(t,this)),this._tooltip.setContent(e)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(e||!this._tooltipHandlersAdded){var t=e?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),Ee&&(n.click=this._openTooltip)),this[t](n),this._tooltipHandlersAdded=!e}},openTooltip:function(e,t){return this._tooltip&&this._map&&(t=this._tooltip._prepareOpen(this,e,t),this._map.openTooltip(this._tooltip,t),this._tooltip.options.interactive&&this._tooltip._container&&(dt(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(pt(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(e){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(e)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_openTooltip:function(e){var t=e.layer||e.target;this._tooltip&&this._map&&this.openTooltip(t,this._tooltip.options.sticky?e.latlng:void 0)},_moveTooltip:function(e){var t,n,i=e.latlng;this._tooltip.options.sticky&&e.originalEvent&&(t=this._map.mouseEventToContainerPoint(e.originalEvent),n=this._map.containerPointToLayerPoint(t),i=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(i)}});var ii=An.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var t=e&&"DIV"===e.tagName?e:document.createElement("div"),n=this.options;if(n.html instanceof Element?(lt(t),t.appendChild(n.html)):t.innerHTML=!1!==n.html?n.html:"",n.bgPos){var i=B(n.bgPos);t.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});An.Default=Dn;var ri=xn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:ve,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){p(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),st(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ut(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(ct(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=s(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof N?e:new N(e,e)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t,n=this.getPane().children,i=-e(-1/0,1/0),r=0,o=n.length;r<o;r++)t=n[r].style.zIndex,n[r]!==this._container&&t&&(i=e(i,+t));isFinite(i)&&(this.options.zIndex=i+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!J){mt(this._container,this.options.opacity);var e=+new Date,t=!1,n=!1;for(var i in this._tiles){var r=this._tiles[i];if(r.current&&r.loaded){var o=Math.min(1,(e-r.loaded)/200);mt(r.el,o),o<1?t=!0:(r.active?n=!0:this._onOpaqueTile(r),r.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),t&&(T(this._fadeFrame),this._fadeFrame=k(this._updateOpacity,this))}},_onOpaqueTile:u,_initContainer:function(){this._container||(this._container=at("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(void 0!==e){for(var n in this._levels)this._levels[n].el.children.length||n===e?(this._levels[n].el.style.zIndex=t-Math.abs(e-n),this._onUpdateLevel(n)):(st(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var i=this._levels[e],r=this._map;return i||((i=this._levels[e]={}).el=at("div","leaflet-tile-container leaflet-zoom-animated",this._container),i.el.style.zIndex=t,i.origin=r.project(r.unproject(r.getPixelOrigin()),e).round(),i.zoom=e,this._setZoomTransform(i,r.getCenter(),r.getZoom()),i.el.offsetWidth,this._onCreateLevel(i)),this._level=i,i}},_onUpdateLevel:u,_onRemoveLevel:u,_onCreateLevel:u,_pruneTiles:function(){if(this._map){var e,t,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(e in this._tiles)(t=this._tiles[e]).retain=t.current;for(e in this._tiles)if((t=this._tiles[e]).current&&!t.active){var i=t.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)st(this._levels[e].el),this._onRemoveLevel(e),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,n,i){var r=Math.floor(e/2),o=Math.floor(t/2),a=n-1,s=new N(+r,+o);s.z=+a;var l=this._tileCoordsToKey(s),u=this._tiles[l];return u&&u.active?(u.retain=!0,!0):(u&&u.loaded&&(u.retain=!0),a>i&&this._retainParent(r,o,a,i))},_retainChildren:function(e,t,n,i){for(var r=2*e;r<2*e+2;r++)for(var o=2*t;o<2*t+2;o++){var a=new N(r,o);a.z=n+1;var s=this._tileCoordsToKey(a),l=this._tiles[s];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),n+1<i&&this._retainChildren(r,o,n+1,i))}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return void 0!==t.minNativeZoom&&e<t.minNativeZoom?t.minNativeZoom:void 0!==t.maxNativeZoom&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,n,i){var r=this._clampZoom(Math.round(t));(void 0!==this.options.maxZoom&&r>this.options.maxZoom||void 0!==this.options.minZoom&&r<this.options.minZoom)&&(r=void 0);var o=this.options.updateWhenZooming&&r!==this._tileZoom;i&&!o||(this._tileZoom=r,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==r&&this._update(e),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var n in this._levels)this._setZoomTransform(this._levels[n],e,t)},_setZoomTransform:function(e,t,n){var i=this._map.getZoomScale(n,e.zoom),r=e.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(t,n)).round();me?yt(e.el,r,i):_t(e.el,r)},_resetGrid:function(){var e=this._map,t=e.options.crs,n=this._tileSize=this.getTileSize(),i=this._tileZoom,r=this._map.getPixelWorldBounds(this._tileZoom);r&&(this._globalTileRange=this._pxBoundsToTileRange(r)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],i).x/n.x),Math.ceil(e.project([0,t.wrapLng[1]],i).x/n.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],i).y/n.x),Math.ceil(e.project([t.wrapLat[1],0],i).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(e){var t=this._map,n=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),i=t.getZoomScale(n,this._tileZoom),r=t.project(e,this._tileZoom).floor(),o=t.getSize().divideBy(2*i);return new R(r.subtract(o),r.add(o))},_update:function(e){var t=this._map;if(t){var n=this._clampZoom(t.getZoom());if(void 0===e&&(e=t.getCenter()),void 0!==this._tileZoom){var i=this._getTiledPixelBounds(e),r=this._pxBoundsToTileRange(i),o=r.getCenter(),a=[],s=this.options.keepBuffer,l=new R(r.getBottomLeft().subtract([s,-s]),r.getTopRight().add([s,-s]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var u in this._tiles){var c=this._tiles[u].coords;c.z===this._tileZoom&&l.contains(new N(c.x,c.y))||(this._tiles[u].current=!1)}if(Math.abs(n-this._tileZoom)>1)this._setView(e,n);else{for(var h=r.min.y;h<=r.max.y;h++)for(var d=r.min.x;d<=r.max.x;d++){var p=new N(d,h);if(p.z=this._tileZoom,this._isValidTile(p)){var f=this._tiles[this._tileCoordsToKey(p)];f?f.current=!0:a.push(p)}}if(a.sort((function(e,t){return e.distanceTo(o)-t.distanceTo(o)})),0!==a.length){this._loading||(this._loading=!0,this.fire("loading"));var g=document.createDocumentFragment();for(d=0;d<a.length;d++)this._addTile(a[d],g);this._level.el.appendChild(g)}}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var n=this._globalTileRange;if(!t.wrapLng&&(e.x<n.min.x||e.x>n.max.x)||!t.wrapLat&&(e.y<n.min.y||e.y>n.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(e);return U(this.options.bounds).overlaps(i)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,n=this.getTileSize(),i=e.scaleBy(n),r=i.add(n);return[t.unproject(i,e.z),t.unproject(r,e.z)]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),n=new O(t[0],t[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var t=e.split(":"),n=new N(+t[0],+t[1]);return n.z=+t[2],n},_removeTile:function(e){var t=this._tiles[e];t&&(st(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){dt(e,"leaflet-tile");var t=this.getTileSize();e.style.width=t.x+"px",e.style.height=t.y+"px",e.onselectstart=u,e.onmousemove=u,J&&this.options.opacity<1&&mt(e,this.options.opacity),ne&&!ie&&(e.style.WebkitBackfaceVisibility="hidden")},_addTile:function(e,t){var n=this._getTilePos(e),i=this._tileCoordsToKey(e),o=this.createTile(this._wrapCoords(e),r(this._tileReady,this,e));this._initTile(o),this.createTile.length<2&&k(r(this._tileReady,this,e,null,o)),_t(o,n),this._tiles[i]={el:o,coords:e,current:!0},t.appendChild(o),this.fire("tileloadstart",{tile:o,coords:e})},_tileReady:function(e,t,n){t&&this.fire("tileerror",{error:t,tile:n,coords:e});var i=this._tileCoordsToKey(e);(n=this._tiles[i])&&(n.loaded=+new Date,this._map._fadeAnimated?(mt(n.el,0),T(this._fadeFrame),this._fadeFrame=k(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),t||(dt(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),J||!this._map._fadeAnimated?k(this._pruneTiles,this):setTimeout(r(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new N(this._wrapX?l(e.x,this._wrapX):e.x,this._wrapY?l(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new R(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}}),oi=ri.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(e,t){this._url=e,(t=p(this,t)).detectRetina&&ke&&t.maxZoom>0&&(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom++):(t.zoomOffset++,t.maxZoom--),t.minZoom=Math.max(0,t.minZoom)),"string"==typeof t.subdomains&&(t.subdomains=t.subdomains.split("")),ne||this.on("tileunload",this._onTileRemove)},setUrl:function(e,t){return this._url===e&&void 0===t&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var n=document.createElement("img");return It(n,"load",r(this._tileOnLoad,this,t,n)),It(n,"error",r(this._tileOnError,this,t,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),n.alt="",n.setAttribute("role","presentation"),n.src=this.getTileUrl(e),n},getTileUrl:function(e){var t={r:ke?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=i),t["-y"]=i}return m(this._url,n(t,this.options))},_tileOnLoad:function(e,t){J?setTimeout(r(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,n){var i=this.options.errorTileUrl;i&&t.getAttribute("src")!==i&&(t.src=i),e(n,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom;return this.options.zoomReverse&&(e=t-e),e+this.options.zoomOffset},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)this._tiles[e].coords.z!==this._tileZoom&&((t=this._tiles[e].el).onload=u,t.onerror=u,t.complete||(t.src=_,st(t),delete this._tiles[e]))},_removeTile:function(e){var t=this._tiles[e];if(t)return oe||t.el.setAttribute("src",_),ri.prototype._removeTile.call(this,e)},_tileReady:function(e,t,n){if(this._map&&(!n||n.getAttribute("src")!==_))return ri.prototype._tileReady.call(this,e,t,n)}});function ai(e,t){return new oi(e,t)}var si=oi.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var i=n({},this.defaultWmsParams);for(var r in t)r in this.options||(i[r]=t[r]);var o=(t=p(this,t)).detectRetina&&ke?2:1,a=this.getTileSize();i.width=a.x*o,i.height=a.y*o,this.wmsParams=i},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,oi.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),n=this._crs,i=M(n.project(t[0]),n.project(t[1])),r=i.min,o=i.max,a=(this._wmsVersion>=1.3&&this._crs===kn?[r.y,r.x,o.y,o.x]:[r.x,r.y,o.x,o.y]).join(","),s=oi.prototype.getTileUrl.call(this,e);return s+f(this.wmsParams,s,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+a},setParams:function(e,t){return n(this.wmsParams,e),t||this.redraw(),this}});oi.WMS=si,ai.wms=function(e,t){return new si(e,t)};var li=xn.extend({options:{padding:.1,tolerance:0},initialize:function(e){p(this,e),a(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&dt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var n=this._map.getZoomScale(t,this._zoom),i=bt(this._container),r=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,t),a=this._map.project(e,t).subtract(o),s=r.multiplyBy(-n).add(i).add(r).subtract(a);me?yt(this._container,s,n):_t(this._container,s)},_reset:function(){for(var e in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),n=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new R(n,n.add(t.multiplyBy(1+2*e)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),ui=li.extend({getEvents:function(){var e=li.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){li.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");It(e,"mousemove",this._onMouseMove,this),It(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),It(e,"mouseout",this._handleMouseOut,this),this._ctx=e.getContext("2d")},_destroyContainer:function(){T(this._redrawRequest),delete this._ctx,st(this._container),Dt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var e in this._redrawBounds=null,this._layers)this._layers[e]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){li.prototype._update.call(this);var e=this._bounds,t=this._container,n=e.getSize(),i=ke?2:1;_t(t,e.min),t.width=i*n.x,t.height=i*n.y,t.style.width=n.x+"px",t.style.height=n.y+"px",ke&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){li.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[a(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,n=t.next,i=t.prev;n?n.prev=i:this._drawLast=i,i?i.next=n:this._drawFirst=n,delete e._order,delete this._layers[a(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if("string"==typeof e.options.dashArray){var t,n,i=e.options.dashArray.split(/[, ]+/),r=[];for(n=0;n<i.length;n++){if(t=Number(i[n]),isNaN(t))return;r.push(t)}e.options._dashArray=r}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||k(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new R,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var n=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var i=this._drawFirst;i;i=i.next)e=i.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var n,i,r,o,a=e._parts,s=a.length,l=this._ctx;if(s){for(l.beginPath(),n=0;n<s;n++){for(i=0,r=a[n].length;i<r;i++)o=a[n][i],l[i?"lineTo":"moveTo"](o.x,o.y);t&&l.closePath()}this._fillStroke(l,e)}}},_updateCircle:function(e){if(this._drawing&&!e._empty()){var t=e._point,n=this._ctx,i=Math.max(Math.round(e._radius),1),r=(Math.max(Math.round(e._radiusY),1)||i)/i;1!==r&&(n.save(),n.scale(1,r)),n.beginPath(),n.arc(t.x,t.y/r,i,0,2*Math.PI,!1),1!==r&&n.restore(),this._fillStroke(n,e)}},_fillStroke:function(e,t){var n=t.options;n.fill&&(e.globalAlpha=n.fillOpacity,e.fillStyle=n.fillColor||n.color,e.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=n.opacity,e.lineWidth=n.weight,e.strokeStyle=n.color,e.lineCap=n.lineCap,e.lineJoin=n.lineJoin,e.stroke())},_onClick:function(e){for(var t,n,i=this._map.mouseEventToLayerPoint(e),r=this._drawFirst;r;r=r.next)(t=r.layer).options.interactive&&t._containsPoint(i)&&!this._map._draggableMoved(t)&&(n=t);n&&($t(e),this._fireEvent([n],e))},_onMouseMove:function(e){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(pt(this._container,"leaflet-interactive"),this._fireEvent([t],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var n,i,r=this._drawFirst;r;r=r.next)(n=r.layer).options.interactive&&n._containsPoint(t)&&(i=n);i!==this._hoveredLayer&&(this._handleMouseOut(e),i&&(dt(this._container,"leaflet-interactive"),this._fireEvent([i],e,"mouseover"),this._hoveredLayer=i)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],e),this._mouseHoverThrottled=!0,setTimeout(L.bind((function(){this._mouseHoverThrottled=!1}),this),32)}},_fireEvent:function(e,t,n){this._map._fireDOMEvent(t,n||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var n=t.next,i=t.prev;n&&(n.prev=i,i?i.next=n:n&&(this._drawFirst=n),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e))}},_bringToBack:function(e){var t=e._order;if(t){var n=t.next,i=t.prev;i&&(i.next=n,n?n.prev=i:i&&(this._drawLast=i),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e))}}});function ci(e){return xe?new ui(e):null}var hi=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch(e){return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),di={_initContainer:function(){this._container=at("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(li.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var t=e._container=hi("shape");dt(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=hi("path"),t.appendChild(e._path),this._updateStyle(e),this._layers[a(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;st(t),e.removeInteractiveTarget(t),delete this._layers[a(e)]},_updateStyle:function(e){var t=e._stroke,n=e._fill,i=e.options,r=e._container;r.stroked=!!i.stroke,r.filled=!!i.fill,i.stroke?(t||(t=e._stroke=hi("stroke")),r.appendChild(t),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,i.dashArray?t.dashStyle=v(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=i.lineCap.replace("butt","flat"),t.joinstyle=i.lineJoin):t&&(r.removeChild(t),e._stroke=null),i.fill?(n||(n=e._fill=hi("fill")),r.appendChild(n),n.color=i.fillColor||i.color,n.opacity=i.fillOpacity):n&&(r.removeChild(n),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),n=Math.round(e._radius),i=Math.round(e._radiusY||n);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+n+","+i+" 0,23592600")},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){ut(e._container)},_bringToBack:function(e){ct(e._container)}},pi=Ie?hi:Z,fi=li.extend({getEvents:function(){var e=li.prototype.getEvents.call(this);return e.zoomstart=this._onZoomStart,e},_initContainer:function(){this._container=pi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=pi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){st(this._container),Dt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){li.prototype._update.call(this);var e=this._bounds,t=e.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(t)||(this._svgSize=t,n.setAttribute("width",t.x),n.setAttribute("height",t.y)),_t(n,e.min),n.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(e){var t=e._path=pi("path");e.options.className&&dt(t,e.options.className),e.options.interactive&&dt(t,"leaflet-interactive"),this._updateStyle(e),this._layers[a(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){st(e._path),e.removeInteractiveTarget(e._path),delete this._layers[a(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,n=e.options;t&&(n.stroke?(t.setAttribute("stroke",n.color),t.setAttribute("stroke-opacity",n.opacity),t.setAttribute("stroke-width",n.weight),t.setAttribute("stroke-linecap",n.lineCap),t.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?t.setAttribute("stroke-dasharray",n.dashArray):t.removeAttribute("stroke-dasharray"),n.dashOffset?t.setAttribute("stroke-dashoffset",n.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),n.fill?(t.setAttribute("fill",n.fillColor||n.color),t.setAttribute("fill-opacity",n.fillOpacity),t.setAttribute("fill-rule",n.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(e,t){this._setPath(e,Y(e._parts,t))},_updateCircle:function(e){var t=e._point,n=Math.max(Math.round(e._radius),1),i="a"+n+","+(Math.max(Math.round(e._radiusY),1)||n)+" 0 1,0 ",r=e._empty()?"M0 0":"M"+(t.x-n)+","+t.y+i+2*n+",0 "+i+2*-n+",0 ";this._setPath(e,r)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){ut(e._path)},_bringToBack:function(e){ct(e._path)}});function gi(e){return Le||Ie?new fi(e):null}Ie&&fi.include(di),Zt.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if("overlayPane"===e||void 0===e)return!1;var t=this._paneRenderers[e];return void 0===t&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&ci(e)||gi(e)}});var mi=Un.extend({initialize:function(e,t){Un.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return[(e=U(e)).getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});fi.create=pi,fi.pointsToPath=Y,zn.geometryToLayer=Fn,zn.coordsToLatLng=qn,zn.coordsToLatLngs=jn,zn.latLngToCoords=$n,zn.latLngsToCoords=Hn,zn.getFeature=Wn,zn.asFeature=Kn,Zt.mergeOptions({boxZoom:!0});var vi=nn.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){It(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Dt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){st(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||1!==e.which&&1!==e.button)return!1;this._clearDeferredResetState(),this._resetState(),Ye(),Et(),this._startPoint=this._map.mouseEventToContainerPoint(e),It(document,{contextmenu:Ut,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=at("div","leaflet-zoom-box",this._container),dt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new R(this._point,this._startPoint),n=t.getSize();_t(this._box,t.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(st(this._box),pt(this._container,"leaflet-crosshair")),Xe(),Ct(),Dt(document,{contextmenu:Ut,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if((1===e.which||1===e.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(r(this._resetState,this),0);var t=new O(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(e){27===e.keyCode&&this._finish()}});Zt.addInitHook("addHandler","boxZoom",vi),Zt.mergeOptions({doubleClickZoom:!0});var yi=nn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,n=t.getZoom(),i=t.options.zoomDelta,r=e.originalEvent.shiftKey?n-i:n+i;"center"===t.options.doubleClickZoom?t.setZoom(r):t.setZoomAround(e.containerPoint,r)}});Zt.addInitHook("addHandler","doubleClickZoom",yi),Zt.mergeOptions({dragging:!0,inertia:!ie,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var _i=nn.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new un(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}dt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){pt(this._map._container,"leaflet-grab"),pt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=U(this._map.options.maxBounds);this._offsetLimit=M(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(t),this._prunePositions(t)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),n=this._initialWorldOffset,i=this._draggable._newPos.x,r=(i-t+n)%e+t-n,o=(i+t+n)%e-t-n,a=Math.abs(r+n)<Math.abs(o+n)?r:o;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=a},_onDragEnd:function(e){var t=this._map,n=t.options,i=!n.inertia||this._times.length<2;if(t.fire("dragend",e),i)t.fire("moveend");else{this._prunePositions(+new Date);var r=this._lastPos.subtract(this._positions[0]),o=(this._lastTime-this._times[0])/1e3,a=n.easeLinearity,s=r.multiplyBy(a/o),l=s.distanceTo([0,0]),u=Math.min(n.inertiaMaxSpeed,l),c=s.multiplyBy(u/l),h=u/(n.inertiaDeceleration*a),d=c.multiplyBy(-h/2).round();d.x||d.y?(d=t._limitOffset(d,t.options.maxBounds),k((function(){t.panBy(d,{duration:h,easeLinearity:a,noMoveStart:!0,animate:!0})}))):t.fire("moveend")}}});Zt.addInitHook("addHandler","dragging",_i),Zt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var bi=nn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),It(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Dt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,n=e.scrollTop||t.scrollTop,i=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(i,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var t,n,i=this._panKeys={},r=this.keyCodes;for(t=0,n=r.left.length;t<n;t++)i[r.left[t]]=[-1*e,0];for(t=0,n=r.right.length;t<n;t++)i[r.right[t]]=[e,0];for(t=0,n=r.down.length;t<n;t++)i[r.down[t]]=[0,e];for(t=0,n=r.up.length;t<n;t++)i[r.up[t]]=[0,-1*e]},_setZoomDelta:function(e){var t,n,i=this._zoomKeys={},r=this.keyCodes;for(t=0,n=r.zoomIn.length;t<n;t++)i[r.zoomIn[t]]=e;for(t=0,n=r.zoomOut.length;t<n;t++)i[r.zoomOut[t]]=-e},_addHooks:function(){It(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Dt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t,n=e.keyCode,i=this._map;if(n in this._panKeys)i._panAnim&&i._panAnim._inProgress||(t=this._panKeys[n],e.shiftKey&&(t=B(t).multiplyBy(3)),i.panBy(t),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds));else if(n in this._zoomKeys)i.setZoom(i.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!i._popup||!i._popup.options.closeOnEscapeKey)return;i.closePopup()}Ut(e)}}});Zt.addInitHook("addHandler","keyboard",bi),Zt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var wi=nn.extend({addHooks:function(){It(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Dt(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var t=Vt(e),n=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var i=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(r(this._performZoom,this),i),Ut(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),n=this._map.options.zoomSnap||0;e._stop();var i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),r=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,o=n?Math.ceil(r/n)*n:r,a=e._limitZoom(t+(this._delta>0?o:-o))-t;this._delta=0,this._startTime=null,a&&("center"===e.options.scrollWheelZoom?e.setZoom(t+a):e.setZoomAround(this._lastMousePos,t+a))}});Zt.addInitHook("addHandler","scrollWheelZoom",wi),Zt.mergeOptions({tap:!0,tapTolerance:15});var Ei=nn.extend({addHooks:function(){It(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Dt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(e.touches){if(Ot(e),this._fireClick=!0,e.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var t=e.touches[0],n=t.target;this._startPos=this._newPos=new N(t.clientX,t.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&dt(n,"leaflet-active"),this._holdTimeout=setTimeout(r((function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",t))}),this),1e3),this._simulateEvent("mousedown",t),It(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(e){if(clearTimeout(this._holdTimeout),Dt(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&e&&e.changedTouches){var t=e.changedTouches[0],n=t.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&pt(n,"leaflet-active"),this._simulateEvent("mouseup",t),this._isTapValid()&&this._simulateEvent("click",t)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(e){var t=e.touches[0];this._newPos=new N(t.clientX,t.clientY),this._simulateEvent("mousemove",t)},_simulateEvent:function(e,t){var n=document.createEvent("MouseEvents");n._simulated=!0,t.target._simulatedClick=!0,n.initMouseEvent(e,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(n)}});Ee&&!we&&Zt.addInitHook("addHandler","tap",Ei),Zt.mergeOptions({touchZoom:Ee&&!ie,bounceAtZoomLimits:!0});var Ci=nn.extend({addHooks:function(){dt(this._map._container,"leaflet-touch-zoom"),It(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){pt(this._map._container,"leaflet-touch-zoom"),Dt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(e.touches&&2===e.touches.length&&!t._animatingZoom&&!this._zooming){var n=t.mouseEventToContainerPoint(e.touches[0]),i=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),"center"!==t.options.touchZoom&&(this._pinchStartLatLng=t.containerPointToLatLng(n.add(i)._divideBy(2))),this._startDist=n.distanceTo(i),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),It(document,"touchmove",this._onTouchMove,this),It(document,"touchend",this._onTouchEnd,this),Ot(e)}},_onTouchMove:function(e){if(e.touches&&2===e.touches.length&&this._zooming){var t=this._map,n=t.mouseEventToContainerPoint(e.touches[0]),i=t.mouseEventToContainerPoint(e.touches[1]),o=n.distanceTo(i)/this._startDist;if(this._zoom=t.getScaleZoom(o,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&o<1||this._zoom>t.getMaxZoom()&&o>1)&&(this._zoom=t._limitZoom(this._zoom)),"center"===t.options.touchZoom){if(this._center=this._startLatLng,1===o)return}else{var a=n._add(i)._divideBy(2)._subtract(this._centerPoint);if(1===o&&0===a.x&&0===a.y)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(a),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),T(this._animRequest);var s=r(t._move,t,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=k(s,this,!0),Ot(e)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,T(this._animRequest),Dt(document,"touchmove",this._onTouchMove),Dt(document,"touchend",this._onTouchEnd),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});Zt.addInitHook("addHandler","touchZoom",Ci),Zt.BoxZoom=vi,Zt.DoubleClickZoom=yi,Zt.Drag=_i,Zt.Keyboard=bi,Zt.ScrollWheelZoom=wi,Zt.Tap=Ei,Zt.TouchZoom=Ci,Object.freeze=t,e.version="1.6.0",e.Control=Yt,e.control=Xt,e.Browser=De,e.Evented=D,e.Mixin=on,e.Util=x,e.Class=I,e.Handler=nn,e.extend=n,e.bind=r,e.stamp=a,e.setOptions=p,e.DomEvent=Kt,e.DomUtil=Lt,e.PosAnimation=Gt,e.Draggable=un,e.LineUtil=yn,e.PolyUtil=bn,e.Point=N,e.point=B,e.Bounds=R,e.bounds=M,e.Transformation=H,e.transformation=W,e.Projection=Cn,e.LatLng=z,e.latLng=F,e.LatLngBounds=O,e.latLngBounds=U,e.CRS=q,e.GeoJSON=zn,e.geoJSON=Zn,e.geoJson=Yn,e.Layer=xn,e.LayerGroup=Ln,e.layerGroup=function(e,t){return new Ln(e,t)},e.FeatureGroup=In,e.featureGroup=function(e){return new In(e)},e.ImageOverlay=Xn,e.imageOverlay=function(e,t,n){return new Xn(e,t,n)},e.VideoOverlay=Qn,e.videoOverlay=function(e,t,n){return new Qn(e,t,n)},e.SVGOverlay=Jn,e.svgOverlay=function(e,t,n){return new Jn(e,t,n)},e.DivOverlay=ei,e.Popup=ti,e.popup=function(e,t){return new ti(e,t)},e.Tooltip=ni,e.tooltip=function(e,t){return new ni(e,t)},e.Icon=An,e.icon=function(e){return new An(e)},e.DivIcon=ii,e.divIcon=function(e){return new ii(e)},e.Marker=Pn,e.marker=function(e,t){return new Pn(e,t)},e.TileLayer=oi,e.tileLayer=ai,e.GridLayer=ri,e.gridLayer=function(e){return new ri(e)},e.SVG=fi,e.svg=gi,e.Renderer=li,e.Canvas=ui,e.canvas=ci,e.Path=Bn,e.CircleMarker=Rn,e.circleMarker=function(e,t){return new Rn(e,t)},e.Circle=Mn,e.circle=function(e,t,n){return new Mn(e,t,n)},e.Polyline=On,e.polyline=function(e,t){return new On(e,t)},e.Polygon=Un,e.polygon=function(e,t){return new Un(e,t)},e.Rectangle=mi,e.rectangle=function(e,t){return new mi(e,t)},e.Map=Zt,e.map=function(e,t){return new Zt(e,t)};var Si=window.L;e.noConflict=function(){return window.L=Si,this},window.L=e}(t)}));let Ii;!function(e,t,n){L.drawVersion="1.0.4+838a63b",L.Draw={},L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},finish:{title:"Finish drawing",text:"Finish"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker",circlemarker:"Draw a circlemarker"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},circlemarker:{tooltip:{start:"Click map to place circle marker."}},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}}}},edit:{toolbar:{actions:{save:{title:"Save changes",text:"Save"},cancel:{title:"Cancel editing, discards all changes",text:"Cancel"},clearAll:{title:"Clear all layers",text:"Clear All"}},buttons:{edit:"Edit layers",editDisabled:"No layers to edit",remove:"Delete layers",removeDisabled:"No layers to delete"}},handlers:{edit:{tooltip:{text:"Drag handles or markers to edit features.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove."}}}}},L.Draw.Event={},L.Draw.Event.CREATED="draw:created",L.Draw.Event.EDITED="draw:edited",L.Draw.Event.DELETED="draw:deleted",L.Draw.Event.DRAWSTART="draw:drawstart",L.Draw.Event.DRAWSTOP="draw:drawstop",L.Draw.Event.DRAWVERTEX="draw:drawvertex",L.Draw.Event.EDITSTART="draw:editstart",L.Draw.Event.EDITMOVE="draw:editmove",L.Draw.Event.EDITRESIZE="draw:editresize",L.Draw.Event.EDITVERTEX="draw:editvertex",L.Draw.Event.EDITSTOP="draw:editstop",L.Draw.Event.DELETESTART="draw:deletestart",L.Draw.Event.DELETESTOP="draw:deletestop",L.Draw.Event.TOOLBAROPENED="draw:toolbaropened",L.Draw.Event.TOOLBARCLOSED="draw:toolbarclosed",L.Draw.Event.MARKERCONTEXT="draw:markercontext",L.Draw=L.Draw||{},L.Draw.Feature=L.Handler.extend({initialize:function(e,t){this._map=e,this._container=e._container,this._overlayPane=e._panes.overlayPane,this._popupPane=e._panes.popupPane,t&&t.shapeOptions&&(t.shapeOptions=L.Util.extend({},this.options.shapeOptions,t.shapeOptions)),L.setOptions(this,t);var n=L.version.split(".");1===parseInt(n[0],10)&&parseInt(n[1],10)>=2?L.Draw.Feature.include(L.Evented.prototype):L.Draw.Feature.include(L.Mixin.Events)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DRAWSTOP,{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var e=this._map;e&&(L.DomUtil.disableTextSelection(),e.getContainer().focus(),this._tooltip=new L.Draw.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(e){L.setOptions(this,e)},_fireCreatedEvent:function(e){this._map.fire(L.Draw.Event.CREATED,{layer:e,layerType:this.type})},_cancelDrawing:function(e){27===e.keyCode&&(this._map.fire("draw:canceled",{layerType:this.type}),this.disable())}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,feet:!0,nautic:!1,showLength:!0,zIndexOffset:2e3,factor:1,maxPoints:0},initialize:function(e,t){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,t&&t.drawError&&(t.drawError=L.Util.extend({},this.options.drawError,t.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,e,t)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mouseout",this._onMouseOut,this).on("mousemove",this._onMouseMove,this).on("mousedown",this._onMouseDown,this).on("mouseup",this._onMouseUp,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("touchstart",this._onTouch,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("touchstart",this._onTouch,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var e=this._markers.pop(),t=this._poly,n=t.getLatLngs(),i=n.splice(-1,1)[0];this._poly.setLatLngs(n),this._markerGroup.removeLayer(e),t.getLatLngs().length<2&&this._map.removeLayer(t),this._vertexChanged(i,!1)}},addVertex:function(e){this._markers.length>=2&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(e)?this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(e)),this._poly.addLatLng(e),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(e,!0))},completeShape:function(){this._markers.length<=1||!this._shapeIsValid()||(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_finishShape:function(){var e=this._poly._defaultShape?this._poly._defaultShape():this._poly.getLatLngs(),t=this._poly.newLatLngIntersects(e[e.length-1]);!this.options.allowIntersection&&t||!this._shapeIsValid()?this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_shapeIsValid:function(){return!0},_onZoomEnd:function(){null!==this._markers&&this._updateGuide()},_onMouseMove:function(e){var t=this._map.mouseEventToLayerPoint(e.originalEvent),n=this._map.layerPointToLatLng(t);this._currentLatLng=n,this._updateTooltip(n),this._updateGuide(t),this._mouseMarker.setLatLng(n),L.DomEvent.preventDefault(e.originalEvent)},_vertexChanged:function(e,t){this._map.fire(L.Draw.Event.DRAWVERTEX,{layers:this._markerGroup}),this._updateFinishHandler(),this._updateRunningMeasure(e,t),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(e){if(!this._clickHandled&&!this._touchHandled&&!this._disableMarkers){this._onMouseMove(e),this._clickHandled=!0,this._disableNewMarkers();var t=e.originalEvent,n=t.clientX,i=t.clientY;this._startPoint.call(this,n,i)}},_startPoint:function(e,t){this._mouseDownOrigin=L.point(e,t)},_onMouseUp:function(e){var t=e.originalEvent,n=t.clientX,i=t.clientY;this._endPoint.call(this,n,i,e),this._clickHandled=null},_endPoint:function(t,n,i){if(this._mouseDownOrigin){var r=L.point(t,n).distanceTo(this._mouseDownOrigin),o=this._calculateFinishDistance(i.latlng);this.options.maxPoints>1&&this.options.maxPoints==this._markers.length+1?(this.addVertex(i.latlng),this._finishShape()):o<10&&L.Browser.touch?this._finishShape():Math.abs(r)<9*(e.devicePixelRatio||1)&&this.addVertex(i.latlng),this._enableNewMarkers()}this._mouseDownOrigin=null},_onTouch:function(e){var t,n,i=e.originalEvent;!i.touches||!i.touches[0]||this._clickHandled||this._touchHandled||this._disableMarkers||(t=i.touches[0].clientX,n=i.touches[0].clientY,this._disableNewMarkers(),this._touchHandled=!0,this._startPoint.call(this,t,n),this._endPoint.call(this,t,n,e),this._touchHandled=null),this._clickHandled=null},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_calculateFinishDistance:function(e){var t;if(this._markers.length>0){var n;if(this.type===L.Draw.Polyline.TYPE)n=this._markers[this._markers.length-1];else{if(this.type!==L.Draw.Polygon.TYPE)return 1/0;n=this._markers[0]}var i=this._map.latLngToContainerPoint(n.getLatLng()),r=new L.Marker(e,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),o=this._map.latLngToContainerPoint(r.getLatLng());t=i.distanceTo(o)}else t=1/0;return t},_updateFinishHandler:function(){var e=this._markers.length;e>1&&this._markers[e-1].on("click",this._finishShape,this),e>2&&this._markers[e-2].off("click",this._finishShape,this)},_createMarker:function(e){var t=new L.Marker(e,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(t),t},_updateGuide:function(e){var t=this._markers?this._markers.length:0;t>0&&(e=e||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[t-1].getLatLng()),e))},_updateTooltip:function(e){var t=this._getTooltipText();e&&this._tooltip.updatePosition(e),this._errorShown||this._tooltip.updateContent(t)},_drawGuide:function(e,t){var n,i,r,o=Math.floor(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))),a=this.options.guidelineDistance,s=this.options.maxGuideLineLength,l=o>s?o-s:a;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));l<o;l+=this.options.guidelineDistance)n=l/o,i={x:Math.floor(e.x*(1-n)+n*t.x),y:Math.floor(e.y*(1-n)+n*t.y)},(r=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer)).style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(r,i)},_updateGuideColor:function(e){if(this._guidesContainer)for(var t=0,n=this._guidesContainer.childNodes.length;t<n;t++)this._guidesContainer.childNodes[t].style.backgroundColor=e},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var e,t,n=this.options.showLength;return 0===this._markers.length?e={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(t=n?this._getMeasurementString():"",e=1===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:t}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:t}),e},_updateRunningMeasure:function(e,t){var n,i,r=this._markers.length;1===this._markers.length?this._measurementRunningTotal=0:(n=r-(t?2:1),i=L.GeometryUtil.isVersion07x()?e.distanceTo(this._markers[n].getLatLng())*(this.options.factor||1):this._map.distance(e,this._markers[n].getLatLng())*(this.options.factor||1),this._measurementRunningTotal+=i*(t?1:-1))},_getMeasurementString:function(){var e,t=this._currentLatLng,n=this._markers[this._markers.length-1].getLatLng();return e=L.GeometryUtil.isVersion07x()?n&&t&&t.distanceTo?this._measurementRunningTotal+t.distanceTo(n)*(this.options.factor||1):this._measurementRunningTotal||0:n&&t?this._measurementRunningTotal+this._map.distance(t,n)*(this.options.factor||1):this._measurementRunningTotal||0,L.GeometryUtil.readableDistance(e,this.options.metric,this.options.feet,this.options.nautic,this.options.precision)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_disableNewMarkers:function(){this._disableMarkers=!0},_enableNewMarkers:function(){setTimeout(function(){this._disableMarkers=!1}.bind(this),50)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var e=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,e)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,showLength:!1,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0,feet:!0,nautic:!1,precision:{}},initialize:function(e,t){L.Draw.Polyline.prototype.initialize.call(this,e,t),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var e=this._markers.length;1===e&&this._markers[0].on("click",this._finishShape,this),e>2&&(this._markers[e-1].on("dblclick",this._finishShape,this),e>3&&this._markers[e-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var e,t;return 0===this._markers.length?e=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?(e=L.drawLocal.draw.handlers.polygon.tooltip.cont,t=this._getMeasurementString()):(e=L.drawLocal.draw.handlers.polygon.tooltip.end,t=this._getMeasurementString()),{text:e,subtext:t}},_getMeasurementString:function(){var e=this._area,t="";return e||this.options.showLength?(this.options.showLength&&(t=L.Draw.Polyline.prototype._getMeasurementString.call(this)),e&&(t+="<br>"+L.GeometryUtil.readableArea(e,this.options.metric,this.options.precision)),t):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(e,t){var n;!this.options.allowIntersection&&this.options.showArea&&(n=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(n)),L.Draw.Polyline.prototype._vertexChanged.call(this,e,t)},_cleanUpShape:function(){var e=this._markers.length;e>0&&(this._markers[0].off("click",this._finishShape,this),e>2&&this._markers[e-1].off("dblclick",this._finishShape,this))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(e,t){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,e,t)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this).on("touchstart",this._onMouseDown,this).on("touchmove",this._onMouseMove,this),t.addEventListener("touchstart",L.DomEvent.preventDefault,{passive:!1}))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this).off("touchstart",this._onMouseDown,this).off("touchmove",this._onMouseMove,this),L.DomEvent.off(t,"mouseup",this._onMouseUp,this),L.DomEvent.off(t,"touchend",this._onMouseUp,this),t.removeEventListener("touchstart",L.DomEvent.preventDefault),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(e){this._isDrawing=!0,this._startLatLng=e.latlng,L.DomEvent.on(t,"mouseup",this._onMouseUp,this).on(t,"touchend",this._onMouseUp,this).preventDefault(e.originalEvent)},_onMouseMove:function(e){var t=e.latlng;this._tooltip.updatePosition(t),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(t))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showArea:!0,metric:!0},initialize:function(e,t){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,e,t)},disable:function(){this._enabled&&(this._isCurrentlyTwoClickDrawing=!1,L.Draw.SimpleShape.prototype.disable.call(this))},_onMouseUp:function(e){this._shape||this._isCurrentlyTwoClickDrawing?this._isCurrentlyTwoClickDrawing&&!function(e,t){for(;(e=e.parentElement)&&!e.classList.contains(t););return e}(e.target,"leaflet-pane")||L.Draw.SimpleShape.prototype._onMouseUp.call(this):this._isCurrentlyTwoClickDrawing=!0},_drawShape:function(e){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,e)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,e),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var e=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,e)},_getTooltipText:function(){var e,t,n,i=L.Draw.SimpleShape.prototype._getTooltipText.call(this),r=this._shape,o=this.options.showArea;return r&&(e=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),t=L.GeometryUtil.geodesicArea(e),n=o?L.GeometryUtil.readableArea(t,this.options.metric):""),{text:i.text,subtext:n}}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(e,t){this.type=L.Draw.Marker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.marker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,e,t)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:this._initialLabelText}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onTouch,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._map.off("click",this._onClick,this).off("click",this._onTouch,this),this._marker&&(this._marker.off("click",this._onClick,this),this._map.removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(e){var t=e.latlng;this._tooltip.updatePosition(t),this._mouseMarker.setLatLng(t),this._marker?(t=this._mouseMarker.getLatLng(),this._marker.setLatLng(t)):(this._marker=this._createMarker(t),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_createMarker:function(e){return new L.Marker(e,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset})},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_onTouch:function(e){this._onMouseMove(e),this._onClick()},_fireCreatedEvent:function(){var e=new L.Marker.Touch(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,e)}}),L.Draw.CircleMarker=L.Draw.Marker.extend({statics:{TYPE:"circlemarker"},options:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,zIndexOffset:2e3},initialize:function(e,t){this.type=L.Draw.CircleMarker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circlemarker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,e,t)},_fireCreatedEvent:function(){var e=new L.CircleMarker(this._marker.getLatLng(),this.options);L.Draw.Feature.prototype._fireCreatedEvent.call(this,e)},_createMarker:function(e){return new L.CircleMarker(e,this.options)}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0,feet:!0,nautic:!1},initialize:function(e,t){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,e,t)},_drawShape:function(e){if(L.GeometryUtil.isVersion07x())var t=this._startLatLng.distanceTo(e);else t=this._map.distance(this._startLatLng,e);this._shape?this._shape.setRadius(t):(this._shape=new L.Circle(this._startLatLng,t,this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var e=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,e)},_onMouseMove:function(e){var t,n=e.latlng,i=this.options.showRadius,r=this.options.metric;if(this._tooltip.updatePosition(n),this._isDrawing){this._drawShape(n),t=this._shape.getRadius().toFixed(1);var o="";i&&(o=L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(t,r,this.options.feet,this.options.nautic)),this._tooltip.updateContent({text:this._endLabelText,subtext:o})}}}),L.Edit=L.Edit||{},L.Edit.Marker=L.Handler.extend({initialize:function(e,t){this._marker=e,L.setOptions(this,t)},addHooks:function(){var e=this._marker;e.dragging.enable(),e.on("dragend",this._onDragEnd,e),this._toggleMarkerHighlight()},removeHooks:function(){var e=this._marker;e.dragging.disable(),e.off("dragend",this._onDragEnd,e),this._toggleMarkerHighlight()},_onDragEnd:function(e){var t=e.target;t.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:t})},_toggleMarkerHighlight:function(){var e=this._marker._icon;e&&(e.style.display="none",L.DomUtil.hasClass(e,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(e,"leaflet-edit-marker-selected"),this._offsetMarker(e,-4)):(L.DomUtil.addClass(e,"leaflet-edit-marker-selected"),this._offsetMarker(e,4)),e.style.display="")},_offsetMarker:function(e,t){var n=parseInt(e.style.marginTop,10)-t,i=parseInt(e.style.marginLeft,10)-t;e.style.marginTop=n+"px",e.style.marginLeft=i+"px"}}),L.Marker.addInitHook((function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())})),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({initialize:function(e){this.latlngs=[e._latlngs],e._holes&&(this.latlngs=this.latlngs.concat(e._holes)),this._poly=e,this._poly.on("revert-edited",this._updateLatLngs,this)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._poly._latlngs)?this._poly._latlngs:this._poly._latlngs[0]:this._poly._latlngs},_eachVertexHandler:function(e){for(var t=0;t<this._verticesHandlers.length;t++)e(this._verticesHandlers[t])},addHooks:function(){this._initHandlers(),this._eachVertexHandler((function(e){e.addHooks()}))},removeHooks:function(){this._eachVertexHandler((function(e){e.removeHooks()}))},updateMarkers:function(){this._eachVertexHandler((function(e){e.updateMarkers()}))},_initHandlers:function(){this._verticesHandlers=[];for(var e=0;e<this.latlngs.length;e++)this._verticesHandlers.push(new L.Edit.PolyVerticesEdit(this._poly,this.latlngs[e],this._poly.options.poly))},_updateLatLngs:function(e){this.latlngs=[e.layer._latlngs],e.layer._holes&&(this.latlngs=this.latlngs.concat(e.layer._holes))}}),L.Edit.PolyVerticesEdit=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),drawError:{color:"#b00b00",timeout:1e3}},initialize:function(e,t,n){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this._poly=e,n&&n.drawError&&(n.drawError=L.Util.extend({},this.options.drawError,n.drawError)),this._latlngs=t,L.setOptions(this,n)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]:this._latlngs},addHooks:function(){var e=this._poly,t=e._path;e instanceof L.Polygon||(e.options.fill=!1,e.options.editing&&(e.options.editing.fill=!1)),t&&e.options.editing&&e.options.editing.className&&(e.options.original.className&&e.options.original.className.split(" ").forEach((function(e){L.DomUtil.removeClass(t,e)})),e.options.editing.className.split(" ").forEach((function(e){L.DomUtil.addClass(t,e)}))),e.setStyle(e.options.editing),this._poly._map&&(this._map=this._poly._map,this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var e=this._poly,t=e._path;t&&e.options.editing&&e.options.editing.className&&(e.options.editing.className.split(" ").forEach((function(e){L.DomUtil.removeClass(t,e)})),e.options.original.className&&e.options.original.className.split(" ").forEach((function(e){L.DomUtil.addClass(t,e)}))),e.setStyle(e.options.original),e._map&&(e._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var e,t,n,i,r,o,a=this._defaultShape();for(e=0,n=a.length;e<n;e++)(i=this._createMarker(a[e],e)).on("click",this._onMarkerClick,this),i.on("contextmenu",this._onContextMenu,this),this._markers.push(i);for(e=0,t=n-1;e<n;t=e++)(0!==e||L.Polygon&&this._poly instanceof L.Polygon)&&(r=this._markers[t],o=this._markers[e],this._createMiddleMarker(r,o),this._updatePrevNext(r,o))},_createMarker:function(e,t){var n=new L.Marker.Touch(e,{draggable:!0,icon:this.options.icon});return n._origLatLng=e,n._index=t,n.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._fireEdit,this).on("touchmove",this._onTouchMove,this).on("touchend",this._fireEdit,this).on("MSPointerMove",this._onTouchMove,this).on("MSPointerUp",this._fireEdit,this),this._markerGroup.addLayer(n),n},_onMarkerDragStart:function(){this._poly.fire("editstart")},_spliceLatLngs:function(){var e=this._defaultShape(),t=[].splice.apply(e,arguments);return this._poly._convertLatLngs(e,!0),this._poly.redraw(),t},_removeMarker:function(e){var t=e._index;this._markerGroup.removeLayer(e),this._markers.splice(t,1),this._spliceLatLngs(t,1),this._updateIndexes(t,-1),e.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("touchmove",this._onMarkerDrag,this).off("touchend",this._fireEdit,this).off("click",this._onMarkerClick,this).off("MSPointerMove",this._onTouchMove,this).off("MSPointerUp",this._fireEdit,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit"),this._poly._map.fire(L.Draw.Event.EDITVERTEX,{layers:this._markerGroup,poly:this._poly})},_onMarkerDrag:function(e){var t=e.target,n=this._poly,i=L.LatLngUtil.cloneLatLng(t._origLatLng);if(L.extend(t._origLatLng,t._latlng),n.options.poly){var r=n._map._editTooltip;if(!n.options.poly.allowIntersection&&n.intersects()){L.extend(t._origLatLng,i),t.setLatLng(i);var o=n.options.color;n.setStyle({color:this.options.drawError.color}),r&&r.updateContent({text:L.drawLocal.draw.handlers.polyline.error}),setTimeout((function(){n.setStyle({color:o}),r&&r.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext})}),1e3)}}t._middleLeft&&t._middleLeft.setLatLng(this._getMiddleLatLng(t._prev,t)),t._middleRight&&t._middleRight.setLatLng(this._getMiddleLatLng(t,t._next)),this._poly._bounds._southWest=L.latLng(1/0,1/0),this._poly._bounds._northEast=L.latLng(-1/0,-1/0);var a=this._poly.getLatLngs();this._poly._convertLatLngs(a,!0),this._poly.redraw(),this._poly.fire("editdrag")},_onMarkerClick:function(e){var t=L.Polygon&&this._poly instanceof L.Polygon?4:3,n=e.target;this._defaultShape().length<t||(this._removeMarker(n),this._updatePrevNext(n._prev,n._next),n._middleLeft&&this._markerGroup.removeLayer(n._middleLeft),n._middleRight&&this._markerGroup.removeLayer(n._middleRight),n._prev&&n._next?this._createMiddleMarker(n._prev,n._next):n._prev?n._next||(n._prev._middleRight=null):n._next._middleLeft=null,this._fireEdit())},_onContextMenu:function(e){var t=e.target;this._poly,this._poly._map.fire(L.Draw.Event.MARKERCONTEXT,{marker:t,layers:this._markerGroup,poly:this._poly}),L.DomEvent.stopPropagation},_onTouchMove:function(e){var t=this._map.mouseEventToLayerPoint(e.originalEvent.touches[0]),n=this._map.layerPointToLatLng(t),i=e.target;L.extend(i._origLatLng,n),i._middleLeft&&i._middleLeft.setLatLng(this._getMiddleLatLng(i._prev,i)),i._middleRight&&i._middleRight.setLatLng(this._getMiddleLatLng(i,i._next)),this._poly.redraw(),this.updateMarkers()},_updateIndexes:function(e,t){this._markerGroup.eachLayer((function(n){n._index>e&&(n._index+=t)}))},_createMiddleMarker:function(e,t){var n,i,r,o=this._getMiddleLatLng(e,t),a=this._createMarker(o);a.setOpacity(.6),e._middleRight=t._middleLeft=a,i=function(){a.off("touchmove",i,this);var r=t._index;a._index=r,a.off("click",n,this).on("click",this._onMarkerClick,this),o.lat=a.getLatLng().lat,o.lng=a.getLatLng().lng,this._spliceLatLngs(r,0,o),this._markers.splice(r,0,a),a.setOpacity(1),this._updateIndexes(r,1),t._index++,this._updatePrevNext(e,a),this._updatePrevNext(a,t),this._poly.fire("editstart")},r=function(){a.off("dragstart",i,this),a.off("dragend",r,this),a.off("touchmove",i,this),this._createMiddleMarker(e,a),this._createMiddleMarker(a,t)},n=function(){i.call(this),r.call(this),this._fireEdit()},a.on("click",n,this).on("dragstart",i,this).on("dragend",r,this).on("touchmove",i,this),this._markerGroup.addLayer(a)},_updatePrevNext:function(e,t){e&&(e._next=t),t&&(t._prev=e)},_getMiddleLatLng:function(e,t){var n=this._poly._map,i=n.project(e.getLatLng()),r=n.project(t.getLatLng());return n.unproject(i._add(r)._divideBy(2))}}),L.Polyline.addInitHook((function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",(function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()})),this.on("remove",(function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})))})),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"}),touchMoveIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon"}),touchResizeIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon"})},initialize:function(e,t){L.Browser.touch&&(this.options.moveIcon=this.options.touchMoveIcon,this.options.resizeIcon=this.options.touchResizeIcon),this._shape=e,L.Util.setOptions(this,t)},addHooks:function(){var e=this._shape;this._shape._map&&(this._map=this._shape._map,e.setStyle(e.options.editing),e._map&&(this._map=e._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup)))},removeHooks:function(){var e=this._shape;if(e.setStyle(e.options.original),e._map){this._unbindMarker(this._moveMarker);for(var t=0,n=this._resizeMarkers.length;t<n;t++)this._unbindMarker(this._resizeMarkers[t]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(e,t){var n=new L.Marker.Touch(e,{draggable:!0,icon:t,zIndexOffset:10});return this._bindMarker(n),this._markerGroup.addLayer(n),n},_bindMarker:function(e){e.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this).on("touchstart",this._onTouchStart,this).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onTouchEnd,this).on("MSPointerUp",this._onTouchEnd,this)},_unbindMarker:function(e){e.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this).off("touchstart",this._onTouchStart,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onTouchEnd,this).off("MSPointerUp",this._onTouchEnd,this)},_onMarkerDragStart:function(e){e.target.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit")},_onMarkerDrag:function(e){var t=e.target,n=t.getLatLng();t===this._moveMarker?this._move(n):this._resize(n),this._shape.redraw(),this._shape.fire("editdrag")},_onMarkerDragEnd:function(e){e.target.setOpacity(1),this._fireEdit()},_onTouchStart:function(e){if(L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,e),"function"==typeof this._getCorners){var t=this._getCorners(),n=e.target,i=n._cornerIndex;n.setOpacity(0),this._oppositeCorner=t[(i+2)%4],this._toggleCornerMarkers(0,i)}this._shape.fire("editstart")},_onTouchMove:function(e){var t=this._map.mouseEventToLayerPoint(e.originalEvent.touches[0]),n=this._map.layerPointToLatLng(t);return e.target===this._moveMarker?this._move(n):this._resize(n),this._shape.redraw(),!1},_onTouchEnd:function(e){e.target.setOpacity(1),this.updateMarkers(),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var e=this._shape.getBounds().getCenter();this._moveMarker=this._createMarker(e,this.options.moveIcon)},_createResizeMarker:function(){var e=this._getCorners();this._resizeMarkers=[];for(var t=0,n=e.length;t<n;t++)this._resizeMarkers.push(this._createMarker(e[t],this.options.resizeIcon)),this._resizeMarkers[t]._cornerIndex=t},_onMarkerDragStart:function(e){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,e);var t=this._getCorners(),n=e.target._cornerIndex;this._oppositeCorner=t[(n+2)%4],this._toggleCornerMarkers(0,n)},_onMarkerDragEnd:function(e){var t,n=e.target;n===this._moveMarker&&(t=this._shape.getBounds().getCenter(),n.setLatLng(t)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,e)},_move:function(e){for(var t,n=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),i=this._shape.getBounds().getCenter(),r=[],o=0,a=n.length;o<a;o++)t=[n[o].lat-i.lat,n[o].lng-i.lng],r.push([e.lat+t[0],e.lng+t[1]]);this._shape.setLatLngs(r),this._repositionCornerMarkers(),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})},_resize:function(e){var t;this._shape.setBounds(L.latLngBounds(e,this._oppositeCorner)),t=this._shape.getBounds(),this._moveMarker.setLatLng(t.getCenter()),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})},_getCorners:function(){var e=this._shape.getBounds();return[e.getNorthWest(),e.getNorthEast(),e.getSouthEast(),e.getSouthWest()]},_toggleCornerMarkers:function(e){for(var t=0,n=this._resizeMarkers.length;t<n;t++)this._resizeMarkers[t].setOpacity(e)},_repositionCornerMarkers:function(){for(var e=this._getCorners(),t=0,n=this._resizeMarkers.length;t<n;t++)this._resizeMarkers[t].setLatLng(e[t])}}),L.Rectangle.addInitHook((function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())})),L.Edit=L.Edit||{},L.Edit.CircleMarker=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var e=this._shape.getLatLng();this._moveMarker=this._createMarker(e,this.options.moveIcon)},_createResizeMarker:function(){this._resizeMarkers=[]},_move:function(e){if(this._resizeMarkers.length){var t=this._getResizeMarkerPoint(e);this._resizeMarkers[0].setLatLng(t)}this._shape.setLatLng(e),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})}}),L.CircleMarker.addInitHook((function(){L.Edit.CircleMarker&&(this.editing=new L.Edit.CircleMarker(this),this.options.editable&&this.editing.enable()),this.on("add",(function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()})),this.on("remove",(function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))})),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.CircleMarker.extend({_createResizeMarker:function(){var e=this._shape.getLatLng(),t=this._getResizeMarkerPoint(e);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(t,this.options.resizeIcon))},_getResizeMarkerPoint:function(e){var t=this._shape._radius*Math.cos(Math.PI/4),n=this._map.project(e);return this._map.unproject([n.x+t,n.y-t])},_resize:function(e){var t=this._moveMarker.getLatLng();L.GeometryUtil.isVersion07x()?radius=t.distanceTo(e):radius=this._map.distance(t,e),this._shape.setRadius(radius),this._map.editTooltip&&this._map._editTooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.subtext+"<br />"+L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(radius,!0,this.options.feet,this.options.nautic)}),this._shape.setRadius(radius),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})}}),L.Circle.addInitHook((function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable())})),L.Map.mergeOptions({touchExtend:!0}),L.Map.TouchExtend=L.Handler.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.on(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.on(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.on(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.on(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.on(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.on(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.on(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.on(this._container,"touchleave",this._onTouchLeave,this))},removeHooks:function(){L.DomEvent.off(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.off(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.off(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.off(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.off(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.off(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.off(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.off(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.off(this._container,"touchleave",this._onTouchLeave,this))},_touchEvent:function(e,t){var n={};if(void 0!==e.touches){if(!e.touches.length)return;n=e.touches[0]}else{if("touch"!==e.pointerType)return;if(n=e,!this._filterClick(e))return}var i=this._map.mouseEventToContainerPoint(n),r=this._map.mouseEventToLayerPoint(n),o=this._map.layerPointToLatLng(r);this._map.fire(t,{latlng:o,layerPoint:r,containerPoint:i,pageX:n.pageX,pageY:n.pageY,originalEvent:e})},_filterClick:function(e){var t=e.timeStamp||e.originalEvent.timeStamp,n=L.DomEvent._lastClick&&t-L.DomEvent._lastClick;return n&&n>100&&n<500||e.target._simulatedClick&&!e._simulated?(L.DomEvent.stop(e),!1):(L.DomEvent._lastClick=t,!0)},_onTouchStart:function(e){this._map._loaded&&this._touchEvent(e,"touchstart")},_onTouchEnd:function(e){this._map._loaded&&this._touchEvent(e,"touchend")},_onTouchCancel:function(e){if(this._map._loaded){var t="touchcancel";this._detectIE()&&(t="pointercancel"),this._touchEvent(e,t)}},_onTouchLeave:function(e){this._map._loaded&&this._touchEvent(e,"touchleave")},_onTouchMove:function(e){this._map._loaded&&this._touchEvent(e,"touchmove")},_detectIE:function(){var t=e.navigator.userAgent,n=t.indexOf("MSIE ");if(n>0)return parseInt(t.substring(n+5,t.indexOf(".",n)),10);if(t.indexOf("Trident/")>0){var i=t.indexOf("rv:");return parseInt(t.substring(i+3,t.indexOf(".",i)),10)}var r=t.indexOf("Edge/");return r>0&&parseInt(t.substring(r+5,t.indexOf(".",r)),10)}}),L.Map.addInitHook("addHandler","touchExtend",L.Map.TouchExtend),L.Marker.Touch=L.Marker.extend({_initInteraction:function(){return this.addInteractiveTarget?L.Marker.prototype._initInteraction.apply(this):this._initInteractionLegacy()},_initInteractionLegacy:function(){if(this.options.clickable){var e=this._icon,t=["dblclick","mousedown","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove"];this._detectIE?t.concat(["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"]):t.concat(["touchcancel"]),L.DomUtil.addClass(e,"leaflet-clickable"),L.DomEvent.on(e,"click",this._onMouseClick,this),L.DomEvent.on(e,"keypress",this._onKeyPress,this);for(var n=0;n<t.length;n++)L.DomEvent.on(e,t[n],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_detectIE:function(){var t=e.navigator.userAgent,n=t.indexOf("MSIE ");if(n>0)return parseInt(t.substring(n+5,t.indexOf(".",n)),10);if(t.indexOf("Trident/")>0){var i=t.indexOf("rv:");return parseInt(t.substring(i+3,t.indexOf(".",i)),10)}var r=t.indexOf("Edge/");return r>0&&parseInt(t.substring(r+5,t.indexOf(".",r)),10)}}),L.LatLngUtil={cloneLatLngs:function(e){for(var t=[],n=0,i=e.length;n<i;n++)Array.isArray(e[n])?t.push(L.LatLngUtil.cloneLatLngs(e[n])):t.push(this.cloneLatLng(e[n]));return t},cloneLatLng:function(e){return L.latLng(e.lat,e.lng)}},function(){var e={km:2,ha:2,m:0,mi:2,ac:2,yd:0,ft:0,nm:2};L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(e){var t,n,i=e.length,r=0,o=Math.PI/180;if(i>2){for(var a=0;a<i;a++)t=e[a],r+=((n=e[(a+1)%i]).lng-t.lng)*o*(2+Math.sin(t.lat*o)+Math.sin(n.lat*o));r=6378137*r*6378137/2}return Math.abs(r)},formattedNumber:function(e,t){var n=parseFloat(e).toFixed(t),i=L.drawLocal.format&&L.drawLocal.format.numeric,r=i&&i.delimiters,o=r&&r.thousands,a=r&&r.decimal;if(o||a){var s=n.split(".");n=o?s[0].replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+o):s[0],a=a||".",s.length>1&&(n=n+a+s[1])}return n},readableArea:function(t,n,i){var r,o,a;i=L.Util.extend({},e,i);return n?(o=["ha","m"],"string"===(a=typeof n)?o=[n]:"boolean"!==a&&(o=n),r=t>=1e6&&-1!==o.indexOf("km")?L.GeometryUtil.formattedNumber(1e-6*t,i.km)+" km²":t>=1e4&&-1!==o.indexOf("ha")?L.GeometryUtil.formattedNumber(1e-4*t,i.ha)+" ha":L.GeometryUtil.formattedNumber(t,i.m)+" m²"):r=(t/=.836127)>=3097600?L.GeometryUtil.formattedNumber(t/3097600,i.mi)+" mi²":t>=4840?L.GeometryUtil.formattedNumber(t/4840,i.ac)+" acres":L.GeometryUtil.formattedNumber(t,i.yd)+" yd²",r},readableDistance:function(t,n,i,r,o){var a;o=L.Util.extend({},e,o);switch(n?"string"==typeof n?n:"metric":i?"feet":r?"nauticalMile":"yards"){case"metric":a=t>1e3?L.GeometryUtil.formattedNumber(t/1e3,o.km)+" km":L.GeometryUtil.formattedNumber(t,o.m)+" m";break;case"feet":t*=3.28083,a=L.GeometryUtil.formattedNumber(t,o.ft)+" ft";break;case"nauticalMile":t*=.53996,a=L.GeometryUtil.formattedNumber(t/1e3,o.nm)+" nm";break;case"yards":default:a=(t*=1.09361)>1760?L.GeometryUtil.formattedNumber(t/1760,o.mi)+" miles":L.GeometryUtil.formattedNumber(t,o.yd)+" yd"}return a},isVersion07x:function(){var e=L.version.split(".");return 0===parseInt(e[0],10)&&7===parseInt(e[1],10)}})}(),L.Util.extend(L.LineUtil,{segmentsIntersect:function(e,t,n,i){return this._checkCounterclockwise(e,n,i)!==this._checkCounterclockwise(t,n,i)&&this._checkCounterclockwise(e,t,n)!==this._checkCounterclockwise(e,t,i)},_checkCounterclockwise:function(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}}),L.Polyline.include({intersects:function(){var e,t,n,i=this._getProjectedPoints(),r=i?i.length:0;if(this._tooFewPointsForIntersection())return!1;for(e=r-1;e>=3;e--)if(t=i[e-1],n=i[e],this._lineSegmentsIntersectsRange(t,n,e-2))return!0;return!1},newLatLngIntersects:function(e,t){return!!this._map&&this.newPointIntersects(this._map.latLngToLayerPoint(e),t)},newPointIntersects:function(e,t){var n=this._getProjectedPoints(),i=n?n.length:0,r=n?n[i-1]:null,o=i-2;return!this._tooFewPointsForIntersection(1)&&this._lineSegmentsIntersectsRange(r,e,o,t?1:0)},_tooFewPointsForIntersection:function(e){var t=this._getProjectedPoints(),n=t?t.length:0;return!t||(n+=e||0)<=3},_lineSegmentsIntersectsRange:function(e,t,n,i){var r,o,a=this._getProjectedPoints();i=i||0;for(var s=n;s>i;s--)if(r=a[s-1],o=a[s],L.LineUtil.segmentsIntersect(e,t,r,o))return!0;return!1},_getProjectedPoints:function(){if(!this._defaultShape)return this._originalPoints;for(var e=[],t=this._defaultShape(),n=0;n<t.length;n++)e.push(this._map.latLngToLayerPoint(t[n]));return e}}),L.Polygon.include({intersects:function(){var e,t,n,i,r=this._getProjectedPoints();return!this._tooFewPointsForIntersection()&&(!!L.Polyline.prototype.intersects.call(this)||(e=r.length,t=r[0],n=r[e-1],i=e-2,this._lineSegmentsIntersectsRange(n,t,i,1)))}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(e){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");var t;L.Control.prototype.initialize.call(this,e),this._toolbars={},L.DrawToolbar&&this.options.draw&&(t=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=t,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(t=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=t,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.toolbar=this},onAdd:function(e){var t,n=L.DomUtil.create("div","leaflet-draw"),i=!1;for(var r in this._toolbars)this._toolbars.hasOwnProperty(r)&&(t=this._toolbars[r].addToolbar(e))&&(i||(L.DomUtil.hasClass(t,"leaflet-draw-toolbar-top")||L.DomUtil.addClass(t.childNodes[0],"leaflet-draw-toolbar-top"),i=!0),n.appendChild(t));return n},onRemove:function(){for(var e in this._toolbars)this._toolbars.hasOwnProperty(e)&&this._toolbars[e].removeToolbar()},setDrawingOptions:function(e){for(var t in this._toolbars)this._toolbars[t]instanceof L.DrawToolbar&&this._toolbars[t].setOptions(e)},_toolbarEnabled:function(e){var t=e.target;for(var n in this._toolbars)this._toolbars[n]!==t&&this._toolbars[n].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook((function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))})),L.Toolbar=L.Class.extend({initialize:function(e){L.setOptions(this,e),this._modes={},this._actionButtons=[],this._activeMode=null;var t=L.version.split(".");1===parseInt(t[0],10)&&parseInt(t[1],10)>=2?L.Toolbar.include(L.Evented.prototype):L.Toolbar.include(L.Mixin.Events)},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(e){var t,n=L.DomUtil.create("div","leaflet-draw-section"),i=0,r=this._toolbarClass||"",o=this.getModeHandlers(e);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=e,t=0;t<o.length;t++)o[t].enabled&&this._initModeHandler(o[t].handler,this._toolbarContainer,i++,r,o[t].title);if(i)return this._lastButtonIndex=--i,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),n.appendChild(this._toolbarContainer),n.appendChild(this._actionsContainer),n},removeToolbar:function(){for(var e in this._modes)this._modes.hasOwnProperty(e)&&(this._disposeButton(this._modes[e].button,this._modes[e].handler.enable,this._modes[e].handler),this._modes[e].handler.disable(),this._modes[e].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var t=0,n=this._actionButtons.length;t<n;t++)this._disposeButton(this._actionButtons[t].button,this._actionButtons[t].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(e,t,n,i,r){var o=e.type;this._modes[o]={},this._modes[o].handler=e,this._modes[o].button=this._createButton({type:o,title:r,className:i+"-"+o,container:t,callback:this._modes[o].handler.enable,context:this._modes[o].handler}),this._modes[o].buttonIndex=n,this._modes[o].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_detectIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!e.MSStream},_createButton:function(e){var t=L.DomUtil.create("a",e.className||"",e.container),n=L.DomUtil.create("span","sr-only",e.container);t.href="#",t.appendChild(n),e.title&&(t.title=e.title,n.innerHTML=e.title),e.text&&(t.innerHTML=e.text,n.innerHTML=e.text);var i=this._detectIOS()?"touchstart":"click";return L.DomEvent.on(t,"click",L.DomEvent.stopPropagation).on(t,"mousedown",L.DomEvent.stopPropagation).on(t,"dblclick",L.DomEvent.stopPropagation).on(t,"touchstart",L.DomEvent.stopPropagation).on(t,"click",L.DomEvent.preventDefault).on(t,i,e.callback,e.context),t},_disposeButton:function(e,t){var n=this._detectIOS()?"touchstart":"click";L.DomEvent.off(e,"click",L.DomEvent.stopPropagation).off(e,"mousedown",L.DomEvent.stopPropagation).off(e,"dblclick",L.DomEvent.stopPropagation).off(e,"touchstart",L.DomEvent.stopPropagation).off(e,"click",L.DomEvent.preventDefault).off(e,n,t)},_handlerActivated:function(e){this.disable(),this._activeMode=this._modes[e.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(e){var t,n,i,r,o=this._actionsContainer,a=this.getActions(e),s=a.length;for(n=0,i=this._actionButtons.length;n<i;n++)this._disposeButton(this._actionButtons[n].button,this._actionButtons[n].callback);for(this._actionButtons=[];o.firstChild;)o.removeChild(o.firstChild);for(var l=0;l<s;l++)"enabled"in a[l]&&!a[l].enabled||(t=L.DomUtil.create("li","",o),r=this._createButton({title:a[l].title,text:a[l].text,container:t,callback:a[l].callback,context:a[l].context}),this._actionButtons.push({button:r,callback:a[l].callback}))},_showActionsToolbar:function(){var e=this._activeMode.buttonIndex,t=this._lastButtonIndex,n=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=n+"px",0===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),e===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block",this._map.fire(L.Draw.Event.TOOLBAROPENED)},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom"),this._map.fire(L.Draw.Event.TOOLBARCLOSED)}}),L.Draw=L.Draw||{},L.Draw.Tooltip=L.Class.extend({initialize:function(e){this._map=e,this._popupPane=e._panes.popupPane,this._visible=!1,this._container=e.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(e){return this._container?(e.subtext=e.subtext||"",0!==e.subtext.length||this._singleLineLabel?e.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(e.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+e.subtext+"</span><br />":"")+"<span>"+e.text+"</span>",e.text||e.subtext?(this._visible=!0,this._container.style.visibility="inherit"):(this._visible=!1,this._container.style.visibility="hidden"),this):this},updatePosition:function(e){var t=this._map.latLngToLayerPoint(e),n=this._container;return this._container&&(this._visible&&(n.style.visibility="inherit"),L.DomUtil.setPosition(n,t)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}}),L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{},circlemarker:{}},initialize:function(e){for(var t in this.options)this.options.hasOwnProperty(t)&&e[t]&&(e[t]=L.extend({},this.options[t],e[t]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,e)},getModeHandlers:function(e){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(e,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(e,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(e,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(e,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(e,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.circlemarker,handler:new L.Draw.CircleMarker(e,this.options.circlemarker),title:L.drawLocal.draw.toolbar.buttons.circlemarker}]},getActions:function(e){return[{enabled:e.completeShape,title:L.drawLocal.draw.toolbar.finish.title,text:L.drawLocal.draw.toolbar.finish.text,callback:e.completeShape,context:e},{enabled:e.deleteLastVertex,title:L.drawLocal.draw.toolbar.undo.title,text:L.drawLocal.draw.toolbar.undo.text,callback:e.deleteLastVertex,context:e},{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(e){for(var t in L.setOptions(this,e),this._modes)this._modes.hasOwnProperty(t)&&e.hasOwnProperty(t)&&this._modes[t].handler.setOptions(e[t])}}),L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1}},remove:{},poly:null,featureGroup:null},initialize:function(e){e.edit&&(void 0===e.edit.selectedPathOptions&&(e.edit.selectedPathOptions=this.options.edit.selectedPathOptions),e.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,e.edit.selectedPathOptions)),e.remove&&(e.remove=L.extend({},this.options.remove,e.remove)),e.poly&&(e.poly=L.extend({},this.options.poly,e.poly)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,e),this._selectedFeatureCount=0},getModeHandlers:function(e){var t=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(e,{featureGroup:t,selectedPathOptions:this.options.edit.selectedPathOptions,poly:this.options.poly}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(e,{featureGroup:t}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(e){var t=[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}];return e.removeAllLayers&&t.push({title:L.drawLocal.edit.toolbar.actions.clearAll.title,text:L.drawLocal.edit.toolbar.actions.clearAll.text,callback:this._clearAllLayers,context:this}),t},addToolbar:function(e){var t=L.Toolbar.prototype.addToolbar.call(this,e);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),t},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode&&this._activeMode.handler.disable()},_clearAllLayers:function(){this._activeMode.handler.removeAllLayers(),this._activeMode&&this._activeMode.handler.disable()},_checkDisabled:function(){var e,t=0!==this.options.featureGroup.getLayers().length;this.options.edit&&(e=this._modes[L.EditToolbar.Edit.TYPE].button,t?L.DomUtil.removeClass(e,"leaflet-disabled"):L.DomUtil.addClass(e,"leaflet-disabled"),e.setAttribute("title",t?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(e=this._modes[L.EditToolbar.Delete.TYPE].button,t?L.DomUtil.removeClass(e,"leaflet-disabled"):L.DomUtil.addClass(e,"leaflet-disabled"),e.setAttribute("title",t?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},initialize:function(e,t){if(L.Handler.prototype.initialize.call(this,e),L.setOptions(this,t),this._featureGroup=t.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE;var n=L.version.split(".");1===parseInt(n[0],10)&&parseInt(n[1],10)>=2?L.EditToolbar.Edit.include(L.Evented.prototype):L.EditToolbar.Edit.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.EDITSTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.EDITSTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var e=this._map;e&&(e.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),e._editTooltip=this._tooltip,this._updateTooltip(),this._map.on("mousemove",this._onMouseMove,this).on("touchmove",this._onMouseMove,this).on("MSPointerMove",this._onMouseMove,this).on(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this).off("touchmove",this._onMouseMove,this).off("MSPointerMove",this._onMouseMove,this).off(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},revertLayers:function(){this._featureGroup.eachLayer((function(e){this._revertLayer(e)}),this)},save:function(){var e=new L.LayerGroup;this._featureGroup.eachLayer((function(t){t.edited&&(e.addLayer(t),t.edited=!1)})),this._map.fire(L.Draw.Event.EDITED,{layers:e})},_backupLayer:function(e){var t=L.Util.stamp(e);this._uneditedLayerProps[t]||(e instanceof L.Polyline||e instanceof L.Polygon||e instanceof L.Rectangle?this._uneditedLayerProps[t]={latlngs:L.LatLngUtil.cloneLatLngs(e.getLatLngs())}:e instanceof L.Circle?this._uneditedLayerProps[t]={latlng:L.LatLngUtil.cloneLatLng(e.getLatLng()),radius:e.getRadius()}:(e instanceof L.Marker||e instanceof L.CircleMarker)&&(this._uneditedLayerProps[t]={latlng:L.LatLngUtil.cloneLatLng(e.getLatLng())}))},_getTooltipText:function(){return{text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}},_updateTooltip:function(){this._tooltip.updateContent(this._getTooltipText())},_revertLayer:function(e){var t=L.Util.stamp(e);e.edited=!1,this._uneditedLayerProps.hasOwnProperty(t)&&(e instanceof L.Polyline||e instanceof L.Polygon||e instanceof L.Rectangle?e.setLatLngs(this._uneditedLayerProps[t].latlngs):e instanceof L.Circle?(e.setLatLng(this._uneditedLayerProps[t].latlng),e.setRadius(this._uneditedLayerProps[t].radius)):(e instanceof L.Marker||e instanceof L.CircleMarker)&&e.setLatLng(this._uneditedLayerProps[t].latlng),e.fire("revert-edited",{layer:e}))},_enableLayerEdit:function(e){var t,n,i=e.layer||e.target||e;this._backupLayer(i),this.options.poly&&(n=L.Util.extend({},this.options.poly),i.options.poly=n),this.options.selectedPathOptions&&((t=L.Util.extend({},this.options.selectedPathOptions)).maintainColor&&(t.color=i.options.color,t.fillColor=i.options.fillColor),i.options.original=L.extend({},i.options),i.options.editing=t),i instanceof L.Marker?(i.editing&&i.editing.enable(),i.dragging.enable(),i.on("dragend",this._onMarkerDragEnd).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onMarkerDragEnd,this).on("MSPointerUp",this._onMarkerDragEnd,this)):i.editing.enable()},_disableLayerEdit:function(e){var t=e.layer||e.target||e;t.edited=!1,t.editing&&t.editing.disable(),delete t.options.editing,delete t.options.original,this._selectedPathOptions&&(t instanceof L.Marker?this._toggleMarkerHighlight(t):(t.setStyle(t.options.previousOptions),delete t.options.previousOptions)),t instanceof L.Marker?(t.dragging.disable(),t.off("dragend",this._onMarkerDragEnd,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onMarkerDragEnd,this).off("MSPointerUp",this._onMarkerDragEnd,this)):t.editing.disable()},_onMouseMove:function(e){this._tooltip.updatePosition(e.latlng)},_onMarkerDragEnd:function(e){var t=e.target;t.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:t})},_onTouchMove:function(e){var t=e.originalEvent.changedTouches[0],n=this._map.mouseEventToLayerPoint(t),i=this._map.layerPointToLatLng(n);e.target.setLatLng(i)},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},initialize:function(e,t){if(L.Handler.prototype.initialize.call(this,e),L.Util.setOptions(this,t),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE;var n=L.version.split(".");1===parseInt(n[0],10)&&parseInt(n[1],10)>=2?L.EditToolbar.Delete.include(L.Evented.prototype):L.EditToolbar.Delete.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DELETESTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DELETESTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var e=this._map;e&&(e.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._deletedLayers.eachLayer((function(e){this._deletableLayers.addLayer(e),e.fire("revert-deleted",{layer:e})}),this)},save:function(){this._map.fire(L.Draw.Event.DELETED,{layers:this._deletedLayers})},removeAllLayers:function(){this._deletableLayers.eachLayer((function(e){this._removeLayer({layer:e})}),this),this.save()},_enableLayerDelete:function(e){(e.layer||e.target||e).on("click",this._removeLayer,this)},_disableLayerDelete:function(e){var t=e.layer||e.target||e;t.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(t)},_removeLayer:function(e){var t=e.layer||e.target||e;this._deletableLayers.removeLayer(t),this._deletedLayers.addLayer(t),t.fire("deleted")},_onMouseMove:function(e){this._tooltip.updatePosition(e.latlng)},_hasAvailableLayers:function(){return 0!==this._deletableLayers.getLayers().length}})}(window,document),L.GridLayer.GoogleMutant=L.GridLayer.extend({options:{minZoom:0,maxZoom:23,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,type:"roadmap",maxNativeZoom:21},initialize:function(e){L.GridLayer.prototype.initialize.call(this,e),this._ready=!!window.google&&!!window.google.maps&&!!window.google.maps.Map,this._GAPIPromise=this._ready?Promise.resolve(window.google):new Promise((function(e,t){var n=0,i=null;i=setInterval((function(){return n>=10?(clearInterval(i),t(new Error("window.google not found after 10 attempts"))):window.google&&window.google.maps&&window.google.maps.Map?(clearInterval(i),e(window.google)):void n++}),500)})),this._tileCallbacks={},this._freshTiles={},this._imagesPerTile="hybrid"===this.options.type?2:1,this._boundOnMutatedImage=this._onMutatedImage.bind(this)},onAdd:function(e){L.GridLayer.prototype.onAdd.call(this,e),this._initMutantContainer(),this._GAPIPromise.then(function(){if(this._ready=!0,this._map=e,this._initMutant(),e.on("viewreset",this._reset,this),this.options.updateWhenIdle?e.on("moveend",this._update,this):e.on("move",this._update,this),e.on("zoomend",this._handleZoomAnim,this),e.on("resize",this._resize,this),google.maps.event.addListenerOnce(this._mutant,"idle",function(){this._checkZoomLevels(),this._mutantIsReady=!0}.bind(this)),e._controlCorners.bottomright.style.marginBottom="20px",e._controlCorners.bottomleft.style.marginBottom="20px",this._reset(),this._update(),this._subLayers)for(var t in this._subLayers)this._subLayers[t].setMap(this._mutant)}.bind(this))},onRemove:function(e){L.GridLayer.prototype.onRemove.call(this,e),this._observer.disconnect(),e._container.removeChild(this._mutantContainer),google.maps.event.clearListeners(e,"idle"),google.maps.event.clearListeners(this._mutant,"idle"),e.off("viewreset",this._reset,this),e.off("move",this._update,this),e.off("moveend",this._update,this),e.off("zoomend",this._handleZoomAnim,this),e.off("resize",this._resize,this),e._controlCorners&&(e._controlCorners.bottomright.style.marginBottom="0em",e._controlCorners.bottomleft.style.marginBottom="0em")},getAttribution:function(){return this.options.attribution},setElementSize:function(e,t){e.style.width=t.x+"px",e.style.height=t.y+"px"},addGoogleLayer:function(e,t){return this._subLayers||(this._subLayers={}),this._GAPIPromise.then(function(){var n=new(0,google.maps[e])(t);return n.setMap(this._mutant),this._subLayers[e]=n,n}.bind(this))},removeGoogleLayer:function(e){var t=this._subLayers&&this._subLayers[e];t&&(t.setMap(null),delete this._subLayers[e])},_initMutantContainer:function(){this._mutantContainer||(this._mutantContainer=L.DomUtil.create("div","leaflet-google-mutant leaflet-top leaflet-left"),this._mutantContainer.id="_MutantContainer_"+L.Util.stamp(this._mutantContainer),this._mutantContainer.style.zIndex="800",this._mutantContainer.style.pointerEvents="none",L.DomEvent.off(this._mutantContainer)),this._map.getContainer().appendChild(this._mutantContainer),this.setOpacity(this.options.opacity),this.setElementSize(this._mutantContainer,this._map.getSize()),this._attachObserver(this._mutantContainer)},_initMutant:function(){if(this._ready&&this._mutantContainer)if(this._mutant)this._resize();else{this._mutantCenter=new google.maps.LatLng(0,0);var e=new google.maps.Map(this._mutantContainer,{center:this._mutantCenter,zoom:0,tilt:0,mapTypeId:this.options.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.styles||{},backgroundColor:"transparent"});this._mutant=e,google.maps.event.addListenerOnce(e,"idle",function(){for(var e=this._mutantContainer.querySelectorAll("a"),t=0;t<e.length;t++)e[t].style.pointerEvents="auto"}.bind(this)),this.fire("spawned",{mapObject:e})}},_attachObserver:function(e){this._observer||(this._observer=new MutationObserver(this._onMutations.bind(this))),this._observer.observe(e,{childList:!0,subtree:!0}),Array.prototype.forEach.call(e.querySelectorAll("img"),this._boundOnMutatedImage)},_onMutations:function(e){for(var t=0;t<e.length;++t)for(var n=e[t],i=0;i<n.addedNodes.length;++i){var r=n.addedNodes[i];r instanceof HTMLImageElement?this._onMutatedImage(r):r instanceof HTMLElement&&(Array.prototype.forEach.call(r.querySelectorAll("img"),this._boundOnMutatedImage),"white"===r.style.backgroundColor&&L.DomUtil.remove(r),0===r.textContent.indexOf("For development purposes only")&&L.DomUtil.remove(r),Array.prototype.forEach.call(r.querySelectorAll('div[draggable=false][style*="text-align: center"]'),L.DomUtil.remove))}},_roadRegexp:/!1i(\d+)!2i(\d+)!3i(\d+)!/,_satRegexp:/x=(\d+)&y=(\d+)&z=(\d+)/,_staticRegExp:/StaticMapService\.GetMapImage/,_onMutatedImage:function(e){var t,n=e.src.match(this._roadRegexp),i=0;if(n?(t={z:n[1],x:n[2],y:n[3]},this._imagesPerTile>1&&(e.style.zIndex=1,i=1)):((n=e.src.match(this._satRegexp))&&(t={x:n[1],y:n[2],z:n[3]}),i=0),t){var r=this._tileCoordsToKey(t);e.style.position="absolute",e.style.visibility="hidden";var o=r+"/"+i;if(this._freshTiles[o]=e,o in this._tileCallbacks&&this._tileCallbacks[o])this._tileCallbacks[o].pop()(e),this._tileCallbacks[o].length||delete this._tileCallbacks[o];else if(this._tiles[r]){var a=this._tiles[r].el,s=0===i?a.firstChild:a.firstChild.nextSibling,l=this._clone(e);a.replaceChild(l,s)}}else e.src.match(this._staticRegExp)&&(e.style.visibility="hidden")},createTile:function(e,t){var n=this._tileCoordsToKey(e),i=L.DomUtil.create("div");i.dataset.pending=this._imagesPerTile,t=t.bind(this,null,i);for(var r=0;r<this._imagesPerTile;r++){var o=n+"/"+r;if(o in this._freshTiles){var a=this._freshTiles[o];i.appendChild(this._clone(a)),i.dataset.pending--}else this._tileCallbacks[o]=this._tileCallbacks[o]||[],this._tileCallbacks[o].push(function(e){return function(n){e.appendChild(this._clone(n)),e.dataset.pending--,parseInt(e.dataset.pending)||t()}.bind(this)}.bind(this)(i))}return parseInt(i.dataset.pending)||L.Util.requestAnimFrame(t),i},_clone:function(e){var t=e.cloneNode(!0);return t.style.visibility="visible",t},_checkZoomLevels:function(){var e=this._map.getZoom(),t=this._mutant.getZoom();e&&t&&(t!==e||t>this.options.maxNativeZoom)&&this._setMaxNativeZoom(t)},_setMaxNativeZoom:function(e){e!=this.options.maxNativeZoom&&(this.options.maxNativeZoom=e,this._resetView())},_reset:function(){this._initContainer()},_update:function(){if(this._mutant){var e=this._map.getCenter(),t=new google.maps.LatLng(e.lat,e.lng);this._mutant.setCenter(t);var n=this._map.getZoom(),i=n!==Math.round(n),r=this._mutant.getZoom();i||n==r||(this._mutant.setZoom(n),this._mutantIsReady&&this._checkZoomLevels())}L.GridLayer.prototype._update.call(this)},_resize:function(){var e=this._map.getSize();this._mutantContainer.style.width===e.x&&this._mutantContainer.style.height===e.y||(this.setElementSize(this._mutantContainer,e),this._mutant&&google.maps.event.trigger(this._mutant,"resize"))},_handleZoomAnim:function(){if(!this._mutant)return;var e=this._map.getCenter(),t=new google.maps.LatLng(e.lat,e.lng);this._mutant.setCenter(t),this._mutant.setZoom(Math.round(this._map.getZoom()));const n=this._mutant.getZoom();for(let e of Object.keys(this._freshTiles)){n!=e.split(":")[2]&&delete this._freshTiles[e]}},_removeTile:function(e){if(this._mutant)return setTimeout(this._pruneTile.bind(this,e),1e3),L.GridLayer.prototype._removeTile.call(this,e)},_getLargeGMapBound:function(e){const t=e.getSouthWest(),n=e.getNorthEast(),i=t.lat(),r=t.lng(),o=n.lat(),a=n.lng(),s=Math.abs(o-i),l=Math.abs(a-r);return L.latLngBounds([[i-s,r-l],[o+s,a+l]])},_pruneTile:function(e){var t=this._mutant.getZoom(),n=e.split(":")[2];const i=this._mutant.getBounds(),r=this._getLargeGMapBound(i);for(var o=0;o<this._imagesPerTile;o++){var a=e+"/"+o;if(a in this._freshTiles){var s=this._map&&this._keyToBounds(e);this._map&&s.overlaps(r)&&n==t||delete this._freshTiles[a]}}}}),L.gridLayer.googleMutant=function(e){return new L.GridLayer.GoogleMutant(e)};const Ai=a&&a.maps&&a.maps.length>0?a.maps:[{name:"streets",maxzoom:24,tiles:["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"],attribution:'© <a href="http://openstreetmap.org">OpenStreetMap</a> | <a href="www.openstreetmap.org/copyright">Terms</a>'}];let Di="https://maps.googleapis.com/maps/api/geocode/json?address={address}&sensor=true&key={api_key}";const Ni=a.googleApiKey||a.google_api_key,Pi=Li.divIcon({iconSize:24,className:"enketo-geopoint-marker"}),Bi=Li.divIcon({iconSize:16,className:"enketo-geopoint-circle-marker"}),Ri=Li.divIcon({iconSize:16,className:"enketo-geopoint-circle-marker-active"});u((function(e,t){
/*!
     * Datepicker for Bootstrap v1.9.0 (https://github.com/uxsolutions/bootstrap-datepicker)
     *
     * Licensed under the Apache License v2.0 (http://www.apache.org/licenses/LICENSE-2.0)
     */
!function(e,t){function n(){return new Date(Date.UTC.apply(Date,arguments))}function i(){var e=new Date;return n(e.getFullYear(),e.getMonth(),e.getDate())}function r(e,t){return e.getUTCFullYear()===t.getUTCFullYear()&&e.getUTCMonth()===t.getUTCMonth()&&e.getUTCDate()===t.getUTCDate()}function o(n,i){return function(){return i!==t&&e.fn.datepicker.deprecated(i),this[n].apply(this,arguments)}}var a,s=(a={get:function(e){return this.slice(e)[0]},contains:function(e){for(var t=e&&e.valueOf(),n=0,i=this.length;n<i;n++)if(0<=this[n].valueOf()-t&&this[n].valueOf()-t<864e5)return n;return-1},remove:function(e){this.splice(e,1)},replace:function(t){t&&(e.isArray(t)||(t=[t]),this.clear(),this.push.apply(this,t))},clear:function(){this.length=0},copy:function(){var e=new s;return e.replace(this),e}},function(){var t=[];return t.push.apply(t,arguments),e.extend(t,a),t}),l=function(t,n){e.data(t,"datepicker",this),this._events=[],this._secondaryEvents=[],this._process_options(n),this.dates=new s,this.viewDate=this.o.defaultViewDate,this.focusDate=null,this.element=e(t),this.isInput=this.element.is("input"),this.inputField=this.isInput?this.element:this.element.find("input"),this.component=!!this.element.hasClass("date")&&this.element.find(".add-on, .input-group-addon, .input-group-append, .input-group-prepend, .btn"),this.component&&0===this.component.length&&(this.component=!1),this.isInline=!this.component&&this.element.is("div"),this.picker=e(v.template),this._check_template(this.o.templates.leftArrow)&&this.picker.find(".prev").html(this.o.templates.leftArrow),this._check_template(this.o.templates.rightArrow)&&this.picker.find(".next").html(this.o.templates.rightArrow),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&this.picker.addClass("datepicker-rtl"),this.o.calendarWeeks&&this.picker.find(".datepicker-days .datepicker-switch, thead .datepicker-title, tfoot .today, tfoot .clear").attr("colspan",(function(e,t){return Number(t)+1})),this._process_options({startDate:this._o.startDate,endDate:this._o.endDate,daysOfWeekDisabled:this.o.daysOfWeekDisabled,daysOfWeekHighlighted:this.o.daysOfWeekHighlighted,datesDisabled:this.o.datesDisabled}),this._allow_update=!1,this.setViewMode(this.o.startView),this._allow_update=!0,this.fillDow(),this.fillMonths(),this.update(),this.isInline&&this.show()};l.prototype={constructor:l,_resolveViewName:function(t){return e.each(v.viewModes,(function(n,i){if(t===n||-1!==e.inArray(t,i.names))return t=n,!1})),t},_resolveDaysOfWeek:function(t){return e.isArray(t)||(t=t.split(/[,\s]*/)),e.map(t,Number)},_check_template:function(n){try{return n!==t&&""!==n&&((n.match(/[<>]/g)||[]).length<=0||e(n).length>0)}catch(e){return!1}},_process_options:function(t){this._o=e.extend({},this._o,t);var r=this.o=e.extend({},this._o),o=r.language;m[o]||(o=o.split("-")[0],m[o]||(o=f.language)),r.language=o,r.startView=this._resolveViewName(r.startView),r.minViewMode=this._resolveViewName(r.minViewMode),r.maxViewMode=this._resolveViewName(r.maxViewMode),r.startView=Math.max(this.o.minViewMode,Math.min(this.o.maxViewMode,r.startView)),!0!==r.multidate&&(r.multidate=Number(r.multidate)||!1,!1!==r.multidate&&(r.multidate=Math.max(0,r.multidate))),r.multidateSeparator=String(r.multidateSeparator),r.weekStart%=7,r.weekEnd=(r.weekStart+6)%7;var a=v.parseFormat(r.format);r.startDate!==-1/0&&(r.startDate?r.startDate instanceof Date?r.startDate=this._local_to_utc(this._zero_time(r.startDate)):r.startDate=v.parseDate(r.startDate,a,r.language,r.assumeNearbyYear):r.startDate=-1/0),r.endDate!==1/0&&(r.endDate?r.endDate instanceof Date?r.endDate=this._local_to_utc(this._zero_time(r.endDate)):r.endDate=v.parseDate(r.endDate,a,r.language,r.assumeNearbyYear):r.endDate=1/0),r.daysOfWeekDisabled=this._resolveDaysOfWeek(r.daysOfWeekDisabled||[]),r.daysOfWeekHighlighted=this._resolveDaysOfWeek(r.daysOfWeekHighlighted||[]),r.datesDisabled=r.datesDisabled||[],e.isArray(r.datesDisabled)||(r.datesDisabled=r.datesDisabled.split(",")),r.datesDisabled=e.map(r.datesDisabled,(function(e){return v.parseDate(e,a,r.language,r.assumeNearbyYear)}));var s=String(r.orientation).toLowerCase().split(/\s+/g),l=r.orientation.toLowerCase();if(s=e.grep(s,(function(e){return/^auto|left|right|top|bottom$/.test(e)})),r.orientation={x:"auto",y:"auto"},l&&"auto"!==l)if(1===s.length)switch(s[0]){case"top":case"bottom":r.orientation.y=s[0];break;case"left":case"right":r.orientation.x=s[0]}else l=e.grep(s,(function(e){return/^left|right$/.test(e)})),r.orientation.x=l[0]||"auto",l=e.grep(s,(function(e){return/^top|bottom$/.test(e)})),r.orientation.y=l[0]||"auto";if(r.defaultViewDate instanceof Date||"string"==typeof r.defaultViewDate)r.defaultViewDate=v.parseDate(r.defaultViewDate,a,r.language,r.assumeNearbyYear);else if(r.defaultViewDate){var u=r.defaultViewDate.year||(new Date).getFullYear(),c=r.defaultViewDate.month||0,h=r.defaultViewDate.day||1;r.defaultViewDate=n(u,c,h)}else r.defaultViewDate=i()},_applyEvents:function(e){for(var n,i,r,o=0;o<e.length;o++)n=e[o][0],2===e[o].length?(i=t,r=e[o][1]):3===e[o].length&&(i=e[o][1],r=e[o][2]),n.on(r,i)},_unapplyEvents:function(e){for(var n,i,r,o=0;o<e.length;o++)n=e[o][0],2===e[o].length?(r=t,i=e[o][1]):3===e[o].length&&(r=e[o][1],i=e[o][2]),n.off(i,r)},_buildEvents:function(){var t={keyup:e.proxy((function(t){-1===e.inArray(t.keyCode,[27,37,39,38,40,32,13,9])&&this.update()}),this),keydown:e.proxy(this.keydown,this),paste:e.proxy(this.paste,this)};!0===this.o.showOnFocus&&(t.focus=e.proxy(this.show,this)),this.isInput?this._events=[[this.element,t]]:this.component&&this.inputField.length?this._events=[[this.inputField,t],[this.component,{click:e.proxy(this.show,this)}]]:this._events=[[this.element,{click:e.proxy(this.show,this),keydown:e.proxy(this.keydown,this)}]],this._events.push([this.element,"*",{blur:e.proxy((function(e){this._focused_from=e.target}),this)}],[this.element,{blur:e.proxy((function(e){this._focused_from=e.target}),this)}]),this.o.immediateUpdates&&this._events.push([this.element,{"changeYear changeMonth":e.proxy((function(e){this.update(e.date)}),this)}]),this._secondaryEvents=[[this.picker,{click:e.proxy(this.click,this)}],[this.picker,".prev, .next",{click:e.proxy(this.navArrowsClick,this)}],[this.picker,".day:not(.disabled)",{click:e.proxy(this.dayCellClick,this)}],[e(window),{resize:e.proxy(this.place,this)}],[e(document),{"mousedown touchstart":e.proxy((function(e){this.element.is(e.target)||this.element.find(e.target).length||this.picker.is(e.target)||this.picker.find(e.target).length||this.isInline||this.hide()}),this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(t,n){var i=n||this.dates.get(-1),r=this._utc_to_local(i);this.element.trigger({type:t,date:r,viewMode:this.viewMode,dates:e.map(this.dates,this._utc_to_local),format:e.proxy((function(e,t){0===arguments.length?(e=this.dates.length-1,t=this.o.format):"string"==typeof e&&(t=e,e=this.dates.length-1),t=t||this.o.format;var n=this.dates.get(e);return v.formatDate(n,t,this.o.language)}),this)})},show:function(){if(!(this.inputField.is(":disabled")||this.inputField.prop("readonly")&&!1===this.o.enableOnReadonly))return this.isInline||this.picker.appendTo(this.o.container),this.place(),this.picker.show(),this._attachSecondaryEvents(),this._trigger("show"),(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&this.o.disableTouchKeyboard&&e(this.element).blur(),this},hide:function(){return this.isInline||!this.picker.is(":visible")||(this.focusDate=null,this.picker.hide().detach(),this._detachSecondaryEvents(),this.setViewMode(this.o.startView),this.o.forceParse&&this.inputField.val()&&this.setValue(),this._trigger("hide")),this},destroy:function(){return this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date,this},paste:function(t){var n;if(t.originalEvent.clipboardData&&t.originalEvent.clipboardData.types&&-1!==e.inArray("text/plain",t.originalEvent.clipboardData.types))n=t.originalEvent.clipboardData.getData("text/plain");else{if(!window.clipboardData)return;n=window.clipboardData.getData("Text")}this.setDate(n),this.update(),t.preventDefault()},_utc_to_local:function(e){if(!e)return e;var t=new Date(e.getTime()+6e4*e.getTimezoneOffset());return t.getTimezoneOffset()!==e.getTimezoneOffset()&&(t=new Date(e.getTime()+6e4*t.getTimezoneOffset())),t},_local_to_utc:function(e){return e&&new Date(e.getTime()-6e4*e.getTimezoneOffset())},_zero_time:function(e){return e&&new Date(e.getFullYear(),e.getMonth(),e.getDate())},_zero_utc_time:function(e){return e&&n(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())},getDates:function(){return e.map(this.dates,this._utc_to_local)},getUTCDates:function(){return e.map(this.dates,(function(e){return new Date(e)}))},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){var e=this.dates.get(-1);return e!==t?new Date(e):null},clearDates:function(){this.inputField.val(""),this.update(),this._trigger("changeDate"),this.o.autoclose&&this.hide()},setDates:function(){var t=e.isArray(arguments[0])?arguments[0]:arguments;return this.update.apply(this,t),this._trigger("changeDate"),this.setValue(),this},setUTCDates:function(){var t=e.isArray(arguments[0])?arguments[0]:arguments;return this.setDates.apply(this,e.map(t,this._utc_to_local)),this},setDate:o("setDates"),setUTCDate:o("setUTCDates"),remove:o("destroy","Method `remove` is deprecated and will be removed in version 2.0. Use `destroy` instead"),setValue:function(){var e=this.getFormattedDate();return this.inputField.val(e),this},getFormattedDate:function(n){n===t&&(n=this.o.format);var i=this.o.language;return e.map(this.dates,(function(e){return v.formatDate(e,n,i)})).join(this.o.multidateSeparator)},getStartDate:function(){return this.o.startDate},setStartDate:function(e){return this._process_options({startDate:e}),this.update(),this.updateNavArrows(),this},getEndDate:function(){return this.o.endDate},setEndDate:function(e){return this._process_options({endDate:e}),this.update(),this.updateNavArrows(),this},setDaysOfWeekDisabled:function(e){return this._process_options({daysOfWeekDisabled:e}),this.update(),this},setDaysOfWeekHighlighted:function(e){return this._process_options({daysOfWeekHighlighted:e}),this.update(),this},setDatesDisabled:function(e){return this._process_options({datesDisabled:e}),this.update(),this},place:function(){if(this.isInline)return this;var t=this.picker.outerWidth(),n=this.picker.outerHeight(),i=e(this.o.container),r=i.width(),o="body"===this.o.container?e(document).scrollTop():i.scrollTop(),a=i.offset(),s=[0];this.element.parents().each((function(){var t=e(this).css("z-index");"auto"!==t&&0!==Number(t)&&s.push(Number(t))}));var l=Math.max.apply(Math,s)+this.o.zIndexOffset,u=this.component?this.component.parent().offset():this.element.offset(),c=this.component?this.component.outerHeight(!0):this.element.outerHeight(!1),h=this.component?this.component.outerWidth(!0):this.element.outerWidth(!1),d=u.left-a.left,p=u.top-a.top;"body"!==this.o.container&&(p+=o),this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left"),"auto"!==this.o.orientation.x?(this.picker.addClass("datepicker-orient-"+this.o.orientation.x),"right"===this.o.orientation.x&&(d-=t-h)):u.left<0?(this.picker.addClass("datepicker-orient-left"),d-=u.left-10):d+t>r?(this.picker.addClass("datepicker-orient-right"),d+=h-t):this.o.rtl?this.picker.addClass("datepicker-orient-right"):this.picker.addClass("datepicker-orient-left");var f=this.o.orientation.y;if("auto"===f&&(f=-o+p-n<0?"bottom":"top"),this.picker.addClass("datepicker-orient-"+f),"top"===f?p-=n+parseInt(this.picker.css("padding-top")):p+=c,this.o.rtl){var g=r-(d+h);this.picker.css({top:p,right:g,zIndex:l})}else this.picker.css({top:p,left:d,zIndex:l});return this},_allow_update:!0,update:function(){if(!this._allow_update)return this;var t=this.dates.copy(),n=[],i=!1;return arguments.length?(e.each(arguments,e.proxy((function(e,t){t instanceof Date&&(t=this._local_to_utc(t)),n.push(t)}),this)),i=!0):(n=(n=this.isInput?this.element.val():this.element.data("date")||this.inputField.val())&&this.o.multidate?n.split(this.o.multidateSeparator):[n],delete this.element.data().date),n=e.map(n,e.proxy((function(e){return v.parseDate(e,this.o.format,this.o.language,this.o.assumeNearbyYear)}),this)),n=e.grep(n,e.proxy((function(e){return!this.dateWithinRange(e)||!e}),this),!0),this.dates.replace(n),this.o.updateViewDate&&(this.dates.length?this.viewDate=new Date(this.dates.get(-1)):this.viewDate<this.o.startDate?this.viewDate=new Date(this.o.startDate):this.viewDate>this.o.endDate?this.viewDate=new Date(this.o.endDate):this.viewDate=this.o.defaultViewDate),i?(this.setValue(),this.element.change()):this.dates.length&&String(t)!==String(this.dates)&&i&&(this._trigger("changeDate"),this.element.change()),!this.dates.length&&t.length&&(this._trigger("clearDate"),this.element.change()),this.fill(),this},fillDow:function(){if(this.o.showWeekDays){var t=this.o.weekStart,n="<tr>";for(this.o.calendarWeeks&&(n+='<th class="cw">&#160;</th>');t<this.o.weekStart+7;)n+='<th class="dow',-1!==e.inArray(t,this.o.daysOfWeekDisabled)&&(n+=" disabled"),n+='">'+m[this.o.language].daysMin[t++%7]+"</th>";n+="</tr>",this.picker.find(".datepicker-days thead").append(n)}},fillMonths:function(){for(var e=this._utc_to_local(this.viewDate),t="",n=0;n<12;n++)t+='<span class="month'+(e&&e.getMonth()===n?" focused":"")+'">'+m[this.o.language].monthsShort[n]+"</span>";this.picker.find(".datepicker-months td").html(t)},setRange:function(t){t&&t.length?this.range=e.map(t,(function(e){return e.valueOf()})):delete this.range,this.fill()},getClassNames:function(t){var n=[],o=this.viewDate.getUTCFullYear(),a=this.viewDate.getUTCMonth(),s=i();return t.getUTCFullYear()<o||t.getUTCFullYear()===o&&t.getUTCMonth()<a?n.push("old"):(t.getUTCFullYear()>o||t.getUTCFullYear()===o&&t.getUTCMonth()>a)&&n.push("new"),this.focusDate&&t.valueOf()===this.focusDate.valueOf()&&n.push("focused"),this.o.todayHighlight&&r(t,s)&&n.push("today"),-1!==this.dates.contains(t)&&n.push("active"),this.dateWithinRange(t)||n.push("disabled"),this.dateIsDisabled(t)&&n.push("disabled","disabled-date"),-1!==e.inArray(t.getUTCDay(),this.o.daysOfWeekHighlighted)&&n.push("highlighted"),this.range&&(t>this.range[0]&&t<this.range[this.range.length-1]&&n.push("range"),-1!==e.inArray(t.valueOf(),this.range)&&n.push("selected"),t.valueOf()===this.range[0]&&n.push("range-start"),t.valueOf()===this.range[this.range.length-1]&&n.push("range-end")),n},_fill_yearsView:function(n,i,r,o,a,s,l){for(var u,c,h,d="",p=r/10,f=this.picker.find(n),g=Math.floor(o/r)*r,m=g+9*p,v=Math.floor(this.viewDate.getFullYear()/p)*p,y=e.map(this.dates,(function(e){return Math.floor(e.getUTCFullYear()/p)*p})),_=g-p;_<=m+p;_+=p)u=[i],c=null,_===g-p?u.push("old"):_===m+p&&u.push("new"),-1!==e.inArray(_,y)&&u.push("active"),(_<a||_>s)&&u.push("disabled"),_===v&&u.push("focused"),l!==e.noop&&((h=l(new Date(_,0,1)))===t?h={}:"boolean"==typeof h?h={enabled:h}:"string"==typeof h&&(h={classes:h}),!1===h.enabled&&u.push("disabled"),h.classes&&(u=u.concat(h.classes.split(/\s+/))),h.tooltip&&(c=h.tooltip)),d+='<span class="'+u.join(" ")+'"'+(c?' title="'+c+'"':"")+">"+_+"</span>";f.find(".datepicker-switch").text(g+"-"+m),f.find("td").html(d)},fill:function(){var r,o,a=new Date(this.viewDate),s=a.getUTCFullYear(),l=a.getUTCMonth(),u=this.o.startDate!==-1/0?this.o.startDate.getUTCFullYear():-1/0,c=this.o.startDate!==-1/0?this.o.startDate.getUTCMonth():-1/0,h=this.o.endDate!==1/0?this.o.endDate.getUTCFullYear():1/0,d=this.o.endDate!==1/0?this.o.endDate.getUTCMonth():1/0,p=m[this.o.language].today||m.en.today||"",f=m[this.o.language].clear||m.en.clear||"",g=m[this.o.language].titleFormat||m.en.titleFormat,y=i(),_=(!0===this.o.todayBtn||"linked"===this.o.todayBtn)&&y>=this.o.startDate&&y<=this.o.endDate&&!this.weekOfDateIsDisabled(y);if(!isNaN(s)&&!isNaN(l)){this.picker.find(".datepicker-days .datepicker-switch").text(v.formatDate(a,g,this.o.language)),this.picker.find("tfoot .today").text(p).css("display",_?"table-cell":"none"),this.picker.find("tfoot .clear").text(f).css("display",!0===this.o.clearBtn?"table-cell":"none"),this.picker.find("thead .datepicker-title").text(this.o.title).css("display","string"==typeof this.o.title&&""!==this.o.title?"table-cell":"none"),this.updateNavArrows(),this.fillMonths();var b=n(s,l,0),w=b.getUTCDate();b.setUTCDate(w-(b.getUTCDay()-this.o.weekStart+7)%7);var E=new Date(b);b.getUTCFullYear()<100&&E.setUTCFullYear(b.getUTCFullYear()),E.setUTCDate(E.getUTCDate()+42),E=E.valueOf();for(var C,S,k=[];b.valueOf()<E;){if((C=b.getUTCDay())===this.o.weekStart&&(k.push("<tr>"),this.o.calendarWeeks)){var T=new Date(+b+(this.o.weekStart-C-7)%7*864e5),x=new Date(Number(T)+(11-T.getUTCDay())%7*864e5),L=new Date(Number(L=n(x.getUTCFullYear(),0,1))+(11-L.getUTCDay())%7*864e5),I=(x-L)/864e5/7+1;k.push('<td class="cw">'+I+"</td>")}(S=this.getClassNames(b)).push("day");var A=b.getUTCDate();this.o.beforeShowDay!==e.noop&&((o=this.o.beforeShowDay(this._utc_to_local(b)))===t?o={}:"boolean"==typeof o?o={enabled:o}:"string"==typeof o&&(o={classes:o}),!1===o.enabled&&S.push("disabled"),o.classes&&(S=S.concat(o.classes.split(/\s+/))),o.tooltip&&(r=o.tooltip),o.content&&(A=o.content)),S=e.isFunction(e.uniqueSort)?e.uniqueSort(S):e.unique(S),k.push('<td class="'+S.join(" ")+'"'+(r?' title="'+r+'"':"")+' data-date="'+b.getTime().toString()+'">'+A+"</td>"),r=null,C===this.o.weekEnd&&k.push("</tr>"),b.setUTCDate(b.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").html(k.join(""));var D=m[this.o.language].monthsTitle||m.en.monthsTitle||"Months",N=this.picker.find(".datepicker-months").find(".datepicker-switch").text(this.o.maxViewMode<2?D:s).end().find("tbody span").removeClass("active");if(e.each(this.dates,(function(e,t){t.getUTCFullYear()===s&&N.eq(t.getUTCMonth()).addClass("active")})),(s<u||s>h)&&N.addClass("disabled"),s===u&&N.slice(0,c).addClass("disabled"),s===h&&N.slice(d+1).addClass("disabled"),this.o.beforeShowMonth!==e.noop){var P=this;e.each(N,(function(n,i){var r=new Date(s,n,1),o=P.o.beforeShowMonth(r);o===t?o={}:"boolean"==typeof o?o={enabled:o}:"string"==typeof o&&(o={classes:o}),!1!==o.enabled||e(i).hasClass("disabled")||e(i).addClass("disabled"),o.classes&&e(i).addClass(o.classes),o.tooltip&&e(i).prop("title",o.tooltip)}))}this._fill_yearsView(".datepicker-years","year",10,s,u,h,this.o.beforeShowYear),this._fill_yearsView(".datepicker-decades","decade",100,s,u,h,this.o.beforeShowDecade),this._fill_yearsView(".datepicker-centuries","century",1e3,s,u,h,this.o.beforeShowCentury)}},updateNavArrows:function(){if(this._allow_update){var e,t,n=new Date(this.viewDate),i=n.getUTCFullYear(),r=n.getUTCMonth(),o=this.o.startDate!==-1/0?this.o.startDate.getUTCFullYear():-1/0,a=this.o.startDate!==-1/0?this.o.startDate.getUTCMonth():-1/0,s=this.o.endDate!==1/0?this.o.endDate.getUTCFullYear():1/0,l=this.o.endDate!==1/0?this.o.endDate.getUTCMonth():1/0,u=1;switch(this.viewMode){case 4:u*=10;case 3:u*=10;case 2:u*=10;case 1:e=Math.floor(i/u)*u<=o,t=Math.floor(i/u)*u+u>s;break;case 0:e=i<=o&&r<=a,t=i>=s&&r>=l}this.picker.find(".prev").toggleClass("disabled",e),this.picker.find(".next").toggleClass("disabled",t)}},click:function(t){var r,o,a;t.preventDefault(),t.stopPropagation(),(r=e(t.target)).hasClass("datepicker-switch")&&this.viewMode!==this.o.maxViewMode&&this.setViewMode(this.viewMode+1),r.hasClass("today")&&!r.hasClass("day")&&(this.setViewMode(0),this._setDate(i(),"linked"===this.o.todayBtn?null:"view")),r.hasClass("clear")&&this.clearDates(),r.hasClass("disabled")||(r.hasClass("month")||r.hasClass("year")||r.hasClass("decade")||r.hasClass("century"))&&(this.viewDate.setUTCDate(1),1===this.viewMode?(a=r.parent().find("span").index(r),o=this.viewDate.getUTCFullYear(),this.viewDate.setUTCMonth(a)):(a=0,o=Number(r.text()),this.viewDate.setUTCFullYear(o)),this._trigger(v.viewModes[this.viewMode-1].e,this.viewDate),this.viewMode===this.o.minViewMode?this._setDate(n(o,a,1)):(this.setViewMode(this.viewMode-1),this.fill())),this.picker.is(":visible")&&this._focused_from&&this._focused_from.focus(),delete this._focused_from},dayCellClick:function(t){var n=e(t.currentTarget).data("date"),i=new Date(n);this.o.updateViewDate&&(i.getUTCFullYear()!==this.viewDate.getUTCFullYear()&&this._trigger("changeYear",this.viewDate),i.getUTCMonth()!==this.viewDate.getUTCMonth()&&this._trigger("changeMonth",this.viewDate)),this._setDate(i)},navArrowsClick:function(t){var n=e(t.currentTarget).hasClass("prev")?-1:1;0!==this.viewMode&&(n*=12*v.viewModes[this.viewMode].navStep),this.viewDate=this.moveMonth(this.viewDate,n),this._trigger(v.viewModes[this.viewMode].e,this.viewDate),this.fill()},_toggle_multidate:function(e){var t=this.dates.contains(e);if(e||this.dates.clear(),-1!==t?(!0===this.o.multidate||this.o.multidate>1||this.o.toggleActive)&&this.dates.remove(t):!1===this.o.multidate?(this.dates.clear(),this.dates.push(e)):this.dates.push(e),"number"==typeof this.o.multidate)for(;this.dates.length>this.o.multidate;)this.dates.remove(0)},_setDate:function(e,t){t&&"date"!==t||this._toggle_multidate(e&&new Date(e)),(!t&&this.o.updateViewDate||"view"===t)&&(this.viewDate=e&&new Date(e)),this.fill(),this.setValue(),t&&"view"===t||this._trigger("changeDate"),this.inputField.trigger("change"),!this.o.autoclose||t&&"date"!==t||this.hide()},moveDay:function(e,t){var n=new Date(e);return n.setUTCDate(e.getUTCDate()+t),n},moveWeek:function(e,t){return this.moveDay(e,7*t)},moveMonth:function(e,t){if(!(n=e)||isNaN(n.getTime()))return this.o.defaultViewDate;var n;if(!t)return e;var i,r,o=new Date(e.valueOf()),a=o.getUTCDate(),s=o.getUTCMonth(),l=Math.abs(t);if(t=t>0?1:-1,1===l)r=-1===t?function(){return o.getUTCMonth()===s}:function(){return o.getUTCMonth()!==i},i=s+t,o.setUTCMonth(i),i=(i+12)%12;else{for(var u=0;u<l;u++)o=this.moveMonth(o,t);i=o.getUTCMonth(),o.setUTCDate(a),r=function(){return i!==o.getUTCMonth()}}for(;r();)o.setUTCDate(--a),o.setUTCMonth(i);return o},moveYear:function(e,t){return this.moveMonth(e,12*t)},moveAvailableDate:function(e,t,n){do{if(e=this[n](e,t),!this.dateWithinRange(e))return!1;n="moveDay"}while(this.dateIsDisabled(e));return e},weekOfDateIsDisabled:function(t){return-1!==e.inArray(t.getUTCDay(),this.o.daysOfWeekDisabled)},dateIsDisabled:function(t){return this.weekOfDateIsDisabled(t)||e.grep(this.o.datesDisabled,(function(e){return r(t,e)})).length>0},dateWithinRange:function(e){return e>=this.o.startDate&&e<=this.o.endDate},keydown:function(e){if(this.picker.is(":visible")){var t,n,i=!1,r=this.focusDate||this.viewDate;switch(e.keyCode){case 27:this.focusDate?(this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill()):this.hide(),e.preventDefault(),e.stopPropagation();break;case 37:case 38:case 39:case 40:if(!this.o.keyboardNavigation||7===this.o.daysOfWeekDisabled.length)break;t=37===e.keyCode||38===e.keyCode?-1:1,0===this.viewMode?e.ctrlKey?(n=this.moveAvailableDate(r,t,"moveYear"))&&this._trigger("changeYear",this.viewDate):e.shiftKey?(n=this.moveAvailableDate(r,t,"moveMonth"))&&this._trigger("changeMonth",this.viewDate):37===e.keyCode||39===e.keyCode?n=this.moveAvailableDate(r,t,"moveDay"):this.weekOfDateIsDisabled(r)||(n=this.moveAvailableDate(r,t,"moveWeek")):1===this.viewMode?(38!==e.keyCode&&40!==e.keyCode||(t*=4),n=this.moveAvailableDate(r,t,"moveMonth")):2===this.viewMode&&(38!==e.keyCode&&40!==e.keyCode||(t*=4),n=this.moveAvailableDate(r,t,"moveYear")),n&&(this.focusDate=this.viewDate=n,this.setValue(),this.fill(),e.preventDefault());break;case 13:if(!this.o.forceParse)break;r=this.focusDate||this.dates.get(-1)||this.viewDate,this.o.keyboardNavigation&&(this._toggle_multidate(r),i=!0),this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.setValue(),this.fill(),this.picker.is(":visible")&&(e.preventDefault(),e.stopPropagation(),this.o.autoclose&&this.hide());break;case 9:this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill(),this.hide()}i&&(this.dates.length?this._trigger("changeDate"):this._trigger("clearDate"),this.inputField.trigger("change"))}else 40!==e.keyCode&&27!==e.keyCode||(this.show(),e.stopPropagation())},setViewMode:function(e){this.viewMode=e,this.picker.children("div").hide().filter(".datepicker-"+v.viewModes[this.viewMode].clsName).show(),this.updateNavArrows(),this._trigger("changeViewMode",new Date(this.viewDate))}};var u=function(t,n){e.data(t,"datepicker",this),this.element=e(t),this.inputs=e.map(n.inputs,(function(e){return e.jquery?e[0]:e})),delete n.inputs,this.keepEmptyValues=n.keepEmptyValues,delete n.keepEmptyValues,p.call(e(this.inputs),n).on("changeDate",e.proxy(this.dateUpdated,this)),this.pickers=e.map(this.inputs,(function(t){return e.data(t,"datepicker")})),this.updateDates()};function c(t,n){var i=e(t).data(),r={},o=new RegExp("^"+n.toLowerCase()+"([A-Z])");function a(e,t){return t.toLowerCase()}for(var s in n=new RegExp("^"+n.toLowerCase()),i)n.test(s)&&(r[s.replace(o,a)]=i[s]);return r}function h(t){var n={};if(m[t]||(t=t.split("-")[0],m[t])){var i=m[t];return e.each(g,(function(e,t){t in i&&(n[t]=i[t])})),n}}u.prototype={updateDates:function(){this.dates=e.map(this.pickers,(function(e){return e.getUTCDate()})),this.updateRanges()},updateRanges:function(){var t=e.map(this.dates,(function(e){return e.valueOf()}));e.each(this.pickers,(function(e,n){n.setRange(t)}))},clearDates:function(){e.each(this.pickers,(function(e,t){t.clearDates()}))},dateUpdated:function(n){if(!this.updating){this.updating=!0;var i=e.data(n.target,"datepicker");if(i!==t){var r=i.getUTCDate(),o=this.keepEmptyValues,a=e.inArray(n.target,this.inputs),s=a-1,l=a+1,u=this.inputs.length;if(-1!==a){if(e.each(this.pickers,(function(e,t){t.getUTCDate()||t!==i&&o||t.setUTCDate(r)})),r<this.dates[s])for(;s>=0&&r<this.dates[s];)this.pickers[s--].setUTCDate(r);else if(r>this.dates[l])for(;l<u&&r>this.dates[l];)this.pickers[l++].setUTCDate(r);this.updateDates(),delete this.updating}}}},destroy:function(){e.map(this.pickers,(function(e){e.destroy()})),e(this.inputs).off("changeDate",this.dateUpdated),delete this.element.data().datepicker},remove:o("destroy","Method `remove` is deprecated and will be removed in version 2.0. Use `destroy` instead")};var d=e.fn.datepicker,p=function(n){var i,r=Array.apply(null,arguments);if(r.shift(),this.each((function(){var t=e(this),o=t.data("datepicker"),a="object"==typeof n&&n;if(!o){var s=c(this,"date"),d=h(e.extend({},f,s,a).language),p=e.extend({},f,d,s,a);t.hasClass("input-daterange")||p.inputs?(e.extend(p,{inputs:p.inputs||t.find("input").toArray()}),o=new u(this,p)):o=new l(this,p),t.data("datepicker",o)}"string"==typeof n&&"function"==typeof o[n]&&(i=o[n].apply(o,r))})),i===t||i instanceof l||i instanceof u)return this;if(this.length>1)throw new Error("Using only allowed for the collection of a single element ("+n+" function)");return i};e.fn.datepicker=p;var f=e.fn.datepicker.defaults={assumeNearbyYear:!1,autoclose:!1,beforeShowDay:e.noop,beforeShowMonth:e.noop,beforeShowYear:e.noop,beforeShowDecade:e.noop,beforeShowCentury:e.noop,calendarWeeks:!1,clearBtn:!1,toggleActive:!1,daysOfWeekDisabled:[],daysOfWeekHighlighted:[],datesDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keepEmptyValues:!1,keyboardNavigation:!0,language:"en",minViewMode:0,maxViewMode:4,multidate:!1,multidateSeparator:",",orientation:"auto",rtl:!1,startDate:-1/0,startView:0,todayBtn:!1,todayHighlight:!1,updateViewDate:!0,weekStart:0,disableTouchKeyboard:!1,enableOnReadonly:!0,showOnFocus:!0,zIndexOffset:10,container:"body",immediateUpdates:!1,title:"",templates:{leftArrow:"&#x00AB;",rightArrow:"&#x00BB;"},showWeekDays:!0},g=e.fn.datepicker.locale_opts=["format","rtl","weekStart"];e.fn.datepicker.Constructor=l;var m=e.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM yyyy"}},v={viewModes:[{names:["days","month"],clsName:"days",e:"changeMonth"},{names:["months","year"],clsName:"months",e:"changeYear",navStep:1},{names:["years","decade"],clsName:"years",e:"changeDecade",navStep:10},{names:["decades","century"],clsName:"decades",e:"changeCentury",navStep:100},{names:["centuries","millennium"],clsName:"centuries",e:"changeMillennium",navStep:1e3}],validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\u5e74\u6708\u65e5\[-`{-~\t\n\r]+/g,parseFormat:function(e){if("function"==typeof e.toValue&&"function"==typeof e.toDisplay)return e;var t=e.replace(this.validParts,"\0").split("\0"),n=e.match(this.validParts);if(!t||!t.length||!n||0===n.length)throw new Error("Invalid date format.");return{separators:t,parts:n}},parseDate:function(n,r,o,a){if(!n)return t;if(n instanceof Date)return n;if("string"==typeof r&&(r=v.parseFormat(r)),r.toValue)return r.toValue(n,r,o);var s,u,c,h,d,p={d:"moveDay",m:"moveMonth",w:"moveWeek",y:"moveYear"},f={yesterday:"-1d",today:"+0d",tomorrow:"+1d"};if(n in f&&(n=f[n]),/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/i.test(n)){for(s=n.match(/([\-+]\d+)([dmwy])/gi),n=new Date,h=0;h<s.length;h++)u=s[h].match(/([\-+]\d+)([dmwy])/i),c=Number(u[1]),d=p[u[2].toLowerCase()],n=l.prototype[d](n,c);return l.prototype._zero_utc_time(n)}s=n&&n.match(this.nonpunctuation)||[];var g,y,_={},b=["yyyy","yy","M","MM","m","mm","d","dd"],w={yyyy:function(e,t){return e.setUTCFullYear(a?(!0===(i=a)&&(i=10),(n=t)<100&&(n+=2e3)>(new Date).getFullYear()+i&&(n-=100),n):t);var n,i},m:function(e,t){if(isNaN(e))return e;for(t-=1;t<0;)t+=12;for(t%=12,e.setUTCMonth(t);e.getUTCMonth()!==t;)e.setUTCDate(e.getUTCDate()-1);return e},d:function(e,t){return e.setUTCDate(t)}};w.yy=w.yyyy,w.M=w.MM=w.mm=w.m,w.dd=w.d,n=i();var E=r.parts.slice();function C(){var e=this.slice(0,s[h].length),t=s[h].slice(0,e.length);return e.toLowerCase()===t.toLowerCase()}if(s.length!==E.length&&(E=e(E).filter((function(t,n){return-1!==e.inArray(n,b)})).toArray()),s.length===E.length){var S,k,T;for(h=0,S=E.length;h<S;h++){if(g=parseInt(s[h],10),u=E[h],isNaN(g))switch(u){case"MM":y=e(m[o].months).filter(C),g=e.inArray(y[0],m[o].months)+1;break;case"M":y=e(m[o].monthsShort).filter(C),g=e.inArray(y[0],m[o].monthsShort)+1}_[u]=g}for(h=0;h<b.length;h++)(T=b[h])in _&&!isNaN(_[T])&&(k=new Date(n),w[T](k,_[T]),isNaN(k)||(n=k))}return n},formatDate:function(t,n,i){if(!t)return"";if("string"==typeof n&&(n=v.parseFormat(n)),n.toDisplay)return n.toDisplay(t,n,i);var r={d:t.getUTCDate(),D:m[i].daysShort[t.getUTCDay()],DD:m[i].days[t.getUTCDay()],m:t.getUTCMonth()+1,M:m[i].monthsShort[t.getUTCMonth()],MM:m[i].months[t.getUTCMonth()],yy:t.getUTCFullYear().toString().substring(2),yyyy:t.getUTCFullYear()};r.dd=(r.d<10?"0":"")+r.d,r.mm=(r.m<10?"0":"")+r.m,t=[];for(var o=e.extend([],n.separators),a=0,s=n.parts.length;a<=s;a++)o.length&&t.push(o.shift()),t.push(r[n.parts[a]]);return t.join("")},headTemplate:'<thead><tr><th colspan="7" class="datepicker-title"></th></tr><tr><th class="prev">'+f.templates.leftArrow+'</th><th colspan="5" class="datepicker-switch"></th><th class="next">'+f.templates.rightArrow+"</th></tr></thead>",contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};v.template='<div class="datepicker"><div class="datepicker-days"><table class="table-condensed">'+v.headTemplate+"<tbody></tbody>"+v.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+v.headTemplate+v.contTemplate+v.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+v.headTemplate+v.contTemplate+v.footTemplate+'</table></div><div class="datepicker-decades"><table class="table-condensed">'+v.headTemplate+v.contTemplate+v.footTemplate+'</table></div><div class="datepicker-centuries"><table class="table-condensed">'+v.headTemplate+v.contTemplate+v.footTemplate+"</table></div></div>",e.fn.datepicker.DPGlobal=v,e.fn.datepicker.noConflict=function(){return e.fn.datepicker=d,this},e.fn.datepicker.version="1.9.0",e.fn.datepicker.deprecated=function(e){var t=window.console;t&&t.warn&&t.warn("DEPRECATED: "+e)},e(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',(function(t){var n=e(this);n.data("datepicker")||(t.preventDefault(),p.call(n,"show"))})),e((function(){p.call(e('[data-provide="datepicker-inline"]'))}))}(T)}));
/*!
     * Timepicker
     *
     * Forked from https://github.com/jdewit/bootstrap-timepicker: 
     * 
     * Copyright 2013 Joris de Wit and timepicker contributors
     *
     * Contributors https://github.com/jdewit/bootstrap-timepicker/graphs/contributors
     * Contributors https://github.com/enketo/timepicker-basic/graphs/contributors
     *
     * For the full copyright and license information, please view the LICENSE
     * file that was distributed with this source code.
     */
((e,t,n)=>{const i=function(t,n){this.widget="",this.$element=e(t),this.defaultTime=n.defaultTime,this.disableFocus=n.disableFocus,this.disableMousewheel=n.disableMousewheel,this.isOpen=n.isOpen,this.minuteStep=n.minuteStep,this.orientation=n.orientation,this.secondStep=n.secondStep,this.snapToStep=n.snapToStep,this.showInputs=n.showInputs,this.showMeridian=n.showMeridian,this.meridianNotation=n.meridianNotation,this.showSeconds=n.showSeconds,this.template=n.template,this.appendWidgetTo=n.appendWidgetTo,this.showWidgetOnAddonClick=n.showWidgetOnAddonClick,this.icons=n.icons,this.maxHours=n.maxHours,this.explicitMode=n.explicitMode,this.handleDocumentClick=e=>{const t=e.data.scope;t.$element.parent().find(e.target).length||t.$widget.is(e.target)||t.$widget.find(e.target).length||t.hideWidget()},this._init()};i.prototype={constructor:i,_init(){const t=this;this.showWidgetOnAddonClick&&this.$element.parent().hasClass("input-group")&&this.$element.parent().hasClass("timepicker")?(this.$element.parent(".input-group.timepicker").find(".input-group-addon").on({"click.timepicker":e.proxy(this.showWidget,this)}),this.$element.on({"focus.timepicker":e.proxy(this.highlightUnit,this),"click.timepicker":e.proxy(this.highlightUnit,this),"keydown.timepicker":e.proxy(this.elementKeydown,this),"blur.timepicker":e.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":e.proxy(this.mousewheel,this)})):this.template?this.$element.on({"focus.timepicker":e.proxy(this.showWidget,this),"click.timepicker":e.proxy(this.showWidget,this),"blur.timepicker":e.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":e.proxy(this.mousewheel,this)}):this.$element.on({"focus.timepicker":e.proxy(this.highlightUnit,this),"click.timepicker":e.proxy(this.highlightUnit,this),"keydown.timepicker":e.proxy(this.elementKeydown,this),"blur.timepicker":e.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":e.proxy(this.mousewheel,this)}),!1!==this.template?this.$widget=e(this.getTemplate()).on("click",e.proxy(this.widgetClick,this)):this.$widget=!1,this.showInputs&&!1!==this.$widget&&this.$widget.find("input").each((function(){e(this).on({"click.timepicker":function(){e(this).select()},"keydown.timepicker":e.proxy(t.widgetKeydown,t),"keyup.timepicker":e.proxy(t.widgetKeyup,t)})})),this.setDefaultTime(this.defaultTime)},blurElement(){this.highlightedUnit=null,this.updateFromElementVal()},clear(){this.hour="",this.minute="",this.second="",this.meridian="",this.$element.val("")},decrementHour(){if(""===this.hour&&(this.hour=this.getCurrentHour(),this.incrementHour()),this.showMeridian)if(1===this.hour)this.hour=12;else{if(12===this.hour)return this.hour--,this.toggleMeridian();if(0===this.hour)return this.hour=11,this.toggleMeridian();this.hour--}else this.hour<=0?this.hour=this.maxHours-1:this.hour--},decrementMinute(e){let t;""===this.minute&&(this.minute=this.getCurrentMinute(),this.incrementMinute()),t=e?this.minute-e:this.minute-this.minuteStep,t<0?(this.decrementHour(),this.minute=t+60):this.minute=t},decrementSecond(){const e=this.second-this.secondStep;e<0?(this.decrementMinute(!0),this.second=e+60):this.second=e},elementKeydown(e){switch(e.which){case 9:if(e.shiftKey){if("hour"===this.highlightedUnit){this.hideWidget();break}this.highlightPrevUnit()}else{if(this.showMeridian&&"meridian"===this.highlightedUnit||this.showSeconds&&"second"===this.highlightedUnit||!this.showMeridian&&!this.showSeconds&&"minute"===this.highlightedUnit){this.hideWidget();break}this.highlightNextUnit()}e.preventDefault(),this.updateFromElementVal();break;case 27:this.updateFromElementVal();break;case 37:e.preventDefault(),this.highlightPrevUnit(),this.updateFromElementVal();break;case 38:switch(e.preventDefault(),this.highlightedUnit){case"hour":this.incrementHour(),this.highlightHour();break;case"minute":this.incrementMinute(),this.highlightMinute();break;case"second":this.incrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian()}this.update();break;case 39:e.preventDefault(),this.highlightNextUnit(),this.updateFromElementVal();break;case 40:switch(e.preventDefault(),this.highlightedUnit){case"hour":this.decrementHour(),this.highlightHour();break;case"minute":this.decrementMinute(),this.highlightMinute();break;case"second":this.decrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian()}this.update()}},getCursorPosition(){const e=this.$element.get(0);if("selectionStart"in e)return e.selectionStart;if(n.selection){e.focus();const t=n.selection.createRange(),i=n.selection.createRange().text.length;return t.moveStart("character",-e.value.length),t.text.length-i}},getMeridianLength(){const e=n.createElement("span");e.textContent=this.meridianNotation.am,e.style.position="absolute",n.querySelector("body").appendChild(e);const t=e.scrollWidth;e.textContent=this.meridianNotation.pm;const i=e.scrollWidth;return e.remove(),t>i?t:i},getTemplate(){let e,t,n,i,r,o;if(this.showInputs){const e=this.getMeridianLength()>26?`style="width: ${this.getMeridianLength()+24}px"`:"";t=`<input type="text" class="timepicker-hour" ${e}/>`,n=`<input type="text" class="timepicker-minute" ${e}/>`,i=`<input type="text" class="timepicker-second" ${e}/>`,r=`<input type="text" class="timepicker-meridian"${e}/>`}else t='<span class="timepicker-hour"></span>',n='<span class="timepicker-minute"></span>',i='<span class="timepicker-second"></span>',r='<span class="timepicker-meridian"></span>';switch(o=`<table><tr><td><a href="#" data-action="incrementHour"><span class="${this.icons.up}"></span></a></td><td class="separator">&nbsp;</td><td><a href="#" data-action="incrementMinute"><span class="${this.icons.up}"></span></a></td>${this.showSeconds?`<td class="separator">&nbsp;</td><td><a href="#" data-action="incrementSecond"><span class="${this.icons.up}"></span></a></td>`:""}${this.showMeridian?`<td class="separator">&nbsp;</td><td class="meridian-column"><a href="#" data-action="toggleMeridian"><span class="${this.icons.up}"></span></a></td>`:""}</tr><tr><td>${t}</td> <td class="separator">:</td><td>${n}</td> ${this.showSeconds?`<td class="separator">:</td><td>${i}</td>`:""}${this.showMeridian?`<td class="separator">&nbsp;</td><td>${r}</td>`:""}</tr><tr><td><a href="#" data-action="decrementHour"><span class="${this.icons.down}"></span></a></td><td class="separator"></td><td><a href="#" data-action="decrementMinute"><span class="${this.icons.down}"></span></a></td>${this.showSeconds?`<td class="separator">&nbsp;</td><td><a href="#" data-action="decrementSecond"><span class="${this.icons.down}"></span></a></td>`:""}${this.showMeridian?`<td class="separator">&nbsp;</td><td><a href="#" data-action="toggleMeridian"><span class="${this.icons.down}"></span></a></td>`:""}</tr></table>`,this.template){case"dropdown":e=`<div class="timepicker-widget dropdown-menu">${o}</div>`}return e},getTime(){return""===this.hour?"":`${1===this.hour.toString().length?"0"+this.hour:this.hour}:${1===this.minute.toString().length?"0"+this.minute:this.minute}${this.showSeconds?":"+(1===this.second.toString().length?"0"+this.second:this.second):""}${this.showMeridian?" "+this.meridian:""}`},hideWidget(){!1!==this.isOpen&&(this.$element.trigger({type:"hide.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}}),this.$widget.removeClass("open"),e(n).off("mousedown.timepicker, touchend.timepicker",this.handleDocumentClick),this.isOpen=!1,this.$widget.detach())},highlightUnit(){this.position=this.getCursorPosition(),this.position>=0&&this.position<=2?this.highlightHour():this.position>=3&&this.position<=5?this.highlightMinute():this.position>=6&&this.position<=8?this.showSeconds?this.highlightSecond():this.highlightMeridian():this.position>=9&&this.position<=11&&this.highlightMeridian()},highlightNextUnit(){switch(this.highlightedUnit){case"hour":this.highlightMinute();break;case"minute":this.showSeconds?this.highlightSecond():this.showMeridian?this.highlightMeridian():this.highlightHour();break;case"second":this.showMeridian?this.highlightMeridian():this.highlightHour();break;case"meridian":this.highlightHour()}},highlightPrevUnit(){switch(this.highlightedUnit){case"hour":this.showMeridian?this.highlightMeridian():this.showSeconds?this.highlightSecond():this.highlightMinute();break;case"minute":this.highlightHour();break;case"second":this.highlightMinute();break;case"meridian":this.showSeconds?this.highlightSecond():this.highlightMinute()}},highlightHour(){const e=this.$element.get(0),t=this;this.highlightedUnit="hour",e.setSelectionRange&&setTimeout(()=>{t.hour<10?e.setSelectionRange(0,1):e.setSelectionRange(0,2)},0)},highlightMinute(){const e=this.$element.get(0),t=this;this.highlightedUnit="minute",e.setSelectionRange&&setTimeout(()=>{t.hour<10?e.setSelectionRange(2,4):e.setSelectionRange(3,5)},0)},highlightSecond(){const e=this.$element.get(0),t=this;this.highlightedUnit="second",e.setSelectionRange&&setTimeout(()=>{t.hour<10?e.setSelectionRange(5,7):e.setSelectionRange(6,8)},0)},highlightMeridian(){const e=this.$element.get(0),t=this;this.highlightedUnit="meridian",e.setSelectionRange&&(this.showSeconds?setTimeout(()=>{t.hour<10?e.setSelectionRange(8,10):e.setSelectionRange(9,11)},0):setTimeout(()=>{t.hour<10?e.setSelectionRange(5,7):e.setSelectionRange(6,8)},0))},getCurrentHour(){const e=(new Date).getHours();return this.showMeridian?e%12:e},getCurrentMinute:()=>(new Date).getMinutes(),incrementHour(){if(""===this.hour&&(this.hour=this.getCurrentHour(),this.decrementHour()),this.showMeridian){if(11===this.hour)return this.hour++,this.toggleMeridian();12===this.hour&&(this.hour=0)}this.hour!==this.maxHours-1?this.hour++:this.hour=0},incrementMinute(e){let t;""===this.minute&&(this.minute=this.getCurrentMinute(),this.decrementMinute()),t=e?this.minute+e:this.minute+this.minuteStep-this.minute%this.minuteStep,t>59?(this.incrementHour(),this.minute=t-60):this.minute=t},incrementSecond(){const e=this.second+this.secondStep-this.second%this.secondStep;e>59?(this.incrementMinute(!0),this.second=e-60):this.second=e},mousewheel(t){if(this.disableMousewheel)return;t.preventDefault(),t.stopPropagation();const n=t.originalEvent.wheelDelta||-t.originalEvent.detail;let i=null;switch("mousewheel"===t.type?i=-1*t.originalEvent.wheelDelta:"DOMMouseScroll"===t.type&&(i=40*t.originalEvent.detail),i&&(t.preventDefault(),e(this).scrollTop(i+e(this).scrollTop())),this.highlightedUnit){case"minute":n>0?this.incrementMinute():this.decrementMinute(),this.highlightMinute();break;case"second":n>0?this.incrementSecond():this.decrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian();break;default:n>0?this.incrementHour():this.decrementHour(),this.highlightHour()}return!1},changeToNearestStep:(e,t)=>e%t==0?e:Math.round(e%t/t)?(e+(t-e%t))%60:e-e%t,place(){if(this.isInline)return;const n=this.$widget.outerWidth(),i=this.$widget.outerHeight(),r=e(t).width(),o=e(t).height(),a=e(t).scrollTop(),s=parseInt(this.$element.parents().filter((function(){return"auto"!==e(this).css("z-index")})).first().css("z-index"),10)+10,l=this.component?this.component.parent().offset():this.$element.offset(),u=this.component?this.component.outerHeight(!0):this.$element.outerHeight(!1),c=this.component?this.component.outerWidth(!0):this.$element.outerWidth(!1);let h=l.left,d=l.top;this.$widget.removeClass("timepicker-orient-top timepicker-orient-bottom timepicker-orient-right timepicker-orient-left"),"auto"!==this.orientation.x?(this.$widget.addClass("timepicker-orient-"+this.orientation.x),"right"===this.orientation.x&&(h-=n-c)):(this.$widget.addClass("timepicker-orient-left"),l.left<0?h-=l.left-10:l.left+n>r&&(h=r-n-10));let p,f,g=this.orientation.y;"auto"===g&&(p=-a+l.top-i,f=a+o-(l.top+u+i),g=Math.max(p,f)===f?"top":"bottom"),this.$widget.addClass("timepicker-orient-"+g),"top"===g?d+=u:d-=i+parseInt(this.$widget.css("padding-top"),10),this.$widget.css({top:d,left:h,zIndex:s})},remove(){e("document").off(".timepicker"),this.$widget&&this.$widget.remove(),delete this.$element.data().timepicker},setDefaultTime(e){if(this.$element.val())this.updateFromElementVal();else if("current"===e){const e=new Date;let t=e.getHours(),n=e.getMinutes(),i=e.getSeconds(),r=this.meridianNotation.am;0!==i&&(i=Math.ceil(e.getSeconds()/this.secondStep)*this.secondStep,60===i&&(n+=1,i=0)),0!==n&&(n=Math.ceil(e.getMinutes()/this.minuteStep)*this.minuteStep,60===n&&(t+=1,n=0)),this.showMeridian&&(0===t?t=12:t>=12?(t>12&&(t-=12),r=this.meridianNotation.pm):r=this.meridianNotation.am),this.hour=t,this.minute=n,this.second=i,this.meridian=r,this.update()}else!1===e?(this.hour=0,this.minute=0,this.second=0,this.meridian=this.meridianNotation.am):this.setTime(e)},setTime(e,t){if(!e)return void this.clear();let n,i,r,o,a,s;if("object"==typeof e&&e.getMonth)r=e.getHours(),o=e.getMinutes(),a=e.getSeconds(),this.showMeridian&&(s=this.meridianNotation.am,r>12&&(s=this.meridianNotation.pm,r%=12),12===r&&(s=this.meridianNotation.pm));else{let t=this.showMeridian?this.meridianNotation.am:"am",l=this.showMeridian?this.meridianNotation.pm:"pm";if(n=(new RegExp(t,"i").test(e)?1:0)+(new RegExp(l,"i").test(e)?2:0),n>2)return void this.clear();if(i=e.replace(/[^0-9:]/g,"").split(":"),r=i[0]?i[0].toString():i.toString(),this.explicitMode&&r.length>2&&r.length%2!=0)return void this.clear();o=i[1]?i[1].toString():"",a=i[2]?i[2].toString():"",r.length>4&&(a=r.slice(-2),r=r.slice(0,-2)),r.length>2&&(o=r.slice(-2),r=r.slice(0,-2)),o.length>2&&(a=o.slice(-2),o=o.slice(0,-2)),r=parseInt(r,10),o=parseInt(o,10),a=parseInt(a,10),isNaN(r)&&(r=0),isNaN(o)&&(o=0),isNaN(a)&&(a=0),a>59&&(a=59),o>59&&(o=59),r>=this.maxHours&&(r=this.maxHours-1),this.showMeridian?(r>=12&&(n||(n=2),r-=12),n||(n=1),0===r&&(r=12),s=1===n?this.meridianNotation.am:this.meridianNotation.pm):r<12&&2===n?r+=12:r>=this.maxHours?r=this.maxHours-1:(r<0||12===r&&1===n)&&(r=0)}this.hour=r,this.snapToStep?(this.minute=this.changeToNearestStep(o,this.minuteStep),this.second=this.changeToNearestStep(a,this.secondStep)):(this.minute=o,this.second=a),this.meridian=s,this.update(t)},showWidget(){this.isOpen||this.$element.is(":disabled")||(this.setTime(this.$element.val()),this.updateWidget(),this.$widget.appendTo(this.appendWidgetTo),e(n).on("mousedown.timepicker, touchend.timepicker",{scope:this},this.handleDocumentClick),this.$element.trigger({type:"show.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}}),this.place(),this.disableFocus&&this.$element.blur(),""===this.hour&&this.defaultTime&&this.setDefaultTime(this.defaultTime),!1===this.isOpen&&this.$widget.addClass("open"),this.isOpen=!0)},toggleMeridian(){this.meridian=this.meridian===this.meridianNotation.am?this.meridianNotation.pm:this.meridianNotation.am},update(e){this.updateElement(),e||this.updateWidget(),this.$element.trigger({type:"changeTime.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}})},updateElement(){this.$element.val(this.getTime()),this.$element[0].dispatchEvent(yt.Change())},updateFromElementVal(){this.setTime(this.$element.val())},updateWidget(){if(!1===this.$widget)return;const e=this.hour,t=1===this.minute.toString().length?"0"+this.minute:this.minute,n=1===this.second.toString().length?"0"+this.second:this.second;this.showInputs?(this.$widget.find("input.timepicker-hour").val(e),this.$widget.find("input.timepicker-minute").val(t),this.showSeconds&&this.$widget.find("input.timepicker-second").val(n),this.showMeridian&&this.$widget.find("input.timepicker-meridian").val(this.meridian)):(this.$widget.find("span.timepicker-hour").text(e),this.$widget.find("span.timepicker-minute").text(t),this.showSeconds&&this.$widget.find("span.timepicker-second").text(n),this.showMeridian&&this.$widget.find("span.timepicker-meridian").text(this.meridian))},updateFromWidgetInputs(){if(!1===this.$widget)return;const e=`${this.$widget.find("input.timepicker-hour").val()}:${this.$widget.find("input.timepicker-minute").val()}${this.showSeconds?":"+this.$widget.find("input.timepicker-second").val():""}${this.showMeridian?this.$widget.find("input.timepicker-meridian").val():""}`;this.setTime(e,!0)},widgetClick(t){t.stopPropagation(),t.preventDefault();const n=e(t.target),i=n.closest("a").data("action");i&&this[i](),this.update(),n.is("input")&&n.get(0).setSelectionRange(0,2)},widgetKeydown(t){const n=e(t.target),i=n.attr("class").replace("timepicker-","");switch(t.which){case 9:if(t.shiftKey){if("hour"===i)return this.hideWidget()}else if(this.showMeridian&&"meridian"===i||this.showSeconds&&"second"===i||!this.showMeridian&&!this.showSeconds&&"minute"===i)return this.hideWidget();break;case 27:this.hideWidget();break;case 38:switch(t.preventDefault(),i){case"hour":this.incrementHour();break;case"minute":this.incrementMinute();break;case"second":this.incrementSecond();break;case"meridian":this.toggleMeridian()}this.setTime(this.getTime()),n.get(0).setSelectionRange(0,2);break;case 40:switch(t.preventDefault(),i){case"hour":this.decrementHour();break;case"minute":this.decrementMinute();break;case"second":this.decrementSecond();break;case"meridian":this.toggleMeridian()}this.setTime(this.getTime()),n.get(0).setSelectionRange(0,2)}},widgetKeyup(e){(65===e.which||77===e.which||80===e.which||46===e.which||8===e.which||e.which>=48&&e.which<=57||e.which>=96&&e.which<=105)&&this.updateFromWidgetInputs()}},e.fn.timepicker=function(t){const n=Array(...arguments);return n.shift(),this.each((function(){const r=e(this);let o=r.data("timepicker");const a="object"==typeof t&&t;o||r.data("timepicker",o=new i(this,e.extend({},e.fn.timepicker.defaults,a,e(this).data()))),"string"==typeof t&&o[t](...n)}))},e.fn.timepicker.defaults={defaultTime:"current",disableFocus:!1,disableMousewheel:!1,isOpen:!1,minuteStep:15,orientation:{x:"auto",y:"auto"},secondStep:15,snapToStep:!1,showSeconds:!1,showInputs:!0,showMeridian:!0,meridianNotation:{am:"AM",pm:"PM"},template:"dropdown",appendWidgetTo:"body",showWidgetOnAddonClick:!0,icons:{up:"glyphicon glyphicon-chevron-up",down:"glyphicon glyphicon-chevron-down"},maxHours:24,explicitMode:!1},e.fn.timepicker.Constructor=i,e(n).on("focus.timepicker.data-api click.timepicker.data-api",'[data-provide="timepicker"]',(function(t){const n=e(this);n.data("timepicker")||(t.preventDefault(),n.timepicker())}))})(T,window,document);var Mi=u((function(e,t){e.exports=function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){if(!s&&l)return l();if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,(function(e){var n=t[a][1][e];return r(n||e)}),c,c.exports,e,t,n,i)}return n[a].exports}for(var o=l,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e){function n(e){return e&&"object"===(void 0===e?"undefined":o(e))}function a(e){var t=Object.keys(e).sort();if(1===t.length){var n=t[0],i=e[n],r=void 0,o=void 0;switch(n){case"eq":r="only";break;case"gt":r="lowerBound",o=!0;break;case"lt":r="upperBound",o=!0;break;case"gte":r="lowerBound";break;case"lte":r="upperBound";break;default:throw new TypeError("`"+n+"` is not a valid key")}return[r,[i,o]]}var a=e[t[0]],s=e[t[1]],l=t.join("-");switch(l){case"gt-lt":case"gt-lte":case"gte-lt":case"gte-lte":return["bound",[a,s,"gt"===t[0],"lt"===t[1]]];default:throw new TypeError("`"+l+"` are conflicted keys")}}function s(e){if(e&&"object"===(void 0===e?"undefined":o(e))&&!(e instanceof l)){var t=a(e),n=r(t,2),s=n[0],u=n[1];return l[s].apply(l,i(u))}return e}var l=e.IDBKeyRange||e.webkitIDBKeyRange,u="readonly",c="readwrite",h=Object.prototype.hasOwnProperty,d=function(e){return e},p=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.oIndexedDB||e.msIndexedDB||e.shimIndexedDB||function(){throw new Error("IndexedDB required")}(),f={},g=["abort","error","versionchange"],m=function(e,t,n,r){var s=this,h=null,p=function(r,a,s,d,p,f,g){return new Promise((function(m,v){var y=void 0;try{y=r?l[r].apply(l,i(a)):null}catch(e){return void v(e)}f=f||[],p=p||null;var _=[],b=0,w=[y],E=t.transaction(e,h?c:u);E.onerror=function(e){return v(e)},E.onabort=function(e){return v(e)},E.oncomplete=function(){return m(_)};var C=E.objectStore(e),S="string"==typeof n?C.index(n):C;"count"!==s&&w.push(d||"next");var k=h?Object.keys(h):[];S[s].apply(S,w).onsuccess=function(e){var t=e.target.result;if("number"==typeof t)_=t;else if(t)if(null!==p&&p[0]>b)b=p[0],t.advance(p[0]);else if(null!==p&&b>=p[0]+p[1]);else{var n=function(){var e=!0,n="value"in t?t.value:t.key;try{f.forEach((function(t){e="function"==typeof t[0]?e&&t[0](n):e&&n[t[0]]===t[1]}))}catch(e){return v(e),{v:void 0}}if(e){if(b++,h)try{n=function(e){return k.forEach((function(t){var n=h[t];"function"==typeof n&&(n=n(e)),e[t]=n})),e}(n),t.update(n)}catch(e){return v(e),{v:void 0}}try{_.push(g(n))}catch(e){return v(e),{v:void 0}}}t.continue()}();if("object"===(void 0===n?"undefined":o(n)))return n.v}}}))},f=function(e,t,n){var i=[],a="next",s="openCursor",l=null,u=d,c=!1,f=r||n,g=function(){return f?Promise.reject(f):p(e,t,s,c?a+"unique":a,l,i,u)},m=function(){return a=null,s="count",{execute:g}},v=function(){return s="openKeyCursor",{desc:b,distinct:w,execute:g,filter:_,limit:y,map:C}},y=function(e,t){return f=(l=t?[e,t]:[0,e]).some((function(e){return"number"!=typeof e}))?new Error("limit() arguments must be numeric"):f,{desc:b,distinct:w,filter:_,keys:v,execute:g,map:C,modify:E}},_=function e(t,n){return i.push([t,n]),{desc:b,distinct:w,execute:g,filter:e,keys:v,limit:y,map:C,modify:E}},b=function(){return a="prev",{distinct:w,execute:g,filter:_,keys:v,limit:y,map:C,modify:E}},w=function(){return c=!0,{count:m,desc:b,execute:g,filter:_,keys:v,limit:y,map:C,modify:E}},E=function(e){return h=e&&"object"===(void 0===e?"undefined":o(e))?e:null,{execute:g}},C=function(e){return u=e,{count:m,desc:b,distinct:w,execute:g,filter:_,keys:v,limit:y,modify:E}};return{count:m,desc:b,distinct:w,execute:g,filter:_,keys:v,limit:y,map:C,modify:E}};["only","bound","upperBound","lowerBound"].forEach((function(e){s[e]=function(){return f(e,arguments)}})),this.range=function(e){var t=void 0,n=[null,null];try{n=a(e)}catch(e){t=e}return f.apply(void 0,i(n).concat([t]))},this.filter=function(){var e=f(null,null);return e.filter.apply(e,arguments)},this.all=function(){return this.filter()}},v=function(e,t,i,r){var o=this,a=!1;if(this.getIndexedDB=function(){return e},this.isClosed=function(){return a},this.query=function(t,n){var i=a?new Error("Database has been closed"):null;return new m(t,e,n,i)},this.add=function(t){for(var i=arguments.length,r=Array(i>1?i-1:0),o=1;i>o;o++)r[o-1]=arguments[o];return new Promise((function(i,o){if(a)o(new Error("Database has been closed"));else{var l=r.reduce((function(e,t){return e.concat(t)}),[]),u=e.transaction(t,c);u.onerror=function(e){e.preventDefault(),o(e)},u.onabort=function(e){return o(e)},u.oncomplete=function(){return i(l)};var d=u.objectStore(t);l.some((function(e){var t=void 0,i=void 0;if(n(e)&&h.call(e,"item")&&(i=e.key,e=e.item,null!=i))try{i=s(i)}catch(e){return o(e),!0}try{t=null!=i?d.add(e,i):d.add(e)}catch(e){return o(e),!0}t.onsuccess=function(t){if(n(e)){var i=t.target,r=i.source.keyPath;null===r&&(r="__id__"),h.call(e,r)||Object.defineProperty(e,r,{value:i.result,enumerable:!0})}}}))}}))},this.update=function(t){for(var i=arguments.length,r=Array(i>1?i-1:0),o=1;i>o;o++)r[o-1]=arguments[o];return new Promise((function(i,o){if(a)o(new Error("Database has been closed"));else{var l=r.reduce((function(e,t){return e.concat(t)}),[]),u=e.transaction(t,c);u.onerror=function(e){e.preventDefault(),o(e)},u.onabort=function(e){return o(e)},u.oncomplete=function(){return i(l)};var d=u.objectStore(t);l.some((function(e){var t=void 0,i=void 0;if(n(e)&&h.call(e,"item")&&(i=e.key,e=e.item,null!=i))try{i=s(i)}catch(e){return o(e),!0}try{t=null!=i?d.put(e,i):d.put(e)}catch(e){return o(e),!0}t.onsuccess=function(t){if(n(e)){var i=t.target,r=i.source.keyPath;null===r&&(r="__id__"),h.call(e,r)||Object.defineProperty(e,r,{value:i.result,enumerable:!0})}}}))}}))},this.put=function(){return this.update.apply(this,arguments)},this.remove=function(t,n){return new Promise((function(i,r){if(a)r(new Error("Database has been closed"));else{try{n=s(n)}catch(e){return void r(e)}var o=e.transaction(t,c);o.onerror=function(e){e.preventDefault(),r(e)},o.onabort=function(e){return r(e)},o.oncomplete=function(){return i(n)};var l=o.objectStore(t);try{l.delete(n)}catch(e){r(e)}}}))},this.delete=function(){return this.remove.apply(this,arguments)},this.clear=function(t){return new Promise((function(n,i){if(a)i(new Error("Database has been closed"));else{var r=e.transaction(t,c);r.onerror=function(e){return i(e)},r.onabort=function(e){return i(e)},r.oncomplete=function(){return n()},r.objectStore(t).clear()}}))},this.close=function(){return new Promise((function(n,r){return a?void r(new Error("Database has been closed")):(e.close(),a=!0,delete f[t][i],void n())}))},this.get=function(t,n){return new Promise((function(i,r){if(a)r(new Error("Database has been closed"));else{try{n=s(n)}catch(e){return void r(e)}var o=e.transaction(t);o.onerror=function(e){e.preventDefault(),r(e)},o.onabort=function(e){return r(e)};var l=o.objectStore(t),u=void 0;try{u=l.get(n)}catch(e){r(e)}u.onsuccess=function(e){return i(e.target.result)}}}))},this.count=function(t,n){return new Promise((function(i,r){if(a)r(new Error("Database has been closed"));else{try{n=s(n)}catch(e){return void r(e)}var o=e.transaction(t);o.onerror=function(e){e.preventDefault(),r(e)},o.onabort=function(e){return r(e)};var l=o.objectStore(t),u=void 0;try{u=null==n?l.count():l.count(n)}catch(e){r(e)}u.onsuccess=function(e){return i(e.target.result)}}}))},this.addEventListener=function(t,n){if(!g.includes(t))throw new Error("Unrecognized event type "+t);return"error"===t?void e.addEventListener(t,(function(e){e.preventDefault(),n(e)})):void e.addEventListener(t,n)},this.removeEventListener=function(t,n){if(!g.includes(t))throw new Error("Unrecognized event type "+t);e.removeEventListener(t,n)},g.forEach((function(e){this[e]=function(t){return this.addEventListener(e,t),this}}),this),!r){var l=void 0;return[].some.call(e.objectStoreNames,(function(e){if(o[e])return l=new Error('The store name, "'+e+'", which you have attempted to load, conflicts with db.js method names."'),o.close(),!0;o[e]={},Object.keys(o).filter((function(e){return![].concat(g,["close","addEventListener","removeEventListener"]).includes(e)})).map((function(t){return o[e][t]=function(){for(var n=arguments.length,i=Array(n),r=0;n>r;r++)i[r]=arguments[r];return o[t].apply(o,[e].concat(i))}}))})),l}},y=function(e,t,n,i){var r=e.target.result;f[t][n]=r;var o=new v(r,t,n,i);return o instanceof Error?Promise.reject(o):Promise.resolve(o)},_={version:"0.15.0",open:function(e){var t=e.server,n=e.version||1,i=e.schema,r=e.noServerMethods;return f[t]||(f[t]={}),new Promise((function(e,a){if(f[t][n])y({target:{result:f[t][n]}},t,n,r).then(e,a);else{var s=function(){if("function"==typeof i)try{i=i()}catch(e){return a(e),{v:void 0}}var s=p.open(t,n);s.onsuccess=function(i){return y(i,t,n,r).then(e,a)},s.onerror=function(e){e.preventDefault(),a(e)},s.onupgradeneeded=function(e){var t=function(e,t,n,i,r,a){if(n&&0!==n.length){for(var s=0;s<i.objectStoreNames.length;s++){var l=i.objectStoreNames[s];h.call(n,l)||i.deleteObjectStore(l)}var u=void 0;return Object.keys(n).some((function(e){var r=n[e],a=void 0;if(i.objectStoreNames.contains(e))a=t.transaction.objectStore(e);else try{a=i.createObjectStore(e,r.key)}catch(e){return u=e,!0}Object.keys(r.indexes||{}).some((function(e){try{a.index(e)}catch(n){var t=r.indexes[e];t=t&&"object"===(void 0===t?"undefined":o(t))?t:{};try{a.createIndex(e,t.keyPath||t.key||e,t)}catch(e){return u=e,!0}}}))})),u}}(0,s,i,e.target.result);t&&a(t)},s.onblocked=function(e){var i=new Promise((function(e,i){s.onsuccess=function(o){y(o,t,n,r).then(e,i)},s.onerror=function(e){return i(e)}}));e.resume=i,a(e)}}();if("object"===(void 0===s?"undefined":o(s)))return s.v}}))},delete:function(e){return new Promise((function(t,n){var i=p.deleteDatabase(e);i.onsuccess=function(e){return t(e)},i.onerror=function(e){return n(e)},i.onblocked=function(e){e=null===e.newVersion||"undefined"==typeof Proxy?e:new Proxy(e,{get:function(e,t){return"newVersion"===t?null:e[t]}});var t=new Promise((function(t,n){i.onsuccess=function(n){"newVersion"in n||(n.newVersion=e.newVersion),"oldVersion"in n||(n.oldVersion=e.oldVersion),t(n)},i.onerror=function(e){return n(e)}}));e.resume=t,n(e)}}))},cmp:function(e,t){return new Promise((function(n,i){try{n(p.cmp(e,t))}catch(e){i(e)}}))}};void 0!==t&&void 0!==t.exports?t.exports=_:e.db=_}(self)},{}]},{},[1])(1)}));const Oi=new DOMParser;let Ui,zi,Fi=!1;function Vi(){return ji.update({name:"testWrite",value:(new Date).getTime()})}function qi(){return function(){const e=new Blob(['<a id="a"><b id="b">hey!</b></a>'],{type:"text/xml"});return ji.update({name:"testBlobWrite",value:e})}().then(()=>{zi=!1}).catch(()=>{console.log("This browser is not able to store blobs directly, so blobs will be Base64 encoded"),zi=!0})}const ji={get:e=>Ui.properties.get(e).then(Ki),update:e=>Ui.properties.update(e).then(Ki),removeAll:()=>Qi("properties"),getSurveyStats:e=>Ui.properties.get(e+":stats"),incrementRecordCount:e=>ji.getSurveyStats(e.enketoId).then(t=>(t||(t={name:e.enketoId+":stats"}),t.recordCount||(t.recordCount=0),++t.recordCount,ji.update(t))),addSubmittedInstanceId:e=>ji.getSurveyStats(e.enketoId).then(t=>(t||(t={name:e.enketoId+":stats"}),t.submitted||(t.submitted=[]),t.submitted.push(e.instanceId),ji.update(t)))},$i={get:e=>Ui.surveys.get(e).then(Ki).then(Zi),set(e){if(!(e.form&&e.model&&e.enketoId&&e.hash))throw new Error("Survey not complete");return Ui.surveys.add(Gi(e)).then(Ki).then(t=>{const n=[];return e.binaryDefaults&&e.binaryDefaults.forEach(t=>{n.push($i.resource.update(e.enketoId,t))}),Promise.all(n).then(()=>t)}).then(Zi)},update(e){let t=[],n=[];if(!e.form||!e.model||!e.enketoId)throw new Error("Survey not complete");const i=[].concat(e.resources||[]).map(e=>e.url),r=[].concat(e.binaryDefaults||[]).map(e=>e.url);return Ui.surveys.get(e.enketoId).then(o=>(e.resources&&(t=(o.resources||[]).filter(e=>i.indexOf(e)<0)),e.binaryDefaults&&(n=(o.binaryDefaults||[]).filter(e=>r.indexOf(e)<0)),Gi(e),Ui.surveys.update({form:e.form,model:e.model,enketoId:e.enketoId,hash:e.hash,theme:e.theme,resources:e.resources?i:void 0,binaryDefaults:e.binaryDefaults?r:void 0,maxSize:e.maxSize,externalData:e.externalData,branding:e.branding}))).then(()=>{const i=[];return(e.resources||[]).concat(e.binaryDefaults||[]).forEach(t=>{i.push($i.resource.update(e.enketoId,t))}),t.concat(n).forEach(t=>{i.push($i.resource.remove(e.enketoId,t))}),Promise.all(i).then(()=>e).then(Zi)})},remove(e){let t;const n=[];return $i.get(e).then(i=>(t=i.resources||[],t.forEach(t=>{n.push($i.resource.remove(e,t))}),n.push(Ui.surveys.remove(e)),Promise.all(n)))},removeAll:()=>Qi("surveys").then(()=>Qi("resources")),resource:{get:(e,t)=>Yi("resources",e,t),update:(e,t)=>Xi("resources",e,t),remove:(e,t)=>Ui.resources.remove(`${e}:${t}`)}},Hi={get:e=>Ui.data.get(e).then(Ki),update(e){if(!e.enketoId)throw new Error("Dynamic data object not complete");return Ui.data.update(e).then(Ki)},remove:e=>Hi.remove(e)},Wi={get(e){const t=[];return Ui.records.get(e).then(Ki).then(e=>e?(e.files.forEach(n=>{t.push(Wi.file.get(e.instanceId,n))}),Promise.all(t).then(t=>(t=t.filter(e=>e),e.files=t||[],e))):e)},getAll:(e,t)=>e?Ui.records.query("enketoId").only(e).execute().then(e=>(t&&(e=e.filter(e=>!e.draft)),e.sort((e,t)=>e.updated-t.updated))):Promise.reject(new Error("No Enketo ID provided")),set(e){let t;return e.instanceId&&e.enketoId&&e.name&&e.xml?(e.files=e.files||[],t=e.files.map(e=>e.name),Ui.records.add({instanceId:e.instanceId,enketoId:e.enketoId,name:e.name,xml:e.xml,files:t,created:(new Date).getTime(),updated:(new Date).getTime(),draft:e.draft}).then(Ki).then(ji.incrementRecordCount).then(()=>e.files.reduce((t,n)=>t.then(()=>n&&n.item&&n.item instanceof Blob?Wi.file.update(e.instanceId,n):Promise.resolve()),Promise.resolve())).then(()=>e)):Promise.reject(new Error("Record not complete"))},update(e){let t,n=[];if(!(e.instanceId&&e.enketoId&&e.name&&e.xml))throw new Error("Record not complete");return e.files=e.files||[],t=e.files.map(e=>e.name),Ui.records.get(e.instanceId).then(i=>(i&&i.files&&(n=i.files.filter(e=>t.indexOf(e)<0)),Ui.records.update({instanceId:e.instanceId,enketoId:e.enketoId,name:e.name,xml:e.xml,files:t,created:i&&i.created?i.created:(new Date).getTime(),updated:(new Date).getTime(),draft:e.draft}))).then(()=>e.files.reduce((t,n)=>t.then(()=>n&&n.item&&n.item instanceof Blob?Wi.file.update(e.instanceId,n):Promise.resolve()),Promise.resolve()).then(()=>n.reduce((t,n)=>t.then(()=>Wi.file.remove(e.instanceId,n)),Promise.resolve())).then(()=>e))},remove:e=>Ui.records.get(e).then(Ki).then(t=>{const n=[];return(t&&t.files?t.files:[]).forEach(t=>{n.push(Wi.file.remove(e,t))}),n.push(Ui.records.remove(e)),Promise.all(n)}),removeAll:()=>Qi("records").then(()=>Qi("files")),file:{get:(e,t)=>Yi("files",e,t),update:(e,t)=>Xi("files",e,t),remove:(e,t)=>Ui.files.remove(`${e}:${t}`)}};function Ki(e){return Array.isArray(e)?Promise.resolve(e[0]):Promise.resolve(e)}function Gi(e){return e&&e.externalData&&(e.externalData=e.externalData.map(e=>(e.xml instanceof XMLDocument&&(e.xml=(new XMLSerializer).serializeToString(e.xml.documentElement,"text/xml")),e))),e}function Zi(e){return e&&e.externalData&&(e.externalData=e.externalData.map(e=>("string"==typeof e.xml&&(e.xml=Oi.parseFromString(e.xml,"text/xml")),e))),e}function Yi(e,t,n){let i;const r={};return new Promise((o,a)=>{if("resources"===e||"files"===e)return i="resources"===e?"url":"name",Ui[e].get(`${t}:${n}`).then(e=>{r[i]=n,e instanceof Blob?(r.item=e,o(r)):"string"==typeof e?C.dataUriToBlob(e).then(e=>{r.item=e,o(r)}):o(void 0)}).catch(a);a(new Error("Unknown table or missing id or key."))})}function Xi(e,t,n){let i,r,o;return"resources"===e||"files"===e?(r="resources"===e?"url":"name",t&&n&&n.item instanceof Blob&&n[r]?(o=n[r],n.key=`${t}:${n[r]}`,delete n[r],zi?C.blobToDataUri(n.item).then(t=>(n.item=t,Ui[e].update(n).then(()=>(n[r]=o,delete n.key,n)))):Ui[e].update(n).then(()=>(n[r]=o,delete n.key,n))):(i=new Error("DataError. File not complete or ID not provided."),i.name="DataError",Promise.reject(i))):Promise.reject(new Error("Unknown table or missing ID or key."))}function Qi(e){return Ui[e].clear()}var Ji={init:function(){return function(){let e;return new Promise((t,n)=>{"object"==typeof indexedDB?t():(e=vt.os.ios?new Error(dt("store.error.iosusesafari")):new Error(dt("store.error.notsupported")),e.status=500,n(e))})}().then(()=>Mi.open({server:"enketo",version:2,schema:{surveys:{key:{keyPath:"enketoId",autoIncrement:!1},indexes:{enketoId:{unique:!0}}},resources:{key:{autoIncrement:!1},indexes:{key:{unique:!0}}},records:{key:{keyPath:"instanceId"},indexes:{name:{unique:!0},instanceId:{unique:!0},enketoId:{unique:!1}}},files:{key:{autoIncrement:!1},indexes:{key:{unique:!0}}},properties:{key:{keyPath:"name",autoIncrement:!1},indexes:{key:{unique:!0}}},data:{key:{keyPath:"enketoId",autoIncrement:!1},indexes:{enketoId:{unique:!0}}}}})).then(e=>{Ui=e}).then(Vi).then(qi).then(()=>{Fi=!0}).catch(e=>{throw console.error("store initialization error",e),"string"==typeof e?e=new Error(e):e instanceof Error||(e=new Error(dt("store.error.notavailable",{error:JSON.stringify(e)}))),e.status=500,e})},get available(){return Fi},property:ji,survey:$i,dynamicData:Hi,record:Wi,flush:function(){let e;return new Promise((t,n)=>{try{Ui.close("enketo")}catch(e){console.log("Database has probably been removed already. Doing nothing.",e),t()}e=indexedDB.deleteDatabase("enketo"),e.onsuccess=()=>{console.log("Deleted database successfully"),t()},e.onerror=e=>{n(e)},e.onblocked=e=>{n(e)}})},dump:{resources(){Ui.resources.query().all().execute().done(e=>{console.log(e.length+" resources found"),e.forEach(e=>{e instanceof Blob?console.log(e.type,e.size,URL.createObjectURL(e)):console.log("resource string with length ",e.length,"found")})})},surveys(){Ui.surveys.query().all().execute().done(e=>{console.log(e.length+" surveys found"),e.forEach(e=>{console.log("survey",e)})})},records(){Ui.records.query().all().execute().done(e=>{console.log(e.length+" records found"),e.forEach(e=>{console.log("survey",e)})})},files(){Ui.files.query().all().execute().done(e=>{console.log(e.length+" resources found"),e.forEach(e=>{e instanceof Blob?console.log(e.type,e.size,URL.createObjectURL(e)):console.log("resource string with length ",e.length,"found")})})}}};const er=/[a-zA-Z0-9+-.]+?:\/\//;let tr;function nr(e){return new Promise((t,n)=>{e?"string"==typeof e?e.startsWith("/")?t(e):tr&&Object.prototype.hasOwnProperty.call(tr,e)?t(tr[e]):Ji.available?er.test(e)?Ji.survey.resource.get(k.enketoId,e).then(e=>{e.item?t(URL.createObjectURL(e.item)):n(new Error("File Retrieval Error"))}).catch(n):Ji.record.file.get(k.recordId,e).then(e=>{e.item?rr(e.item)?n(or()):t(URL.createObjectURL(e.item)):n(new Error("File Retrieval Error"))}).catch(n):n(new Error("store not available")):"object"==typeof e?rr(e)?n(or()):t(URL.createObjectURL(e)):n(new Error("Unknown error occurred")):t(null)})}function ir(){const e=[...document.querySelectorAll('form.or input[type="file"], form.or input[type="text"][data-drawing="true"]')],t=[],n=function(e,t){if(t&&t.name){const n=f(t,e.dataset.filenamePostfix);e.dataset.resized&&e.dataset.resizedDataURI&&(t=C.dataUriToBlobSync(e.dataset.resizedDataURI)),(t=new Blob([t],{type:t.type})).name=n}return t};return e.forEach(e=>{if("file"===e.type)e.files[0]&&t.push(Promise.resolve(n(e,e.files[0])));else if(e.value){const i=e.closest(".question").querySelector(".draw-widget canvas");i&&!er.test(e.value)&&t.push(new Promise(t=>i.toBlob(i=>{i.name=e.value,t(n(e,i))})))}}),Promise.all(t).then(t=>(e.filter(e=>e.matches("[data-loaded-file-name]")).forEach(e=>t.push(e.getAttribute("data-loaded-file-name"))),t))}function rr(e){return e&&e.size>ar()}function or(){return new Error(dt("filepicker.toolargeerror",{maxSize:sr()}))}function ar(){return k.maxSize||5242880}function sr(){return Math.round(100*ar()/1048576/100)+"MB"}var lr={isWaitingForPermissions:function(){return!1},init:function(){return Promise.resolve(!0)},setInstanceAttachments:function(e){tr=e},getFileUrl:nr,getObjectUrl:function(e){return nr(e).then(e=>/https?:\/\//.test(e)?tn.getMediaFile(e).then(e=>URL.createObjectURL(e.item)):e)},getCurrentFiles:ir,getCurrentFile:function(e){return ir().then(t=>t.find(t=>t.name===e))},isTooLarge:rr,getMaxSizeReadable:sr};var ur={updateDownloadLink:function(e,t,n){if(window.updateDownloadLinkIe11)return window.updateDownloadLinkIe11(...arguments);e.setAttribute("href",t||""),e.setAttribute("download",n||"")}};function cr(e,t,n){this.message=e,this.translationKey=t,this.translationOptions=n}cr.prototype=Object.create(Error.prototype),cr.prototype.name="TranslatedError";
/*!
     * Signature Pad v2.3.2
     * https://github.com/szimek/signature_pad
     *
     * Copyright 2017 Szymon Nowak
     * Released under the MIT license
     *
     * The main idea and some parts of the code (e.g. drawing variable width Bézier curve) are taken from:
     * http://corner.squareup.com/2012/07/smoother-signatures.html
     *
     * Implementation of interpolation using cubic Bézier curves is taken from:
     * http://benknowscode.wordpress.com/2012/09/14/path-interpolation-using-cubic-bezier-and-control-point-estimation-in-javascript
     *
     * Algorithm for approximated length of a Bézier curve is taken from:
     * http://www.lemoda.net/maths/bezier-length/index.html
     *
     */
function hr(e,t,n){this.x=e,this.y=t,this.time=n||(new Date).getTime()}function dr(e,t,n,i){this.startPoint=e,this.control1=t,this.control2=n,this.endPoint=i}function pr(e,t){var n=this,i=t||{};this.velocityFilterWeight=i.velocityFilterWeight||.7,this.minWidth=i.minWidth||.5,this.maxWidth=i.maxWidth||2.5,this.throttle="throttle"in i?i.throttle:16,this.minDistance="minDistance"in i?i.minDistance:5,this.throttle?this._strokeMoveUpdate=function(e,t,n){var i,r,o,a=null,s=0;n||(n={});var l=function(){s=!1===n.leading?0:Date.now(),a=null,o=e.apply(i,r),a||(i=r=null)};return function(){var u=Date.now();s||!1!==n.leading||(s=u);var c=t-(u-s);return i=this,r=arguments,c<=0||c>t?(a&&(clearTimeout(a),a=null),s=u,o=e.apply(i,r),a||(i=r=null)):a||!1===n.trailing||(a=setTimeout(l,c)),o}}(pr.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=pr.prototype._strokeUpdate,this.dotSize=i.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=i.penColor||"black",this.backgroundColor=i.backgroundColor||"rgba(0,0,0,0)",this.onBegin=i.onBegin,this.onEnd=i.onEnd,this._canvas=e,this._ctx=e.getContext("2d"),this.clear(),this._handleMouseDown=function(e){1===e.which&&(n._mouseButtonDown=!0,n._strokeBegin(e))},this._handleMouseMove=function(e){n._mouseButtonDown&&n._strokeMoveUpdate(e)},this._handleMouseUp=function(e){1===e.which&&n._mouseButtonDown&&(n._mouseButtonDown=!1,n._strokeEnd(e))},this._handleTouchStart=function(e){if(1===e.targetTouches.length){var t=e.changedTouches[0];n._strokeBegin(t)}},this._handleTouchMove=function(e){e.preventDefault();var t=e.targetTouches[0];n._strokeMoveUpdate(t)},this._handleTouchEnd=function(e){e.target===n._canvas&&(e.preventDefault(),n._strokeEnd(e))},this.on()}hr.prototype.velocityFrom=function(e){return this.time!==e.time?this.distanceTo(e)/(this.time-e.time):1},hr.prototype.distanceTo=function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},hr.prototype.equals=function(e){return this.x===e.x&&this.y===e.y&&this.time===e.time},dr.prototype.length=function(){for(var e=0,t=void 0,n=void 0,i=0;i<=10;i+=1){var r=i/10,o=this._point(r,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),a=this._point(r,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(i>0){var s=o-t,l=a-n;e+=Math.sqrt(s*s+l*l)}t=o,n=a}return e},dr.prototype._point=function(e,t,n,i,r){return t*(1-e)*(1-e)*(1-e)+3*n*(1-e)*(1-e)*e+3*i*(1-e)*e*e+r*e*e*e},pr.prototype.clear=function(){var e=this._ctx,t=this._canvas;e.fillStyle=this.backgroundColor,e.clearRect(0,0,t.width,t.height),e.fillRect(0,0,t.width,t.height),this._data=[],this._reset(),this._isEmpty=!0},pr.prototype.fromDataURL=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new Image,r=n.ratio||window.devicePixelRatio||1,o=n.width||this._canvas.width/r,a=n.height||this._canvas.height/r;this._reset(),i.src=e,i.onload=function(){t._ctx.drawImage(i,0,0,o,a)},this._isEmpty=!1},pr.prototype.toDataURL=function(e){var t;switch(e){case"image/svg+xml":return this._toSVG();default:for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return(t=this._canvas).toDataURL.apply(t,[e].concat(i))}},pr.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},pr.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},pr.prototype.isEmpty=function(){return this._isEmpty},pr.prototype._strokeBegin=function(e){this._data.push([]),this._reset(),this._strokeUpdate(e),"function"==typeof this.onBegin&&this.onBegin(e)},pr.prototype._strokeUpdate=function(e){var t=e.clientX,n=e.clientY,i=this._createPoint(t,n),r=this._data[this._data.length-1],o=r&&r[r.length-1],a=o&&i.distanceTo(o)<this.minDistance;if(!o||!a){var s=this._addPoint(i),l=s.curve,u=s.widths;l&&u&&this._drawCurve(l,u.start,u.end),this._data[this._data.length-1].push({x:i.x,y:i.y,time:i.time,color:this.penColor})}},pr.prototype._strokeEnd=function(e){var t=this.points.length>2,n=this.points[0];if(!t&&n&&this._drawDot(n),n){var i=this._data[this._data.length-1],r=i[i.length-1];n.equals(r)||i.push({x:n.x,y:n.y,time:n.time,color:this.penColor})}"function"==typeof this.onEnd&&this.onEnd(e)},pr.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},pr.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},pr.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},pr.prototype._createPoint=function(e,t,n){var i=this._canvas.getBoundingClientRect();return new hr(e-i.left,t-i.top,n||(new Date).getTime())},pr.prototype._addPoint=function(e){var t=this.points;if(t.push(e),t.length>2){3===t.length&&t.unshift(t[0]);var n=this._calculateCurveControlPoints(t[0],t[1],t[2]).c2,i=this._calculateCurveControlPoints(t[1],t[2],t[3]).c1,r=new dr(t[1],n,i,t[2]),o=this._calculateCurveWidths(r);return t.shift(),{curve:r,widths:o}}return{}},pr.prototype._calculateCurveControlPoints=function(e,t,n){var i=e.x-t.x,r=e.y-t.y,o=t.x-n.x,a=t.y-n.y,s=(e.x+t.x)/2,l=(e.y+t.y)/2,u=(t.x+n.x)/2,c=(t.y+n.y)/2,h=Math.sqrt(i*i+r*r),d=Math.sqrt(o*o+a*a),p=d/(h+d),f=u+(s-u)*p,g=c+(l-c)*p,m=t.x-f,v=t.y-g;return{c1:new hr(s+m,l+v),c2:new hr(u+m,c+v)}},pr.prototype._calculateCurveWidths=function(e){var t=e.startPoint,n=e.endPoint,i={start:null,end:null},r=this.velocityFilterWeight*n.velocityFrom(t)+(1-this.velocityFilterWeight)*this._lastVelocity,o=this._strokeWidth(r);return i.start=this._lastWidth,i.end=o,this._lastVelocity=r,this._lastWidth=o,i},pr.prototype._strokeWidth=function(e){return Math.max(this.maxWidth/(e+1),this.minWidth)},pr.prototype._drawPoint=function(e,t,n){var i=this._ctx;i.moveTo(e,t),i.arc(e,t,n,0,2*Math.PI,!1),this._isEmpty=!1},pr.prototype._drawCurve=function(e,t,n){var i=this._ctx,r=n-t,o=Math.floor(e.length());i.beginPath();for(var a=0;a<o;a+=1){var s=a/o,l=s*s,u=l*s,c=1-s,h=c*c,d=h*c,p=d*e.startPoint.x;p+=3*h*s*e.control1.x,p+=3*c*l*e.control2.x,p+=u*e.endPoint.x;var f=d*e.startPoint.y;f+=3*h*s*e.control1.y,f+=3*c*l*e.control2.y,f+=u*e.endPoint.y;var g=t+u*r;this._drawPoint(p,f,g)}i.closePath(),i.fill()},pr.prototype._drawDot=function(e){var t=this._ctx,n="function"==typeof this.dotSize?this.dotSize():this.dotSize;t.beginPath(),this._drawPoint(e.x,e.y,n),t.closePath(),t.fill()},pr.prototype._fromData=function(e,t,n){for(var i=0;i<e.length;i+=1){var r=e[i];if(r.length>1)for(var o=0;o<r.length;o+=1){var a=r[o],s=new hr(a.x,a.y,a.time),l=a.color;if(0===o)this.penColor=l,this._reset(),this._addPoint(s);else if(o!==r.length-1){var u=this._addPoint(s),c=u.curve,h=u.widths;c&&h&&t(c,h,l)}}else this._reset(),n(r[0])}},pr.prototype._toSVG=function(){var e=this,t=this._data,n=this._canvas,i=Math.max(window.devicePixelRatio||1,1),r=n.width/i,o=n.height/i,a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"width",n.width),a.setAttributeNS(null,"height",n.height),this._fromData(t,(function(e,t,n){var i=document.createElement("path");if(!(isNaN(e.control1.x)||isNaN(e.control1.y)||isNaN(e.control2.x)||isNaN(e.control2.y))){var r="M "+e.startPoint.x.toFixed(3)+","+e.startPoint.y.toFixed(3)+" C "+e.control1.x.toFixed(3)+","+e.control1.y.toFixed(3)+" "+e.control2.x.toFixed(3)+","+e.control2.y.toFixed(3)+" "+e.endPoint.x.toFixed(3)+","+e.endPoint.y.toFixed(3);i.setAttribute("d",r),i.setAttribute("stroke-width",(2.25*t.end).toFixed(3)),i.setAttribute("stroke",n),i.setAttribute("fill","none"),i.setAttribute("stroke-linecap","round"),a.appendChild(i)}}),(function(t){var n=document.createElement("circle"),i="function"==typeof e.dotSize?e.dotSize():e.dotSize;n.setAttribute("r",i),n.setAttribute("cx",t.x),n.setAttribute("cy",t.y),n.setAttribute("fill",t.color),a.appendChild(n)}));var s='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 '+r+" "+o+'" width="'+r+'" height="'+o+'">',l=a.innerHTML;if(void 0===l){var u=document.createElement("dummy"),c=a.childNodes;u.innerHTML="";for(var h=0;h<c.length;h+=1)u.appendChild(c[h].cloneNode(!0));l=u.innerHTML}return"data:image/svg+xml;base64,"+btoa(s+l+"</svg>")},pr.prototype.fromData=function(e){var t=this;this.clear(),this._fromData(e,(function(e,n){return t._drawCurve(e,n.start,n.end)}),(function(e){return t._drawDot(e)})),this._data=e},pr.prototype.toData=function(){return this._data};pr.prototype.fromObjectURL=function(e,t){const n=new Image,i=(t=t||{}).ratio||window.devicePixelRatio||1,r=t.width||this._canvas.width/i,o=t.height||this._canvas.height/i,a=this;return this._reset(),new Promise(t=>{n.src=e,n.onload=()=>{const i=n.width,s=n.height,l=r/i,u=o/s;let c,h;if(l<1||u<1){const e=Math.min(l,u);c=(r-i*e)/2,h=(o-s*e)/2,a._ctx.drawImage(n,0,0,i,s,c,h,i*e,s*e)}else c=(r-i)/2,h=(o-s)/2,a._ctx.drawImage(n,c,h,i,s);t(e)},a._isEmpty=!1})},pr.prototype.updateData=function(e){const t=this;this._fromData(e,(e,n)=>{t._drawCurve(e,n.start,n.end)},e=>{t._drawDot(e)}),this._data=e};function fr(e,t,n){if(void 0===n)return e&&e.h5s&&e.h5s.data&&e.h5s.data[t];e.h5s=e.h5s||{},e.h5s.data=e.h5s.data||{},e.h5s.data[t]=n}var gr=function(e,t){if(!(e instanceof NodeList||e instanceof HTMLCollection||e instanceof Array))throw new Error("You must provide a nodeList/HTMLCollection/Array of elements to be filtered.");return"string"!=typeof t?Array.from(e):Array.from(e).filter((function(e){return 1===e.nodeType&&e.matches(t)}))},mr=new Map,vr=function(){function e(){this._config=new Map,this._placeholder=void 0,this._data=new Map}return Object.defineProperty(e.prototype,"config",{get:function(){var e={};return this._config.forEach((function(t,n){e[n]=t})),e},set:function(e){if("object"!=typeof e)throw new Error("You must provide a valid configuration object to the config setter.");var t=Object.assign({},e);this._config=new Map(Object.entries(t))},enumerable:!0,configurable:!0}),e.prototype.setConfig=function(e,t){if(!this._config.has(e))throw new Error("Trying to set invalid configuration item: "+e);this._config.set(e,t)},e.prototype.getConfig=function(e){if(!this._config.has(e))throw new Error("Invalid configuration item requested: "+e);return this._config.get(e)},Object.defineProperty(e.prototype,"placeholder",{get:function(){return this._placeholder},set:function(e){if(!(e instanceof HTMLElement)&&null!==e)throw new Error("A placeholder must be an html element or null.");this._placeholder=e},enumerable:!0,configurable:!0}),e.prototype.setData=function(e,t){if("string"!=typeof e)throw new Error("The key must be a string.");this._data.set(e,t)},e.prototype.getData=function(e){if("string"!=typeof e)throw new Error("The key must be a string.");return this._data.get(e)},e.prototype.deleteData=function(e){if("string"!=typeof e)throw new Error("The key must be a string.");return this._data.delete(e)},e}(),yr=function(e){if(!(e instanceof HTMLElement))throw new Error("Please provide a sortable to the store function.");return mr.has(e)||mr.set(e,new vr),mr.get(e)};function _r(e,t,n){if(e instanceof Array)for(var i=0;i<e.length;++i)_r(e[i],t,n);else e.addEventListener(t,n),yr(e).setData("event"+t,n)}function br(e,t){if(e instanceof Array)for(var n=0;n<e.length;++n)br(e[n],t);else e.removeEventListener(t,yr(e).getData("event"+t)),yr(e).deleteData("event"+t)}function wr(e,t,n){if(e instanceof Array)for(var i=0;i<e.length;++i)wr(e[i],t,n);else e.setAttribute(t,n)}function Er(e,t){if(e instanceof Array)for(var n=0;n<e.length;++n)Er(e[n],t);else e.removeAttribute(t)}var Cr=function(e){if(!e.parentElement||0===e.getClientRects().length)throw new Error("target element must be part of the dom");var t=e.getClientRects()[0];return{left:t.left+window.pageXOffset,right:t.right+window.pageXOffset,top:t.top+window.pageYOffset,bottom:t.bottom+window.pageYOffset}},Sr=function(e,t){if(!(e instanceof HTMLElement&&(t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array)))throw new Error("You must provide an element and a list of elements.");return Array.from(t).indexOf(e)},kr=function(e){if(!(e instanceof HTMLElement))throw new Error("Element is not a node element.");return null!==e.parentNode},Tr=function(e,t,n){if(!(e instanceof HTMLElement&&e.parentElement instanceof HTMLElement))throw new Error("target and element must be a node");e.parentElement.insertBefore(t,"before"===n?e:e.nextElementSibling)},xr=function(e,t){return Tr(e,t,"after")},Lr=function(e){if(!(e instanceof HTMLElement))throw new Error("You must provide a valid dom element");var t=window.getComputedStyle(e);return["height","padding-top","padding-bottom"].map((function(e){var n=parseInt(t.getPropertyValue(e),10);return isNaN(n)?0:n})).reduce((function(e,t){return e+t}))},Ir=function(e){if(!(e instanceof HTMLElement))throw new Error("You must provide a valid dom element");var t=window.getComputedStyle(e);return["width","padding-left","padding-right"].map((function(e){var n=parseInt(t.getPropertyValue(e),10);return isNaN(n)?0:n})).reduce((function(e,t){return e+t}))},Ar=function(e,t){if(!(e instanceof Array))throw new Error("You must provide a Array of HTMLElements to be filtered.");return"string"!=typeof t?e:e.filter((function(e){return e.querySelector(t)instanceof HTMLElement||e.shadowRoot&&e.shadowRoot.querySelector(t)instanceof HTMLElement})).map((function(e){return e.querySelector(t)||e.shadowRoot&&e.shadowRoot.querySelector(t)}))},Dr=function(e){return e.composedPath&&e.composedPath()[0]||e.target},Nr=function(e,t,n){return{element:e,posX:n.pageX-t.left,posY:n.pageY-t.top}},Pr=function(e,t){if(!0===e.isSortable){var n=yr(e).getConfig("acceptFrom");if(null!==n&&!1!==n&&"string"!=typeof n)throw new Error('HTML5Sortable: Wrong argument, "acceptFrom" must be "null", "false", or a valid selector string.');if(null!==n)return!1!==n&&n.split(",").filter((function(e){return e.length>0&&t.matches(e)})).length>0;if(e===t)return!0;if(void 0!==yr(e).getConfig("connectWith")&&null!==yr(e).getConfig("connectWith"))return yr(e).getConfig("connectWith")===yr(t).getConfig("connectWith")}return!1},Br={items:null,connectWith:null,disableIEFix:null,acceptFrom:null,copy:!1,placeholder:null,placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging",hoverClass:!1,debounce:0,throttleTime:100,maxItems:0,itemSerializer:void 0,containerSerializer:void 0,customDragImage:null,orientation:"vertical"};var Rr,Mr,Or,Ur,zr,Fr,Vr,qr,jr,$r=function(e,t){if("string"==typeof yr(e).getConfig("hoverClass")){var n=yr(e).getConfig("hoverClass").split(" ");!0===t?(_r(e,"mousemove",function(e,t){var n=this;if(void 0===t&&(t=250),"function"!=typeof e)throw new Error("You must provide a function as the first argument for throttle.");if("number"!=typeof t)throw new Error("You must provide a number as the second argument for throttle.");var i=null;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var a=Date.now();(null===i||a-i>=t)&&(i=a,e.apply(n,r))}}((function(t){0===t.buttons&&gr(e.children,yr(e).getConfig("items")).forEach((function(e){var i,r;e!==t.target?(i=e.classList).remove.apply(i,n):(r=e.classList).add.apply(r,n)}))}),yr(e).getConfig("throttleTime"))),_r(e,"mouseleave",(function(){gr(e.children,yr(e).getConfig("items")).forEach((function(e){var t;(t=e.classList).remove.apply(t,n)}))}))):(br(e,"mousemove"),br(e,"mouseleave"))}},Hr=function(e){br(e,"dragstart"),br(e,"dragend"),br(e,"dragover"),br(e,"dragenter"),br(e,"drop"),br(e,"mouseenter"),br(e,"mouseleave")},Wr=function(e){!function(e){e.h5s&&delete e.h5s.data}(e),Er(e,"aria-dropeffect")},Kr=function(e){Er(e,"aria-grabbed"),Er(e,"aria-copied"),Er(e,"draggable"),Er(e,"role")};function Gr(e,t){if(t.composedPath)return t.composedPath().find((function(e){return e.isSortable}));for(;!0!==e.isSortable;)e=e.parentElement;return e}function Zr(e,t){var n=fr(e,"opts"),i=gr(e.children,n.items).filter((function(e){return e.contains(t)||e.shadowRoot&&e.shadowRoot.contains(t)}));return i.length>0?i[0]:t}var Yr=function(e){var t=fr(e,"opts"),n=gr(e.children,t.items),i=Ar(n,t.handle);(wr(e,"aria-dropeffect","move"),fr(e,"_disabled","false"),wr(i,"draggable","true"),!1===t.disableIEFix)&&("function"==typeof(document||window.document).createElement("span").dragDrop&&_r(i,"mousedown",(function(){if(-1!==n.indexOf(this))this.dragDrop();else{for(var e=this.parentElement;-1===n.indexOf(e);)e=e.parentElement;e.dragDrop()}})))};function Xr(e,t){var n=String(t);return t=t||{},"string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLElement&&(e=[e]),e=Array.prototype.slice.call(e),/serialize/.test(n)?e.map((function(e){var t=fr(e,"opts");return function(e,t,n){if(void 0===t&&(t=function(e,t){return e}),void 0===n&&(n=function(e){return e}),!(e instanceof HTMLElement)||!0==!e.isSortable)throw new Error("You need to provide a sortableContainer to be serialized.");if("function"!=typeof t||"function"!=typeof n)throw new Error("You need to provide a valid serializer for items and the container.");var i=fr(e,"opts").items,r=gr(e.children,i),o=r.map((function(t){return{parent:e,node:t,html:t.outerHTML,index:Sr(t,r)}}));return{container:n({node:e,itemCount:o.length}),items:o.map((function(n){return t(n,e)}))}}(e,t.itemSerializer,t.containerSerializer)})):(e.forEach((function(e){if(/enable|disable|destroy/.test(n))return Xr[n](e);["connectWith","disableIEFix"].forEach((function(e){Object.prototype.hasOwnProperty.call(t,e)&&null!==t[e]&&console.warn('HTML5Sortable: You are using the deprecated configuration "'+e+'". This will be removed in an upcoming version, make sure to migrate to the new options when updating.')})),t=Object.assign({},Br,yr(e).config,t),yr(e).config=t,fr(e,"opts",t),e.isSortable=!0,function(e){var t=fr(e,"opts"),n=gr(e.children,t.items),i=Ar(n,t.handle);fr(e,"_disabled","false"),Hr(n),br(i,"mousedown"),br(e,"dragover"),br(e,"dragenter"),br(e,"drop")}(e);var i,r=gr(e.children,t.items);if(null!==t.placeholder&&void 0!==t.placeholder){var o=document.createElement(e.tagName);t.placeholder instanceof HTMLElement?o.appendChild(t.placeholder):o.innerHTML=t.placeholder,i=o.children[0]}yr(e).placeholder=function(e,t,n){var i;if(void 0===n&&(n="sortable-placeholder"),!(e instanceof HTMLElement))throw new Error("You must provide a valid element as a sortable.");if(!(t instanceof HTMLElement)&&void 0!==t)throw new Error("You must provide a valid element as a placeholder or set ot to undefined.");return void 0===t&&(["UL","OL"].includes(e.tagName)?t=document.createElement("li"):["TABLE","TBODY"].includes(e.tagName)?(t=document.createElement("tr")).innerHTML='<td colspan="100"></td>':t=document.createElement("div")),"string"==typeof n&&(i=t.classList).add.apply(i,n.split(" ")),t}(e,i,t.placeholderClass),fr(e,"items",t.items),t.acceptFrom?fr(e,"acceptFrom",t.acceptFrom):t.connectWith&&fr(e,"connectWith",t.connectWith),Yr(e),wr(r,"role","option"),wr(r,"aria-grabbed","false"),$r(e,!0),_r(e,"dragstart",(function(e){var n=Dr(e);if(!0!==n.isSortable&&(e.stopImmediatePropagation(),(!t.handle||n.matches(t.handle))&&"false"!==n.getAttribute("draggable"))){var i=Gr(n,e),r=Zr(i,n);Vr=gr(i.children,t.items),zr=Vr.indexOf(r),Fr=Sr(r,i.children),Ur=i,function(e,t,n){if(!(e instanceof Event))throw new Error("setDragImage requires a DragEvent as the first argument.");if(!(t instanceof HTMLElement))throw new Error("setDragImage requires the dragged element as the second argument.");if(n||(n=Nr),e.dataTransfer&&e.dataTransfer.setDragImage){var i=n(t,Cr(t),e);if(!(i.element instanceof HTMLElement)||"number"!=typeof i.posX||"number"!=typeof i.posY)throw new Error("The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].");e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",Dr(e).id),e.dataTransfer.setDragImage(i.element,i.posX,i.posY)}}(e,r,t.customDragImage),Mr=Lr(r),Or=Ir(r),r.classList.add(t.draggingClass),Rr=function(e,t){var n=e;return!0===yr(t).getConfig("copy")&&(wr(n=e.cloneNode(!0),"aria-copied","true"),e.parentElement.appendChild(n),n.style.display="none",n.oldDisplay=e.style.display),n}(r,i),wr(Rr,"aria-grabbed","true"),i.dispatchEvent(new CustomEvent("sortstart",{detail:{origin:{elementIndex:Fr,index:zr,container:Ur},item:Rr,originalTarget:n}}))}})),_r(e,"dragenter",(function(t){var n=Dr(t),i=Gr(n,t);i&&i!==qr&&(jr=gr(i.children,fr(i,"items")).filter((function(t){return t!==yr(e).placeholder})),i.dispatchEvent(new CustomEvent("sortenter",{detail:{origin:{elementIndex:Fr,index:zr,container:Ur},destination:{container:i,itemsBeforeUpdate:jr},item:Rr,originalTarget:n}}))),qr=i})),_r(e,"dragend",(function(n){if(Rr){Rr.classList.remove(t.draggingClass),wr(Rr,"aria-grabbed","false"),"true"===Rr.getAttribute("aria-copied")&&"true"!==fr(Rr,"dropped")&&Rr.remove(),Rr.style.display=Rr.oldDisplay,delete Rr.oldDisplay;var i=Array.from(mr.values()).map((function(e){return e.placeholder})).filter((function(e){return e instanceof HTMLElement})).filter(kr)[0];i&&i.remove(),e.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:Fr,index:zr,container:Ur},item:Rr}})),qr=null,Rr=null,Mr=null,Or=null}})),_r(e,"drop",(function(n){if(Pr(e,Rr.parentElement)){n.preventDefault(),n.stopPropagation(),fr(Rr,"dropped","true");var i=Array.from(mr.values()).map((function(e){return e.placeholder})).filter((function(e){return e instanceof HTMLElement})).filter(kr)[0];xr(i,Rr),i.remove(),e.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:Fr,index:zr,container:Ur},item:Rr}}));var r=yr(e).placeholder,o=gr(Ur.children,t.items).filter((function(e){return e!==r})),a=!0===this.isSortable?this:this.parentElement,s=gr(a.children,fr(a,"items")).filter((function(e){return e!==r})),l=Sr(Rr,Array.from(Rr.parentElement.children).filter((function(e){return e!==r}))),u=Sr(Rr,s);Fr===l&&Ur===a||e.dispatchEvent(new CustomEvent("sortupdate",{detail:{origin:{elementIndex:Fr,index:zr,container:Ur,itemsBeforeUpdate:Vr,items:o},destination:{index:u,elementIndex:l,container:a,itemsBeforeUpdate:jr,items:s},item:Rr}}))}}));var a,s,l,u=(a=function(e,n,i,r){if(Rr)if(t.forcePlaceholderSize&&(yr(e).placeholder.style.height=Mr+"px",yr(e).placeholder.style.width=Or+"px"),Array.from(e.children).indexOf(n)>-1){var o=Lr(n),a=Ir(n),s=Sr(yr(e).placeholder,n.parentElement.children),l=Sr(n,n.parentElement.children);if(o>Mr||a>Or){var u=o-Mr,c=a-Or,h=Cr(n).top,d=Cr(n).left;if(s<l&&("vertical"===t.orientation&&r<h||"horizontal"===t.orientation&&i<d))return;if(s>l&&("vertical"===t.orientation&&r>h+o-u||"horizontal"===t.orientation&&i>d+a-c))return}void 0===Rr.oldDisplay&&(Rr.oldDisplay=Rr.style.display),"none"!==Rr.style.display&&(Rr.style.display="none");var p=!1;try{var f=Cr(n).top+n.offsetHeight/2,g=Cr(n).left+n.offsetWidth/2;p="vertical"===t.orientation&&r>=f||"horizontal"===t.orientation&&i>=g}catch(e){p=s<l}p?xr(n,yr(e).placeholder):function(e,t){Tr(e,t,"before")}(n,yr(e).placeholder),Array.from(mr.values()).filter((function(e){return void 0!==e.placeholder})).forEach((function(t){t.placeholder!==yr(e).placeholder&&t.placeholder.remove()}))}else{var m=Array.from(mr.values()).filter((function(e){return void 0!==e.placeholder})).map((function(e){return e.placeholder}));-1!==m.indexOf(n)||e!==n||gr(n.children,t.items).length||(m.forEach((function(e){return e.remove()})),n.appendChild(yr(e).placeholder))}},void 0===(s=t.debounce)&&(s=0),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];clearTimeout(l),l=setTimeout((function(){a.apply(void 0,e)}),s)}),c=function(e){var t=e.target,n=!0===t.isSortable?t:Gr(t,e);if(t=Zr(n,t),Rr&&Pr(n,Rr.parentElement)&&"true"!==fr(n,"_disabled")){var i=fr(n,"opts");parseInt(i.maxItems)&&gr(n.children,fr(n,"items")).length>=parseInt(i.maxItems)&&Rr.parentElement!==n||(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect=!0===yr(n).getConfig("copy")?"copy":"move",u(n,t,e.pageX,e.pageY))}};_r(r.concat(e),"dragover",c),_r(r.concat(e),"dragenter",c)})),e)}Xr.destroy=function(e){!function(e){var t=fr(e,"opts")||{},n=gr(e.children,t.items),i=Ar(n,t.handle);br(e,"dragover"),br(e,"dragenter"),br(e,"dragstart"),br(e,"dragend"),br(e,"drop"),Wr(e),br(i,"mousedown"),Hr(n),Kr(n),e.isSortable=!1}(e)},Xr.enable=function(e){Yr(e)},Xr.disable=function(e){!function(e){var t=fr(e,"opts"),n=gr(e.children,t.items),i=Ar(n,t.handle);wr(e,"aria-dropeffect","none"),fr(e,"_disabled","true"),wr(i,"draggable","false"),br(i,"mousedown")}(e)},Xr.__testing={_data:fr,_removeItemEvents:Hr,_removeItemData:Kr,_removeSortableData:Wr};var Qr=Xr;const Jr="path[id], g[id], circle[id]";let eo;class ImageCustomizer extends Widget{static get selector(){return".or-appearance-image-customization[data-image-customization]"}static get helpersRequired(){return["input","pathToAbsolute"]}}ImageCustomizer.prototype._init=function(){const e=this,t=this.element.querySelector("img");this.$styleInput=this._getStyleInput(),this.$styleInput.on("valuechange.enketo inputupdate.enketo",this._updateImage.bind(this)),this.element.classList.contains("or-image-map-initialized")?new MutationObserver(t=>{t.forEach(t=>{t.addedNodes[0].classList.contains("image-map")&&e._updateImage()})}).observe(e.element.querySelector(".option-wrapper").parentElement,{childList:!0}):this.$styleInput&&this.$styleInput.length&&t&&(t.getAttribute("src")?this._addMarkup(t).then(this._updateImage.bind(this)):T(t).on("load",()=>{e._addMarkup(t).then(e._updateImage.bind(e))}))},ImageCustomizer.prototype._getStyleInput=function(){const e=this.element.querySelector("input"),t=this.options.helpers.input.getName(e);if(this.element.dataset.imageCustomization){const e=this.element.dataset.imageCustomization.trim(),n=this.options.helpers.pathToAbsolute(e,t);return T(this.element).closest("form.or").find(`[name="${n}"], [data-name="${n}"]`).eq(0)}return T()},ImageCustomizer.prototype._addMarkup=function(e){const t=this,n=e.getAttribute("src");return T.get(n).then(e=>{let n,i,r,o;if(t._isSvgDoc(e))return n=T(e.querySelector("svg")),i=T('<div class="widget image-map"/>').append(n),T(t.element).find("img").remove(),T(t.element).append(i),r=n.attr("width")||n[0].getBBox().width,o=n.attr("height")||n[0].getBBox().height,n.attr("viewBox",[0,0,r,o].join(" ")),i})},ImageCustomizer.prototype._getInput=function(e){return this.element.querySelector(`input[value="${e}"]`)},ImageCustomizer.prototype._isSvgDoc=e=>"object"==typeof e&&e.querySelector("svg"),ImageCustomizer.prototype._complementSelectedRule=function(e){eo||(T("head").append("<style/>"),eo=document.styleSheets[document.styleSheets.length-1]),eo.cssRules[0]&&eo.deleteRule(0),eo.insertRule(`.or-appearance-image-customization .image-map svg path[id][or-selected]{${this._getStyleValue(e)}}`,0)},ImageCustomizer.prototype._updateImage=function(){let e,t,n;const i=this.$styleInput.val(),r=JSON.parse(i),o=T(this.element).find("svg");if(this._complementSelectedRule(r.selected),o.find("path[id][style]").removeAttr("style"),r&&o.length)for(t in r)e=o.find("path#"+t),n=this._getStyleValue(r[t]),e.attr("style",n)},ImageCustomizer.prototype._getStyleValue=e=>{let t,n="";for(t in e)n+=`${t}:${e[t]} !important;`;return n};const to="flash",no="stop",io="start";const ro=[class NoteWidget{},class DesktopSelectpicker extends Widget{static get selector(){return".question select"}static get list(){return!0}static condition(){return!o.touch}_init(){const e=this.element;e.style.display="none";const t=this._getTemplate();e.after(t),this.picker=this.question.querySelector(".bootstrap-select"),this.props.readonly&&this.disable(),this._clickListener(),this._focusListener()}_getTemplate(){const e=Si.createContextualFragment(`\n        <div class="btn-group bootstrap-select widget clearfix">\n            <button type="button" class="btn btn-default dropdown-toggle clearfix" data-toggle="dropdown">\n                <span class="selected"></span><span class="caret"></span>\n            </button>\n            <ul class="dropdown-menu" role="menu">${this._getLisHtml()}</ul>\n        </div>`);return this._showSelected(e.querySelector(".selected")),e}_getLisHtml(){const e=this.props.multiple?'type="checkbox"':`type="radio" name="${1e5*Math.random()}"`;return[...this.element.querySelectorAll("option")].map(t=>{const n=t.textContent,i=t.matches(":checked"),r=t.value;if(r){return`\n                        <li ${i?'class="active"':""}>\n                            <a class="option-wrapper" tabindex="-1" href="#">\n                                <label>\n                                    <input class="ignore" ${e}${i?' checked="checked"':""} value="${r}" />\n                                    <span class="option-label">${n}</span>\n                                </label>\n                            </a>\n                        </li>`}return""}).join("")}_showSelected(e){const t=[...this.element.querySelectorAll("option:checked")].filter(e=>e.getAttribute("value").length).map(e=>e.textContent);if(0===t.length)e.textContent=dt("selectpicker.noneselected"),e.dataset.i18n="selectpicker.noneselected",delete e.dataset.i18nNumber;else if(1===t.length)e.textContent=t[0],delete e.dataset.i18n,delete e.dataset.i18nNumber;else{const n=t.length;e.textContent=dt("selectpicker.numberselected",{number:n}),e.dataset.i18n="selectpicker.numberselected",e.dataset.i18nNumber=n}}_clickListener(){const e=this;T(this.picker).on("click","li:not(.disabled)",(function(t){const n=this,i=n.querySelector("input"),r=e.element,o=r.querySelector(`option[value="${i.value}"]`),a=o.matches(":checked");"input"!==t.target.nodeName.toLowerCase()&&t.preventDefault(),e.props.multiple?t.stopPropagation():(e.picker.querySelectorAll("li").forEach(e=>e.classList.remove("active")),In(o,"option").forEach(e=>{e.selected=!1}),e.picker.querySelectorAll("input").forEach(e=>e.checked=!1)),setTimeout(()=>{a?(n.classList.remove("active"),i.checked=!1,o.selected=!1):(n.classList.add("active"),o.selected=!0,i.checked=!0);const t=e.picker.querySelector(".selected");e._showSelected(t),r.dispatchEvent(new yt.Change)},10)})).on("keydown","li:not(.disabled)",e=>{const t=e.keyCode.toString(10);if(/(13|32)/.test(t)){/(32)/.test(t)||e.preventDefault();const n=T(":focus");n.click(),n.focus(),e.preventDefault()}}).on("click","li.disabled",e=>(e.stopPropagation(),!1)).on("click","a",e=>{e.preventDefault()})}_focusListener(){const e=this;this.element.addEventListener(yt.ApplyFocus().type,()=>{e.picker.querySelector(".dropdown-toggle").focus()})}disable(){this.picker.querySelectorAll("li").forEach(e=>{e.classList.add("disabled");const t=e.querySelector("input");t.disabled=!0,t.readOnly=!0})}enable(){this.picker.querySelectorAll("li").forEach(e=>{e.classList.remove("disabled");const t=e.querySelector("input");t.disabled=!1,t.readOnly=!1})}update(){this.picker.remove(),this._init()}},class MobileSelectPicker extends Widget{static get selector(){return".question select[multiple]"}static condition(){return o.touch}_init(){const e=document.createRange().createContextualFragment('<span class="widget mobileselect"></span>');this.element.after(e),this.widget=this.element.parentElement.querySelector(".widget"),this.element.addEventListener("change",()=>{this._showSelectedValues()}),this._showSelectedValues()}_showSelectedValues(){this.widget.textContent=this.originalInputValue.join(", ")}update(){this._showSelectedValues()}},class AutocompleteSelectpicker extends Widget{static get selector(){return".question input[list]"}static get list(){return!0}_init(){const e=this.element.getAttribute("list");if(0===An(this.element,"datalist").length){const t=An(this.element.closest(".or-repeat"),".or-repeat-info");this.options=t.length?[...t[0].querySelectorAll(`datalist#${e} > option`)]:[]}else this.options=[...this.question.querySelectorAll(`datalist#${e} > option`)];this.options.forEach(e=>{const t=e.getAttribute("value");!e.classList.contains("itemset-template")&&e.textContent&&null!=t&&(e.dataset.value=t,e.setAttribute("value",e.textContent),e.textContent="")});const t=document.createRange().createContextualFragment(`<input type="text" class="ignore widget autocomplete" list="${e}" />`);this.element.classList.add("hide"),this.element.after(t),this.fakeInput=this.element.parentElement.querySelector("input.autocomplete"),this.props.readonly&&this.fakeInput.setAttribute("readonly","readonly"),this.props.disabled&&this.fakeInput.setAttribute("disabled","disabled"),xi&&T(this.fakeInput).relevantDropdown(),this._setFakeInputListener(),this._setFocusListener(),this._showCurrentLabel()}_showCurrentLabel(){const e=this.originalInputValue,t=this._findLabel(e);this.fakeInput.value=t,e&&!t&&this.fakeInput.dispatchEvent(yt.Input())}_setFakeInputListener(){this.fakeInput.addEventListener("input",e=>{const t=e.target,n=t.value,i=this._findValue(n)||"";this.originalInputValue!==i&&(this.originalInputValue=i),t.classList.toggle("notfound",n&&!i)})}_findValue(e){let t="";return e?(this.options.forEach(n=>{if(n.value===e)return t=n.getAttribute("data-value"),!1}),t):""}_findLabel(e){let t="";return e?(this.options.forEach(n=>{if(n.dataset.value===e)return t=n.value,!1}),t):""}_setFocusListener(){this.element.addEventListener(yt.ApplyFocus().type,()=>{this.fakeInput.focus()})}disable(){this.fakeInput.classList.add("disabled")}enable(){this.fakeInput.classList.remove("disabled")}update(){this.element.parentElement.querySelector(".widget").remove(),this._init()}},class Geopicker extends Widget{static get selector(){return'.question input[data-type-xml="geopoint"], .question input[data-type-xml="geotrace"], .question input[data-type-xml="geoshape"]'}static condition(e){return!On.has(e,"ArcGisGeopicker")}_init(){const e=this.originalInputValue,t=this;this.$form=T(this.element).closest("form.or"),this.$question=T(this.element).closest(".question"),this.mapId=Math.round(1e7*Math.random()),this._addDomElements(),this.currentIndex=0,this.points=[],e&&(this.value=e),this.$widget.find('[name="lat"], [name="long"], [name="alt"], [name="acc"]').on("change change.bymap change.bysearch",e=>{const n=t.$lat.val()?Number(t.$lat.val()):"",i=t.$lng.val()?Number(t.$lng.val()):"",r=t.$alt.val()?Number(t.$alt.val()):"",o=t.$acc.val()?Number(t.$acc.val()):"",a={lat:n,lng:i};e.stopImmediatePropagation(),"bymap"!==e.namespace&&"bysearch"!==e.namespace&&t.polyline&&"geoshape"===t.props.type&&!t.containsEmptyPoints(t.points,t.currentIndex)&&t.updatedPolylineWouldIntersect(a,t.currentIndex)?(t._showIntersectError(),t._updateInputs(t.points[t.currentIndex],"nochange")):(t._editPoint([n,i,r,o]),"bysearch"!==e.namespace&&t.$search&&t.$search.val(""))}),this.$kmlInput.on("change",(function(e){const n=t.$points.find(".addpoint"),i=T(this).prev(".paste-progress").removeClass("hide"),r=e.target.value,o=t._convertKmlCoordinatesToLeafletCoordinates(r);e.target.value="",setTimeout(()=>{o.forEach((e,i)=>{t._updateInputs(e),i<o.length-1&&n.click()}),i.remove(),t._switchInputType("points")},10)})),this.$widget.find(".toggle-input-type-btn").on("click",()=>{const e=t.$inputGroup.hasClass("kml-input-mode")?"points":"kml";return t._switchInputType(e),!1}),T(this.element).on("change",(function(){t.$kmlInput.prop("disabled",!!this.value)})).on("applyfocus",()=>{t.$widget[0].querySelector("input").focus()}),this.$points.on("click",".point",(function(){return t._setCurrent(t.$points.find(".point").index(T(this))),t._switchInputType("points"),!1})),this.$points.find(".addpoint").on("click",()=>(t._addPoint(),!1)),this.$widget.find(".close-chain-btn").on("click",()=>(t._closePolygon(),!1)),this.$widget.find(".btn-remove").on("click",()=>{t.points.length<2?t._updateInputs([]):Kt.confirm(dt("geopicker.removePoint")).then(e=>{e&&t._removePoint()}).catch(()=>{})}),this.$map.find(".show-map-btn").on("click",()=>(t.$widget.find(".search-bar").removeClass("hide-search"),t.$widget.addClass("full-screen"),t._updateMap(),!1)),this.$form.on("pageflip.map"+this.mapId,e=>{t.map&&T.contains(e.target,t.element)&&(t.map.invalidateSize(),t.$form.off("pageflip.map"+t.mapId))}),this.props.wide&&this.$widget.addClass("wide"),this.$widget.toggleClass("hide-input",this.$question.hasClass("or-appearance-hide-input")).find(".toggle-input-visibility-btn").on("click",(function(){t.$widget.toggleClass("hide-input"),T(this).toggleClass("open",t.$widget.hasClass("hide-input")),t.map&&t.map.invalidateSize(!1)})).toggleClass("open",t.$widget.hasClass("hide-input")),this.$widget.find(".hide-map-btn").on("click",()=>(t.$widget.find(".search-bar").addClass("hide-search"),t.$widget.removeClass("full-screen").find(".map-canvas").removeClass("leaflet-container").find(".leaflet-google-layer").remove(),t.map&&(t.map.remove(),t.map=null,t.polygon=null,t.polyline=null),!1)),this.props.search&&this._enableSearch(),this.props.detect&&this._enableDetection(),this.props.readonly&&this.disable(),e?this.points.forEach(()=>{t._addPointBtn()}):this._addPoint(),e?(this._updateMap(),this._setCurrent(this.currentIndex)):(this._updateMap([0,0],1),this.props.detect&&navigator.geolocation.getCurrentPosition(e=>{t._updateMap([e.coords.latitude,e.coords.longitude],15)}))}_switchInputType(e){"kml"===e?this.$inputGroup.addClass("kml-input-mode"):"points"===e&&this.$inputGroup.removeClass("kml-input-mode")}_addPointBtn(){this.$points.find(".addpoint").before('<a href="#" class="point" aria-label="point"> </a>')}_addDomElements(){const e=`<div class="map-canvas-wrapper"><div class=map-canvas id="map${this.mapId}"></div></div>`,t=`\n            <a href="#" class="toggle-input-type-btn">\n                <span class="kml-input">KML</span>\n                <span class="points-input" data-i18n="geopicker.points">${dt("geopicker.points")}</span>\n            </a>\n            <label class="geo kml">\n                <span data-i18n="geopicker.kmlcoords">${dt("geopicker.kmlcoords")}</span>\n                <progress class="paste-progress hide"></progress>\n                <textarea class="ignore" name="kml" placeholder="${dt("geopicker.kmlpaste")}" data-i18n="geopicker.kmlpaste"></textarea>\n                <span class="disabled-msg">remove all points to enable</span>\n            </label>`,n=`<button type="button" class="close-chain-btn btn btn-default btn-xs" data-i18n="geopicker.closepolygon">${dt("geopicker.closepolygon")}</button>`;if(this.$widget=T(`<div class="geopicker widget">\n                <div class="search-bar hide-search no-map no-detect">\n                    <button type="button" class="hide-map-btn btn btn-default"><span class="icon icon-arrow-left"> </span></button>\n                    <button name="geodetect" type="button" class="btn btn-default" title="detect current location" data-placement="top"><span class="icon icon-crosshairs"> </span></button>\n                    <div class="input-group">\n                        <input class="geo ignore" name="search" type="text" placeholder="${dt("geopicker.searchPlaceholder")}" data-i18n="geopicker.searchPlaceholder" disabled="disabled"/>\n                        <button type="button" class="btn btn-default search-btn"><i class="icon icon-search"> </i></button>\n                    </div>\n                </div>\n                <div class="geo-inputs">\n                    <label class="geo lat">\n                        <span data-i18n="geopicker.latitude">${dt("geopicker.latitude")}</span>\n                        <input class="ignore" name="lat" type="number" step="0.000001" min="-90" max="90"/>\n                    </label>\n                    <label class="geo long">\n                        <span data-i18n="geopicker.longitude">${dt("geopicker.longitude")}</span>\n                        <input class="ignore" name="long" type="number" step="0.000001" min="-180" max="180"/>\n                    </label>\n                    <label class="geo alt">\n                        <span data-i18n="geopicker.altitude">${dt("geopicker.altitude")}</span>\n                        <input class="ignore" name="alt" type="number" step="0.1" />\n                    </label>\n                    <label class="geo acc">\n                        <span data-i18n="geopicker.accuracy">${dt("geopicker.accuracy")}</span>\n                        <input class="ignore" name="acc" type="number" step="0.1" />\n                    </label>\n                    <button type="button" class="btn-icon-only btn-remove" aria-label="remove"><span class="icon icon-trash"> </span></button>\n                </div>\n            </div>`),this.props.detect&&(this.$widget.find(".search-bar").removeClass("no-detect"),this.$detect=this.$widget.find('button[name="geodetect"]')),this.$search=this.$widget.find('[name="search"]'),this.$inputGroup=this.$widget.find(".geo-inputs"),this.props.map?(this.$widget.find(".search-bar").removeClass("no-map").after(e),this.$map=this.$widget.find(".map-canvas"),this.$map.parent().append('<button type="button" class="toggle-input-visibility-btn" aria-label="toggle input"> </button>')):this.$map=T(),this.props.touch&&this.props.map&&this.$map.append('<button type="button" class="show-map-btn btn btn-default">Map</button>'),this.props.touch||this.$widget.find(".search-bar").removeClass("hide-search"),"geopoint"!==this.props.type){this.$points=T('<div class="points"><button type="button" class="addpoint">+</button></div>'),this.$widget.prepend(this.$points),"geoshape"===this.props.type&&this.$inputGroup.append(n);const e=T(t);this.$kmlInput=e.find('[name="kml"]'),this.$inputGroup.prepend(e)}else this.$points=T(),this.$kmlInput=T();this.$lat=this.$widget.find('[name="lat"]'),this.$lng=this.$widget.find('[name="long"]'),this.$alt=this.$widget.find('[name="alt"]'),this.$acc=this.$widget.find('[name="acc"]'),T(this.element).hide().after(this.$widget).parent().addClass("clearfix")}_updateValue(){this._markAsValid();const e=this.originalInputValue,t=this.value;return e!==t&&(this.originalInputValue=t,!0)}_isValidGeopoint(e){return!!e&&$n.geopoint.validate(e)}_isValidLatLngList(e){const t=this;return e.every((e,n,i)=>t._isValidLatLng(e)||""===e.join()&&n===i.length-1)}_cleanLatLng(e){return Array.isArray(e)?[e[0],e[1]]:e}_isValidLatLng(e){const t="number"==typeof e[0]?e[0]:"number"==typeof e.lat?e.lat:null,n="number"==typeof e[1]?e[1]:"number"==typeof e.lng?e.lng:null;return $n.geopoint.validate([t,n].join(" "))}_markAsInvalid(e){this.$points.find(".point").eq(e).addClass("has-error")}_markAsValid(){this.$points.find(".point").removeClass("has-error")}_setCurrent(e){this.currentIndex=e,this.$points.find(".point").removeClass("active").eq(e).addClass("active"),this._updateInputs(this.points[e],""),!this.map||this.props.touch&&!this._inFullScreenMode()||this._updateMarkers()}_enableDetection(){const e=this,t={enableHighAccuracy:!0,maximumAge:0};this.$detect.click(n=>(n.preventDefault(),navigator.geolocation.getCurrentPosition(t=>{const n={lat:Math.round(1e6*t.coords.latitude)/1e6,lng:Math.round(1e6*t.coords.longitude)/1e6};e.polyline&&"geoshape"===e.props.type&&e.updatedPolylineWouldIntersect(n,e.currentIndex)?e._showIntersectError():(e._updateInputs([n.lat,n.lng,t.coords.altitude,t.coords.accuracy]),e.currentIndex===e.points.length-1&&"geopoint"!==e.props.type&&e._addPoint())},()=>{console.error("error occurred trying to obtain position")},t),!1))}_enableSearch(){const e=this;Di=Ni?Di.replace("{api_key}",Ni):Di.replace("&key={api_key}",""),this.$search.prop("disabled",!1).on("change",(function(t){let n=T(this).val();t.stopImmediatePropagation(),n&&(n=n.split(/\s+/).join("+"),T.get(Di.replace("{address}",n),t=>{let i;t.results&&t.results.length>0&&t.results[0].geometry&&t.results[0].geometry.location?(i=t.results[0].geometry.location,e._updateMap([i.lat,i.lng],15),e.$search.closest(".input-group").removeClass("has-error")):(e.$search.closest(".input-group").addClass("has-error"),console.warn(`Location "${n}" not found`))},"json").fail(()=>{e.$search.closest(".input-group").addClass("has-error"),console.error("Error. Geocoding service may not be available or app is offline")}).always(()=>{}))}))}_dynamicMapAvailable(){return!!this.map}_inFullScreenMode(){return this.$widget.hasClass("full-screen")}_updateMap(e,t){const n=this;this.props.map&&(t||(t=this.map&&this.map.getZoom()||15),e&&(this.lastLatLng=e,this.lastZoom=t),this.props.touch&&!this._inFullScreenMode()||(this.loadMap=this.loadMap||this._addDynamicMap(),this.loadMap.then(()=>{n._updateDynamicMapView(e,t)})))}_addDynamicMap(){const e=this;return this._getLayers().then(t=>{const n={layers:e._getDefaultLayer(t)};e.map=Li.map("map"+e.mapId,n).on("click",t=>{let n,i;if(e.props.readonly)return!1;n=t.latlng,i=e.$lat.val()&&e.$lng.val()?e.points.length:e.currentIndex,n.lat=Math.round(1e6*n.lat)/1e6,n.lng=Math.round(1e6*n.lng)/1e6,"geoshape"===e.props.type&&!e.containsEmptyPoints(e.points,i)&&e.updatedPolylineWouldIntersect(n,i)?e._showIntersectError():e.$lat.val()&&e.$lng.val()&&"geopoint"!==e.props.type?e.$lat.val()&&e.$lng.val()&&(e._addPoint(),e._updateInputs(n,"change.bymap")):e._updateInputs(n,"change.bymap")}),e.map.attributionControl.setPrefix(""),t.length>1&&Li.control.layers(e._getBaseLayers(t),null).addTo(e.map),e.$widget.find(".leaflet-control-layers-toggle").append('<span class="icon icon-globe"></span>'),e.map.on("baselayerchange",()=>{e.$widget.find(".leaflet-control-container input").addClass("ignore no-unselect").next("span").addClass("option-label")})})}_updateDynamicMapView(e,t){e?this.map.setView(e,t||15):(this._updatePolyline(),this._updateMarkers(),1===this.points.length&&""===this.points[0].toString()&&(this.lastLatLng?this.map.setView(this.lastLatLng,this.lastZoom||15):this.map.setView(Li.latLng(0,0),t||15)))}_showIntersectError(){Kt.alert(dt("geopicker.bordersintersectwarning"))}_getLayers(){const e=this,t=[];return Ai.forEach((n,i)=>{"string"==typeof n.tiles&&/^GOOGLE_(SATELLITE|ROADMAP|HYBRID|TERRAIN)/.test(n.tiles)?t.push(e._getGoogleTileLayer(n,i)):n.tiles?t.push(e._getLeafletTileLayer(n,i)):console.error("Configuration error for map tiles. Not a valid tile layer: ",n)}),Promise.all(t)}_getLeafletTileLayer(e,t){let n;const i=this._getTileOptions(e,t);return e.tileIndex=void 0===e.tileIndex?Math.round(100*Math.random())%e.tiles.length:e.tileIndex,n=e.tiles[e.tileIndex],Promise.resolve(Li.tileLayer(n,i))}_getGoogleTileLayer(e,t){const n=this._getTileOptions(e,t);return n.type=e.tiles.substring(7).toLowerCase(),this._loadGoogleMapsScript().then(()=>Li.gridLayer.googleMutant(n))}_getTileOptions(e,t){const n=e.name||"map-"+(t+1);return{id:e.id||n,maxZoom:e.maxzoom||18,minZoom:e.minzoom||0,name:n,attribution:e.attribution||""}}_loadGoogleMapsScript(){return Ii||(Ii=new Promise(e=>{let t,n;window.gmapsLoaded=()=>{delete window.gmapsLoaded,e()},t=Ni?"&key="+Ni:"",n=`https://maps.google.com/maps/api/js?v=3.exp${t}&libraries=places&callback=gmapsLoaded`,T.getScript(n)})),Ii}_getDefaultLayer(e){let t;const n=this;return e.reverse().some(e=>(t=e,n.props.appearances.some(t=>t===e.options.name))),t}_getBaseLayers(e){const t={};return e.forEach(e=>{t[e.options.name]=e}),t}_updateMarkers(){const e=[],t=[],n=this;this.markerLayer&&this.markerLayer.clearLayers(),this.points.length<2&&""===this.points[0].join()||(this.points.forEach((i,r)=>{const o="geopoint"===n.props.type?Pi:r===n.currentIndex?Ri:Bi;n._isValidLatLng(i)?(e.push(n._cleanLatLng(i)),t.push(Li.marker(n._cleanLatLng(i),{icon:o,clickable:!n.props.readonly,draggable:!n.props.readonly,alt:r,opacity:.9}).on("click",e=>{0===e.target.options.alt&&"geoshape"===n.props.type?n._closePolygon():n._setCurrent(e.target.options.alt)}).on("dragend",e=>{const t=e.target.getLatLng(),i=e.target.options.alt;t.lat=Math.round(1e6*t.lat)/1e6,t.lng=Math.round(1e6*t.lng)/1e6,n.polyline&&"geoshape"===n.props.type&&n.updatedPolylineWouldIntersect(t,i)?(n._showIntersectError(),n._updateMarkers()):(n._setCurrent(i),n._updateInputs(t,"change.bymap"),n._updateMap())}))):console.warn("this latLng was not considered valid",i)}),t.length>0&&(this.markerLayer=Li.layerGroup(t).addTo(this.map),1!==this.points.length&&this._isValidLatLngList(this.points)||this.map.setView(e[0],this.lastZoom||15)))}_updatePolyline(){let e;const t=this;if("geopoint"!==this.props.type){if(this.points.length<2||!this._isValidLatLngList(this.points))return this.map&&(this.polyline&&this.map.removeLayer(this.polyline),this.polygon&&this.map.removeLayer(this.polygon)),this.polyline=null,void(this.polygon=null);"geoshape"===this.props.type&&this._updatePolygon(),e=""!==this.points[this.points.length-1].join("")?this.points:this.points.slice(0,this.points.length-1),e=e.map(e=>t._cleanLatLng(e)),this.polyline?this.polyline.setLatLngs(e):(this.polyline=Li.polyline(e,{color:"red"}),this.map.addLayer(this.polyline)),setTimeout(()=>{t.map.fitBounds(t.polyline.getBounds())},0)}}_updatePolygon(){let e;const t=this;"geopoint"!==this.props.type&&"geotrace"!==this.props.type&&(e=""!==this.points[this.points.length-1].join("")?this.points:this.points.slice(0,this.points.length-1),e=e.map(e=>t._cleanLatLng(e)),this.polygon?this.polygon.setLatLngs(e):(this.polygon=Li.polygon(e,{color:"red",stroke:!1}),this.map.addLayer(this.polygon)),this._updateArea(e))}_updateArea(e){let t,n;if(e.length>2){const i=e.map(e=>({lat:e[0],lng:e[1]}));t=Li.GeometryUtil.geodesicArea(i),n=Li.GeometryUtil.readableArea(t,!0),Li.popup({className:"enketo-area-popup"}).setLatLng(this.polygon.getBounds().getCenter()).setContent(n).openOn(this.map)}else this.map.closePopup()}_addPoint(){this._addPointBtn(),this.points.push([]),this._setCurrent(this.points.length-1),this._updateValue()}_editPoint(e){let t;return this.points[this.currentIndex]=e,t=this._updateValue(),t&&this._updateMap(),t}_removePoint(){let e=this.currentIndex;this.points.splice(this.currentIndex,1),this._updateValue(),this.$points.find(".point").eq(this.currentIndex).remove(),void 0===this.points[this.currentIndex]&&(e=this.currentIndex-1),this._setCurrent(e),this._updateMap()}_closePolygon(){const e=this.points[this.points.length-1];if(!(this.points.length<3||3===this.points.length&&!this._isValidLatLng(this.points[2])||JSON.stringify(this.points[0])===JSON.stringify(e))){if(this._isValidLatLng(e)?this._addPoint():this.currentIndex=this.points.length-1,this.polyline&&!this.containsEmptyPoints(this.points,this.points.length)&&this.updatedPolylineWouldIntersect(this.points[0],this.currentIndex))return this._showIntersectError();this._updateInputs(this.points[0])}}_updateInputs(e,t){const n=e[0]||e.lat||"",i=e[1]||e.lng||"",r=e[2]||e.alt||"",o=e[3]||e.acc||"";t=void 0!==t?t:"change",this.$lat.val(n||""),this.$lng.val(i||""),this.$alt.val(r||""),this.$acc.val(o||"").trigger(t)}_convertKmlCoordinatesToLeafletCoordinates(e){const t=[],n=/<\s?coordinates>(([^<]|\n)*)<\/\s?coordinates\s?>/;return(e=n.test(e)?e.match(n)[1]:e).trim().split(/\s+/).forEach(e=>{const n=[];e.split(",").forEach((e,t)=>{const i=Number(e);0===t?n[1]=i:1===t?n[0]=i:2===t&&(n[2]=i)}),t.push(n)}),t}updatedPolylineWouldIntersect(e,t){const n=[];let i,r,o;const a=this;return!(this.points<3)&&(T.extend(!0,n,this.points),n[t]=[e[0]||e.lat,e[1]||e.lng],i=""!==n[n.length-1].join("")?n:n.slice(0,n.length-1),i[0][0]===i[i.length-1][0]&&i[0][1]===i[i.length-1][1]&&(i=i.slice(0,i.length-1)),i=i.map(e=>a._cleanLatLng(e)),r=Li.polyline(i,{color:"white"}),this.map.addLayer(r),o=r.intersects(),this.map.removeLayer(r),o)}containsEmptyPoints(e,t){return e.some((e,n)=>!(n===t||e[0]&&e[1]))}get props(){const e=this._props;return e.detect=!!navigator.geolocation,e.map=!o.touch||e.appearances.includes("maps")||e.appearances.includes("placement-map"),e.search=e.map,e.touch=o.touch,e.wide=this.question.clientWidth/this.element.closest("form.or").clientWidth>.8,e}get value(){let e="";return this.points.forEach((t,n,i)=>{let r;const o="number"==typeof t[0]?t[0]:"number"==typeof t.lat?t.lat:null,a="number"==typeof t[1]?t[1]:"number"==typeof t.lng?t.lng:null,s="number"==typeof t[2]?t[2]:0,l="number"==typeof t[3]?t[3]:0;r=o&&a?`${o} ${a} ${s} ${l}`:"",this._isValidGeopoint(r)||""===r&&n===i.length-1||this._markAsInvalid(n),""!==r||n!==i.length-1?(e+=r,n!==i.length-1&&(e+=";")):e=e.substring(0,e.lastIndexOf(";"))}),e}set value(e){e.trim().split(";").forEach((e,t)=>{this.points[t]=e.trim().split(" "),this.points[t].forEach((e,t,n)=>{n[t]=Number(e)})})}enable(){T(this.element).next(".widget").removeClass("readonly").find("input, select, textarea").prop("disabled",!1).end().find(".btn:not(.show-map-btn):not(.hide-map-btn), .btn-icon-only, .addpoint").prop("disabled",!1),this.map&&this.map.invalidateSize()}disable(){T(this.element).next(".widget").addClass("readonly").find("input, select, textarea").prop("disabled",!0).end().find(".btn:not(.show-map-btn):not(.hide-map-btn), .btn-icon-only, .addpoint").prop("disabled",!0)}update(){const e=this.element.parentElement.querySelector(".widget");e&&(e.remove(),this.loadMap=void 0,this.map=void 0,this.polyline=void 0,this.polygon=void 0,this._init())}},class TextareaWidget extends Widget{static get selector(){return"form"}_init(){const e=this.element.querySelectorAll("textarea");this.defaultHeight=e[0]?e[0].clientHeight:20,this.element.addEventListener("input",e=>{const t=e.target;"textarea"===t.nodeName.toLowerCase()&&this._resize(t)}),e.forEach(this._resize.bind(this)),this.element.addEventListener(yt.PageFlip().type,e=>{e.target.querySelectorAll("textarea").forEach(this._resize.bind(this))})}_resize(e){e.scrollHeight>e.clientHeight&&e.scrollHeight>this.defaultHeight&&(e.style.height=e.scrollHeight+"px",e.style.flex="auto")}},class UrlWidget extends Widget{static get selector(){return'.or-appearance-url input[type="text"]'}_init(){const e=document.createRange().createContextualFragment('<a class="widget url-widget" target="_blank" rel="noopener"/>');this.element.classList.add("hide"),this.element.after(e),this.value=this.originalInputValue}update(){this.value=this.originalInputValue}get value(){return this.question.querySelector(".url-widget").href}set value(e){e=e||"";const t=this.question.querySelector(".url-widget");t.href=e,t.title=e,t.textContent=e}},class TableWidget{},class Radiopicker extends Widget{static get selector(){return"form"}_init(){const e=T(this.element),t=this;e.on("click",'input[type="radio"]:not([readonly]):checked',(function(){T(this).parent("label").siblings().removeAttr("data-checked").end().attr("data-checked","true")})).on("click",'input[type="checkbox"]:not([readonly])',(function(){t._updateDataChecked(this)})).on(yt.InputUpdate().type,'input[type="radio"], input[type="checkbox"]',(function(){this.closest(".option-wrapper").querySelectorAll('input[type="radio"],input[type="checkbox"]').forEach(e=>t._updateDataChecked(e))})).on("click",'input[type="checkbox"][readonly],input[type="radio"][readonly]',e=>(e.stopImmediatePropagation(),!1)).on(yt.Change().type,'input[type="checkbox"][readonly],input[type="radio"][readonly]',(function(e){const t=void 0===e.originalEvent;return t||(e.stopImmediatePropagation(),this.checked&&"true"!==this.parentNode.dataset.checked&&(this.checked=!1)),t})).on("click",'[data-checked]>input[type="radio"]:not(.no-unselect)',(function(){T(this).prop("checked",!1).trigger("change").parent().removeAttr("data-checked")})),this.element.querySelectorAll('input[type="radio"]:checked, input[type="checkbox"]:checked').forEach(e=>this._updateDataChecked(e))}_updateDataChecked(e){e.checked?e.parentNode.dataset.checked=!0:delete e.parentNode.dataset.checked}},class DatepickerExtended extends Widget{static get selector(){return'.question input[type="date"]'}static condition(){return!o.touch||!o.inputTypes.date}_init(){this.settings=this.props.appearances.includes("year")?{format:"yyyy",startView:"decade",minViewMode:"years"}:this.props.appearances.includes("month-year")?{format:"yyyy-mm",startView:"year",minViewMode:"months"}:{format:"yyyy-mm-dd",startView:"month",minViewMode:"days"},this.$fakeDateI=this._createFakeDateInput(this.settings.format),this._setChangeHandler(this.$fakeDateI),this._setFocusHandler(this.$fakeDateI),this._setResetHandler(this.$fakeDateI),this.enable(),this.value=this.element.value,this.props.readonly&&this.disable()}_createFakeDateInput(e){const t=T(this.element),n=T(`<div class="widget date"><input class="ignore input-small" type="text" placeholder="${e}" /></div>`).append(this.resetButtonHtml),i=n.find("input");return t.hide().before(n),i}_setChangeHandler(e){const t=this.settings;e.on("change paste",n=>{let i="",r="paste"===n.type?v(n):this.value;return r.length>0&&(g(r)&&"yyyy"!==t.format?i="":(r=this._toActualDate(r),i=$n.date.convert(r))),e.val(this._toDisplayDate(i)).datepicker("update"),""===i&&"paste"===n.type&&n.stopImmediatePropagation(),this.originalInputValue!==i&&(this.originalInputValue=i),!1})}_setResetHandler(e){e.next(".btn-reset").on("click",()=>{this.originalInputValue&&(this.value="")})}_setFocusHandler(e){T(this.element).on("applyfocus",()=>{e[0].focus()})}_toActualDate(e=""){return(e=e.trim())&&"yyyy"===this.settings.format&&e.length<5?e+"-01-01":e&&"yyyy-mm"===this.settings.format&&e.length<8?e+"-01":e}_toDisplayDate(e=""){return(e=e.trim())&&"yyyy"===this.settings.format?e.substring(0,4):"yyyy-mm"===this.settings.format?e.substring(0,7):e}disable(){this.$fakeDateI.datepicker("destroy"),this.$fakeDateI.prop("disabled",!0),this.$fakeDateI.next(".btn-reset").prop("disabled",!0)}enable(){this.$fakeDateI.datepicker({format:this.settings.format,autoclose:!0,todayHighlight:!0,startView:this.settings.startView,minViewMode:this.settings.minViewMode,forceParse:!1}),this.$fakeDateI.prop("disabled",!1),this.$fakeDateI.next(".btn-reset").prop("disabled",!1)}update(){this.value=this.element.value}get displayedValue(){return this.question.querySelector(".widget input").value}get value(){return this._toActualDate(this.displayedValue)}set value(e){this.$fakeDateI[0].disabled?this.$fakeDateI[0].value=this._toDisplayDate(e):this.$fakeDateI.datepicker("setDate",this._toDisplayDate(e))}},class TimepickerExtended extends Widget{static get selector(){return'.question input[type="time"]:not([readonly])'}static condition(){return!o.touch||!o.inputTypes.time}_init(){const e=document.createRange().createContextualFragment('<div class="widget timepicker">\n                <input class="ignore timepicker-default" type="text" placeholder="hh:mm" />\n            </div>');e.querySelector(".widget").append(this.resetButtonHtml),this.element.classList.add("hide"),this.element.before(e);const t=this.question.querySelector(".widget > .btn-reset");this.fakeTimeI=this.question.querySelector(".widget > input"),T(this.fakeTimeI).timepicker({showMeridian:jn.hour12,meridianNotation:{am:jn.amNotation,pm:jn.pmNotation}}),this.value=this.originalInputValue,this.fakeTimeI.addEventListener("change",()=>{const e=jn.hour12?$n.time.convertMeridian(this.value):this.value;this.originalInputValue=e}),t.addEventListener("click",this._reset.bind(this)),this.element.addEventListener(yt.ApplyFocus().type,()=>{this.fakeTimeI.focus()})}_reset(){const e=this.originalInputValue?yt.Change():null;(e||this.value)&&(this.value="",this.fakeTimeI.dispatchEvent(e))}update(){this.element.value!==this.value&&this.fakeTimeI&&T(this.fakeTimeI).timepicker("setTime",this.element.value)}get value(){return this.fakeTimeI.value}set value(e){T(this.fakeTimeI).timepicker("setTime",e)}},class DatetimepickerExtended extends Widget{static get selector(){return'.question input[type="datetime-local"]:not([readonly])'}static condition(){return!o.touch||!o.inputTypes["datetime-local"]}_init(){this.$fakeDateI=this._createFakeDateInput(),this.$fakeTimeI=this._createFakeTimeInput(),this.element.classList.add("hide"),this.element.before(document.createRange().createContextualFragment('<div class="datetimepicker widget" />'));const e=this.question.querySelector(".widget");e.append(this.$fakeDateI[0].closest(".date")),e.append(this.$fakeTimeI[0].closest(".timepicker")),this.$fakeDateI.datepicker({format:"yyyy-mm-dd",autoclose:!0,todayHighlight:!0,forceParse:!1}),this.$fakeTimeI.timepicker({showMeridian:jn.hour12,meridianNotation:{am:jn.amNotation,pm:jn.pmNotation}}),this.value=this.originalInputValue,this._setFocusHandler(this.$fakeDateI.add(this.$fakeTimeI)),this.$fakeDateI.on("change changeDate",()=>($n.date.validate(this.$fakeDateI[0].value)||this.$fakeDateI.val("").datepicker("update"),this.originalInputValue=this.value,!1)),this.$fakeTimeI.on("change",()=>(this.originalInputValue=this.value,!1)),this.question.querySelector(".btn-reset").addEventListener("click",()=>{const e=this.originalInputValue?"change":"";(e||this.$fakeDateI.val()||this.$fakeTimeI.val())&&(this.$fakeDateI.val("").trigger(e).datepicker("update"),this.$fakeTimeI.val("").trigger(e))})}_createFakeDateInput(){return T('<div class="date"><input class="ignore" type="text" placeholder="yyyy-mm-dd"/></div>').find("input")}_createFakeTimeInput(){return T('<div class="timepicker">\n                    <input class="ignore timepicker-default" type="text" placeholder="hh:mm"/>\n                </div>').append(this.resetButtonHtml).find("input")}_setFocusHandler(e){this.element.addEventListener(yt.ApplyFocus().type,()=>{e.eq(0).focus()})}update(){const e=T(this.element),t=e.val().length>0?new Date(e.val()).toISOLocalString():"";if(t!==this.value){const e=t.split("T"),n=e[0],i=e[1]&&e[1].length>4?e[1].substring(0,5):"";this.$fakeDateI.datepicker("setDate",n),this.$fakeTimeI.timepicker("setTime",i)}}get value(){if(this.$fakeDateI.val().length>0&&this.$fakeTimeI.val().length>3){const e=this.$fakeDateI.val().split("-"),t=(jn.hour12?$n.time.convertMeridian(this.$fakeTimeI.val()):this.$fakeTimeI.val()).split(":");return new Date(e[0],e[1]-1,e[2],t[0],t[1]).toISOLocalString()}return""}set value(e){const t=(e?new Date(e).toISOLocalString():"").split("T"),n=t[0],i=t[1]&&t[1].length>4?t[1].substring(0,5):n&&!t[1]?"00:00":"";this.$fakeDateI.datepicker("setDate",n),this.$fakeTimeI.timepicker("setTime",i)}},class MediaPicker extends Widget{static get selector(){return".or-appearance-no-buttons"}_init(){this.element.querySelectorAll(".option-label").forEach((function(e){An(e,"img, video, audio").length>0&&(e.style.display="none")}))}},class Filepicker extends Widget{static get selector(){return'.question:not(.or-appearance-draw):not(.or-appearance-signature):not(.or-appearance-annotate) input[type="file"]'}_init(){const e=this.element.getAttribute("data-loaded-file-name"),t=this;this.element.classList.add("hide"),this.question.classList.add("with-media","clearfix");const n=document.createRange().createContextualFragment('<div class="widget file-picker">\n                    <input class="ignore fake-file-input"/>\n                    <div class="file-feedback"></div>\n                    <div class="file-preview"></div>\n                </div>');n.querySelector("input").after(this.downloadButtonHtml),n.querySelector("input").after(this.resetButtonHtml),this.element.after(n),this.disable();const i=this.question.querySelector(".widget");this.feedback=i.querySelector(".file-feedback"),this.preview=i.querySelector(".file-preview"),this.fakeInput=i.querySelector(".fake-file-input"),this.downloadLink=i.querySelector(".btn-download"),t._setResetButtonListener(i.querySelector(".btn-reset")),t._setFocusListener(),this._showFileName(e),lr.isWaitingForPermissions()&&this._showFeedback(dt("filepicker.waitingForPermissions"),"warning"),this._updatePlaceholder(),this.element.closest("form.or").addEventListener(yt.UpdateMaxSize().type,this._updatePlaceholder.bind(this)),lr.init().then(()=>{t._showFeedback(),t._setChangeListener(),t.props.readonly||t.enable(),e&&lr.getFileUrl(e).then(n=>{t._showPreview(n,t.props.mediaType),t._updateDownloadLink(n,e)}).catch(()=>{t._showFeedback(dt("filepicker.notFound",{existing:e}),"error")})}).catch(e=>{t._showFeedback(e,"error")})}_updatePlaceholder(){this.fakeInput.setAttribute("placeholder",dt("filepicker.placeholder",{maxSize:lr.getMaxSizeReadable()||"?MB"}))}_setResetButtonListener(e){e&&e.addEventListener("click",()=>{(this.originalInputValue||this.value)&&Kt.confirm(dt("filepicker.resetWarning",{item:dt("filepicker.file")})).then(e=>{e&&(this.originalInputValue="")}).catch(()=>{})})}_setChangeListener(){const e=this;T(this.element).on("click",t=>{if(e.props.readonly||"propagate"!==t.namespace)return e.fakeInput.focus(),t.stopImmediatePropagation(),!1}).on("change.propagate",t=>{let n,i,r;const o=this.element.getAttribute("data-loaded-file-name"),a=new Date;if("propagate"===t.namespace)return T(this.element).trigger("change.file"),!1;t.stopImmediatePropagation(),n=t.target.files[0],r=`-${a.getHours()}_${a.getMinutes()}_${a.getSeconds()}`,t.target.dataset.filenamePostfix=r,i=f(n,r),this._resizeFile(n,e.props.mediaType).then(e=>{t.target.dataset.resized=!0,t.target.dataset.resizedDataURI=e.dataURI,n=e.blob}).catch(()=>{}).finally(()=>{lr.getFileUrl(n,i).then(t=>{e._showPreview(t,e.props.mediaType),e._showFeedback(),e._showFileName(i),o&&o!==i&&e.element.removeAttribute("data-loaded-file-name"),e._updateDownloadLink(t,i),T(e.element).trigger("change.propagate")}).catch(t=>{T(e.element).val("").trigger("change.propagate"),e._showFileName(""),e._showPreview(null),e._showFeedback(t,"error"),e._updateDownloadLink("","")})})}),this.fakeInput.addEventListener("click",t=>{if(t.preventDefault(),this.props.readonly||this.originalInputValue||this.value)return this.fakeInput.focus(),void t.stopImmediatePropagation();T(e.element).trigger("click.propagate")}),this.fakeInput.addEventListener("change",e=>{e.preventDefault(),e.stopPropagation()})}_setFocusListener(){this.element.addEventListener(yt.ApplyFocus().type,()=>{this.fakeInput.focus()})}_showFileName(e){this.value=e,this.fakeInput.readOnly=!!e}_showFeedback(e,t){const n=e instanceof cr?dt(e.translationKey,e.translationOptions):e instanceof Error?e.message:e||"";t=t||"",this.feedback.textContent=n,this.feedback.setAttribute("class","file-feedback "+t)}_showPreview(e,t){let n;switch(function(e){[...e.children].forEach(e=>e.remove())}(this.preview),t){case"image/*":n="<img />";break;case"audio/*":n='<audio controls="controls"/>';break;case"video/*":n='<video controls="controls"/>'}if(e&&n){const t=document.createRange().createContextualFragment(n);t.querySelector("*").src=e,this.preview.append(t)}}_resizeFile(e,t){return new Promise((n,i)=>{"image/*"!==t&&i(e),this.props&&this.props.maxPixels?function(e,t){return new Promise((n,i)=>{const r=new Image;r.src=URL.createObjectURL(e),r.onload=()=>{const i=r.width,o=r.height;let a,s;i<=t&&o<=t&&n(e),i>o?(s=o*(t/i),a=t):(a=i*(t/o),s=t);const l=document.createElement("canvas");l.width=a,l.height=s;l.getContext("2d").drawImage(r,0,0,a,s),l.toBlob(n,e.type)},r.onerror=i})}(e,this.props.maxPixels).then(e=>{const t=new FileReader;t.addEventListener("load",(function(){n({blob:e,dataURI:t.result})}),!1),t.readAsDataURL(e)}).catch(()=>{i(e)}):i(e)})}_updateDownloadLink(e,t){ur.updateDownloadLink(this.downloadLink,e,t)}disable(){this.element.disabled=!0,this.question.querySelector(".btn-reset").disabled=!0}enable(){this.element.disabled=!1,this.question.querySelector(".btn-reset").disabled=!1}get props(){const e=this._props;return e.mediaType=this.element.getAttribute("accept"),this.element.dataset.maxPixels&&g(this.element.dataset.maxPixels)&&(e.maxPixels=parseInt(this.element.dataset.maxPixels,10)),e}get value(){return this.fakeInput.value}set value(e){this.fakeInput.value=e}},class DrawWidget extends Widget{static get selector(){return'.or-appearance-draw input[data-type-xml="binary"][accept^="image"], .or-appearance-signature input[data-type-xml="binary"][accept^="image"], .or-appearance-annotate input[data-type-xml="binary"][accept^="image"]'}_init(){let e;const t=this,n=this.element.dataset.loadedFileName;this.element.type="text",this.element.dataset.drawing=!0,this.element.after(this._getMarkup());const i=this.question;i.classList.add(`or-${this.props.type}-initialized`),this.$widget=T(i.querySelector(".widget")),e=this.$widget[0].querySelector(".draw-widget__body__canvas"),this._handleResize(e),this._resizeCanvas(e),this.props.load&&this._handleFiles(n),e.addEventListener("blur",this._forceUpdate.bind(this)),this.initialize=lr.init().then(()=>(t.pad=new pr(e,{onEnd:()=>{clearTimeout(t._updateWithDelay),t._updateWithDelay=setTimeout(t._updateValue.bind(t),1500)},penColor:t.props.colors[0]||"black"}),t.pad.off(),!n||(t.element.value=n,t._loadFileIntoPad(n).then(t._updateDownloadLink.bind(t))))),this.disable(),this.initialize.then(()=>{t.$widget.find(".btn-reset").on("click",t._reset.bind(t)).end().find(".draw-widget__colorpicker").on("click",".current",(function(){T(this).parent().toggleClass("reveal")})).on("click","[data-color]:not(.current)",(function(){T(this).siblings().removeClass("current").end().addClass("current").parent().removeClass("reveal"),t.pad.penColor=this.dataset.color})).end().find(".draw-widget__undo").on("click",()=>{const e=t.pad.toData();t.pad.clear();const n=t.$widget[0].querySelector("input[type=file]"),i=n&&n.files[0]?n.files[0]:t.element.dataset.loadedFileName;t._loadFileIntoPad(i).then(()=>{t.pad.updateData(e.slice(0,-1)),t._updateValue(),t.pad.penColor=t.$widget.find(".draw-widget__colorpicker .current")[0].dataset.color})}).end().find(".show-canvas-btn").on("click",()=>(t.$widget.addClass("full-screen"),t._resizeCanvas(e),t.enable(),!1)).end().find(".hide-canvas-btn").on("click",()=>(t.$widget.removeClass("full-screen"),t.pad.off(),t._forceUpdate(),t._resizeCanvas(e),!1)).click(),T(e).on("canvasreload",()=>{t.cache&&t.pad.fromObjectURL(t.cache).then(t._updateValue.bind(t,!1))}),t.enable()}).catch(e=>{t._showFeedback(e.message)}),T(this.element).on("applyfocus",()=>{e.focus()}).closest('[role="page"]').on(yt.PageFlip().type,()=>{t._resizeCanvas(e)})}_forceUpdate(){this._updateWithDelay&&(clearTimeout(this._updateWithDelay),this._updateValue())}_handleFiles(e){this._updatePlaceholder(),this.element.closest("form.or").addEventListener(yt.UpdateMaxSize().type,this._updatePlaceholder.bind(this));const t=this,n=this.$widget.find("input[type=file]"),i=this.$widget.find(".fake-file-input");this._showFileName(e),n.on("click",e=>{if(t.props.readonly||"propagate"!==e.namespace)return t.$fakeInput.focus(),e.stopImmediatePropagation(),!1}).on("change",(function(){const e=this.files[0];e?lr.isTooLarge(e)?t._showFeedback(dt("filepicker.toolargeerror",{maxSize:lr.getMaxSizeReadable()})):(t.pad.clear(),t._loadFileIntoPad(this.files[0]).then(()=>{t._updateValue.call(t),t._showFileName(e.name),t.enable()})):t._showFileName(null)})),i.on("click",(function(e){if(t.props.readonly||n[0].value||i[0].value)return T(this).focus(),e.stopImmediatePropagation(),!1;e.preventDefault(),n.trigger("click.propagate")})).on("change",()=>!1)}_showFileName(e){this.$widget.find(".fake-file-input").val(e).prop("readonly",!!e)}_updatePlaceholder(){this.$widget.find(".fake-file-input").attr("placeholder",dt("filepicker.placeholder",{maxSize:lr.getMaxSizeReadable()||"?MB"}))}_getMarkup(){const e=this.props.load?`<input type="file" class="ignore draw-widget__load"${null!==this.props.capture?` capture="${this.props.capture}"`:""} accept="${this.props.accept}"/><div class="widget file-picker"><input class="ignore fake-file-input"/><div class="file-feedback"></div></div>`:"",t=this.props.touch?'<button type="button" class="show-canvas-btn btn btn-default">Draw/Sign</button><button type="button" class="hide-canvas-btn btn btn-default"><span class="icon icon-arrow-left"> </span></button>':"",n=document.createRange().createContextualFragment(`<div class="widget draw-widget">\n                <div class="draw-widget__body">\n                    ${t}\n                    ${e}\n                    <canvas class="draw-widget__body__canvas noSwipe disabled" tabindex="0"></canvas>\n                    <div class="draw-widget__colorpicker"></div>\n                    ${"signature"===this.props.type?"":'<button class="btn-icon-only draw-widget__undo" aria-label="undo" type=button><i class="icon icon-undo"> </i></button>'}\n                </div>\n                <div class="draw-widget__footer">\n                    <div class="draw-widget__feedback"></div>\n                </div>\n            </div>`);n.querySelector(".draw-widget__footer").prepend(this.downloadButtonHtml),n.querySelector(".draw-widget__footer").prepend(this.resetButtonHtml);const i=n.querySelector(".draw-widget__colorpicker");return this.props.colors.forEach((e,t)=>{const n=0===t?" current":"",r=document.createRange().createContextualFragment(`<div class="${n}"data-color="${e}" style="background: ${e};" />`);i.append(r)}),n}_updateValue(e=!0){const t=new Date,n=`-${t.getHours()}_${t.getMinutes()}_${t.getSeconds()}`;this.element.dataset.filenamePostfix=n,e&&(this.originalInputValue=this.props.filename),this.value=this.pad.toDataURL(),this._updateDownloadLink(this.value)}_reset(){const e=this;if(this.element.value){const t="signature"===this.props.type?dt("drawwidget.signature"):"drawing"===this.props.type?dt("drawwidget.drawing"):dt("drawwidget.annotation");Kt.confirm(dt("filepicker.resetWarning",{item:t})).then(t=>{t&&(e.pad.clear(),e.cache=null,delete e.element.dataset.loadedFileName,delete e.element.dataset.loadedUrl,e.element.dataset.filenamePostfix="",T(e.element).val("").trigger("change"),e.$widget.find("input[type=file]").val("").trigger("change"),e._updateDownloadLink(""),e.disable(),e.enable())})}}_loadFileIntoPad(e){const t=this;return e?("string"==typeof e&&e.startsWith("jr://")&&this.element.dataset.loadedUrl&&(e=this.element.dataset.loadedUrl),lr.getObjectUrl(e).then(t.pad.fromObjectURL.bind(t.pad)).then(e=>(t.cache=e,e)).catch(()=>{t._showFeedback("File could not be loaded (leave unchanged if already submitted and you want to preserve it).","error")})):Promise.resolve("")}_showFeedback(e){e=e||"",this.$widget.find(".draw-widget__feedback").text(e)}_updateDownloadLink(e){e&&0===e.indexOf("data:")&&(e=URL.createObjectURL(m(e)));const t=e?f({name:this.element.value},this.element.dataset.filenamePostfix):"";ur.updateDownloadLink(this.$widget.find(".btn-download")[0],e,t)}_handleResize(e){const t=this;T(window).on("resize",()=>{t._forceUpdate(),t._resizeCanvas(e)})}_resizeCanvas(e){if(e.offsetWidth>0){const t=Math.max(window.devicePixelRatio||1,1);e.width=e.offsetWidth*t,e.height=e.offsetHeight*t,e.getContext("2d").scale(t,t),T(e).trigger("canvasreload")}}disable(){const e=this,t=this.$widget.find(".draw-widget__body__canvas")[0];this.initialize.then(()=>{e.pad.off(),t.classList.add("disabled"),e.$widget.find(".btn-reset").prop("disabled",!0)})}enable(){const e=this,t=this.$widget.find(".draw-widget__body__canvas")[0],n=this.props.touch&&!this.$widget.is(".full-screen"),i=this.props.load&&!this.element.value;this.initialize.then(()=>{e.props.readonly||i||n||(e.pad.on(),t.classList.remove("disabled"),e.$widget.find(".btn-reset").prop("disabled",!1)),e._resizeCanvas(t)})}update(){""===this.originalInputValue&&this._reset()}get props(){const e=this._props;return e.type=e.appearances.includes("draw")?"drawing":e.appearances.includes("signature")?"signature":"annotation",e.filename=e.type+".png",e.load="annotation"===e.type,e.colors="signature"===e.type?[]:["black","lightblue","blue","red","orange","cyan","yellow","lightgreen","green","pink","purple","lightgray","darkgray"],e.touch=o.touch,e.accept=this.element.getAttribute("accept"),e.capture=this.element.getAttribute("capture"),e}get value(){return this.cache||""}set value(e){this.cache=e}},class RankWidget extends Widget{static get selector(){return".question input.rank"}static get list(){return!0}_init(){const e=this,t=this.originalInputValue,n=o.touch?"rankwidget.tapstart":"rankwidget.clickstart";this.itemSelector="label:not(.itemset-template)",this.list=T(this.element).next(".option-wrapper").addClass("widget rank-widget")[0],T(this.list).toggleClass("rank-widget--empty",!t).append(this.resetButtonHtml).append(`<div class="rank-widget__overlay"><span class="rank-widget__overlay__content" data-i18n="${n}">${o.touch?dt("rankwidget.tapstart"):dt("rankwidget.clickstart")}</span></div>`).on("click",(function(){e.element.disabled||(this.classList.remove("rank-widget--empty"),e.originalInputValue=e.value,e.element.dispatchEvent(yt.FakeFocus()))})),this.list.querySelector(".btn-reset").addEventListener("click",e=>{this._reset(),e.stopPropagation()}),this.element.classList.add("hide"),this.value=t,Qr(this.list,{items:this.itemSelector,containerSerializer:t=>({value:[].slice.call(t.node.querySelectorAll(e.itemSelector+" input")).map(e=>e.value).join(" ")})})[0].addEventListener("sortupdate",()=>{this.originalInputValue=this.value,this.element.dispatchEvent(yt.FakeFocus())}),this.props.readonly&&this.disable()}_reset(){this.originalInputValue=""}get value(){return Qr(this.list,"serialize")[0].container.value}set value(e){if(e){const t=this,n=e.split(" "),i=[...this.list.querySelectorAll(this.itemSelector+" input")];if(n.length!==i.length)throw new Error("Could not load rank widget value. Number of items mismatch.");i.sort((e,t)=>{const i=n.indexOf(e.value),r=n.indexOf(t.value);if(-1===i||-1===r)throw new Error("Could not load rank widget value. Mismatch in item values.");return i-r}),i.forEach(e=>{T(t.list).find(".btn-reset").before(T(e.parentNode).detach())})}else this._reset()}disable(){T(this.element).prop("disabled",!0).next(".widget").find("input, button").prop("disabled",!0),Qr(this.list,"disable")}enable(){T(this.element).prop("disabled",!1).next(".widget").find("input, button").prop("disabled",!1),Qr(this.list,"enable")}update(){const e=this.element.value;Qr(this.list),e?(this.value=e,this.originalInputValue=e):this._reset()}get originalInputValue(){return super.originalInputValue}set originalInputValue(e){super.originalInputValue=e,this.list.classList.toggle("rank-widget--empty",!e)}},class LikertItem{},class RangeWidget extends Widget{static get selector(){return'.or-appearance-distress input[type="number"], .question:not(.or-appearance-analog-scale):not(.or-appearance-rating) > input[type="number"][min][max][step]'}_init(){const e=this,t=document.createRange().createContextualFragment(this._getHtmlStr());t.querySelector(".range-widget__scale__end").before(this.resetButtonHtml),t.querySelector(".range-widget__scale__start").textContent=this.props.min,t.querySelector(".range-widget__scale__end").textContent=this.props.max,this.element.after(t),this.element.classList.add("hide"),this.element.addEventListener("applyfocus",()=>{this.range.focus()}),this.widget=this.question.querySelector(".widget"),this.range=this.widget.querySelector("input"),this.current=this.widget.querySelector(".range-widget__current"),this.props.readonly&&this.disable(),this.range.addEventListener("change",()=>{this.originalInputValue!==this.value&&(this.current.textContent=this.value,this.originalInputValue=this.value,this._updateMercury((this.value-this.props.min)/(e.props.max-e.props.min)))}),this.widget.querySelector("input.empty").addEventListener("click",()=>{this.range.classList.remove("empty"),this.range.dispatchEvent(yt.Change())}),this.widget.querySelector("input.empty").addEventListener("touchstart",()=>{this.range.classList.remove("empty"),this.range.dispatchEvent(yt.Change())}),this.widget.querySelector(".btn-reset").addEventListener("click",this._reset.bind(this)),this.update();let n=this.props.ticks?Math.ceil(Math.abs((this.props.max-this.props.min)/this.props.step)):1,i=Math.ceil(n/this.props.maxTicks);for(;n%i&&i<n;)i++;n/=i,this.widget.querySelector(".range-widget__ticks").append(document.createRange().createContextualFragment(new Array(n).fill("<span></span>").join("")))}_getHtmlStr(){return`<div class="widget range-widget">\n                <div class="range-widget__wrap">\n                    <div class="range-widget__current"></div>\n                    <div class="range-widget__bg"></div>\n                    <div class="range-widget__ticks"></div>\n                    <div class="range-widget__scale">\n                        <span class="range-widget__scale__start"></span>\n                        ${this._stepsBetweenHtmlStr(this.props)}\n                        <span class="range-widget__scale__end"></span>\n                    </div>\n                    <div class="range-widget__bulb">\n                        <div class="range-widget__bulb__inner"></div>\n                        <div class="range-widget__bulb__mercury"></div>\n                    </div>\n                </div>\n                <input type="range" class="ignore empty" min="${this.props.min}" max="${this.props.max}" step="${this.props.step}"/>\n            </div>`}_updateMercury(e){const t=this.widget.querySelector(".range-widget__ticks").clientHeight,n=this.widget.querySelector(".range-widget__bulb").clientHeight;this.widget.querySelector(".range-widget__bulb__mercury").style.height=e*t+.5*n+"px"}_stepsBetweenHtmlStr(e){let t="";if(e.distress){if((e.max-e.min)/e.step<=10&&(e.max-e.min)%e.step==0)for(let n=e.min+e.step;n<e.max;n+=e.step)t+=`<span class="range-widget__scale__between">${n}</span>`}return t}_reset(){this.current.textContent="",this._updateMercury(0),this.value="",this.originalInputValue=""}disable(){this.widget.querySelectorAll("input, button").forEach(e=>e.disabled=!0)}enable(){this.widget.querySelectorAll("input, button").forEach(e=>e.disabled=!1)}update(){const e=this.element.value;g(e)?(this.value=e,this.range.dispatchEvent(yt.Change())):this._reset()}get props(){const e=this._props,t=g(this.element.getAttribute("min"))?this.element.getAttribute("min"):0,n=g(this.element.getAttribute("max"))?this.element.getAttribute("max"):10,i=g(this.element.getAttribute("step"))?this.element.getAttribute("step"):1,r=e.appearances.includes("distress");return e.min=Number(t),e.max=Number(n),e.step=Number(i),e.vertical=e.appearances.includes("vertical")||r,e.ticks=!e.appearances.includes("no-ticks"),e.distress=r,e.maxTicks=50,e}get value(){return this.range.classList.contains("empty")?"":this.range.value}set value(e){this.range.value=e,this.range.classList.toggle("empty",""===e)}},class Columns extends Widget{static get selector(){return".question.or-appearance-columns"}_init(){this.element.querySelectorAll(".option-wrapper").forEach(e=>{let t=3-e.querySelectorAll("label").length%3;for(;t<3&&t>0;)e.append(document.createRange().createContextualFragment('<label class="filler"></label>')),t--;this.question.classList.add("or-columns-initialized")})}},class ImageViewer extends Widget{static get selector(){return"a.or-big-image"}_init(){this.element.addEventListener("click",e=>{const t=this.element.getAttribute("href"),n=this.element.querySelector("img"),i=n.getAttribute("src");this.element.setAttribute("href",i),n.setAttribute("src",t),this.element.classList.toggle("open"),e.preventDefault(),e.stopPropagation()})}},class Comment extends Widget{static get selector(){return'.or-appearance-comment input[type="text"][data-for], .or-appearance-comment textarea[data-for]'}static get helpersRequired(){return["input","pathToAbsolute"]}_init(){if(this.linkedQuestion=this._getLinkedQuestion(this.element),this.commentQuestion=this.question,this.linkedQuestion){this.commentQuestion.classList.add("hide"),this.commentQuestion.setAttribute("role","comment");const e=document.createRange().createContextualFragment('<a class="btn-icon-only btn-comment aria-label="comment" type="button" href="#"><i class="icon"> </i></a>'),t=this.linkedQuestion.querySelectorAll(".question-label");t[t.length-1].after(e),this.commentButton=this.linkedQuestion.querySelector(".btn-comment"),this._setCommentButtonState(this.originalInputValue),this._setCommentButtonHandler(),this._setValidationHandler(),this._setFocusHandler()}}_getLinkedQuestion(e){const t=this.options.helpers.input.getName(e),n=this.element.dataset.for.trim(),i=this.options.helpers.pathToAbsolute(n,t),r=e.closest("form.or, .or-repeat");return this.options.helpers.input.getWrapNode(r.querySelector(`[name="${i}"], [data-name="${i}"]`))}_commentHasError(){return this.commentQuestion.classList.contains("invalid-required")||this.commentQuestion.classList.contains("invalid-constraint")}_setCommentButtonState(e,t){e="string"==typeof e?e.trim():e,this.commentButton.classList.toggle("empty",!e),this.commentButton.classList.toggle("invalid",!!t)}_setCommentButtonHandler(){this.commentButton.addEventListener("click",e=>{this._isCommentModalShown(this.linkedQuestion)?this._hideCommentModal(this.linkedQuestion):this._showCommentModal(),e.preventDefault(),e.stopPropagation()})}_setValidationHandler(){this.element.closest("form.or").addEventListener(yt.ValidationComplete().type,()=>{const e=this._commentHasError(),t=this.originalInputValue;this._setCommentButtonState(t,e)})}_setFocusHandler(){T(this.element).on("applyfocus",()=>{this.commentButton.matches(":visible")?this.commentButton.click():console.warn("The linked question is not visible. Cannot apply focus to "+this.element.getAttribute("name"))})}_isCommentModalShown(e){return!!e.querySelector(".or-comment-widget")}_showCommentModal(){const e=this.question.cloneNode(!0),t=dt("widget.comment.update")||"Update",n=e.querySelector("input:not(.ignore), textarea:not(.ignore)");e.classList.remove("hide"),n.classList.add("ignore"),n.removeAttribute("name data-for data-type-xml");const i=document.createRange().createContextualFragment(`<section class="widget or-comment-widget">\n                <div class="or-comment-widget__content">\n                    <button class="btn btn-primary or-comment-widget__content__btn-update" type="button">${t}</button>\n                    <button class="btn-icon-only or-comment-widget__content__btn-close-x" type="button">&times;</button>\n                </div>\n            </section>\n            `);i.querySelector(".or-comment-widget__content").prepend(e);const r=document.createRange().createContextualFragment('<div class="or-comment-widget__overlay"></div>');this.linkedQuestion.prepend(i),this.linkedQuestion.before(r);const o=this.linkedQuestion.previousElementSibling,a=this.linkedQuestion.querySelector(".or-comment-widget"),s=a.querySelector(".or-comment-widget__content__btn-update"),l=a.querySelector(".or-comment-widget__content__btn-close-x");n.focus(),a.scrollIntoView(!1),s.addEventListener("click",e=>{const t=n.value;this.originalInputValue=t,this.element.dispatchEvent(yt.Change());const i=this._commentHasError();this._setCommentButtonState(t,i),this._hideCommentModal(this.linkedQuestion),this.options.helpers.input.validate(T(this.linkedQuestion.querySelector("input:not(.ignore), select:not(.ignore), textarea:not(.ignore)"))),e.preventDefault(),e.stopPropagation()}),l.addEventListener("click",e=>{this._hideCommentModal(this.linkedQuestion),e.stopPropagation(),e.preventDefault()}),o.addEventListener("click",e=>{this._hideCommentModal(this.linkedQuestion),e.stopPropagation(),e.preventDefault()})}_hideCommentModal(e){e.querySelector(".or-comment-widget").remove();const t=e.previousElementSibling;t&&t.matches(".or-comment-widget__overlay")&&t.remove()}},class ImageMap extends Widget{static get selector(){return".simple-select.or-appearance-image-map label:first-child > input"}_init(){const e=this.question.querySelector("img");if(this.question.classList.add("or-image-map-initialized"),e)return e.getAttribute("src")?this._addMarkup(e).then(this._addFunctionality.bind(this)).then(()=>this):new Promise(t=>{e.addEventListener("load",()=>{this._addMarkup(e).then(this._addFunctionality.bind(this)),t(this)})});this._showSvgNotFoundError()}_addFunctionality(e){e&&(this.svg=e.querySelector("svg"),this.tooltip=e.querySelector(".image-map__ui__tooltip"),this.props.readonly&&this.disable(),this._setSvgClickHandler(),this._setChangeHandler(),this._setHoverHandler(),this._updateImage(),this._setPageHandler())}_addMarkup(e){const t=this,n=e.getAttribute("src");return fetch(n).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/xml")).then(e=>{if(t._isSvgDoc(e)){const n=t._removeUnmatchedIds(e.querySelector("svg")),i=document.createRange().createContextualFragment('<div class="widget image-map">\n                            <div class="image-map__ui">\n                                <span class="image-map__ui__tooltip"></span>\n                            </div>\n                        </div>');i.querySelector(".widget").append(n),t.question.querySelectorAll("img").forEach(e=>e.remove()),t.question.querySelector(".option-wrapper").before(i);const r=t.question.querySelector(".image-map"),o=r.querySelector("svg");return o.getAttribute("viewBox")||this._setViewBox(o),r}throw"Image is not an SVG doc"}).catch(this._showSvgNotFoundError.bind(t))}_setViewBox(e){let t;try{const n=e.getBBox();t=`${n.x} ${n.y} ${n.width} ${n.height}`}catch(n){console.error("Could not obtain Boundary Box of SVG element",n);let i=e.getAttribute("width"),r=e.getAttribute("height");i&&r&&(t=`0 0 ${parseInt(i,10)} ${parseInt(r,10)}`)}e.setAttribute("viewBox",t)}_showSvgNotFoundError(e){console.error(e);const t=document.createRange().createContextualFragment(`<div class="widget image-map">\n                <div class="image-map__error" data-i18n="imagemap.svgNotFound">${dt("imagemap.svgNotFound")}</div>\n            </div>`);this.question.querySelector(".option-wrapper").before(t)}_removeUnmatchedIds(e){return e.querySelectorAll(Jr).forEach(e=>{this._getInput(e.id)||e.removeAttribute("id")}),e}_getInput(e){return this.question.querySelector(`input[value="${e}"]`)}_setSvgClickHandler(){this.svg.addEventListener("click",e=>{if(!e.target.closest("svg").matches("[or-readonly]")&&(e.target.matches(Jr)||e.target.closest(Jr))){const t=e.target.id||e.target.closest("g[id]").id,n=this._getInput(t);n&&(n.checked=!n.checked,n.dispatchEvent(yt.Change()),n.dispatchEvent(yt.FakeFocus()))}})}_setChangeHandler(){this.question.addEventListener("change",this._updateImage.bind(this))}_setHoverHandler(){this.svg.querySelectorAll(Jr).forEach(e=>{e.addEventListener("mouseenter",e=>{const t=e.target.id||e.target.closest("g[id]").id,n=An(this._getInput(t),".option-label.active"),i=n&&n.length?n[0].textContent:"";this.tooltip.textContent=i}),e.addEventListener("mouseleave",e=>{e.target.matches(Jr)&&(this.tooltip.textContent="")})})}_setPageHandler(){const e=this.element.closest('[role="page"]');e&&e.addEventListener(yt.PageFlip().type,()=>this._setViewBox(this.svg))}_isSvgDoc(e){return"object"==typeof e&&e.querySelector("svg")}_updateImage(){let e=this.originalInputValue;this.svg.querySelectorAll("path[or-selected], g[or-selected], circle[or-selected]").forEach(e=>e.removeAttribute("or-selected")),"string"==typeof e&&(e=[e]),e.forEach(e=>{e&&this.svg.querySelectorAll(`path#${e},g#${e},circle#${e}`).forEach(e=>e.setAttribute("or-selected",""))})}disable(){this.svg.setAttribute("or-readonly","")}enable(){this.svg.removeAttribute("or-readonly")}update(){this._updateImage()}get value(){return this.originalInputValue}set value(e){this.originalInputValue=e}},class DatepickerNative extends Widget{static get selector(){return'.question input[type="date"],.question input[type="datetime-local"]'}static condition(e){return!On.has(e,"DatepickerExtended")&&!On.has(e,"DatetimepickerExtended")&&!o.touch}_init(){this.element.type="text",this.element.classList.add("mask-date")}},class DatepickerNativeIos extends Widget{static get selector(){return' .question input[type="date"], .question input[type="datetime-local"], .question input[type="time"]'}static condition(e){return!On.has(e,"DatepickerExtended")&&!On.has(e,"DatetimepickerExtended")&&!On.has(e,"TimepickerExtended")&&n.ios}_init(){this.element.addEventListener("focus",()=>{this.element.readOnly&&this.element.blur()})}},class DatepickerMobile extends Widget{static get selector(){return'.or-appearance-month-year input[type="date"]'}static condition(e){return!On.has(e,"DatepickerExtended")&&o.touch&&o.inputTypes.month}_init(){this.element.classList.add("hide");const e=document.createRange().createContextualFragment('<input class="ignore widget datepicker-mobile" type="month"/>');this.element.after(e),this.widgetInput=this.question.querySelector("input.widget"),this.value=this.originalInputValue,this.widgetInput.addEventListener("change",()=>{this.originalInputValue=this.value})}get value(){return this.widgetInput.value?this.widgetInput.value+"-01":""}set value(e){const t=e?e.substring(0,e.lastIndexOf("-")):"";this.widgetInput.value=t}update(){this.value=this.originalInputValue}},class TextMaxWidget extends Widget{static get selector(){return'[data-type-xml="string"]'}_init(){const e=Number(a.textMaxChars);!isNaN(e)&&e>0&&this.element.setAttribute("maxlength",a.textMaxChars)}},class TextPrintWidget extends Widget{static get selector(){return".question:not(.or-appearance-autocomplete):not(.or-appearance-url) > input[type=text]:not(.ignore):not([data-for]), .question:not(.or-appearance-autocomplete):not(.or-appearance-url) > textarea:not(.ignore):not([data-for])"}_init(){this.question.addEventListener(yt.Printify().type,this._addWidget.bind(this)),this.question.addEventListener(yt.DePrintify().type,this._removeWidget.bind(this))}_addWidget(){if(!this.widget){const e="print-input-text",t=document.createElement("div");t.classList.add(e,"widget"),this.element.after(t),this.element.classList.add("print-hide"),this.widget=this.element.parentElement.querySelector("."+e),this.widget.innerHTML=this.element.value.replace(/\n/g,"<br>")}}_removeWidget(){this.widget&&(this.element.classList.remove("print-hide"),this.element.parentElement.removeChild(this.widget),this.widget=null)}},class RatingWidget extends Widget{static get selector(){return'.or-appearance-rating input[type="number"]'}_init(){const e=document.createRange().createContextualFragment(this._getHtmlStr());this.element.after(e),this.element.classList.add("hide"),this.widget=this.question.querySelector(".widget");let t="",n=Math.random().toString(36).substring(2,15);for(let e=this.props.min;e<=this.props.max;e+=this.props.step)t+=`<input type=radio name="rating-stars__${n}" class="rating-widget__rating__star ignore" value="${e}"/>`;this.widget.querySelector(".rating-widget__rating").append(document.createRange().createContextualFragment(t)),this.rating=this.widget.querySelector(".rating-widget__rating"),this.stars=this.rating.querySelectorAll(".rating-widget__rating__star"),this.stars.forEach(e=>{e.addEventListener("change",()=>{const e=this.rating.querySelector("input:checked");(this.value!=e.value||this.rating.classList.contains("empty"))&&(this.value=e.value)})}),this.update(),this.props.readonly&&this.disable()}_getHtmlStr(){return'<div class="widget rating-widget">\n                \t<div class="rating-widget__rating empty"></div>\n            \t</div>'}disable(){this.stars.forEach(e=>e.disabled=!0)}enable(){this.stars.forEach(e=>e.disabled=!1)}update(){const e=this.element.value;g(e)?this.stars.forEach(t=>{t.value===e&&(t.checked=!0,t.dispatchEvent(yt.Change()))}):this._reset()}_reset(){const e=this.rating.querySelector("input:checked");e&&(this.value="",e.checked=!1)}get props(){const e=this._props,t=g(this.element.getAttribute("min"))?this.element.getAttribute("min"):0,n=g(this.element.getAttribute("max"))?this.element.getAttribute("max"):10,i=g(this.element.getAttribute("step"))?this.element.getAttribute("step"):1;return e.min=Number(t),e.max=Number(n),e.step=Number(i),e}get value(){return this.originalInputValue}set value(e){this.originalInputValue=e,this.rating.classList.toggle("empty",""===e)}},class ThousandsSeparatorWidget extends Widget{static get selector(){return'.or-appearance-thousands-sep input[type="number"]'}_init(){const e=document.createRange().createContextualFragment('<div class="widget "></div>');this.element.after(e),this.widget=this.element.parentElement.querySelector(".widget"),this.update(),this.element.addEventListener("change",this.update.bind(this))}update(){this.value=this.originalInputValue}get value(){return this.widget.textContent}set value(e){let t="";g(e)&&(t=Number(e).toLocaleString(void 0,{maximumFractionDigits:20})),this.widget.textContent=t}},ImageCustomizer,class LiteracyWidget extends Widget{static get selector(){return".or-appearance-literacy.simple-select"}static get helpersRequired(){return["evaluate"]}_init(){const e=document.createRange();let t;if(!this.element.querySelector('input[type="checkbox"]')||this.element.querySelector('input[type="checkbox"][readonly]'))return void console.error("literacy widget cannot be instantiated on this question type");const n=this.props.name;t=this._getCurrentModelValue(),this.checkboxes=[...this.element.querySelectorAll('input[type="checkbox"]')],this.checkboxes.forEach(e=>{e.classList.add("ignore"),e.removeAttribute("name"),e.removeAttribute("data-type-xml"),e.removeAttribute("data-relevant"),e.removeAttribute("data-required"),e.disabled=!0});const i=this.element.querySelector(".option-wrapper");i.classList.add("widget","literacy-widget"),i.after(e.createContextualFragment(`<input type="text" name="${n}" ${this.props.readonly?"readonly":""}${["required","constraint","relevant"].map(e=>this.props[e]?`data-${e}="${this.props[e]}" `:"").join("")}/>`)),this.input=this.element.querySelector(`input[name="${n}"]`),i.prepend(e.createContextualFragment('<button class="btn btn-default literacy-widget__start" type="button" data-i18n="literacywidget.start"></button>\n                <div class="literacy-widget__timer"/>'));const r=i.querySelector(".literacy-widget__start");i.append(e.createContextualFragment('<button class="btn btn-primary literacy-widget__stop" disabled type="button" data-i18n="literacywidget.finish"></button>')),i.append(this.resetButtonHtml);const o=i.querySelector(".literacy-widget__stop"),a=i.querySelector(".btn-reset");this._addResetHandler(a),a.click(),this._addTimerHandlers(r,o),this._addWordHandlers(),t&&(this.input.value=t,this.value=t,this._setState("finish"))}_getCurrentModelValue(){const e=this.props.name.split("/").length>3?this.props.name.substring(0,this.props.name.lastIndexOf("/")):null,t=this.element.closest(".or-repeat[name]"),n=t?[...this.element.closest("form.or").querySelectorAll(`.or-repeat[name="${t.getAttribute("name")}"]`)].indexOf(t):0;return this.options.helpers.evaluate(this.props.name,"string",e,n)}_addResetHandler(e){e.addEventListener("click",()=>{this.timer&&this.timer.interval&&clearInterval(this.timer.interval),this.timer={elapsed:0,element:this.element.querySelector(".literacy-widget__timer"),interval:null,state:null},this.result={flashWordIndex:null,lastWordIndex:null},this.input.value="",this.input.dispatchEvent(yt.Change()),this._resetCheckboxes(),this._resetWords(),this._updateTimer(),this._setState(null)})}_addTimerHandlers(e,t){this._updateTimer(),e.addEventListener("click",()=>{this.timer.interval=setInterval(this._tick.bind(this),1e3),this._setState(io),t.disabled=!1}),t.addEventListener("click",()=>{clearInterval(this.timer.interval),this._setState(no),t.disabled=!0})}_addWordHandlers(){this.element.addEventListener("click",e=>"input"===e.target.nodeName.toLowerCase()),this.element.querySelectorAll(".option-label").forEach(e=>e.addEventListener("click",e=>{-1!==[io,no,to].indexOf(this.timer.state)&&e.target.closest("label").classList.toggle("incorrect-word")})),this.element.addEventListener("change",e=>{e.target.matches('input[type="checkbox"]')&&(e.target.checked&&this.timer.state===to?(this.result.flashWordIndex=this._getCheckboxIndex(e.target),this._setState(io)):e.target.checked&&this.timer.state===no&&(this.result.lastWordIndex=this._getCheckboxIndex(e.target),this.input.value=this.value,this.input.dispatchEvent(yt.Change()),this._setState("finish")))})}_resetWords(){this.element.querySelectorAll(".incorrect-word, .at-flash, .at-end, .unread").forEach(e=>e.classList.remove("incorrect-word","at-flash","at-end","unread"))}_hideCheckboxes(){this.checkboxes.forEach(e=>e.disabled=!0)}_getCheckboxIndex(e){return this.checkboxes.indexOf(e)}_showCheckboxes(e){e=e||0,this.checkboxes.slice(e).forEach(e=>e.disabled=!1)}_resetCheckboxes(){this.checkboxes.forEach(e=>e.checked=!1)}_setState(e){let t;switch(this.element.classList.remove(io,no,to,"finish"),this.timer.state=e,e&&this.element.classList.add(e),e){case io:this._updateWordCounts(),this._hideCheckboxes();break;case no:t=this._getCheckboxIndex([...this.element.querySelectorAll('.incorrect-word input[type="checkbox"]')].pop()),this._showCheckboxes(this.result.flashWordIndex>=t?this.result.flashWordIndex:t);break;case to:t=this._getCheckboxIndex([...this.element.querySelectorAll('.incorrect-word input[type="checkbox"]')].pop()),this._showCheckboxes(t||0);break;case"finish":this._updateWordCounts(),this._hideCheckboxes();break;default:this._hideCheckboxes()}}_updateTimer(){this.timer.element.textContent=this._formatTime(this.timer.elapsed)}_updateWordCounts(){if(null!==this.result.flashWordIndex&&this.checkboxes[this.result.flashWordIndex].parentElement.classList.add("at-flash"),null!==this.result.lastWordIndex){this.checkboxes[this.result.lastWordIndex].parentElement.classList.add("at-end");let e=this.result.lastWordIndex+1;for(;this.checkboxes[e];)this.checkboxes[e].parentElement.classList.add("unread"),e++}}_formatTime(e){const t=~~(e/3600),n=~~(e%3600/60),i=e%60;let r="";return t>0&&(r+=`${t}:${n<10?"0":""}`),r+=`${n}:${i<10?"0":""}`,r+=""+i,r}_tick(){this.timer.elapsed++,this._updateTimer(),this.timer.elapsed===this.props.flashTime&&this._setState(to)}_convertSpaceList(e){const t=e.split(" ").map(e=>"null"===e?null:Number(e));return{flashCount:t[0],finishCount:t[2],finishTime:t[1],incorrectWords:t.splice(10)}}get props(){const e=this._props,t=this.element.querySelector('input[type="text"], input[type="checkbox"]'),n=this.element.querySelectorAll(".option-wrapper label");return e.flashTime=isNaN(this.element.dataset.flash)?60:Number(this.element.dataset.flash),e.name=t.name,e.numberWords=n.length,e.relevant=t.dataset.relevant||"",e.constraint=t.dataset.constraint||"",e.required=t.dataset.required||"",e}get value(){const e=null!==this.result.lastWordIndex?this.result.lastWordIndex+1:null,t=null!==this.result.flashWordIndex?this.result.flashWordIndex+1:null,n=[...this.element.querySelectorAll(".incorrect-word input")].map(e=>e.value);return[t,this.timer.elapsed,e,null,null,null,null,null,null,null].map(e=>null==e?"null":e).concat(n).join(" ")}set value(e){const t=this._convertSpaceList(e),n=this.checkboxes.map(e=>e.parentElement);this.timer.elapsed=t.finishTime,this.result.lastWordIndex=null!==t.finishCount?t.finishCount-1:null,this.result.flashWordIndex=null!==t.flashCount?t.flashCount-1:null,this._updateTimer(),this._updateWordCounts(),t.incorrectWords.forEach(e=>{n[e-1].classList.add("incorrect-word")})}}].filter(e=>e.selector);let oo,ao;function so(e,t){return t?"form"===t?[ao]:e.classList.contains("question")?[...e.querySelectorAll("input:not(.ignore), select:not(.ignore), textarea:not(.ignore)")].filter(e=>e.matches(t)):[...e.querySelectorAll(t)]:[]}class Collection{constructor(e){Array.isArray(e)||(e=[e]),this.elements=e}_instantiateSingleWidget(e,t,n={}){if(!t.condition(e))return;if(On.has(e,t))return;const i=new t(e,n);i instanceof Promise?i.then(n=>On.put(e,t.name,n)):On.put(e,t.name,i)}_methodCall(e,t){this.elements.forEach(n=>{const i=On.get(n,e.name);i&&i[t]()})}instantiate(e,t){this.elements.forEach(n=>this._instantiateSingleWidget(n,e,t))}update(e){this._methodCall(e,"update")}disable(e){this._methodCall(e,"disable")}enable(e){this._methodCall(e,"enable")}}var lo={init:function(e,t={}){if(!this.form)throw new Error("Widgets module not correctly instantiated with form property.");oo=t,ao=this.form.view.html;const n=e&&e.length?e[0]:ao;return ro.forEach(e=>{!function(e,t){let n={};if(!e.name)return console.error("widget doesn't have a name");e.helpersRequired&&e.helpersRequired.length>0&&(n.helpers={},e.helpersRequired.forEach(e=>{n.helpers[e]=oo[e]}));const i=so(t,e.selector);if(!i.length)return;new Collection(i).instantiate(e,n),function(e,t){t.length>0&&ao.addEventListener(yt.ChangeLanguage().type,()=>{new Collection(t).update(e)})}(e,i),function(e,t){t.length>0&&e.list&&T(t).on(yt.ChangeOption().type,(function(){new Collection(this).update(e)}))}(e,i),function(e,t){t.length>0&&t[0].matches("input, select, textarea")&&t.forEach(t=>t.addEventListener(yt.InputUpdate().type,t=>{new Collection(t.target).update(e)}))}(e,i)}(e,n)}),!0},enable:function(e){ro.forEach(t=>{const n=so(e,t.selector).filter(e=>"select"===e.nodeName.toLowerCase()?!e.hasAttribute("readonly"):!e.readOnly);new Collection(n).enable(t)})},disable:function(e){ro.forEach(t=>{const n=so(e,t.selector);new Collection(n).disable(t)})}},uo={init(e){if(!this.form)throw new Error("Language module not correctly instantiated with form property.");const t=this.form.view.html.closest("body")||this.form.view.html.parentNode;if(!t)return;const n=t.querySelector(".form-language-selector"),i=this.form.view.html.querySelector("#form-languages");if(!i)return;this.languages=[...i.querySelectorAll("option")].map(e=>e.value),n&&(n.append(i),this.languages.length>1&&n.classList.remove("hide")),this.formLanguages=t.querySelector("#form-languages"),e&&this.languages.includes(e)&&this.languages.length>1?(this._currentLang=e,this.setFormUi(this._currentLang)):this._currentLang=this.formLanguages.dataset.defaultLang||this.languages[0]||"";const r=this.formLanguages.querySelector(`[value="${this._currentLang}"]`),o=r&&r.dataset.dir||"ltr";this.formLanguages.value=this._currentLang,this.form.view.html.setAttribute("dir",o),this.languages.length<2||(this.formLanguages.addEventListener(yt.Change().type,e=>{e.preventDefault(),this._currentLang=e.target.value,this.setFormUi(this._currentLang)}),this.form.view.html.addEventListener(yt.AddRepeat().type,e=>this.setFormUi(this._currentLang,e.target)))},get currentLang(){return this._currentLang},get currentLangDesc(){const e=this.formLanguages.querySelector(`[value="${this._currentLang}"]`);return e?e.textContent:null},get languagesUsed(){return this.languages||[]},setFormUi(e,t=this.form.view.html){const n=this.formLanguages.querySelector(`[value="${e}"]`).dataset.dir||"ltr",i=[...t.querySelectorAll("[lang]")];this.form.view.html.setAttribute("dir",n),i.forEach(e=>e.classList.remove("active")),i.filter(t=>t.matches(`[lang="${e}"], [lang=""]`)&&(!t.classList.contains("or-form-short")||t.classList.contains("or-form-short")&&0===An(t,".or-form-long").length)).forEach(e=>e.classList.add("active")),window.enketoFormLocale=e,this.form.view.html.querySelectorAll("select, datalist").forEach(e=>this.setSelect(e)),this.form.view.html.dispatchEvent(yt.ChangeLanguage())},setSelect(e){const t=e.nodeName.toLowerCase(),n=e.closest(".question, .or-repeat-info"),i=n?n.querySelector(".or-option-translations"):null;i&&[...e.children].filter(e=>e.matches("option")&&!e.matches('[value=""], [data-value=""]')).forEach(e=>{const n="datalist"===t?e.value:e.textContent,r="datalist"===t&&e.dataset.value||e.value,o=i.querySelector(`.active[data-option-value="${r}"]`);if(o){let t=n;o&&o.textContent&&(t=o.textContent),e.value=r,e.textContent=t}})}},co={init(){if(!this.form)throw new Error("Preload module not correctly instantiated with form property.");this.form.view.html.querySelectorAll("input[data-preload], select[data-preload], textarea[data-preload]").forEach(e=>{const t=this.form.input.getProps(e),n=e.dataset&&e.dataset.preload?e.dataset.preload.toLowerCase():void 0,i=e.dataset&&e.dataset.preloadParams?e.dataset.preloadParams.toLowerCase():void 0;if(void 0!==this[n]){const e=this.form.model.node(t.path,t.index);if(e.getElements().length){const r=e.getVal(),o=this[n]({param:i,curVal:r,dataNode:e});e.setVal(o,t.xmlType)}}else console.warn(`Preload "${n}" not supported. May or may not be a big deal.`)})},timestamp:function(e){let t;const n=this;return"start"===e.param?e.curVal.length>0?e.curVal:this.form.model.evaluate("now()","string"):"end"===e.param?(this.form.view.html.addEventListener(yt.BeforeSave().type,()=>{t=n.form.model.evaluate("now()","string"),e.dataNode.setVal(t,"datetime")}),this.form.model.evaluate("now()","string")):"error - unknown timestamp parameter"},date:function(e){let t,n,i,r;return 0===e.curVal.length?(t=new Date(this.form.model.evaluate("today()","string")),n=t.getFullYear().toString().pad(4),i=(t.getMonth()+1).toString().pad(2),r=t.getDate().toString().pad(2),`${n}-${i}-${r}`):e.curVal},property:function(e){let t;return 0===e.curVal.length?(t=this.form.model.node('instance("__session")/session/context/'+e.param),t.getElements().length?t.getVal():`no ${e.param} property in enketo`):e.curVal},context:function(e){return 0===e.curVal.length?"application"===e.param?"enketo":e.param+" not supported in enketo":e.curVal},patient:function(e){return 0===e.curVal.length?"patient preload item not supported in enketo":e.curVal},user:function(e){return 0===e.curVal.length?"user preload item not supported in enketo yet":e.curVal},uid:function(e){return 0===e.curVal.length?this.form.model.evaluate('concat("uuid:", uuid())',"string"):e.curVal}},ho={update(e){const t={};let n="";const i=this;if(!this.form)throw new Error("Output module not correctly instantiated with form property.");const r=this.form.getRelatedNodes("data-value",".or-output",e),o=this.form.repeatsPresent&&this.form.view.html.querySelector(".or-repeat.clone");r.each((function(){const e=T(this);if(e.closest(".or-branch").parent().closest(".disabled").length)return;const r=this.dataset.value;let a=this.closest(".question, .or-group");a.matches(".or-group")||(a=a.querySelector("[name]"));let s=i.form.input.getName(a);T(a).children(`.or-repeat-info[data-name="${s}"]`).length&&!T(a).children(`.or-repeat[name="${s}"]`).length&&(s=null);const l=o&&e.parentsUntil(".or",".or-repeat").length>0,u=l&&e.parentsUntil(".or",".or-repeat.clone").length>0&&s?i.form.input.getIndex(a):0;void 0!==t[r]?n=t[r]:(n=i.form.model.evaluate(r,"string",s,u,!0),l||(t[r]=n)),e.text()!==n&&e.text(n)}))}},po={update(e={},t=""){let n;if(!this.form)throw new Error("Calculation module not correctly instantiated with form property.");n=e.relevantPath?this.form.getRelatedNodes("data-calculate",`[name^="${e.relevantPath}/"]${t}`).add(this.form.getRelatedNodes("data-calculate",`[name="${e.relevantPath}"]${t}`)).add(this.form.getRelatedNodes("data-calculate",`[data-name="${e.relevantPath}"]${t}`)).get():this.form.getRelatedNodes("data-calculate",t,e).get(),n.forEach(t=>{const n=this.form.input.getName(t),i=this.form.model.node(n),r=i.getElements(),o={name:n,expr:this.form.input.getCalculation(t),dataType:this.form.input.getXmlType(t),relevantExpr:this.form.input.getRelevant(t),index:0,dataNodesObj:i};if(r.length>1)if(e.repeatPath&&-1!==n.indexOf(e.repeatPath+"/")){const i=-1!==n.lastIndexOf("/")?n.substring(n.lastIndexOf("/")+1):n,a=this.form.model.node(e.repeatPath,e.repeatIndex).getElement().querySelector(i);o.index=r.indexOf(a),this._updateCalc(t,o)}else if("hidden"===t.type)r.forEach((e,n)=>{const i=Object.create(o);i.index=n,this._updateCalc(t,i)});else{const e=In(t.closest(".or-repeat"),".or-repeat");e.length===r.length&&(o.index=e.indexOf(t.closest(".or-repeat")),this._updateCalc(t,o))}else 1===r.length&&this._updateCalc(t,o)})},setValue(e){let t=!1;if(!e)return;if(!this.form)throw new Error("Setvalue module not correctly instantiated with form property.");let n=[];if(e.type===(new yt.InstanceFirstLoad).type)t=!0,n=this.form.filterRadioCheckSiblings([...this.form.view.html.querySelectorAll(`[data-setvalue][data-event*="${e.type}"]`)]);else if(e.type===(new yt.NewRepeat).type)n=this.form.getRelatedNodes("data-setvalue",`[data-event*="${e.type}"]`,e.detail).get();else if(e.type===(new yt.XFormsValueChanged).type){const t=e.target.closest(".question");n=t?[...t.querySelectorAll(`[data-setvalue][data-event*="${e.type}"]`)]:n}n.forEach(n=>{const i=this.form.input.getName(n),r=this.form.model.node(i),o=r.getElements(),a={name:i,expr:n.dataset.setvalue,dataType:this.form.input.getXmlType(n),relevantExpr:this.form.input.getRelevant(n),index:e.detail&&void 0!==e.detail.repeatIndex?e.detail.repeatIndex:0,dataNodesObj:r};if(o.length>1&&e.type!==(new yt.NewRepeat).type&&e.type!==(new yt.XFormsValueChanged).type)o.forEach((e,i)=>{const r=Object.create(a),o=n;r.index=i,this._updateCalc(o,r,t)});else if(e.type===(new yt.XFormsValueChanged).type){const e=this.form.input.find(a.name,a.index);this._updateCalc(e,a,t)}else if(o[0]){const e=n;this._updateCalc(e,a,t)}else console.error("SetValue called for node that does not exist in model.")})},_updateCalc(e,t,n=!1){let i=!0;n||(i=this._isRelevant(t));const r=this.form.replaceChoiceNameFn(t.expr,"string",t.name,t.index),o=i&&r?this.form.model.evaluate(r,"string",t.name,t.index):"";t.dataNodesObj.setIndex(t.index);const s=t.dataNodesObj.getVal();t.dataNodesObj.setVal(o,t.dataType);const l=t.dataNodesObj.getVal();e&&s!==l&&(this.form.input.setVal(e,l),"hidden"!==e.type&&!0===a.validateContinuously&&this.form.validateInput(e))},_isRelevant(e){let t=!e.relevantExpr||this.form.model.evaluate(e.relevantExpr,"boolean",e.name,e.index);if(t){const n=e.name.split("/"),i=n.splice(0,n.length-1).join("/");let r;r=0===e.index?this.form.view.html.querySelector(`.or-group[name="${i}"],.or-group-data[name="${i}"]`):this.form.view.html.querySelectorAll(`.or-repeat[name="${i}"]`)[e.index]||this.form.view.html.querySelectorAll(`.or-group[name="${i}"],.or-group-data[name="${i}"]`)[e.index];const o=r?[r].concat(Nn(r,".or-group, .or-group-data")):[];o.length&&(t=o.filter(e=>e.matches("[data-relevant]")).map(e=>{const t=this.form.input.getName(e);return{context:t,index:[...this.form.view.html.querySelectorAll(`.or-group[name="${t}"], .or-group-data[name="${t}"]`)].indexOf(e),expr:this.form.input.getRelevant(e)}}).concat([{context:e.name,index:e.index,expr:e.relevantExpr}]).every(e=>!e.expr||this.form.model.evaluate(e.expr,"boolean",e.context,e.index)))}return t}},fo={update(e){const t=this,n={};if(!this.form)throw new Error("Required module not correctly instantiated with form property.");const i=this.form.getRelatedNodes("data-required","",e),r=this.form.repeatsPresent&&this.form.view.html.querySelector(".or-repeat.clone");i.each((function(){const e=T(this),i=t.form.input.getRequired(this),o=t.form.input.getName(this),a=r?t.form.input.getIndex(this):0,s=`${i}__${o.substring(0,o.lastIndexOf("/"))}__${a}`;void 0===n[s]&&(n[s]=t.form.model.node(o,a).isRequired(i)),e.closest(".question").find(".required").toggleClass("hide",!n[s])}))}};var go={init(){this._setNumberMask('[data-type-xml="int"]',/^(-?[0-9]+$)/,"-0123456789"),this._setNumberMask('[data-type-xml="decimal"]',/^(-?[0-9]+[.,]?[0-9]*$)/,"-0123456789.,")},_setNumberMask(e,t,n){const i=this.form.view.html;i.addEventListener("keydown",t=>{if(t.target.matches(e)){if(this._isNotPrintableKey(t)||this._isKeyboardCutPaste(t)||-1!==n.indexOf(t.key))return!0;t.preventDefault(),t.stopPropagation()}}),i.addEventListener("paste",n=>{if(n.target.matches(e)){const e=v(n);if(e&&t.test(e.trim()))return!0;n.target.value="",n.target.dispatchEvent(new Event("change")),n.preventDefault(),n.stopPropagation()}}),i.addEventListener("blur",n=>{n.target.matches(e)&&(void 0!==n.target.validity&&void 0!==n.target.validity.badInput&&n.target.validity.badInput||void 0===n.target.validity.badInput&&n.target.value&&!t.test(n.target.value.trim()))&&(n.target.value="")})},_isNotPrintableKey:e=>e.key.length>1&&"Spacebar"!==e.key,_isKeyboardCutPaste:e=>-1!=="xvc".indexOf(e.key)&&(e.metaKey||e.ctrlKey)},mo={update(e){this.form.getRelatedNodes("readonly","",e).each((function(){T(this).closest(".question").addClass("readonly"),this.value||this.dataset.calculate||this.classList.contains("readonly-forced")||this.classList.add("empty")}))}};function vo(e,t,n){const i=T(e);"string"==typeof e&&(console.deprecate("Form instantiation using a selector","a HTML <form> element"),e=i[0]),this.nonRepeats={},this.all={},this.options="object"!=typeof n?{}:n,this.view={$:i,html:e,clone:e.cloneNode(!0)},this.model=new si(t),this.repeatsPresent=!!this.view.html.querySelector(".or-repeat"),this.widgetsInitialized=!1,this.repeatsInitialized=!1,this.pageNavigationBlocked=!1,this.initialized=!1}T.fn.clearInputs=function(e,t){return e=e||"edit",t=t||"",this.each((function(){T(this).find(".file-preview").remove(),T(this).find("input, select, textarea").not(".ignore").each((function(){const n=T(this);let i,r=n.attr("type");switch("SELECT"===n.prop("nodeName").toUpperCase()&&(r="select"),"TEXTAREA"===n.prop("nodeName").toUpperCase()&&(r="textarea"),r){case"file":i=this.dataset.loadedFileName,delete this.dataset.loadedFileName;case"date":case"datetime-local":case"month":case"time":case"number":case"search":case"color":case"range":case"url":case"email":case"password":case"text":case"tel":case"hidden":case"textarea":(""!==n.val()||i)&&n.val("").trigger(e).trigger(t);break;case"radio":case"checkbox":n.prop("checked")&&(n.prop("checked",!1),n.trigger(e).trigger(t));break;case"select":n[0].selectedIndex>0&&(n[0].selectedIndex=0,n.trigger(e).trigger(t));break;default:console.error("Unrecognized input type found when trying to reset",this)}}))}))},T.fn.reverse=[].reverse,vo.prototype={evaluationCascadeAdditions:[],get evaluationCascade(){return[this.calc.update.bind(this.calc),this.repeats.countUpdate.bind(this.repeats),this.relevant.update.bind(this.relevant),this.output.update.bind(this.output),this.itemset.update.bind(this.itemset),this.required.update.bind(this.required),this.readonly.update.bind(this.readonly),this.validationUpdate].concat(this.evaluationCascadeAdditions)},get recordName(){return this.view.$.attr("name")},set recordName(e){this.view.$.attr("name",e)},get editStatus(){return"true"===this.view.html.dataset.edited},set editStatus(e){e&&e!==this.editStatus&&this.view.html.dispatchEvent(yt.Edited()),this.view.html.dataset.edited=e},get surveyName(){return this.view.$.find("#form-title").text()},get instanceID(){return this.model.instanceID},get deprecatedID(){return this.model.deprecatedID},get instanceName(){return this.model.instanceName},get version(){return this.model.version},get encryptionKey(){return this.view.$.data("base64rsapublickey")},get action(){return this.view.$.attr("action")},get method(){return this.view.$.attr("method")},get id(){return this.view.html.id},get languages(){return this.langs.languagesUsed}},vo.prototype.addModule=function(e){return Object.create(e,{form:{value:this}})},vo.prototype.init=function(){let e=[];const t=this;if(this.toc=this.addModule(fi),this.pages=this.addModule(gi),this.langs=this.addModule(uo),this.progress=this.addModule(vi),this.widgets=this.addModule(lo),this.preloads=this.addModule(co),this.relevant=this.addModule(mi),this.repeats=this.addModule(pi),this.input=this.addModule(ui),this.output=this.addModule(ho),this.itemset=this.addModule(hi),this.calc=this.addModule(po),this.required=this.addModule(fo),this.mask=this.addModule(go),this.readonly=this.addModule(mo),this.model.events.addEventListener(yt.InstanceFirstLoad().type,e=>this.calc.setValue(e)),this.view.html.addEventListener(yt.NewRepeat().type,e=>this.calc.setValue(e)),this.view.html.addEventListener(yt.XFormsValueChanged().type,e=>this.calc.setValue(e)),this.model.events.addEventListener(yt.DataUpdate().type,e=>{t.view.html.dispatchEvent(yt.DataUpdate(e.detail))}),this.model.events.addEventListener(yt.Removed().type,e=>{t.view.html.dispatchEvent(yt.Removed(e.detail))}),e=e.concat(this.model.init()),void 0===this.model||!(this.model instanceof si))return e.push("Form could not be initialized without a model."),e;try{this.preloads.init(),this.view.$.data({instanceID:this.model.instanceID}),this.grosslyViolateStandardComplianceByIgnoringCertainCalcs(),this.calc.update(),this.langs.init(this.options.language),this.pages.init();const n=e=>this.calc.update(e.detail),i=()=>this.all={};return this.view.html.addEventListener(yt.AddRepeat().type,n),this.view.html.addEventListener(yt.RemoveRepeat().type,i),this.repeatsInitialized=!0,this.repeats.init(),this.view.html.removeEventListener(yt.AddRepeat().type,n),this.view.html.removeEventListener(yt.RemoveRepeat().type,i),this.output.update(),this.itemset.update(),this.setAllVals(),this.readonly.update(),this.options.input=this.input,this.options.pathToAbsolute=this.pathToAbsolute.bind(this),this.options.evaluate=this.model.evaluate.bind(this.model),this.options.formClasses=function(e){const t=[];for(let n=e.length>>>0;n--;)t[n]=e[n];return t}(this.view.html.classList),this.options.getModelValue=this.getModelValue.bind(this),this.widgetsInitialized=this.widgets.init(null,this.options),this.relevant.update(),this.setEventHandlers(),this.calc.update(),this.required.update(),this.mask.init(),this.editStatus=!1,!1!==this.options.printRelevantOnly&&this.view.$.addClass("print-relevant-only"),setTimeout(()=>{t.progress.update()},0),this.initialized=!0,e}catch(t){console.error(t),e.push(`${t.name}: ${t.message}`)}return document.querySelector("body").scrollIntoView(),e},vo.prototype.goTo=function(e){const t=[];return this.goToTarget(this.getGoToTarget(e))||t.push(dt("alert.gotonotfound.msg",{path:e.substring(e.lastIndexOf("/")+1)})),t},vo.prototype.getDataStr=function(e){return!1===(e="object"!=typeof e||null===e?{}:e).irrelevant?this.getDataStrWithoutIrrelevantNodes():this.model.getStr()},vo.prototype.resetView=function(){return this.langs.formLanguages&&this.langs.formLanguages.remove(),this.view.html.replaceWith(this.view.clone),document.querySelector("form.or")},vo.prototype.replaceChoiceNameFn=function(e,t,n,i,r){return d(e,"jr:choice-name").forEach(o=>{const a=o[1];if(2!==a.length)throw new Un("jr:choice-name function has incorrect number of parameters: "+o[0]);{let s="";const l=this.model.evaluate(a[0],t,n,i,r),u=p(a[1]).trim(),c=[...this.view.html.querySelectorAll(`[name="${u.startsWith("/")?u:y(n,u)}"]`)],h=c.length?c[0].nodeName.toLowerCase():null;if(l&&c.length){if("select"===h){const e=c.filter(e=>e.querySelector(`[value="${l}"]`));s=e?e[0].querySelector(`[value="${l}"]`).textContent:""}else if("input"===h){const e=c[0].getAttribute("list");if(e){const t=An(c[0],"datalist#"+e);if(t.length){const e=t[0].querySelector(`[data-value="${l}"]`);s=e?e.getAttribute("value"):""}}else{const e=An(c.filter(e=>e.getAttribute("value")===l)[0],".option-label.active");s=e.length?e[0].textContent:""}}}else s="";e=e.replace(o[0],`"${s}"`)}}),e},vo.prototype.setAllVals=function(e,t){const n=this,i=e&&e.attr("name")?e.attr("name"):null;t=void 0!==t?t:null,this.model.node(i,t).getElements().reduce((e,t)=>{const n=[...t.querySelectorAll("*")].filter(e=>0===e.children.length&&e.textContent);return e.concat(n)},[]).forEach(e=>{try{var t=e.textContent,i=Rn(e,"instance");const r=n.model.node(i).getElements().indexOf(e),o=n.input.find(i,r);o&&(n.input.setVal(o,t,null),"binary"===n.input.getXmlType(o)&&t.startsWith("jr://")&&e.getAttribute("src")&&o.setAttribute("data-loaded-url",e.getAttribute("src")))}catch(e){throw console.error(e),new Error(`Could not load input field value with name: ${i} and value: ${t}`)}})},vo.prototype.getModelValue=function(e){const t=e[0],n=this.input.getName(t),i=this.input.getIndex(t);return this.model.node(n,i).getVal()},vo.prototype.getRelatedNodes=function(e,t,n){let i,r,o=null,a=[];const s=this;if(n=n||{},t=t||"",this.nonRepeats[e]||(r=[...this.view.html.querySelectorAll(`:not(.or-repeat-info)[${e}]`)].filter(e=>!e.closest(".or-repeat")),this.nonRepeats[e]=this.filterRadioCheckSiblings(r)),void 0!==n.repeatPath&&n.repeatIndex>=0){const t=[...this.view.html.querySelectorAll(`.or-repeat[name="${n.repeatPath}"]`)][n.repeatIndex];r=t?[...t.querySelectorAll(`[${e}]`)]:[],o=this.filterRadioCheckSiblings(r)}!this.all[e]||n.repeatPath&&!n.cloned?this.all[e]=this.repeatsInitialized?this.filterRadioCheckSiblings([...this.view.html.querySelectorAll(`[${e}]`)]):this.nonRepeats[e]:n.cloned&&o&&(this.all[e]=this.all[e].concat(o)),i=o?this.nonRepeats[e].concat(o):this.all[e],n.nodes&&0!==n.nodes.length?(n.nodes.forEach(n=>{a=a.concat(s.getQuerySelectorsForLogic(t,e,n))}),a=a.concat(s.getQuerySelectorsForLogic(t,e,"*"))):a=a.concat([t]);const l=a.join(", ");return i=l?i.filter(e=>e.matches(l)):i,T(i)},vo.prototype.filterRadioCheckSiblings=e=>{const t=[];return e.filter(e=>{const n="radio"===e.type||"checkbox"===e.type?Pn(e,".option-wrapper",".question"):null;if(n){if(-1!==t.indexOf(n))return!1;t.push(n)}return!0})},vo.prototype.getQuerySelectorsForLogic=(e,t,n)=>[`${e}[${t}*="/${n} "]`,`${e}[${t}*="/${n})"]`,`${e}[${t}*="/${n},"]`,`${e}[${t}$="/${n}"]`,`${e}[${t}*="/${n}]"]`,`${e}[${t}*="/${n}["]`],vo.prototype.getDataStrWithoutIrrelevantNodes=function(){const e=this,t=new si(this.model.getStr());return t.init(),this.getRelatedNodes("data-relevant").reverse().each((function(){const n=T(this),i=e.input.getRelevant(this),r=e.input.getIndex(this),o=e.input.getName(this);let a;a=n.children(`.or-repeat-info[data-name="${o}"]`).length&&!n.children(`.or-repeat[name="${o}"]`).length?null:o,a&&!e.model.evaluate(i,"boolean",a,r)&&t.node(a,r).remove()})),t.getStr()},vo.prototype.grosslyViolateStandardComplianceByIgnoringCertainCalcs=function(){const e=this.view.$.find('[name$="instanceID"][data-calculate]');e.length>0&&e.removeAttr("data-calculate")},vo.prototype.validationUpdate=function(e){let t;const n=this;let i;!0===a.validateContinuously&&(i=e||{},e.cloned&&(i={nodes:e.repeatPath.split("/").reverse().slice(0,1)}),t=this.getRelatedNodes("data-constraint","",i).add(this.getRelatedNodes("data-required","",i)),t.each((function(){n.validateInput(this)})))},vo.prototype.setEventHandlers=function(){const e=this;this.view.$.attr("onsubmit","return false;"),this.view.$.on("change.file","input:not(.ignore), select:not(.ignore), textarea:not(.ignore)",(function(){const t=this,n={path:e.input.getName(t),inputType:e.input.getInputType(t),xmlType:e.input.getXmlType(t),val:e.input.getVal(t),index:e.input.getIndex(t)};n.val.length>0&&"file"===n.inputType&&t.files[0]&&t.files[0].size>0&&(n.val=f(t.files[0],t.dataset.filenamePostfix)),n.val.length>0&&"drawing"===n.inputType&&(n.val=f({name:n.val},t.dataset.filenamePostfix));e.model.node(n.path,n.index).setVal(n.val,n.xmlType)&&e.validateInput(t).then(()=>{t.dispatchEvent(yt.XFormsValueChanged({repeatIndex:n.index}))})})),this.view.html.addEventListener("focusin",e=>{this.progress.update(e.target)}),this.view.html.addEventListener(yt.FakeFocus().type,e=>{this.progress.update(e.target)}),this.model.events.addEventListener(yt.DataUpdate().type,t=>{e.evaluationCascade.forEach(n=>{n.call(e,t.detail)},!0),e.editStatus=!0}),this.view.html.addEventListener(yt.AddRepeat().type,t=>{const n=T(t.target);this.setAllVals(n,t.detail.repeatIndex),this.evaluationCascade.forEach(n=>{n.call(e,t.detail)}),this.progress.update()}),this.view.html.addEventListener(yt.RemoveRepeat().type,()=>{this.progress.update()}),this.view.html.addEventListener(yt.ChangeLanguage().type,()=>{this.output.update()}),this.view.$.find(".or-group > h4").on("click",(function(){T(this).closest(".or-group").toggleClass("or-appearance-compact").trigger("resize")}))},vo.prototype.setValid=function(e,t){const n=t?["invalid-"+t]:["invalid-constraint","invalid-required","invalid-relevant"];this.input.getWrapNode(e).classList.remove(...n)},vo.prototype.setInvalid=function(e,t){t=t||"constraint",!1===a.validatePage&&this.isValid(e)&&this.blockPageNavigation(),this.input.getWrapNode(e).classList.add("invalid-"+t)},vo.prototype.blockPageNavigation=function(){const e=this;this.pageNavigationBlocked=!0,window.clearTimeout(this.blockPageNavigationTimeout),this.blockPageNavigationTimeout=window.setTimeout(()=>{e.pageNavigationBlocked=!1},600)},vo.prototype.isValid=function(e){if(e){const t=this.input.getWrapNode(e).classList;return!t.contains("invalid-required")&&!t.contains("invalid-constraint")&&!t.contains("invalid-relevant")}return null===this.view.html.querySelector(".invalid-required, .invalid-constraint, .invalid-relevant")},vo.prototype.clearNonRelevant=function(){this.relevant.update(null,!0)},vo.prototype.validateAll=function(){const e=this;return this.clearNonRelevant(),this.validateContent(this.view.$).then(t=>(e.view.html.dispatchEvent(yt.ValidationComplete()),t))},vo.prototype.validate=vo.prototype.validateAll,vo.prototype.validateContent=function(e){let t;const n=this;e.find("fieldset:disabled input, fieldset:disabled select, fieldset:disabled textarea, input:disabled, select:disabled, textarea:disabled").each((function(){n.setValid(this)}));const i=e.find(".question").addBack(".question").map((function(){const e=this.querySelector("input:not(.ignore):not(:disabled), select:not(.ignore):not(:disabled), textarea:not(.ignore):not(:disabled)");return e?n.validateInput(e):Promise.resolve()})).toArray();return Promise.all(i).then(()=>(t=e.find(".invalid-required, .invalid-constraint, .invalid-relevant").addBack(".invalid-required, .invalid-constraint, .invalid-relevant").eq(0),t.length>0&&n.goToTarget(t[0]),0===t.length)).catch(()=>!1)},vo.prototype.pathToAbsolute=function(e,t){let n;return 0===e.indexOf("/")?e:(n=this.model.evaluate(e,"node",t,0,!0),Rn(n,"instance",!1))},vo.prototype.validateInput=function(e){if(!this.initialized)return Promise.resolve();const t=this;let n;const i={path:this.input.getName(e),inputType:this.input.getInputType(e),xmlType:this.input.getXmlType(e),enabled:this.input.isEnabled(e),constraint:this.input.getConstraint(e),calculation:this.input.getCalculation(e),required:this.input.getRequired(e),readonly:this.input.getReadonly(e),val:this.input.getVal(e)};return!i.readonly||i.val||i.required||i.constraint||i.calculation?(i.enabled&&"hidden"!==i.inputType?(i.ind=this.input.getIndex(e),n=this.model.node(i.path,i.ind).validate(i.constraint,i.required,i.xmlType)):n=Promise.resolve({requiredValid:!0,constraintValid:!0}),n.then(n=>{let r=!1;const o=!1!==n.requiredValid&&!1!==n.constraintValid;return"hidden"!==i.inputType&&(i.q=t.input.getWrapNode(e),r=i.q.classList.contains("invalid-required")||i.q.classList.contains("invalid-constraint"),!1===n.requiredValid?(t.setValid(e,"constraint"),t.setInvalid(e,"required")):!1===n.constraintValid?(t.setValid(e,"required"),t.setInvalid(e,"constraint")):(t.setValid(e,"constraint"),t.setValid(e,"required"))),o||r||e.dispatchEvent(yt.Invalidated()),o}).catch(n=>{throw console.error("validation error",n),t.setInvalid(e,"constraint"),n})):Promise.resolve()},vo.prototype.getGoToTarget=function(e){let t,n,i,r,o="";const a=/([^[]+)\[(\d+)\]([^[]*$)?/g;if(e&&(n=this.model.node(e).getElement(),n)){if(e=Rn(n,"instance",!0),i=this.view.html.querySelector(`[name="${e}"]`),!i)for(r=this.view.html;null!==(t=a.exec(e))&&r;)o+=t[1],r=r.querySelectorAll(`[name="${o}"], [data-name="${o}"]`)[t[2]],r&&t[3]&&(o+=t[3],r=r.querySelector(`[name="${o}"],[data-name="${o}"]`)),i=r;return i?this.input.getWrapNode(i):i}},vo.prototype.goToTarget=function(e){if(e){this.pages.active&&this.pages.flipToPageContaining(T(e)),e.closest(".calculation, .setvalue")&&e.dispatchEvent(yt.GoToInvisible()),e.closest(".or-branch.disabled")&&e.dispatchEvent(yt.GoToIrrelevant()),e.scrollIntoView();const t=e.querySelector("input:not(.ignore), textarea:not(.ignore), select:not(.ignore)");t.focus(),t.dispatchEvent(yt.ApplyFocus())}return!!e},vo.requiredTransformerVersion="1.40.3";var yo=[],_o=[],bo="undefined"!=typeof Uint8Array?Uint8Array:Array,wo=!1;function Eo(){wo=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;t<n;++t)yo[t]=e[t],_o[e.charCodeAt(t)]=t;_o["-".charCodeAt(0)]=62,_o["_".charCodeAt(0)]=63}function Co(e,t,n){for(var i,r,o=[],a=t;a<n;a+=3)i=(e[a]<<16)+(e[a+1]<<8)+e[a+2],o.push(yo[(r=i)>>18&63]+yo[r>>12&63]+yo[r>>6&63]+yo[63&r]);return o.join("")}function So(e){var t;wo||Eo();for(var n=e.length,i=n%3,r="",o=[],a=0,s=n-i;a<s;a+=16383)o.push(Co(e,a,a+16383>s?s:a+16383));return 1===i?(t=e[n-1],r+=yo[t>>2],r+=yo[t<<4&63],r+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],r+=yo[t>>10],r+=yo[t>>4&63],r+=yo[t<<2&63],r+="="),o.push(r),o.join("")}function ko(e,t,n,i,r){var o,a,s=8*r-i-1,l=(1<<s)-1,u=l>>1,c=-7,h=n?r-1:0,d=n?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+e[t+h],h+=d,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=i;c>0;a=256*a+e[t+h],h+=d,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,i),o-=u}return(p?-1:1)*a*Math.pow(2,o-i)}function To(e,t,n,i,r,o){var a,s,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(t*l-1)*Math.pow(2,r),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,r),a=0));r>=8;e[n+p]=255&s,p+=f,s/=256,r-=8);for(a=a<<r|s,u+=r;u>0;e[n+p]=255&a,p+=f,a/=256,u-=8);e[n+p-f]|=128*g}var xo={}.toString,Lo=Array.isArray||function(e){return"[object Array]"==xo.call(e)};function Io(){return Do.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Ao(e,t){if(Io()<t)throw new RangeError("Invalid typed array length");return Do.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Do.prototype:(null===e&&(e=new Do(t)),e.length=t),e}function Do(e,t,n){if(!(Do.TYPED_ARRAY_SUPPORT||this instanceof Do))return new Do(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Bo(this,e)}return No(this,e,t,n)}function No(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i);Do.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Do.prototype:e=Ro(e,t);return e}(e,t,n,i):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!Do.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|Uo(t,n),r=(e=Ao(e,i)).write(t,n);r!==i&&(e=e.slice(0,r));return e}(e,t,n):function(e,t){if(Oo(t)){var n=0|Mo(t.length);return 0===(e=Ao(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?Ao(e,0):Ro(e,t);if("Buffer"===t.type&&Lo(t.data))return Ro(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function Po(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Bo(e,t){if(Po(t),e=Ao(e,t<0?0:0|Mo(t)),!Do.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function Ro(e,t){var n=t.length<0?0:0|Mo(t.length);e=Ao(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function Mo(e){if(e>=Io())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Io().toString(16)+" bytes");return 0|e}function Oo(e){return!(null==e||!e._isBuffer)}function Uo(e,t){if(Oo(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return ca(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return ha(e).length;default:if(i)return ca(e).length;t=(""+t).toLowerCase(),i=!0}}function zo(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Jo(this,t,n);case"utf8":case"utf-8":return Yo(this,t,n);case"ascii":return Xo(this,t,n);case"latin1":case"binary":return Qo(this,t,n);case"base64":return Zo(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ea(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function Fo(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function Vo(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=Do.from(t,i)),Oo(t))return 0===t.length?-1:qo(e,t,n,i,r);if("number"==typeof t)return t&=255,Do.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):qo(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function qo(e,t,n,i,r){var o,a=1,s=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var c=-1;for(o=n;o<s;o++)if(u(e,o)===u(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(n+l>s&&(n=s-l),o=n;o>=0;o--){for(var h=!0,d=0;d<l;d++)if(u(e,o+d)!==u(t,d)){h=!1;break}if(h)return o}return-1}function jo(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var a=0;a<i;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function $o(e,t,n,i){return da(ca(t,e.length-n),e,n,i)}function Ho(e,t,n,i){return da(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function Wo(e,t,n,i){return Ho(e,t,n,i)}function Ko(e,t,n,i){return da(ha(t),e,n,i)}function Go(e,t,n,i){return da(function(e,t){for(var n,i,r,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),i=n>>8,r=n%256,o.push(r),o.push(i);return o}(t,e.length-n),e,n,i)}function Zo(e,t,n){return 0===t&&n===e.length?So(e):So(e.slice(t,n))}function Yo(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o,a,s,l,u=e[r],c=null,h=u>239?4:u>223?3:u>191?2:1;if(r+h<=n)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(o=e[r+1]))&&(l=(31&u)<<6|63&o)>127&&(c=l);break;case 3:o=e[r+1],a=e[r+2],128==(192&o)&&128==(192&a)&&(l=(15&u)<<12|(63&o)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=e[r+1],a=e[r+2],s=e[r+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),r+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=4096));return n}(i)}Do.TYPED_ARRAY_SUPPORT=void 0===Ae.TYPED_ARRAY_SUPPORT||Ae.TYPED_ARRAY_SUPPORT,Do.poolSize=8192,Do._augment=function(e){return e.__proto__=Do.prototype,e},Do.from=function(e,t,n){return No(null,e,t,n)},Do.TYPED_ARRAY_SUPPORT&&(Do.prototype.__proto__=Uint8Array.prototype,Do.__proto__=Uint8Array),Do.alloc=function(e,t,n){return function(e,t,n,i){return Po(t),t<=0?Ao(e,t):void 0!==n?"string"==typeof i?Ao(e,t).fill(n,i):Ao(e,t).fill(n):Ao(e,t)}(null,e,t,n)},Do.allocUnsafe=function(e){return Bo(null,e)},Do.allocUnsafeSlow=function(e){return Bo(null,e)},Do.isBuffer=pa,Do.compare=function(e,t){if(!Oo(e)||!Oo(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},Do.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Do.concat=function(e,t){if(!Lo(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Do.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=Do.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var o=e[n];if(!Oo(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},Do.byteLength=Uo,Do.prototype._isBuffer=!0,Do.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Fo(this,t,t+1);return this},Do.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Fo(this,t,t+3),Fo(this,t+1,t+2);return this},Do.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Fo(this,t,t+7),Fo(this,t+1,t+6),Fo(this,t+2,t+5),Fo(this,t+3,t+4);return this},Do.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?Yo(this,0,e):zo.apply(this,arguments)},Do.prototype.equals=function(e){if(!Oo(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Do.compare(this,e)},Do.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Do.prototype.compare=function(e,t,n,i,r){if(!Oo(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(i>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),l=this.slice(i,r),u=e.slice(t,n),c=0;c<s;++c)if(l[c]!==u[c]){o=l[c],a=u[c];break}return o<a?-1:a<o?1:0},Do.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},Do.prototype.indexOf=function(e,t,n){return Vo(this,e,t,n,!0)},Do.prototype.lastIndexOf=function(e,t,n){return Vo(this,e,t,n,!1)},Do.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return jo(this,e,t,n);case"utf8":case"utf-8":return $o(this,e,t,n);case"ascii":return Ho(this,e,t,n);case"latin1":case"binary":return Wo(this,e,t,n);case"base64":return Ko(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Go(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},Do.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Xo(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function Qo(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function Jo(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=t;o<n;++o)r+=ua(e[o]);return r}function ea(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function ta(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function na(e,t,n,i,r,o){if(!Oo(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function ia(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-n,2);r<o;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function ra(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-n,4);r<o;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function oa(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function aa(e,t,n,i,r){return r||oa(e,0,n,4),To(e,t,n,i,23,4),n+4}function sa(e,t,n,i,r){return r||oa(e,0,n,8),To(e,t,n,i,52,8),n+8}Do.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),Do.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=Do.prototype;else{var r=t-e;n=new Do(r,void 0);for(var o=0;o<r;++o)n[o]=this[o+e]}return n},Do.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||ta(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},Do.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||ta(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},Do.prototype.readUInt8=function(e,t){return t||ta(e,1,this.length),this[e]},Do.prototype.readUInt16LE=function(e,t){return t||ta(e,2,this.length),this[e]|this[e+1]<<8},Do.prototype.readUInt16BE=function(e,t){return t||ta(e,2,this.length),this[e]<<8|this[e+1]},Do.prototype.readUInt32LE=function(e,t){return t||ta(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Do.prototype.readUInt32BE=function(e,t){return t||ta(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Do.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||ta(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},Do.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||ta(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},Do.prototype.readInt8=function(e,t){return t||ta(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Do.prototype.readInt16LE=function(e,t){t||ta(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},Do.prototype.readInt16BE=function(e,t){t||ta(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},Do.prototype.readInt32LE=function(e,t){return t||ta(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Do.prototype.readInt32BE=function(e,t){return t||ta(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Do.prototype.readFloatLE=function(e,t){return t||ta(e,4,this.length),ko(this,e,!0,23,4)},Do.prototype.readFloatBE=function(e,t){return t||ta(e,4,this.length),ko(this,e,!1,23,4)},Do.prototype.readDoubleLE=function(e,t){return t||ta(e,8,this.length),ko(this,e,!0,52,8)},Do.prototype.readDoubleBE=function(e,t){return t||ta(e,8,this.length),ko(this,e,!1,52,8)},Do.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||na(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},Do.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||na(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},Do.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||na(this,e,t,1,255,0),Do.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Do.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||na(this,e,t,2,65535,0),Do.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):ia(this,e,t,!0),t+2},Do.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||na(this,e,t,2,65535,0),Do.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):ia(this,e,t,!1),t+2},Do.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||na(this,e,t,4,4294967295,0),Do.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):ra(this,e,t,!0),t+4},Do.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||na(this,e,t,4,4294967295,0),Do.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):ra(this,e,t,!1),t+4},Do.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);na(this,e,t,n,r-1,-r)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},Do.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);na(this,e,t,n,r-1,-r)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},Do.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||na(this,e,t,1,127,-128),Do.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Do.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||na(this,e,t,2,32767,-32768),Do.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):ia(this,e,t,!0),t+2},Do.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||na(this,e,t,2,32767,-32768),Do.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):ia(this,e,t,!1),t+2},Do.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||na(this,e,t,4,2147483647,-2147483648),Do.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):ra(this,e,t,!0),t+4},Do.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||na(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Do.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):ra(this,e,t,!1),t+4},Do.prototype.writeFloatLE=function(e,t,n){return aa(this,e,t,!0,n)},Do.prototype.writeFloatBE=function(e,t,n){return aa(this,e,t,!1,n)},Do.prototype.writeDoubleLE=function(e,t,n){return sa(this,e,t,!0,n)},Do.prototype.writeDoubleBE=function(e,t,n){return sa(this,e,t,!1,n)},Do.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,o=i-n;if(this===e&&n<t&&t<i)for(r=o-1;r>=0;--r)e[r+t]=this[r+n];else if(o<1e3||!Do.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},Do.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!Do.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=Oo(e)?e:ca(new Do(e,i).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var la=/[^+\/0-9A-Za-z-_]/g;function ua(e){return e<16?"0"+e.toString(16):e.toString(16)}function ca(e,t){var n;t=t||1/0;for(var i=e.length,r=null,o=[],a=0;a<i;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function ha(e){return function(e){var t,n,i,r,o,a;wo||Eo();var s=e.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[s-2]?2:"="===e[s-1]?1:0,a=new bo(3*s/4-o),i=o>0?s-4:s;var l=0;for(t=0,n=0;t<i;t+=4,n+=3)r=_o[e.charCodeAt(t)]<<18|_o[e.charCodeAt(t+1)]<<12|_o[e.charCodeAt(t+2)]<<6|_o[e.charCodeAt(t+3)],a[l++]=r>>16&255,a[l++]=r>>8&255,a[l++]=255&r;return 2===o?(r=_o[e.charCodeAt(t)]<<2|_o[e.charCodeAt(t+1)]>>4,a[l++]=255&r):1===o&&(r=_o[e.charCodeAt(t)]<<10|_o[e.charCodeAt(t+1)]<<4|_o[e.charCodeAt(t+2)]>>2,a[l++]=r>>8&255,a[l++]=255&r),a}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(la,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function da(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function pa(e){return null!=e&&(!!e._isBuffer||fa(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&fa(e.slice(0,0))}(e))}function fa(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function ga(){}function ma(){ma.init.call(this)}function va(e){return void 0===e._maxListeners?ma.defaultMaxListeners:e._maxListeners}function ya(e,t,n){if(t)e.call(n);else for(var i=e.length,r=Ta(e,i),o=0;o<i;++o)r[o].call(n)}function _a(e,t,n,i){if(t)e.call(n,i);else for(var r=e.length,o=Ta(e,r),a=0;a<r;++a)o[a].call(n,i)}function ba(e,t,n,i,r){if(t)e.call(n,i,r);else for(var o=e.length,a=Ta(e,o),s=0;s<o;++s)a[s].call(n,i,r)}function wa(e,t,n,i,r,o){if(t)e.call(n,i,r,o);else for(var a=e.length,s=Ta(e,a),l=0;l<a;++l)s[l].call(n,i,r,o)}function Ea(e,t,n,i){if(t)e.apply(n,i);else for(var r=e.length,o=Ta(e,r),a=0;a<r;++a)o[a].apply(n,i)}function Ca(e,t,n,i){var r,o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=new ga,e._eventsCount=0),a){if("function"==typeof a?a=o[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),!a.warned&&(r=va(e))&&r>0&&a.length>r){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,s=l,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=o[t]=n,++e._eventsCount;return e}function Sa(e,t,n){var i=!1;function r(){e.removeListener(t,r),i||(i=!0,n.apply(e,arguments))}return r.listener=n,r}function ka(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Ta(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}ga.prototype=Object.create(null),ma.EventEmitter=ma,ma.usingDomains=!1,ma.prototype.domain=void 0,ma.prototype._events=void 0,ma.prototype._maxListeners=void 0,ma.defaultMaxListeners=10,ma.init=function(){this.domain=null,ma.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new ga,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ma.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},ma.prototype.getMaxListeners=function(){return va(this)},ma.prototype.emit=function(e){var t,n,i,r,o,a,s,l="error"===e;if(a=this._events)l=l&&null==a.error;else if(!l)return!1;if(s=this.domain,l){if(t=arguments[1],!s){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=a[e]))return!1;var c="function"==typeof n;switch(i=arguments.length){case 1:ya(n,c,this);break;case 2:_a(n,c,this,arguments[1]);break;case 3:ba(n,c,this,arguments[1],arguments[2]);break;case 4:wa(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];Ea(n,c,this,r)}return!0},ma.prototype.addListener=function(e,t){return Ca(this,e,t,!1)},ma.prototype.on=ma.prototype.addListener,ma.prototype.prependListener=function(e,t){return Ca(this,e,t,!0)},ma.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Sa(this,e,t)),this},ma.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Sa(this,e,t)),this},ma.prototype.removeListener=function(e,t){var n,i,r,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new ga:(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=n[o].listener,r=o;break}if(r<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new ga,this;delete i[e]}else!function(e,t){for(var n=t,i=n+1,r=e.length;i<r;n+=1,i+=1)e[n]=e[i];e.pop()}(n,r);i.removeListener&&this.emit("removeListener",e,a||t)}return this},ma.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new ga,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new ga:delete n[e]),this;if(0===arguments.length){for(var i,r=Object.keys(n),o=0;o<r.length;++o)"removeListener"!==(i=r[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new ga,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},ma.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},ma.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):ka.call(e,t)},ma.prototype.listenerCount=ka,ma.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var xa="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},La=/%[sdj%]/g;function Ia(e){if(!Va(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(Pa(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,r=i.length,o=String(e).replace(La,(function(e){if("%%"===e)return"%";if(n>=r)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}})),a=i[n];n<r;a=i[++n])Fa(a)||!$a(a)?o+=" "+a:o+=" "+Pa(a);return o}function Aa(e,t){if(qa(Ae.process))return function(){return Aa(e,t).apply(this,arguments)};var n=!1;return function(){return n||(console.error(t),n=!0),e.apply(this,arguments)}}var Da,Na={};function Pa(e,t){var n={seen:[],stylize:Ra};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),za(t)?n.showHidden=t:t&&Za(n,t),qa(n.showHidden)&&(n.showHidden=!1),qa(n.depth)&&(n.depth=2),qa(n.colors)&&(n.colors=!1),qa(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=Ba),Ma(n,e,n.depth)}function Ba(e,t){var n=Pa.styles[t];return n?"["+Pa.colors[n][0]+"m"+e+"["+Pa.colors[n][1]+"m":e}function Ra(e,t){return e}function Ma(e,t,n){if(e.customInspect&&t&&Ka(t.inspect)&&t.inspect!==Pa&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return Va(i)||(i=Ma(e,i,n)),i}var r=function(e,t){if(qa(t))return e.stylize("undefined","undefined");if(Va(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(i=t,"number"==typeof i)return e.stylize(""+t,"number");var i;if(za(t))return e.stylize(""+t,"boolean");if(Fa(t))return e.stylize("null","null")}(e,t);if(r)return r;var o=Object.keys(t),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),Wa(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return Oa(t);if(0===o.length){if(Ka(t)){var s=t.name?": "+t.name:"";return e.stylize("[Function"+s+"]","special")}if(ja(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(Ha(t))return e.stylize(Date.prototype.toString.call(t),"date");if(Wa(t))return Oa(t)}var l,u,c="",h=!1,d=["{","}"];(l=t,Array.isArray(l)&&(h=!0,d=["[","]"]),Ka(t))&&(c=" [Function"+(t.name?": "+t.name:"")+"]");return ja(t)&&(c=" "+RegExp.prototype.toString.call(t)),Ha(t)&&(c=" "+Date.prototype.toUTCString.call(t)),Wa(t)&&(c=" "+Oa(t)),0!==o.length||h&&0!=t.length?n<0?ja(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=h?function(e,t,n,i,r){for(var o=[],a=0,s=t.length;a<s;++a)Ya(t,String(a))?o.push(Ua(e,t,n,i,String(a),!0)):o.push("");return r.forEach((function(r){r.match(/^\d+$/)||o.push(Ua(e,t,n,i,r,!0))})),o}(e,t,n,a,o):o.map((function(i){return Ua(e,t,n,a,i,h)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(u,c,d)):d[0]+c+d[1]}function Oa(e){return"["+Error.prototype.toString.call(e)+"]"}function Ua(e,t,n,i,r,o){var a,s,l;if((l=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),Ya(i,r)||(a="["+r+"]"),s||(e.seen.indexOf(l.value)<0?(s=Fa(n)?Ma(e,l.value,null):Ma(e,l.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),qa(a)){if(o&&r.match(/^\d+$/))return s;(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function za(e){return"boolean"==typeof e}function Fa(e){return null===e}function Va(e){return"string"==typeof e}function qa(e){return void 0===e}function ja(e){return $a(e)&&"[object RegExp]"===Ga(e)}function $a(e){return"object"==typeof e&&null!==e}function Ha(e){return $a(e)&&"[object Date]"===Ga(e)}function Wa(e){return $a(e)&&("[object Error]"===Ga(e)||e instanceof Error)}function Ka(e){return"function"==typeof e}function Ga(e){return Object.prototype.toString.call(e)}function Za(e,t){if(!t||!$a(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e}function Ya(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Xa(){this.head=null,this.tail=null,this.length=0}Pa.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Pa.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},Xa.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},Xa.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},Xa.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},Xa.prototype.clear=function(){this.head=this.tail=null,this.length=0},Xa.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},Xa.prototype.concat=function(e){if(0===this.length)return Do.alloc(0);if(1===this.length)return this.head.data;for(var t=Do.allocUnsafe(e>>>0),n=this.head,i=0;n;)n.data.copy(t,i),i+=n.data.length,n=n.next;return t};var Qa=Do.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Ja(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!Qa(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=ts;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=ns;break;default:return void(this.write=es)}this.charBuffer=new Do(6),this.charReceived=0,this.charLength=0}function es(e){return e.toString(this.encoding)}function ts(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function ns(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}Ja.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!((r=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived);var r;i=(t+=e.toString(this.encoding,0,i)).length-1;if((r=t.charCodeAt(i))>=55296&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,i)}return t},Ja.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},Ja.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,i=this.charBuffer,r=this.encoding;t+=i.slice(0,n).toString(r)}return t},os.ReadableState=rs;var is=function(e){if(qa(Da)&&(Da=""),e=e.toUpperCase(),!Na[e])if(new RegExp("\\b"+e+"\\b","i").test(Da)){Na[e]=function(){var t=Ia.apply(null,arguments);console.error("%s %d: %s",e,0,t)}}else Na[e]=function(){};return Na[e]}("stream");function rs(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof Ns&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new Xa,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new Ja(e.encoding),this.encoding=e.encoding)}function os(e){if(!(this instanceof os))return new os(e);this._readableState=new rs(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),ma.call(this)}function as(e,t,n,i,r){var o=function(e,t){var n=null;pa(t)||"string"==typeof t||null==t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));return n}(t,n);if(o)e.emit("error",o);else if(null===n)t.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,ls(e)}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!r){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&r){var s=new Error("stream.unshift() after end event");e.emit("error",s)}else{var l;!t.decoder||r||i||(n=t.decoder.write(n),l=!t.objectMode&&0===n.length),r||(t.reading=!1),l||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&ls(e))),function(e,t){t.readingMore||(t.readingMore=!0,fn(cs,e,t))}(e,t)}else r||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}xa(os,ma),os.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=Do.from(e,t),t=""),as(this,n,e,t,!1)},os.prototype.unshift=function(e){return as(this,this._readableState,e,"",!0)},os.prototype.isPaused=function(){return!1===this._readableState.flowing},os.prototype.setEncoding=function(e){return this._readableState.decoder=new Ja(e),this._readableState.encoding=e,this};function ss(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=8388608?e=8388608:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function ls(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(is("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?fn(us,e):us(e))}function us(e){is("emit readable"),e.emit("readable"),ps(e)}function cs(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(is("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function hs(e){is("readable nexttick read 0"),e.read(0)}function ds(e,t){t.reading||(is("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),ps(e),t.flowing&&!t.reading&&e.read(0)}function ps(e){var t=e._readableState;for(is("flow",t.flowing);t.flowing&&null!==e.read(););}function fs(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var i;e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):i=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,i=1,r=n.data;e-=r.length;for(;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(a===o.length?r+=o:r+=o.slice(0,e),0===(e-=a)){a===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(a));break}++i}return t.length-=i,r}(e,t):function(e,t){var n=Do.allocUnsafe(e),i=t.head,r=1;i.data.copy(n),e-=i.data.length;for(;i=i.next;){var o=i.data,a=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,a),0===(e-=a)){a===o.length?(++r,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=o.slice(a));break}++r}return t.length-=r,n}(e,t);return i}(e,t.buffer,t.decoder),n);var n}function gs(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,fn(ms,t,e))}function ms(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function vs(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function ys(){}function _s(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function bs(e,t){Object.defineProperty(this,"buffer",{get:Aa((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof Ns&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var r=!1===e.decodeStrings;this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,r=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,r){--t.pendingcb,n?fn(r,i):r(i);e._writableState.errorEmitted=!0,e.emit("error",i)}(e,n,i,t,r);else{var o=ks(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||Ss(e,n),i?fn(Cs,e,n,o,r):Cs(e,n,o,r)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new Ls(this)}function ws(e){if(!(this instanceof ws||this instanceof Ns))return new ws(e);this._writableState=new bs(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),ma.call(this)}function Es(e,t,n,i,r,o,a){t.writelen=i,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function Cs(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),xs(e,t)}function Ss(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,r=new Array(i),o=t.corkedRequestsFree;o.entry=n;for(var a=0;n;)r[a]=n,n=n.next,a+=1;Es(e,t,!0,t.length,r,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new Ls(t)}else{for(;n;){var s=n.chunk,l=n.encoding,u=n.callback;if(Es(e,t,!1,t.objectMode?1:s.length,s,l,u),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function ks(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function Ts(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function xs(e,t){var n=ks(t);return n&&(0===t.pendingcb?(Ts(e,t),t.finished=!0,e.emit("finish")):Ts(e,t)),n}function Ls(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var i=t.entry;for(t.entry=null;i;){var r=i.callback;e.pendingcb--,r(n),i=i.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}os.prototype.read=function(e){is("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return is("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?gs(this):ls(this),null;if(0===(e=ss(e,t))&&t.ended)return 0===t.length&&gs(this),null;var i,r=t.needReadable;return is("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&is("length less than watermark",r=!0),t.ended||t.reading?is("reading or ended",r=!1):r&&(is("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=ss(n,t))),null===(i=e>0?fs(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&gs(this)),null!==i&&this.emit("data",i),i},os.prototype._read=function(e){this.emit("error",new Error("not implemented"))},os.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,is("pipe count=%d opts=%j",i.pipesCount,t);var r=!t||!1!==t.end?a:u;function o(e){is("onunpipe"),e===n&&u()}function a(){is("onend"),e.end()}i.endEmitted?fn(r):n.once("end",r),e.on("unpipe",o);var s=function(e){return function(){var t=e._readableState;is("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,ps(e))}}(n);e.on("drain",s);var l=!1;function u(){is("cleanup"),e.removeListener("close",p),e.removeListener("finish",f),e.removeListener("drain",s),e.removeListener("error",d),e.removeListener("unpipe",o),n.removeListener("end",a),n.removeListener("end",u),n.removeListener("data",h),l=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||s()}var c=!1;function h(t){is("ondata"),c=!1,!1!==e.write(t)||c||((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==vs(i.pipes,e))&&!l&&(is("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,c=!0),n.pause())}function d(t){var n;is("onerror",t),g(),e.removeListener("error",d),0===(n="error",e.listeners(n).length)&&e.emit("error",t)}function p(){e.removeListener("finish",f),g()}function f(){is("onfinish"),e.removeListener("close",p),g()}function g(){is("unpipe"),n.unpipe(e)}return n.on("data",h),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",d),e.once("close",p),e.once("finish",f),e.emit("pipe",n),i.flowing||(is("pipe resume"),n.resume()),e},os.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var r=0;r<i;r++)n[r].emit("unpipe",this);return this}var o=vs(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},os.prototype.on=function(e,t){var n=ma.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&ls(this):fn(hs,this))}return n},os.prototype.addListener=os.prototype.on,os.prototype.resume=function(){var e=this._readableState;return e.flowing||(is("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,fn(ds,e,t))}(this,e)),this},os.prototype.pause=function(){return is("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(is("pause"),this._readableState.flowing=!1,this.emit("pause")),this},os.prototype.wrap=function(e){var t=this._readableState,n=!1,i=this;for(var r in e.on("end",(function(){if(is("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&i.push(e)}i.push(null)})),e.on("data",(function(r){(is("wrapped data"),t.decoder&&(r=t.decoder.write(r)),t.objectMode&&null==r)||(t.objectMode||r&&r.length)&&(i.push(r)||(n=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));return function(e,t){for(var n=0,i=e.length;n<i;n++)t(e[n],n)}(["error","close","destroy","pause","resume"],(function(t){e.on(t,i.emit.bind(i,t))})),i._read=function(t){is("wrapped _read",t),n&&(n=!1,e.resume())},i},os._fromList=fs,ws.WritableState=bs,xa(ws,ma),bs.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},ws.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},ws.prototype.write=function(e,t,n){var i=this._writableState,r=!1;return"function"==typeof t&&(n=t,t=null),Do.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=ys),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),fn(t,n)}(this,n):function(e,t,n,i){var r=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):Do.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),fn(i,o),r=!1),r}(this,i,e,n)&&(i.pendingcb++,r=function(e,t,n,i,r){n=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=Do.from(t,n));return t}(t,n,i),Do.isBuffer(n)&&(i="buffer");var o=t.objectMode?1:n.length;t.length+=o;var a=t.length<t.highWaterMark;a||(t.needDrain=!0);if(t.writing||t.corked){var s=t.lastBufferedRequest;t.lastBufferedRequest=new _s(n,i,r),s?s.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else Es(e,t,!1,o,n,i,r);return a}(this,i,e,t,n)),r},ws.prototype.cork=function(){this._writableState.corked++},ws.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||Ss(this,e))},ws.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},ws.prototype._write=function(e,t,n){n(new Error("not implemented"))},ws.prototype._writev=null,ws.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,n){t.ending=!0,xs(e,t),n&&(t.finished?fn(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,i,n)},xa(Ns,os);for(var Is=Object.keys(ws.prototype),As=0;As<Is.length;As++){var Ds=Is[As];Ns.prototype[Ds]||(Ns.prototype[Ds]=ws.prototype[Ds])}function Ns(e){if(!(this instanceof Ns))return new Ns(e);os.call(this,e),ws.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",Ps)}function Ps(){this.allowHalfOpen||this._writableState.ended||fn(Bs,this)}function Bs(e){e.end()}function Rs(e){this.afterTransform=function(t,n){return function(e,t,n){var i=e._transformState;i.transforming=!1;var r=i.writecb;if(!r)return e.emit("error",new Error("no writecb in Transform class"));i.writechunk=null,i.writecb=null,null!=n&&e.push(n);r(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function Ms(e){if(!(this instanceof Ms))return new Ms(e);Ns.call(this,e),this._transformState=new Rs(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e){Os(t,e)})):Os(t)}))}function Os(e,t){if(t)return e.emit("error",t);var n=e._writableState,i=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function Us(e){if(!(this instanceof Us))return new Us(e);Ms.call(this,e)}function zs(){ma.call(this)}xa(Ms,Ns),Ms.prototype.push=function(e,t){return this._transformState.needTransform=!1,Ns.prototype.push.call(this,e,t)},Ms.prototype._transform=function(e,t,n){throw new Error("Not implemented")},Ms.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},Ms.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},xa(Us,Ms),Us.prototype._transform=function(e,t,n){n(null,e)},xa(zs,ma),zs.Readable=os,zs.Writable=ws,zs.Duplex=Ns,zs.Transform=Ms,zs.PassThrough=Us,zs.Stream=zs,zs.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function r(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",r),e._isStdio||t&&!1===t.end||(n.on("end",a),n.on("close",s));var o=!1;function a(){o||(o=!0,e.end())}function s(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function l(e){if(u(),0===ma.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",i),e.removeListener("drain",r),n.removeListener("end",a),n.removeListener("close",s),n.removeListener("error",l),e.removeListener("error",l),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",l),e.on("error",l),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e};var Fs,Vs,qs=zs,js=u((function(e,t){if(t.base64=!0,t.array=!0,t.string=!0,t.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,t.nodebuffer=void 0!==Do,t.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)t.blob=!1;else{var n=new ArrayBuffer(0);try{t.blob=0===new Blob([n],{type:"application/zip"}).size}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(n),t.blob=0===i.getBlob("application/zip").size}catch(e){t.blob=!1}}}try{t.nodestream=!!qs.Readable}catch(e){t.nodestream=!1}})),$s=(js.base64,js.array,js.string,js.arraybuffer,js.nodebuffer,js.uint8array,js.blob,js.nodestream,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Hs=function(e){for(var t,n,i,r,o,a,s,l=[],u=0,c=e.length,h=c,d="string"!==bl.getTypeOf(e);u<e.length;)h=c-u,d?(t=e[u++],n=u<c?e[u++]:0,i=u<c?e[u++]:0):(t=e.charCodeAt(u++),n=u<c?e.charCodeAt(u++):0,i=u<c?e.charCodeAt(u++):0),r=t>>2,o=(3&t)<<4|n>>4,a=h>1?(15&n)<<2|i>>6:64,s=h>2?63&i:64,l.push($s.charAt(r)+$s.charAt(o)+$s.charAt(a)+$s.charAt(s));return l.join("")},Ws=function(e){var t,n,i,r,o,a,s=0,l=0;if("data:"===e.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var u,c=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===$s.charAt(64)&&c--,e.charAt(e.length-2)===$s.charAt(64)&&c--,c%1!=0)throw new Error("Invalid base64 input, bad content length.");for(u=js.uint8array?new Uint8Array(0|c):new Array(0|c);s<e.length;)t=$s.indexOf(e.charAt(s++))<<2|(r=$s.indexOf(e.charAt(s++)))>>4,n=(15&r)<<4|(o=$s.indexOf(e.charAt(s++)))>>2,i=(3&o)<<6|(a=$s.indexOf(e.charAt(s++))),u[l++]=t,64!==o&&(u[l++]=n),64!==a&&(u[l++]=i);return u},Ks=void 0!==Do,Gs=function(e,t){if(Do.from&&Do.from!==Uint8Array.from)return Do.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Do(e,t)},Zs=function(e){if(Do.alloc)return Do.alloc(e);var t=new Do(e);return t.fill(0),t},Ys=function(e){return pa(e)},Xs=function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume},Qs="function"==typeof setImmediate?setImmediate:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)},Js=s.MutationObserver||s.WebKitMutationObserver;if(Js){var el=0,tl=new Js(ol),nl=s.document.createTextNode("");tl.observe(nl,{characterData:!0}),Fs=function(){nl.data=el=++el%2}}else if(s.setImmediate||void 0===s.MessageChannel)Fs="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var e=s.document.createElement("script");e.onreadystatechange=function(){ol(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},s.document.documentElement.appendChild(e)}:function(){setTimeout(ol,0)};else{var il=new s.MessageChannel;il.port1.onmessage=ol,Fs=function(){il.port2.postMessage(0)}}var rl=[];function ol(){var e,t;Vs=!0;for(var n=rl.length;n;){for(t=rl,rl=[],e=-1;++e<n;)t[e]();n=rl.length}Vs=!1}var al=function(e){1!==rl.push(e)||Vs||Fs()};function sl(){}var ll={},ul=["REJECTED"],cl=["FULFILLED"],hl=["PENDING"],dl=pl;function pl(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=hl,this.queue=[],this.outcome=void 0,e!==sl&&vl(this,e)}function fl(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function gl(e,t,n){al((function(){var i;try{i=t(n)}catch(t){return ll.reject(e,t)}i===e?ll.reject(e,new TypeError("Cannot resolve promise with itself")):ll.resolve(e,i)}))}function ml(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function vl(e,t){var n=!1;function i(t){n||(n=!0,ll.reject(e,t))}function r(t){n||(n=!0,ll.resolve(e,t))}var o=yl((function(){t(r,i)}));"error"===o.status&&i(o.value)}function yl(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}pl.prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){throw n}))}))},pl.prototype.catch=function(e){return this.then(null,e)},pl.prototype.then=function(e,t){if("function"!=typeof e&&this.state===cl||"function"!=typeof t&&this.state===ul)return this;var n=new this.constructor(sl);this.state!==hl?gl(n,this.state===cl?e:t,this.outcome):this.queue.push(new fl(n,e,t));return n},fl.prototype.callFulfilled=function(e){ll.resolve(this.promise,e)},fl.prototype.otherCallFulfilled=function(e){gl(this.promise,this.onFulfilled,e)},fl.prototype.callRejected=function(e){ll.reject(this.promise,e)},fl.prototype.otherCallRejected=function(e){gl(this.promise,this.onRejected,e)},ll.resolve=function(e,t){var n=yl(ml,t);if("error"===n.status)return ll.reject(e,n.value);var i=n.value;if(i)vl(e,i);else{e.state=cl,e.outcome=t;for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callFulfilled(t)}return e},ll.reject=function(e,t){e.state=ul,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},pl.resolve=function(e){if(e instanceof this)return e;return ll.resolve(new this(sl),e)},pl.reject=function(e){var t=new this(sl);return ll.reject(t,e)},pl.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);var r=new Array(n),o=0,a=-1,s=new this(sl);for(;++a<n;)l(e[a],a);return s;function l(e,a){t.resolve(e).then((function(e){r[a]=e,++o!==n||i||(i=!0,ll.resolve(s,r))}),(function(e){i||(i=!0,ll.reject(s,e))}))}},pl.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);var r=-1,o=new this(sl);for(;++r<n;)a=e[r],t.resolve(a).then((function(e){i||(i=!0,ll.resolve(o,e))}),(function(e){i||(i=!0,ll.reject(o,e))}));var a;return o};var _l={Promise:"undefined"!=typeof Promise?Promise:dl},bl=u((function(e,t){function n(e){return e}function i(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}t.newBlob=function(e,n){t.checkSupport("blob");try{return new Blob([e],{type:n})}catch(t){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(e),i.getBlob(n)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var r={stringifyByChunk:function(e,t,n){var i=[],r=0,o=e.length;if(o<=n)return String.fromCharCode.apply(null,e);for(;r<o;)"array"===t||"nodebuffer"===t?i.push(String.fromCharCode.apply(null,e.slice(r,Math.min(r+n,o)))):i.push(String.fromCharCode.apply(null,e.subarray(r,Math.min(r+n,o)))),r+=n;return i.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return js.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return js.nodebuffer&&1===String.fromCharCode.apply(null,Zs(1)).length}catch(e){return!1}}()}};function o(e){var n=65536,i=t.getTypeOf(e),o=!0;if("uint8array"===i?o=r.applyCanBeUsed.uint8array:"nodebuffer"===i&&(o=r.applyCanBeUsed.nodebuffer),o)for(;n>1;)try{return r.stringifyByChunk(e,i,n)}catch(e){n=Math.floor(n/2)}return r.stringifyByChar(e)}function a(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}t.applyFromCharCode=o;var s={};s.string={string:n,array:function(e){return i(e,new Array(e.length))},arraybuffer:function(e){return s.string.uint8array(e).buffer},uint8array:function(e){return i(e,new Uint8Array(e.length))},nodebuffer:function(e){return i(e,Zs(e.length))}},s.array={string:o,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return Gs(e)}},s.arraybuffer={string:function(e){return o(new Uint8Array(e))},array:function(e){return a(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return Gs(new Uint8Array(e))}},s.uint8array={string:o,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return Gs(e)}},s.nodebuffer={string:o,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return s.nodebuffer.uint8array(e).buffer},uint8array:function(e){return a(e,new Uint8Array(e.length))},nodebuffer:n},t.transformTo=function(e,n){if(n||(n=""),!e)return n;t.checkSupport(e);var i=t.getTypeOf(n);return s[i][e](n)},t.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":js.nodebuffer&&Ys(e)?"nodebuffer":js.uint8array&&e instanceof Uint8Array?"uint8array":js.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},t.checkSupport=function(e){if(!js[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},t.MAX_VALUE_16BITS=65535,t.MAX_VALUE_32BITS=-1,t.pretty=function(e){var t,n,i="";for(n=0;n<(e||"").length;n++)i+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return i},t.delay=function(e,t,n){Qs((function(){e.apply(n||null,t||[])}))},t.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},t.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},t.prepareContent=function(e,n,r,o,a){return _l.Promise.resolve(n).then((function(e){return js.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new _l.Promise((function(t,n){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(e){n(e.target.error)},i.readAsArrayBuffer(e)})):e})).then((function(n){var s,l=t.getTypeOf(n);return l?("arraybuffer"===l?n=t.transformTo("uint8array",n):"string"===l&&(a?n=Ws(n):r&&!0!==o&&(n=i(s=n,js.uint8array?new Uint8Array(s.length):new Array(s.length)))),n):_l.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}}));bl.newBlob,bl.applyFromCharCode,bl.transformTo,bl.getTypeOf,bl.checkSupport,bl.MAX_VALUE_16BITS,bl.MAX_VALUE_32BITS,bl.pretty,bl.delay,bl.inherits,bl.extend,bl.prepareContent;function wl(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}wl.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}};var El=wl,Cl=u((function(e,t){for(var n=new Array(256),i=0;i<256;i++)n[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;n[254]=n[254]=1;function r(){El.call(this,"utf-8 decode"),this.leftOver=null}function o(){El.call(this,"utf-8 encode")}t.utf8encode=function(e){return js.nodebuffer?Gs(e,"utf-8"):function(e){var t,n,i,r,o,a=e.length,s=0;for(r=0;r<a;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<a&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=js.uint8array?new Uint8Array(s):new Array(s),o=0,r=0;o<s;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<a&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t}(e)},t.utf8decode=function(e){return js.nodebuffer?bl.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,i,r,o,a=e.length,s=new Array(2*a);for(i=0,t=0;t<a;)if((r=e[t++])<128)s[i++]=r;else if((o=n[r])>4)s[i++]=65533,t+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&t<a;)r=r<<6|63&e[t++],o--;o>1?s[i++]=65533:r<65536?s[i++]=r:(r-=65536,s[i++]=55296|r>>10&1023,s[i++]=56320|1023&r)}return s.length!==i&&(s.subarray?s=s.subarray(0,i):s.length=i),bl.applyFromCharCode(s)}(e=bl.transformTo(js.uint8array?"uint8array":"array",e))},bl.inherits(r,El),r.prototype.processChunk=function(e){var i=bl.transformTo(js.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(js.uint8array){var r=i;(i=new Uint8Array(r.length+this.leftOver.length)).set(this.leftOver,0),i.set(r,this.leftOver.length)}else i=this.leftOver.concat(i);this.leftOver=null}var o=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+n[e[i]]>t?i:t}(i),a=i;o!==i.length&&(js.uint8array?(a=i.subarray(0,o),this.leftOver=i.subarray(o,i.length)):(a=i.slice(0,o),this.leftOver=i.slice(o,i.length))),this.push({data:t.utf8decode(a),meta:e.meta})},r.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:t.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},t.Utf8DecodeWorker=r,bl.inherits(o,El),o.prototype.processChunk=function(e){this.push({data:t.utf8encode(e.data),meta:e.meta})},t.Utf8EncodeWorker=o}));Cl.utf8encode,Cl.utf8decode,Cl.Utf8DecodeWorker,Cl.Utf8EncodeWorker;function Sl(e){El.call(this,"ConvertWorker to "+e),this.destType=e}bl.inherits(Sl,El),Sl.prototype.processChunk=function(e){this.push({data:bl.transformTo(this.destType,e.data),meta:e.meta})};var kl=Sl,Tl=qs.Readable;function xl(e,t,n){Tl.call(this,t),this._helper=e;var i=this;e.on("data",(function(e,t){i.push(e)||i._helper.pause(),n&&n(t)})).on("error",(function(e){i.emit("error",e)})).on("end",(function(){i.push(null)}))}bl.inherits(xl,Tl),xl.prototype._read=function(){this._helper.resume()};var Ll=xl,Il=null;if(js.nodestream)try{Il=Ll}catch(e){}function Al(e,t){return new _l.Promise((function(n,i){var r=[],o=e._internalType,a=e._outputType,s=e._mimeType;e.on("data",(function(e,n){r.push(e),t&&t(n)})).on("error",(function(e){r=[],i(e)})).on("end",(function(){try{var e=function(e,t,n){switch(e){case"blob":return bl.newBlob(bl.transformTo("arraybuffer",t),n);case"base64":return Hs(t);default:return bl.transformTo(e,t)}}(a,function(e,t){var n,i=0,r=null,o=0;for(n=0;n<t.length;n++)o+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(r=new Uint8Array(o),n=0;n<t.length;n++)r.set(t[n],i),i+=t[n].length;return r;case"nodebuffer":return Do.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(o,r),s);n(e)}catch(e){i(e)}r=[]})).resume()}))}function Dl(e,t,n){var i=t;switch(t){case"blob":case"arraybuffer":i="uint8array";break;case"base64":i="string"}try{this._internalType=i,this._outputType=t,this._mimeType=n,bl.checkSupport(i),this._worker=e.pipe(new kl(i)),e.lock()}catch(e){this._worker=new El("error"),this._worker.error(e)}}Dl.prototype={accumulate:function(e){return Al(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,(function(e){t.call(n,e.data,e.meta)})):this._worker.on(e,(function(){bl.delay(t,arguments,n)})),this},resume:function(){return bl.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(bl.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new Il(this,{objectMode:"nodebuffer"!==this._outputType},e)}};var Nl=Dl,Pl={base64:!1,binary:!1,dir:!1,createFolders:!0,date:null,compression:null,compressionOptions:null,comment:null,unixPermissions:null,dosPermissions:null};function Bl(e){El.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=bl.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}bl.inherits(Bl,El),Bl.prototype.cleanUp=function(){El.prototype.cleanUp.call(this),this.data=null},Bl.prototype.resume=function(){return!!El.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,bl.delay(this._tickAndRepeat,[],this)),!0)},Bl.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(bl.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},Bl.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})};var Rl=Bl;function Ml(e){El.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}bl.inherits(Ml,El),Ml.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}El.prototype.processChunk.call(this,e)};var Ol=Ml;var Ul=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();var zl=function(e,t){return void 0!==e&&e.length?"string"!==bl.getTypeOf(e)?function(e,t,n,i){var r=Ul,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^r[255&(e^t[a])];return-1^e}(0|t,e,e.length,0):function(e,t,n,i){var r=Ul,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^r[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length,0):0};function Fl(){El.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}bl.inherits(Fl,El),Fl.prototype.processChunk=function(e){this.streamInfo.crc32=zl(e.data,this.streamInfo.crc32||0),this.push(e)};var Vl=Fl;function ql(e,t,n,i,r){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=i,this.compressedContent=r}ql.prototype={getContentWorker:function(){var e=new Rl(_l.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new Ol("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new Rl(_l.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},ql.createWorkerFrom=function(e,t,n){return e.pipe(new Vl).pipe(new Ol("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new Ol("compressedSize")).withStreamInfo("compression",t)};var jl=ql,$l=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};$l.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var i="string"===(n=e.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker();var r=!this._dataBinary;r&&!i&&(t=t.pipe(new Cl.Utf8EncodeWorker)),!r&&i&&(t=t.pipe(new Cl.Utf8DecodeWorker))}catch(e){(t=new El("error")).error(e)}return new Nl(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof jl&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new Cl.Utf8EncodeWorker)),jl.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof jl?this._data.getContentWorker():this._data instanceof El?this._data:new Rl(this._data)}};for(var Hl=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],Wl=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},Kl=0;Kl<Hl.length;Kl++)$l.prototype[Hl[Kl]]=Wl;var Gl=$l,Zl=u((function(e,t){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){var t,n,i,r,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,r),r+=o.length;return a}},o={arraySet:function(e,t,n,i,r){for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,r)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(n)}));Zl.assign,Zl.shrinkBuf,Zl.setTyped,Zl.Buf8,Zl.Buf16,Zl.Buf32;function Yl(e){for(var t=e.length;--t>=0;)e[t]=0}var Xl=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ql=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Jl=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],eu=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],tu=new Array(576);Yl(tu);var nu=new Array(60);Yl(nu);var iu=new Array(512);Yl(iu);var ru=new Array(256);Yl(ru);var ou=new Array(29);Yl(ou);var au,su,lu,uu=new Array(30);function cu(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function hu(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function du(e){return e<256?iu[e]:iu[256+(e>>>7)]}function pu(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function fu(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,pu(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function gu(e,t,n){fu(e,n[2*t],n[2*t+1])}function mu(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function vu(e,t,n){var i,r,o=new Array(16),a=0;for(i=1;i<=15;i++)o[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=mu(o[s]++,s))}}function yu(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function _u(e){e.bi_valid>8?pu(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function bu(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function wu(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&bu(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!bu(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function Eu(e,t,n){var i,r,o,a,s=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],r=e.pending_buf[e.l_buf+s],s++,0===i?gu(e,r,t):(gu(e,(o=ru[r])+256+1,t),0!==(a=Xl[o])&&fu(e,r-=ou[o],a),gu(e,o=du(--i),n),0!==(a=Ql[o])&&fu(e,i-=uu[o],a))}while(s<e.last_lit);gu(e,256,t)}function Cu(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==o[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)wu(e,o,n);r=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],wu(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,wu(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,o,a,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,g=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(o=l[2*l[2*(i=e.heap[n])+1]+1]+1)>f&&(o=f,g++),l[2*i+1]=o,i>u||(e.bl_count[o]++,a=0,i>=p&&(a=d[i-p]),s=l[2*i],e.opt_len+=s*(o+a),h&&(e.static_len+=s*(c[2*i+1]+a)));if(0!==g){do{for(o=f-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[f]--,g-=2}while(g>0);for(o=f;0!==o;o--)for(i=e.bl_count[o];0!==i;)(r=e.heap[--n])>u||(l[2*r+1]!==o&&(e.opt_len+=(o-l[2*r+1])*l[2*r],l[2*r+1]=o),i--)}}(e,t),vu(o,u,e.bl_count)}function Su(e,t,n){var i,r,o=-1,a=t[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++s<l&&r===a||(s<u?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=r,0===a?(l=138,u=3):r===a?(l=6,u=3):(l=7,u=4))}function ku(e,t,n){var i,r,o=-1,a=t[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),i=0;i<=n;i++)if(r=a,a=t[2*(i+1)+1],!(++s<l&&r===a)){if(s<u)do{gu(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==o&&(gu(e,r,e.bl_tree),s--),gu(e,16,e.bl_tree),fu(e,s-3,2)):s<=10?(gu(e,17,e.bl_tree),fu(e,s-3,3)):(gu(e,18,e.bl_tree),fu(e,s-11,7));s=0,o=r,0===a?(l=138,u=3):r===a?(l=6,u=3):(l=7,u=4)}}Yl(uu);var Tu=!1;function xu(e,t,n,i){fu(e,0+(i?1:0),3),function(e,t,n,i){_u(e),i&&(pu(e,n),pu(e,~n)),Zl.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}var Lu={_tr_init:function(e){Tu||(!function(){var e,t,n,i,r,o=new Array(16);for(n=0,i=0;i<28;i++)for(ou[i]=n,e=0;e<1<<Xl[i];e++)ru[n++]=i;for(ru[n-1]=i,r=0,i=0;i<16;i++)for(uu[i]=r,e=0;e<1<<Ql[i];e++)iu[r++]=i;for(r>>=7;i<30;i++)for(uu[i]=r<<7,e=0;e<1<<Ql[i]-7;e++)iu[256+r++]=i;for(t=0;t<=15;t++)o[t]=0;for(e=0;e<=143;)tu[2*e+1]=8,e++,o[8]++;for(;e<=255;)tu[2*e+1]=9,e++,o[9]++;for(;e<=279;)tu[2*e+1]=7,e++,o[7]++;for(;e<=287;)tu[2*e+1]=8,e++,o[8]++;for(vu(tu,287,o),e=0;e<30;e++)nu[2*e+1]=5,nu[2*e]=mu(e,5);au=new cu(tu,Xl,257,286,15),su=new cu(nu,Ql,0,30,15),lu=new cu(new Array(0),Jl,0,19,7)}(),Tu=!0),e.l_desc=new hu(e.dyn_ltree,au),e.d_desc=new hu(e.dyn_dtree,su),e.bl_desc=new hu(e.bl_tree,lu),e.bi_buf=0,e.bi_valid=0,yu(e)},_tr_stored_block:xu,_tr_flush_block:function(e,t,n,i){var r,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),Cu(e,e.l_desc),Cu(e,e.d_desc),a=function(e){var t;for(Su(e,e.dyn_ltree,e.l_desc.max_code),Su(e,e.dyn_dtree,e.d_desc.max_code),Cu(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*eu[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=r&&(r=o)):r=o=n+5,n+4<=r&&-1!==t?xu(e,t,n,i):4===e.strategy||o===r?(fu(e,2+(i?1:0),3),Eu(e,tu,nu)):(fu(e,4+(i?1:0),3),function(e,t,n,i){var r;for(fu(e,t-257,5),fu(e,n-1,5),fu(e,i-4,4),r=0;r<i;r++)fu(e,e.bl_tree[2*eu[r]+1],3);ku(e,e.dyn_ltree,t-1),ku(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),Eu(e,e.dyn_ltree,e.dyn_dtree)),yu(e),i&&_u(e)},_tr_tally:function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(ru[n]+256+1)]++,e.dyn_dtree[2*du(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){fu(e,2,3),gu(e,256,tu),function(e){16===e.bi_valid?(pu(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}};var Iu=function(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(r=r+t[i++]|0)|0}while(--a);r%=65521,o%=65521}return r|o<<16|0};var Au=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();var Du,Nu=function(e,t,n,i){var r=Au,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^r[255&(e^t[a])];return-1^e},Pu={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function Bu(e,t){return e.msg=Pu[t],t}function Ru(e){return(e<<1)-(e>4?9:0)}function Mu(e){for(var t=e.length;--t>=0;)e[t]=0}function Ou(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(Zl.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function Uu(e,t){Lu._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ou(e.strm)}function zu(e,t){e.pending_buf[e.pending++]=t}function Fu(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function Vu(e,t,n,i){var r=e.avail_in;return r>i&&(r=i),0===r?0:(e.avail_in-=r,Zl.arraySet(t,e.input,e.next_in,r,n),1===e.state.wrap?e.adler=Iu(e.adler,t,r,n):2===e.state.wrap&&(e.adler=Nu(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)}function qu(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,u=e.window,c=e.w_mask,h=e.prev,d=e.strstart+258,p=u[o+a-1],f=u[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+a]===f&&u[n+a-1]===p&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<d);if(i=258-(d-o),o=d-258,i>a){if(e.match_start=t,a=i,i>=s)break;p=u[o+a-1],f=u[o+a]}}}while((t=h[t&c])>l&&0!=--r);return a<=e.lookahead?a:e.lookahead}function ju(e){var t,n,i,r,o,a=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=a+(a-262)){Zl.arraySet(e.window,e.window,a,a,0),e.match_start-=a,e.strstart-=a,e.block_start-=a,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=a?i-a:0}while(--n);t=n=a;do{i=e.prev[--t],e.prev[t]=i>=a?i-a:0}while(--n);r+=a}if(0===e.strm.avail_in)break;if(n=Vu(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+3-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function $u(e,t){for(var n,i;;){if(e.lookahead<262){if(ju(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=qu(e,n)),e.match_length>=3)if(i=Lu._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=Lu._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Uu(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(Uu(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Uu(e,!1),0===e.strm.avail_out)?1:2}function Hu(e,t){for(var n,i,r;;){if(e.lookahead<262){if(ju(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=qu(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,i=Lu._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Uu(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=Lu._tr_tally(e,0,e.window[e.strstart-1]))&&Uu(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Lu._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(Uu(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Uu(e,!1),0===e.strm.avail_out)?1:2}function Wu(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function Ku(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Zl.Buf16(1146),this.dyn_dtree=new Zl.Buf16(122),this.bl_tree=new Zl.Buf16(78),Mu(this.dyn_ltree),Mu(this.dyn_dtree),Mu(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Zl.Buf16(16),this.heap=new Zl.Buf16(573),Mu(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Zl.Buf16(573),Mu(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Gu(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,Lu._tr_init(t),0):Bu(e,-2)}function Zu(e){var t=Gu(e);return 0===t&&function(e){e.window_size=2*e.w_size,Mu(e.head),e.max_lazy_match=Du[e.level].max_lazy,e.good_match=Du[e.level].good_length,e.nice_match=Du[e.level].nice_length,e.max_chain_length=Du[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0}(e.state),t}function Yu(e,t,n,i,r,o){if(!e)return-2;var a=1;if(-1===t&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),r<1||r>9||8!==n||i<8||i>15||t<0||t>9||o<0||o>4)return Bu(e,-2);8===i&&(i=9);var s=new Ku;return e.state=s,s.strm=e,s.wrap=a,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Zl.Buf8(2*s.w_size),s.head=new Zl.Buf16(s.hash_size),s.prev=new Zl.Buf16(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Zl.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=n,Zu(e)}Du=[new Wu(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ju(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,Uu(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(Uu(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Uu(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(Uu(e,!1),e.strm.avail_out),1)})),new Wu(4,4,8,4,$u),new Wu(4,5,16,8,$u),new Wu(4,6,32,32,$u),new Wu(4,4,16,16,Hu),new Wu(8,16,32,32,Hu),new Wu(8,16,128,128,Hu),new Wu(8,32,128,256,Hu),new Wu(32,128,258,1024,Hu),new Wu(32,258,258,4096,Hu)];var Xu={deflateInit:function(e,t){return Yu(e,t,8,15,8,0)},deflateInit2:Yu,deflateReset:Zu,deflateResetKeep:Gu,deflateSetHeader:function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},deflate:function(e,t){var n,i,r,o;if(!e||!e.state||t>5||t<0)return e?Bu(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return Bu(e,0===e.avail_out?-5:-2);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,zu(i,31),zu(i,139),zu(i,8),i.gzhead?(zu(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),zu(i,255&i.gzhead.time),zu(i,i.gzhead.time>>8&255),zu(i,i.gzhead.time>>16&255),zu(i,i.gzhead.time>>24&255),zu(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),zu(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(zu(i,255&i.gzhead.extra.length),zu(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Nu(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(zu(i,0),zu(i,0),zu(i,0),zu(i,0),zu(i,0),zu(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),zu(i,3),i.status=113);else{var a=8+(i.w_bits-8<<4)<<8;a|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(a|=32),a+=31-a%31,i.status=113,Fu(i,a),0!==i.strstart&&(Fu(i,e.adler>>>16),Fu(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>r&&(e.adler=Nu(e.adler,i.pending_buf,i.pending-r,r)),Ou(e),r=i.pending,i.pending!==i.pending_buf_size));)zu(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(e.adler=Nu(e.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=Nu(e.adler,i.pending_buf,i.pending-r,r)),Ou(e),r=i.pending,i.pending===i.pending_buf_size)){o=1;break}o=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,zu(i,o)}while(0!==o);i.gzhead.hcrc&&i.pending>r&&(e.adler=Nu(e.adler,i.pending_buf,i.pending-r,r)),0===o&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=Nu(e.adler,i.pending_buf,i.pending-r,r)),Ou(e),r=i.pending,i.pending===i.pending_buf_size)){o=1;break}o=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,zu(i,o)}while(0!==o);i.gzhead.hcrc&&i.pending>r&&(e.adler=Nu(e.adler,i.pending_buf,i.pending-r,r)),0===o&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Ou(e),i.pending+2<=i.pending_buf_size&&(zu(i,255&e.adler),zu(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(Ou(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&Ru(t)<=Ru(n)&&4!==t)return Bu(e,-5);if(666===i.status&&0!==e.avail_in)return Bu(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var s=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(ju(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=Lu._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Uu(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Uu(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Uu(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,i,r,o,a=e.window;;){if(e.lookahead<=258){if(ju(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=a[r=e.strstart-1])===a[++r]&&i===a[++r]&&i===a[++r]){o=e.strstart+258;do{}while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&r<o);e.match_length=258-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=Lu._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Lu._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Uu(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Uu(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Uu(e,!1),0===e.strm.avail_out)?1:2}(i,t):Du[i.level].func(i,t);if(3!==s&&4!==s||(i.status=666),1===s||3===s)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===s&&(1===t?Lu._tr_align(i):5!==t&&(Lu._tr_stored_block(i,0,0,!1),3===t&&(Mu(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),Ou(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(zu(i,255&e.adler),zu(i,e.adler>>8&255),zu(i,e.adler>>16&255),zu(i,e.adler>>24&255),zu(i,255&e.total_in),zu(i,e.total_in>>8&255),zu(i,e.total_in>>16&255),zu(i,e.total_in>>24&255)):(Fu(i,e.adler>>>16),Fu(i,65535&e.adler)),Ou(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},deflateEnd:function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?Bu(e,-2):(e.state=null,113===t?Bu(e,-3):0):-2},deflateSetDictionary:function(e,t){var n,i,r,o,a,s,l,u,c=t.length;if(!e||!e.state)return-2;if(2===(o=(n=e.state).wrap)||1===o&&42!==n.status||n.lookahead)return-2;for(1===o&&(e.adler=Iu(e.adler,t,c,0)),n.wrap=0,c>=n.w_size&&(0===o&&(Mu(n.head),n.strstart=0,n.block_start=0,n.insert=0),u=new Zl.Buf8(n.w_size),Zl.arraySet(u,t,c-n.w_size,n.w_size,0),t=u,c=n.w_size),a=e.avail_in,s=e.next_in,l=e.input,e.avail_in=c,e.next_in=0,e.input=t,ju(n);n.lookahead>=3;){i=n.strstart,r=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+3-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++}while(--r);n.strstart=i,n.lookahead=2,ju(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=s,e.input=l,e.avail_in=a,n.wrap=o,0},deflateInfo:"pako deflate (from Nodeca project)"},Qu=!0,Ju=!0;try{String.fromCharCode.apply(null,[0])}catch(qp){Qu=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(qp){Ju=!1}for(var ec=new Zl.Buf8(256),tc=0;tc<256;tc++)ec[tc]=tc>=252?6:tc>=248?5:tc>=240?4:tc>=224?3:tc>=192?2:1;ec[254]=ec[254]=1;function nc(e,t){if(t<65534&&(e.subarray&&Ju||!e.subarray&&Qu))return String.fromCharCode.apply(null,Zl.shrinkBuf(e,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}var ic=function(e){var t,n,i,r,o,a=e.length,s=0;for(r=0;r<a;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<a&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Zl.Buf8(s),o=0,r=0;o<s;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<a&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},rc=function(e){return nc(e,e.length)},oc=function(e){for(var t=new Zl.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},ac=function(e,t){var n,i,r,o,a=t||e.length,s=new Array(2*a);for(i=0,n=0;n<a;)if((r=e[n++])<128)s[i++]=r;else if((o=ec[r])>4)s[i++]=65533,n+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&n<a;)r=r<<6|63&e[n++],o--;o>1?s[i++]=65533:r<65536?s[i++]=r:(r-=65536,s[i++]=55296|r>>10&1023,s[i++]=56320|1023&r)}return nc(s,i)},sc=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+ec[e[n]]>t?n:t};var lc=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},uc=Object.prototype.toString;function cc(e){if(!(this instanceof cc))return new cc(e);this.options=Zl.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lc,this.strm.avail_out=0;var n=Xu.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(Pu[n]);if(t.header&&Xu.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(i="string"==typeof t.dictionary?ic(t.dictionary):"[object ArrayBuffer]"===uc.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=Xu.deflateSetDictionary(this.strm,i)))throw new Error(Pu[n]);this._dict_set=!0}}function hc(e,t){var n=new cc(t);if(n.push(e,!0),n.err)throw n.msg||Pu[n.err];return n.result}cc.prototype.push=function(e,t){var n,i,r=this.strm,o=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:!0===t?4:0,"string"==typeof e?r.input=ic(e):"[object ArrayBuffer]"===uc.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new Zl.Buf8(o),r.next_out=0,r.avail_out=o),1!==(n=Xu.deflate(r,i))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==r.avail_out&&(0!==r.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(rc(Zl.shrinkBuf(r.output,r.next_out))):this.onData(Zl.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||0===r.avail_out)&&1!==n);return 4===i?(n=Xu.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==i||(this.onEnd(0),r.avail_out=0,!0)},cc.prototype.onData=function(e){this.chunks.push(e)},cc.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Zl.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var dc={Deflate:cc,deflate:hc,deflateRaw:function(e,t){return(t=t||{}).raw=!0,hc(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,hc(e,t)}},pc=function(e,t){var n,i,r,o,a,s,l,u,c,h,d,p,f,g,m,v,y,_,b,w,E,C,S,k,T;n=e.state,i=e.next_in,k=e.input,r=i+(e.avail_in-5),o=e.next_out,T=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),l=n.dmax,u=n.wsize,c=n.whave,h=n.wnext,d=n.window,p=n.hold,f=n.bits,g=n.lencode,m=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{f<15&&(p+=k[i++]<<f,f+=8,p+=k[i++]<<f,f+=8),_=g[p&v];t:for(;;){if(p>>>=b=_>>>24,f-=b,0===(b=_>>>16&255))T[o++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=g[(65535&_)+(p&(1<<b)-1)];continue t}if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&_,(b&=15)&&(f<b&&(p+=k[i++]<<f,f+=8),w+=p&(1<<b)-1,p>>>=b,f-=b),f<15&&(p+=k[i++]<<f,f+=8,p+=k[i++]<<f,f+=8),_=m[p&y];n:for(;;){if(p>>>=b=_>>>24,f-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=m[(65535&_)+(p&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(E=65535&_,f<(b&=15)&&(p+=k[i++]<<f,(f+=8)<b&&(p+=k[i++]<<f,f+=8)),(E+=p&(1<<b)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=b,f-=b,E>(b=o-a)){if((b=E-b)>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=0,S=d,0===h){if(C+=u-b,b<w){w-=b;do{T[o++]=d[C++]}while(--b);C=o-E,S=T}}else if(h<b){if(C+=u+h-b,(b-=h)<w){w-=b;do{T[o++]=d[C++]}while(--b);if(C=0,h<w){w-=b=h;do{T[o++]=d[C++]}while(--b);C=o-E,S=T}}}else if(C+=h-b,b<w){w-=b;do{T[o++]=d[C++]}while(--b);C=o-E,S=T}for(;w>2;)T[o++]=S[C++],T[o++]=S[C++],T[o++]=S[C++],w-=3;w&&(T[o++]=S[C++],w>1&&(T[o++]=S[C++]))}else{C=o-E;do{T[o++]=T[C++],T[o++]=T[C++],T[o++]=T[C++],w-=3}while(w>2);w&&(T[o++]=T[C++],w>1&&(T[o++]=T[C++]))}break}}break}}while(i<r&&o<s);i-=w=f>>3,p&=(1<<(f-=w<<3))-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=p,n.bits=f},fc=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],gc=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],mc=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],vc=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],yc=function(e,t,n,i,r,o,a,s){var l,u,c,h,d,p,f,g,m,v=s.bits,y=0,_=0,b=0,w=0,E=0,C=0,S=0,k=0,T=0,x=0,L=null,I=0,A=new Zl.Buf16(16),D=new Zl.Buf16(16),N=null,P=0;for(y=0;y<=15;y++)A[y]=0;for(_=0;_<i;_++)A[t[n+_]]++;for(E=v,w=15;w>=1&&0===A[w];w--);if(E>w&&(E=w),0===w)return r[o++]=20971520,r[o++]=20971520,s.bits=1,0;for(b=1;b<w&&0===A[b];b++);for(E<b&&(E=b),k=1,y=1;y<=15;y++)if(k<<=1,(k-=A[y])<0)return-1;if(k>0&&(0===e||1!==w))return-1;for(D[1]=0,y=1;y<15;y++)D[y+1]=D[y]+A[y];for(_=0;_<i;_++)0!==t[n+_]&&(a[D[t[n+_]]++]=_);if(0===e?(L=N=a,p=19):1===e?(L=fc,I-=257,N=gc,P-=257,p=256):(L=mc,N=vc,p=-1),x=0,_=0,y=b,d=o,C=E,S=0,c=-1,h=(T=1<<E)-1,1===e&&T>852||2===e&&T>592)return 1;for(;;){f=y-S,a[_]<p?(g=0,m=a[_]):a[_]>p?(g=N[P+a[_]],m=L[I+a[_]]):(g=96,m=0),l=1<<y-S,b=u=1<<C;do{r[d+(x>>S)+(u-=l)]=f<<24|g<<16|m|0}while(0!==u);for(l=1<<y-1;x&l;)l>>=1;if(0!==l?(x&=l-1,x+=l):x=0,_++,0==--A[y]){if(y===w)break;y=t[n+a[_]]}if(y>E&&(x&h)!==c){for(0===S&&(S=E),d+=b,k=1<<(C=y-S);C+S<w&&!((k-=A[C+S])<=0);)C++,k<<=1;if(T+=1<<C,1===e&&T>852||2===e&&T>592)return 1;r[c=x&h]=E<<24|C<<16|d-o|0}}return 0!==x&&(r[d+x]=y-S<<24|64<<16|0),s.bits=E,0};function _c(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function bc(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Zl.Buf16(320),this.work=new Zl.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function wc(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Zl.Buf32(852),t.distcode=t.distdyn=new Zl.Buf32(592),t.sane=1,t.back=-1,0):-2}function Ec(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,wc(e)):-2}function Cc(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,Ec(e))):-2}function Sc(e,t){var n,i;return e?(i=new bc,e.state=i,i.window=null,0!==(n=Cc(e,t))&&(e.state=null),n):-2}var kc,Tc,xc=!0;function Lc(e){if(xc){var t;for(kc=new Zl.Buf32(512),Tc=new Zl.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(yc(1,e.lens,0,288,kc,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;yc(2,e.lens,0,32,Tc,0,e.work,{bits:5}),xc=!1}e.lencode=kc,e.lenbits=9,e.distcode=Tc,e.distbits=5}function Ic(e,t,n,i){var r,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Zl.Buf8(o.wsize)),i>=o.wsize?(Zl.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((r=o.wsize-o.wnext)>i&&(r=i),Zl.arraySet(o.window,t,n-i,r,o.wnext),(i-=r)?(Zl.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}var Ac={inflateReset:Ec,inflateReset2:Cc,inflateResetKeep:wc,inflateInit:function(e){return Sc(e,15)},inflateInit2:Sc,inflate:function(e,t){var n,i,r,o,a,s,l,u,c,h,d,p,f,g,m,v,y,_,b,w,E,C,S,k,T=0,x=new Zl.Buf8(4),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),a=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,u=n.hold,c=n.bits,h=s,d=l,C=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;c<16;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}if(2&n.wrap&&35615===u){n.check=0,x[0]=255&u,x[1]=u>>>8&255,n.check=Nu(n.check,x,2,0),u=0,c=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&u)){e.msg="unknown compression method",n.mode=30;break}if(c-=4,E=8+(15&(u>>>=4)),0===n.wbits)n.wbits=E;else if(E>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<E,e.adler=n.check=1,n.mode=512&u?10:12,u=0,c=0;break;case 2:for(;c<16;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}if(n.flags=u,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(x[0]=255&u,x[1]=u>>>8&255,n.check=Nu(n.check,x,2,0)),u=0,c=0,n.mode=3;case 3:for(;c<32;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}n.head&&(n.head.time=u),512&n.flags&&(x[0]=255&u,x[1]=u>>>8&255,x[2]=u>>>16&255,x[3]=u>>>24&255,n.check=Nu(n.check,x,4,0)),u=0,c=0,n.mode=4;case 4:for(;c<16;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(x[0]=255&u,x[1]=u>>>8&255,n.check=Nu(n.check,x,2,0)),u=0,c=0,n.mode=5;case 5:if(1024&n.flags){for(;c<16;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(x[0]=255&u,x[1]=u>>>8&255,n.check=Nu(n.check,x,2,0)),u=0,c=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((p=n.length)>s&&(p=s),p&&(n.head&&(E=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Zl.arraySet(n.head.extra,i,o,p,E)),512&n.flags&&(n.check=Nu(n.check,i,p,o)),s-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===s)break e;p=0;do{E=i[o+p++],n.head&&E&&n.length<65536&&(n.head.name+=String.fromCharCode(E))}while(E&&p<s);if(512&n.flags&&(n.check=Nu(n.check,i,p,o)),s-=p,o+=p,E)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===s)break e;p=0;do{E=i[o+p++],n.head&&E&&n.length<65536&&(n.head.comment+=String.fromCharCode(E))}while(E&&p<s);if(512&n.flags&&(n.check=Nu(n.check,i,p,o)),s-=p,o+=p,E)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;c<16;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}if(u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}u=0,c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;c<32;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}e.adler=n.check=_c(u),u=0,c=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=a,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=u,n.bits=c,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){u>>>=7&c,c-=7&c,n.mode=27;break}for(;c<3;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}switch(n.last=1&u,c-=1,3&(u>>>=1)){case 0:n.mode=14;break;case 1:if(Lc(n),n.mode=20,6===t){u>>>=2,c-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}u>>>=2,c-=2;break;case 14:for(u>>>=7&c,c-=7&c;c<32;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&u,u=0,c=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(p=n.length){if(p>s&&(p=s),p>l&&(p=l),0===p)break e;Zl.arraySet(r,i,o,p,a),s-=p,o+=p,l-=p,a+=p,n.length-=p;break}n.mode=12;break;case 17:for(;c<14;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}if(n.nlen=257+(31&u),u>>>=5,c-=5,n.ndist=1+(31&u),u>>>=5,c-=5,n.ncode=4+(15&u),u>>>=4,c-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;c<3;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}n.lens[L[n.have++]]=7&u,u>>>=3,c-=3}for(;n.have<19;)n.lens[L[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,S={bits:n.lenbits},C=yc(0,n.lens,0,19,n.lencode,0,n.work,S),n.lenbits=S.bits,C){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;v=(T=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,y=65535&T,!((m=T>>>24)<=c);){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}if(y<16)u>>>=m,c-=m,n.lens[n.have++]=y;else{if(16===y){for(k=m+2;c<k;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}if(u>>>=m,c-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}E=n.lens[n.have-1],p=3+(3&u),u>>>=2,c-=2}else if(17===y){for(k=m+3;c<k;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}c-=m,E=0,p=3+(7&(u>>>=m)),u>>>=3,c-=3}else{for(k=m+7;c<k;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}c-=m,E=0,p=11+(127&(u>>>=m)),u>>>=7,c-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;p--;)n.lens[n.have++]=E}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,S={bits:n.lenbits},C=yc(1,n.lens,0,n.nlen,n.lencode,0,n.work,S),n.lenbits=S.bits,C){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,S={bits:n.distbits},C=yc(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,S),n.distbits=S.bits,C){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(s>=6&&l>=258){e.next_out=a,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=u,n.bits=c,pc(e,d),a=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,u=n.hold,c=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;v=(T=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,y=65535&T,!((m=T>>>24)<=c);){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}if(v&&0==(240&v)){for(_=m,b=v,w=y;v=(T=n.lencode[w+((u&(1<<_+b)-1)>>_)])>>>16&255,y=65535&T,!(_+(m=T>>>24)<=c);){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}u>>>=_,c-=_,n.back+=_}if(u>>>=m,c-=m,n.back+=m,n.length=y,0===v){n.mode=26;break}if(32&v){n.back=-1,n.mode=12;break}if(64&v){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&v,n.mode=22;case 22:if(n.extra){for(k=n.extra;c<k;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,c-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;v=(T=n.distcode[u&(1<<n.distbits)-1])>>>16&255,y=65535&T,!((m=T>>>24)<=c);){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}if(0==(240&v)){for(_=m,b=v,w=y;v=(T=n.distcode[w+((u&(1<<_+b)-1)>>_)])>>>16&255,y=65535&T,!(_+(m=T>>>24)<=c);){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}u>>>=_,c-=_,n.back+=_}if(u>>>=m,c-=m,n.back+=m,64&v){e.msg="invalid distance code",n.mode=30;break}n.offset=y,n.extra=15&v,n.mode=24;case 24:if(n.extra){for(k=n.extra;c<k;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,c-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===l)break e;if(p=d-l,n.offset>p){if((p=n.offset-p)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),g=n.window}else g=r,f=a-n.offset,p=n.length;p>l&&(p=l),l-=p,n.length-=p;do{r[a++]=g[f++]}while(--p);0===n.length&&(n.mode=21);break;case 26:if(0===l)break e;r[a++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;c<32;){if(0===s)break e;s--,u|=i[o++]<<c,c+=8}if(d-=l,e.total_out+=d,n.total+=d,d&&(e.adler=n.check=n.flags?Nu(n.check,r,d,a-d):Iu(n.check,r,d,a-d)),d=l,(n.flags?u:_c(u))!==n.check){e.msg="incorrect data check",n.mode=30;break}u=0,c=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;c<32;){if(0===s)break e;s--,u+=i[o++]<<c,c+=8}if(u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}u=0,c=0}n.mode=29;case 29:C=1;break e;case 30:C=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=a,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=u,n.bits=c,(n.wsize||d!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&Ic(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,n.wrap&&d&&(e.adler=n.check=n.flags?Nu(n.check,r,d,e.next_out-d):Iu(n.check,r,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===h&&0===d||4===t)&&0===C&&(C=-5),C},inflateEnd:function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},inflateGetHeader:function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},inflateSetDictionary:function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&Iu(1,t,i,0)!==n.check?-3:Ic(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,0):-2},inflateInfo:"pako inflate (from Nodeca project)"},Dc={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var Nc=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Pc=Object.prototype.toString;function Bc(e){if(!(this instanceof Bc))return new Bc(e);this.options=Zl.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lc,this.strm.avail_out=0;var n=Ac.inflateInit2(this.strm,t.windowBits);if(n!==Dc.Z_OK)throw new Error(Pu[n]);if(this.header=new Nc,Ac.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=ic(t.dictionary):"[object ArrayBuffer]"===Pc.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ac.inflateSetDictionary(this.strm,t.dictionary))!==Dc.Z_OK))throw new Error(Pu[n])}function Rc(e,t){var n=new Bc(t);if(n.push(e,!0),n.err)throw n.msg||Pu[n.err];return n.result}Bc.prototype.push=function(e,t){var n,i,r,o,a,s=this.strm,l=this.options.chunkSize,u=this.options.dictionary,c=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?Dc.Z_FINISH:Dc.Z_NO_FLUSH,"string"==typeof e?s.input=oc(e):"[object ArrayBuffer]"===Pc.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new Zl.Buf8(l),s.next_out=0,s.avail_out=l),(n=Ac.inflate(s,Dc.Z_NO_FLUSH))===Dc.Z_NEED_DICT&&u&&(n=Ac.inflateSetDictionary(this.strm,u)),n===Dc.Z_BUF_ERROR&&!0===c&&(n=Dc.Z_OK,c=!1),n!==Dc.Z_STREAM_END&&n!==Dc.Z_OK)return this.onEnd(n),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&n!==Dc.Z_STREAM_END&&(0!==s.avail_in||i!==Dc.Z_FINISH&&i!==Dc.Z_SYNC_FLUSH)||("string"===this.options.to?(r=sc(s.output,s.next_out),o=s.next_out-r,a=ac(s.output,r),s.next_out=o,s.avail_out=l-o,o&&Zl.arraySet(s.output,s.output,r,o,0),this.onData(a)):this.onData(Zl.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(c=!0)}while((s.avail_in>0||0===s.avail_out)&&n!==Dc.Z_STREAM_END);return n===Dc.Z_STREAM_END&&(i=Dc.Z_FINISH),i===Dc.Z_FINISH?(n=Ac.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Dc.Z_OK):i!==Dc.Z_SYNC_FLUSH||(this.onEnd(Dc.Z_OK),s.avail_out=0,!0)},Bc.prototype.onData=function(e){this.chunks.push(e)},Bc.prototype.onEnd=function(e){e===Dc.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Zl.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Mc={Inflate:Bc,inflate:Rc,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Rc(e,t)},ungzip:Rc},Oc={};(0,Zl.assign)(Oc,dc,Mc,Dc);var Uc=Oc,zc="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array?"uint8array":"array";function Fc(e,t){El.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}bl.inherits(Fc,El),Fc.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(bl.transformTo(zc,e.data),!1)},Fc.prototype.flush=function(){El.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},Fc.prototype.cleanUp=function(){El.prototype.cleanUp.call(this),this._pako=null},Fc.prototype._createPako=function(){this._pako=new Uc[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}};var Vc={STORE:{magic:"\0\0",compressWorker:function(e){return new El("STORE compression")},uncompressWorker:function(){return new El("STORE decompression")}},DEFLATE:{magic:"\b\0",compressWorker:function(e){return new Fc("Deflate",e)},uncompressWorker:function(){return new Fc("Inflate",{})}}},qc="PK",jc="PK",$c="PK",Hc="PK",Wc="PK",Kc="PK\b",Gc=function(e,t){var n,i="";for(n=0;n<t;n++)i+=String.fromCharCode(255&e),e>>>=8;return i},Zc=function(e,t,n,i,r,o){var a,s,l=e.file,u=e.compression,c=o!==Cl.utf8encode,h=bl.transformTo("string",o(l.name)),d=bl.transformTo("string",Cl.utf8encode(l.name)),p=l.comment,f=bl.transformTo("string",o(p)),g=bl.transformTo("string",Cl.utf8encode(p)),m=d.length!==l.name.length,v=g.length!==p.length,y="",_="",b="",w=l.dir,E=l.date,C={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(C.crc32=e.crc32,C.compressedSize=e.compressedSize,C.uncompressedSize=e.uncompressedSize);var S=0;t&&(S|=8),c||!m&&!v||(S|=2048);var k=0,T=0;w&&(k|=16),"UNIX"===r?(T=798,k|=function(e,t){var n=e;return e||(n=t?16893:33204),(65535&n)<<16}(l.unixPermissions,w)):(T=20,k|=function(e,t){return 63&(e||0)}(l.dosPermissions)),a=E.getUTCHours(),a<<=6,a|=E.getUTCMinutes(),a<<=5,a|=E.getUTCSeconds()/2,s=E.getUTCFullYear()-1980,s<<=4,s|=E.getUTCMonth()+1,s<<=5,s|=E.getUTCDate(),m&&(_=Gc(1,1)+Gc(zl(h),4)+d,y+="up"+Gc(_.length,2)+_),v&&(b=Gc(1,1)+Gc(zl(f),4)+g,y+="uc"+Gc(b.length,2)+b);var x="";return x+="\n\0",x+=Gc(S,2),x+=u.magic,x+=Gc(a,2),x+=Gc(s,2),x+=Gc(C.crc32,4),x+=Gc(C.compressedSize,4),x+=Gc(C.uncompressedSize,4),x+=Gc(h.length,2),x+=Gc(y.length,2),{fileRecord:qc+x+h+y,dirRecord:jc+Gc(T,2)+x+Gc(f.length,2)+"\0\0\0\0"+Gc(k,4)+Gc(i,4)+h+y+f}},Yc=function(e){return Kc+Gc(e.crc32,4)+Gc(e.compressedSize,4)+Gc(e.uncompressedSize,4)};function Xc(e,t,n,i){El.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}bl.inherits(Xc,El),Xc.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,El.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-i-1))/n:100}}))},Xc.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=Zc(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},Xc.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=Zc(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:Yc(e),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},Xc.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e,i=function(e,t,n,i,r){var o=bl.transformTo("string",r(i));return $c+"\0\0\0\0"+Gc(e,2)+Gc(e,2)+Gc(t,4)+Gc(n,4)+Gc(o.length,2)+o}(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},Xc.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},Xc.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},Xc.prototype.resume=function(){return!!El.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},Xc.prototype.error=function(e){var t=this._sources;if(!El.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},Xc.prototype.lock=function(){El.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()};var Qc=Xc,Jc=function(e,t,n){var i=new Qc(t.streamFiles,n,t.platform,t.encodeFileName),r=0;try{e.forEach((function(e,n){r++;var o=function(e,t){var n=e||t,i=Vc[n];if(!i)throw new Error(n+" is not a valid compression method !");return i}(n.options.compression,t.compression),a=n.options.compressionOptions||t.compressionOptions||{},s=n.dir,l=n.date;n._compressWorker(o,a).withStreamInfo("file",{name:e,dir:s,date:l,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(i)})),i.entriesCount=r}catch(e){i.error(e)}return i};function eh(e,t){El.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}bl.inherits(eh,El),eh.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},eh.prototype.pause=function(){return!!El.prototype.pause.call(this)&&(this._stream.pause(),!0)},eh.prototype.resume=function(){return!!El.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)};var th=eh,nh=function(e,t,n){var i,r=bl.getTypeOf(t),o=bl.extend(n||{},Pl);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(e=rh(e)),o.createFolders&&(i=ih(e))&&oh.call(this,i,!0);var a="string"===r&&!1===o.binary&&!1===o.base64;n&&void 0!==n.binary||(o.binary=!a),(t instanceof jl&&0===t.uncompressedSize||o.dir||!t||0===t.length)&&(o.base64=!1,o.binary=!0,t="",o.compression="STORE",r="string");var s=null;s=t instanceof jl||t instanceof El?t:Ks&&Xs(t)?new th(e,t):bl.prepareContent(e,t,o.binary,o.optimizedBinaryString,o.base64);var l=new Gl(e,s,o);this.files[e]=l},ih=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},rh=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},oh=function(e,t){return t=void 0!==t?t:Pl.createFolders,e=rh(e),this.files[e]||nh.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function ah(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var sh={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,i;for(t in this.files)this.files.hasOwnProperty(t)&&(i=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,i))},filter:function(e){var t=[];return this.forEach((function(n,i){e(n,i)&&t.push(i)})),t},file:function(e,t,n){if(1===arguments.length){if(ah(e)){var i=e;return this.filter((function(e,t){return!t.dir&&i.test(e)}))}var r=this.files[this.root+e];return r&&!r.dir?r:null}return e=this.root+e,nh.call(this,e,t,n),this},folder:function(e){if(!e)return this;if(ah(e))return this.filter((function(t,n){return n.dir&&e.test(t)}));var t=this.root+e,n=oh.call(this,t),i=this.clone();return i.root=n.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter((function(t,n){return n.name.slice(0,e.length)===e})),i=0;i<n.length;i++)delete this.files[n[i].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if((n=bl.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:Cl.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");bl.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var i=n.comment||this.comment||"";t=Jc(this,n,i)}catch(e){(t=new El("error")).error(e)}return new Nl(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};function lh(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}lh.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return bl.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}};var uh=lh;function ch(e){uh.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}bl.inherits(ch,uh),ch.prototype.byteAt=function(e){return this.data[this.zero+e]},ch.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),r=e.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===t&&this.data[o+1]===n&&this.data[o+2]===i&&this.data[o+3]===r)return o-this.zero;return-1},ch.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),r=e.charCodeAt(3),o=this.readData(4);return t===o[0]&&n===o[1]&&i===o[2]&&r===o[3]},ch.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};var hh=ch;function dh(e){uh.call(this,e)}bl.inherits(dh,uh),dh.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},dh.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},dh.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},dh.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};var ph=dh;function fh(e){hh.call(this,e)}bl.inherits(fh,hh),fh.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};var gh=fh;function mh(e){gh.call(this,e)}bl.inherits(mh,gh),mh.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};var vh=mh,yh=function(e){var t=bl.getTypeOf(e);return bl.checkSupport(t),"string"!==t||js.uint8array?"nodebuffer"===t?new vh(e):js.uint8array?new gh(bl.transformTo("uint8array",e)):new hh(bl.transformTo("array",e)):new ph(e)};function _h(e,t){this.options=e,this.loadOptions=t}_h.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in Vc)if(Vc.hasOwnProperty(t)&&Vc[t].magic===e)return Vc[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+bl.pretty(this.compressionMethod)+" unknown (inner file : "+bl.transformTo("string",this.fileName)+")");this.decompressed=new jl(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=yh(this.extraFields[1].value);this.uncompressedSize===bl.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===bl.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===bl.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===bl.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,n,i,r=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<r;)t=e.readInt(2),n=e.readInt(2),i=e.readData(n),this.extraFields[t]={id:t,length:n,value:i};e.setIndex(r)},handleUTF8:function(){var e=js.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=Cl.utf8decode(this.fileName),this.fileCommentStr=Cl.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=bl.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var r=bl.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(r)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=yh(e.value);return 1!==t.readInt(1)||zl(this.fileName)!==t.readInt(4)?null:Cl.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=yh(e.value);return 1!==t.readInt(1)||zl(this.fileComment)!==t.readInt(4)?null:Cl.utf8decode(t.readData(e.length-5))}return null}};var bh=_h;function wh(e){this.files=[],this.loadOptions=e}wh.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+bl.pretty(t)+", expected "+bl.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4)===t;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=js.uint8array?"uint8array":"array",n=bl.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,i=this.zip64EndOfCentralSize-44;0<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(qc),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(jc);)(e=new bh({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature($c);if(e<0)throw!this.isSignature(0,qc)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature($c),this.readBlockEndOfCentral(),this.diskNumber===bl.MAX_VALUE_16BITS||this.diskWithCentralDirStart===bl.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===bl.MAX_VALUE_16BITS||this.centralDirRecords===bl.MAX_VALUE_16BITS||this.centralDirSize===bl.MAX_VALUE_32BITS||this.centralDirOffset===bl.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(Hc))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(Hc),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,Wc)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(Wc),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(Wc),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=t-n;if(i>0)this.isSignature(t,jc)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(e){this.reader=yh(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}};var Eh=wh;function Ch(e){return new _l.Promise((function(t,n){var i=e.decompressed.getContentWorker().pipe(new Vl);i.on("error",(function(e){n(e)})).on("end",(function(){i.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}function Sh(){if(!(this instanceof Sh))return new Sh;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new Sh;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}Sh.prototype=sh,Sh.prototype.loadAsync=function(e,t){var n=this;return t=bl.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:Cl.utf8decode}),Ks&&Xs(e)?_l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):bl.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var n=new Eh(t);return n.load(e),n})).then((function(e){var n=[_l.Promise.resolve(e)],i=e.files;if(t.checkCRC32)for(var r=0;r<i.length;r++)n.push(Ch(i[r]));return _l.Promise.all(n)})).then((function(e){for(var i=e.shift(),r=i.files,o=0;o<r.length;o++){var a=r[o];n.file(a.fileNameStr,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:t.createFolders})}return i.zipComment.length&&(n.comment=i.zipComment),n}))},Sh.support=js,Sh.defaults=Pl,Sh.version="3.5.0",Sh.loadAsync=function(e,t){return(new Sh).loadAsync(e,t)},Sh.external=_l;var kh=Sh;function Th(e){const t=new Date(e);return"Invalid Date"===t.toString()?"unknown"+Math.floor(1e4*Math.random()):`${t.getFullYear()}-${xh(t.getMonth()+1,2)}-${xh(t.getDate(),2)}_${xh(t.getHours(),2)}-${xh(t.getMinutes(),2)}-${xh(t.getSeconds(),2)}`}function xh(e,t){let n,i=e.toString();const r=t-i.length;for(n=0;n<r;n++)i="0"+i;return i}var Lh={recordsToZip:function(e,t){let n,i;const r=[],o=[],a=[],s=t||e,l=new kh;return Ji.record.getAll(e).then(e=>e.reduce((e,t)=>e.then(()=>Ji.record.get(t.instanceId).then(e=>{const t=[];let u;return i=`${s}_${Th(e.created)}`,n=l.folder(i),n.file("submission.xml",'<?xml version="1.0" ?>\n'+e.xml,{date:new Date(e.updated)}),u={folder:i,draft:e.draft,"local name":e.name,instanceID:e.instanceId},e.files.forEach(i=>{o.push(C.blobToArrayBuffer(i.item).then(e=>{n.file(i.name,e)}).catch(n=>{console.error(n),t.push(i.name),r.push(`Failed to retrieve ${i.name} for record "${e.name}".`)}))}),Promise.all(o).then(()=>{t.length>0&&(u["failed files"]=t),a.push(u)})})),Promise.resolve())).then(()=>(l.file("meta.json",JSON.stringify(a,null,4)),l.generateAsync({type:"blob"}))).then(e=>{let t;if(e.name=`${s}_${Th(new Date)}.zip`,r.length>0)throw t=new Error(`<ul class="error-list"><li>${r.join("</li><li>")}</li></ul>`),t.exportFile=e,t;return e})}};let Ih,Ah,Dh,Nh,Ph,Bh;const Rh="__autoSave_"+k.enketoId;let Mh=!1;function Oh(e){return Ji.record.get(e)}function Uh(){return Oh(Rh)}function zh(){let e;const t=[],n=[];let i;!Mh&&Bh&&(Mh=!0,Ah.prop("disabled",!0),tn.getOnlineStatus().then(e=>{if(e)return Ji.record.getAll(k.enketoId,!0)}).then(r=>{if(r&&0!==r.length)return console.debug(`Uploading queue of ${r.length} records.`),r.reduce((o,a)=>o.then(()=>Ji.record.get(a.instanceId).then(e=>(e.files=e.files.map(e=>(void 0===e.item.name&&(e.item.name=e.name),e.item)),Ph.update(e.instanceId,"ongoing","",t.length+n.length,r.length),tn.uploadRecord(e))).then(()=>(t.push(a.name),Ph.update(a.instanceId,"success","",t.length+n.length,r.length),Ji.record.remove(a.instanceId).then(()=>Ji.property.addSubmittedInstanceId(a)))).catch(o=>{401===o.status&&(i=!0),e=o.message||Kt.getErrorResponseMsg(o.status),n.push(a.name),Ph.update(a.instanceId,"error",e,t.length+n.length,r.length)}).then(()=>{t.length+n.length===r.length&&(Mh=!1,i?Kt.confirmLogin():t.length>0&&document.dispatchEvent(yt.QueueSubmissionSuccess(t)),Fh())})),Promise.resolve());Mh=!1}))}function Fh(){let e;return Ih.prop("disabled",!0),Ah.prop("disabled",!0),Dh=T(".record-list__records"),Bh=!1,Ji.record.getAll(k.enketoId).then(t=>{t=(t=t||[]).filter(e=>e.instanceId!==Rh),Nh.text(t.length),0===t.length?Dh.empty().append(`<li class="record-list__records--none" data-i18n="record-list.norecords">${dt("record-list.norecords")}</li>`):(Dh.find(".record-list__records--none").remove(),Ih.prop("disabled",!1)),Dh.find(".record-list__records__record").each((function(){const e=T(this);t.some(t=>e.attr("data-id")===t.instanceId)||e.next(".msg").addBack().remove()})),t.forEach(t=>{t.draft||(Bh=!0,Ah.prop("disabled",!1)),e=Ph._getLi(t.instanceId),0===e.length&&(e=T('<li class="record-list__records__record" />').attr("data-id",t.instanceId).appendTo(Dh)),e.text(t.name).attr("data-draft",!!t.draft)})})}Ph={_getLi:e=>T(`.record-list__records__record[data-id="${e}"]`),_reset(e){const t=T(".record-list__records").find("li");t.first().attr("data-id")===e&&t.removeClass("ongoing success error").filter((function(){return!T(this).hasClass("record-list__records__record")})).remove()},_updateClass(e,t){e.removeClass("ongoing success error").addClass(t)},_updateProgressBar(e,t){let n;n=T(".record-list__upload-progress").attr({max:t,value:e}),e===t||1===t?n.css("visibility","hidden"):n.css("visibility","visible")},_getMsg:(e,t)=>"error"===e?t:"",update(e,t,n,i,r){let o;const a=this._getLi(e),s=this._getMsg(t,n);this._reset(e),s&&(o=T(`<li data-id="${e}" class="record-list__records__msg ${t}">${s}</li>`).insertAfter(a),window.setTimeout(()=>{o.hide(600)},3e3)),this._updateClass(a,t),"success"===t&&a.hide(1500),i&&r&&this._updateProgressBar(i,r)}};var Vh={init:function(){return setTimeout(()=>{zh()},3e4),setInterval(()=>{zh()},3e5),Ih=T(".record-list__button-bar__button.export"),Ah=T(".record-list__button-bar__button.upload"),Nh=T(".offline-enabled__queue-length"),Fh()},get:Oh,set:function(e){return Uh().then(t=>(t&&(e.files=t.files),Ji.record.set(e))).then(Fh)},update:function(e){return Ji.record.update(e).then(Fh)},remove:function(e){return Ji.record.remove(e).then(Fh)},getAutoSavedKey:function(){return Rh},getAutoSavedRecord:Uh,updateAutoSavedRecord:function(e){return e.draft=!0,e.name="__autoSave_"+Date.now(),e.instanceId=Rh,e.enketoId=k.enketoId,Ji.record.update(e)},removeAutoSavedRecord:function(){return Ji.record.remove(Rh)},flush:function(){return Ji.flushTable("records").then(()=>Ji.flushTable("files")).then(()=>{console.log("Done! The record store is empty now.")})},getCounterValue:function(e){return Ji.property.getSurveyStats(e).then(e=>!e||isNaN(e.recordCount)?1:e.recordCount+1)},setActive:function(e){k.recordId=e,T(".record-list__records").find(".active").removeClass("active").addBack().find(`[data-id="${e}"]`).addClass("active")},uploadQueue:zh,exportToZip:function(e){return Ih.prop("disabled",!0),Lh.recordsToZip(k.enketoId,e).then(e=>(Ih.prop("disabled",!1),e)).catch(e=>{throw Ih.prop("disabled",!1),e})}},qh={options:{usePureJavaScript:!1}},jh={},$h=jh,Hh={};jh.encode=function(e,t,n){if("string"!=typeof t)throw new TypeError('"alphabet" must be a string.');if(void 0!==n&&"number"!=typeof n)throw new TypeError('"maxline" must be a number.');var i="";if(e instanceof Uint8Array){var r=0,o=t.length,a=t.charAt(0),s=[0];for(r=0;r<e.length;++r){for(var l=0,u=e[r];l<s.length;++l)u+=s[l]<<8,s[l]=u%o,u=u/o|0;for(;u>0;)s.push(u%o),u=u/o|0}for(r=0;0===e[r]&&r<e.length-1;++r)i+=a;for(r=s.length-1;r>=0;--r)i+=t[s[r]]}else i=function(e,t){var n=0,i=t.length,r=t.charAt(0),o=[0];for(n=0;n<e.length();++n){for(var a=0,s=e.at(n);a<o.length;++a)s+=o[a]<<8,o[a]=s%i,s=s/i|0;for(;s>0;)o.push(s%i),s=s/i|0}var l="";for(n=0;0===e.at(n)&&n<e.length()-1;++n)l+=r;for(n=o.length-1;n>=0;--n)l+=t[o[n]];return l}(e,t);if(n){var c=new RegExp(".{1,"+n+"}","g");i=i.match(c).join("\r\n")}return i},jh.decode=function(e,t){if("string"!=typeof e)throw new TypeError('"input" must be a string.');if("string"!=typeof t)throw new TypeError('"alphabet" must be a string.');var n=Hh[t];if(!n){n=Hh[t]=[];for(var i=0;i<t.length;++i)n[t.charCodeAt(i)]=i}e=e.replace(/\s/g,"");var r=t.length,o=t.charAt(0),a=[0];for(i=0;i<e.length;i++){var s=n[e.charCodeAt(i)];if(void 0===s)return;for(var l=0,u=s;l<a.length;++l)u+=a[l]*r,a[l]=255&u,u>>=8;for(;u>0;)a.push(255&u),u>>=8}for(var c=0;e[c]===o&&c<e.length-1;++c)a.push(0);return void 0!==Do?Do.from(a.reverse()):new Uint8Array(a.reverse())};u((function(e){var t=e.exports=qh.util=qh.util||{};function n(e){if(8!==e&&16!==e&&24!==e&&32!==e)throw new Error("Only 8, 16, 24, or 32 bits supported: "+e)}function i(e){if(this.data="",this.read=0,"string"==typeof e)this.data=e;else if(t.isArrayBuffer(e)||t.isArrayBufferView(e))if(void 0!==Do&&e instanceof Do)this.data=e.toString("binary");else{var n=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,n)}catch(e){for(var r=0;r<n.length;++r)this.putByte(n[r])}}else(e instanceof i||"object"==typeof e&&"string"==typeof e.data&&"number"==typeof e.read)&&(this.data=e.data,this.read=e.read);this._constructedStringLength=0}!function(){if("function"==typeof setImmediate)return t.setImmediate=function(){return setImmediate.apply(void 0,arguments)},void(t.nextTick=function(e){return setImmediate(e)});if(t.setImmediate=function(e){setTimeout(e,0)},"undefined"!=typeof window&&"function"==typeof window.postMessage){var e="forge.setImmediate",n=[];t.setImmediate=function(t){n.push(t),1===n.length&&window.postMessage(e,"*")},window.addEventListener("message",(function(t){if(t.source===window&&t.data===e){t.stopPropagation();var i=n.slice();n.length=0,i.forEach((function(e){e()}))}}),!0)}if("undefined"!=typeof MutationObserver){var i=Date.now(),r=!0,o=document.createElement("div");n=[];new MutationObserver((function(){var e=n.slice();n.length=0,e.forEach((function(e){e()}))})).observe(o,{attributes:!0});var a=t.setImmediate;t.setImmediate=function(e){Date.now()-i>15?(i=Date.now(),a(e)):(n.push(e),1===n.length&&o.setAttribute("a",r=!r))}}t.nextTick=t.setImmediate}(),t.isNodejs=void 0!==xn&&xn.versions&&xn.versions.node,t.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.isArrayBuffer=function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer},t.isArrayBufferView=function(e){return e&&t.isArrayBuffer(e.buffer)&&void 0!==e.byteLength},t.ByteBuffer=i,t.ByteStringBuffer=i;t.ByteStringBuffer.prototype._optimizeConstructedString=function(e){this._constructedStringLength+=e,this._constructedStringLength>4096&&(this.data.substr(0,1),this._constructedStringLength=0)},t.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},t.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},t.ByteStringBuffer.prototype.putByte=function(e){return this.putBytes(String.fromCharCode(e))},t.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var n=this.data;t>0;)1&t&&(n+=e),(t>>>=1)>0&&(e+=e);return this.data=n,this._optimizeConstructedString(t),this},t.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this._optimizeConstructedString(e.length),this},t.ByteStringBuffer.prototype.putString=function(e){return this.putBytes(t.encodeUtf8(e))},t.ByteStringBuffer.prototype.putInt16=function(e){return this.putBytes(String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},t.ByteStringBuffer.prototype.putInt24=function(e){return this.putBytes(String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},t.ByteStringBuffer.prototype.putInt32=function(e){return this.putBytes(String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},t.ByteStringBuffer.prototype.putInt16Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255))},t.ByteStringBuffer.prototype.putInt24Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255))},t.ByteStringBuffer.prototype.putInt32Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255))},t.ByteStringBuffer.prototype.putInt=function(e,t){n(t);var i="";do{t-=8,i+=String.fromCharCode(e>>t&255)}while(t>0);return this.putBytes(i)},t.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},t.ByteStringBuffer.prototype.putBuffer=function(e){return this.putBytes(e.getBytes())},t.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},t.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},t.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},t.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},t.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},t.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},t.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},t.ByteStringBuffer.prototype.getInt=function(e){n(e);var t=0;do{t=(t<<8)+this.data.charCodeAt(this.read++),e-=8}while(e>0);return t},t.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),n=2<<e-2;return t>=n&&(t-=n<<1),t},t.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},t.ByteStringBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},t.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},t.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},t.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},t.ByteStringBuffer.prototype.copy=function(){var e=t.createBuffer(this.data);return e.read=this.read,e},t.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},t.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},t.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},t.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var n=this.data.charCodeAt(t);n<16&&(e+="0"),e+=n.toString(16)}return e},t.ByteStringBuffer.prototype.toString=function(){return t.decodeUtf8(this.bytes())},t.DataBuffer=function(e,n){n=n||{},this.read=n.readOffset||0,this.growSize=n.growSize||1024;var i=t.isArrayBuffer(e),r=t.isArrayBufferView(e);if(i||r)return this.data=i?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in n?n.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!=e&&this.putBytes(e),"writeOffset"in n&&(this.write=n.writeOffset)},t.DataBuffer.prototype.length=function(){return this.write-this.read},t.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},t.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var n=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),i=new Uint8Array(this.length()+t);return i.set(n),this.data=new DataView(i.buffer),this},t.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},t.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var n=0;n<t;++n)this.data.setUint8(e);return this},t.DataBuffer.prototype.putBytes=function(e,n){if(t.isArrayBufferView(e)){var i=(r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).byteLength-r.byteOffset;return this.accommodate(i),new Uint8Array(this.data.buffer,this.write).set(r),this.write+=i,this}if(t.isArrayBuffer(e)){var r=new Uint8Array(e);return this.accommodate(r.byteLength),new Uint8Array(this.data.buffer).set(r,this.write),this.write+=r.byteLength,this}if(e instanceof t.DataBuffer||"object"==typeof e&&"number"==typeof e.read&&"number"==typeof e.write&&t.isArrayBufferView(e.data)){r=new Uint8Array(e.data.byteLength,e.read,e.length());return this.accommodate(r.byteLength),new Uint8Array(e.data.byteLength,this.write).set(r),this.write+=r.byteLength,this}if(e instanceof t.ByteStringBuffer&&(e=e.data,n="binary"),n=n||"binary","string"==typeof e){var o;if("hex"===n)return this.accommodate(Math.ceil(e.length/2)),o=new Uint8Array(this.data.buffer,this.write),this.write+=t.binary.hex.decode(e,o,this.write),this;if("base64"===n)return this.accommodate(3*Math.ceil(e.length/4)),o=new Uint8Array(this.data.buffer,this.write),this.write+=t.binary.base64.decode(e,o,this.write),this;if("utf8"===n&&(e=t.encodeUtf8(e),n="binary"),"binary"===n||"raw"===n)return this.accommodate(e.length),o=new Uint8Array(this.data.buffer,this.write),this.write+=t.binary.raw.decode(o),this;if("utf16"===n)return this.accommodate(2*e.length),o=new Uint16Array(this.data.buffer,this.write),this.write+=t.text.utf16.encode(o),this;throw new Error("Invalid encoding: "+n)}throw Error("Invalid parameter: "+e)},t.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},t.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},t.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},t.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},t.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},t.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},t.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},t.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},t.DataBuffer.prototype.putInt=function(e,t){n(t),this.accommodate(t/8);do{t-=8,this.data.setInt8(this.write++,e>>t&255)}while(t>0);return this},t.DataBuffer.prototype.putSignedInt=function(e,t){return n(t),this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},t.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},t.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},t.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},t.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},t.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},t.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},t.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},t.DataBuffer.prototype.getInt=function(e){n(e);var t=0;do{t=(t<<8)+this.data.getInt8(this.read++),e-=8}while(e>0);return t},t.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),n=2<<e-2;return t>=n&&(t-=n<<1),t},t.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},t.DataBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},t.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},t.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},t.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},t.DataBuffer.prototype.copy=function(){return new t.DataBuffer(this)},t.DataBuffer.prototype.compact=function(){if(this.read>0){var e=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(e.byteLength);t.set(e),this.data=new DataView(t),this.write-=this.read,this.read=0}return this},t.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},t.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},t.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var n=this.data.getUint8(t);n<16&&(e+="0"),e+=n.toString(16)}return e},t.DataBuffer.prototype.toString=function(e){var n=new Uint8Array(this.data,this.read,this.length());if("binary"===(e=e||"utf8")||"raw"===e)return t.binary.raw.encode(n);if("hex"===e)return t.binary.hex.encode(n);if("base64"===e)return t.binary.base64.encode(n);if("utf8"===e)return t.text.utf8.decode(n);if("utf16"===e)return t.text.utf16.decode(n);throw new Error("Invalid encoding: "+e)},t.createBuffer=function(e,n){return n=n||"raw",void 0!==e&&"utf8"===n&&(e=t.encodeUtf8(e)),new t.ByteBuffer(e)},t.fillString=function(e,t){for(var n="";t>0;)1&t&&(n+=e),(t>>>=1)>0&&(e+=e);return n},t.xorBytes=function(e,t,n){for(var i="",r="",o="",a=0,s=0;n>0;--n,++a)r=e.charCodeAt(a)^t.charCodeAt(a),s>=10&&(i+=o,o="",s=0),o+=String.fromCharCode(r),++s;return i+=o},t.hexToBytes=function(e){var t="",n=0;for(!0&e.length&&(n=1,t+=String.fromCharCode(parseInt(e[0],16)));n<e.length;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t},t.bytesToHex=function(e){return t.createBuffer(e).toHex()},t.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],a="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";t.encode64=function(e,t){for(var n,i,o,a="",s="",l=0;l<e.length;)n=e.charCodeAt(l++),i=e.charCodeAt(l++),o=e.charCodeAt(l++),a+=r.charAt(n>>2),a+=r.charAt((3&n)<<4|i>>4),isNaN(i)?a+="==":(a+=r.charAt((15&i)<<2|o>>6),a+=isNaN(o)?"=":r.charAt(63&o)),t&&a.length>t&&(s+=a.substr(0,t)+"\r\n",a=a.substr(t));return s+=a},t.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,n,i,r,a="",s=0;s<e.length;)t=o[e.charCodeAt(s++)-43],n=o[e.charCodeAt(s++)-43],i=o[e.charCodeAt(s++)-43],r=o[e.charCodeAt(s++)-43],a+=String.fromCharCode(t<<2|n>>4),64!==i&&(a+=String.fromCharCode((15&n)<<4|i>>2),64!==r&&(a+=String.fromCharCode((3&i)<<6|r)));return a},t.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},t.decodeUtf8=function(e){return decodeURIComponent(escape(e))},t.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:$h.encode,decode:$h.decode}},t.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},t.binary.raw.decode=function(e,t,n){var i=t;i||(i=new Uint8Array(e.length));for(var r=n=n||0,o=0;o<e.length;++o)i[r++]=e.charCodeAt(o);return t?r-n:i},t.binary.hex.encode=t.bytesToHex,t.binary.hex.decode=function(e,t,n){var i=t;i||(i=new Uint8Array(Math.ceil(e.length/2)));var r=0,o=n=n||0;for(1&e.length&&(r=1,i[o++]=parseInt(e[0],16));r<e.length;r+=2)i[o++]=parseInt(e.substr(r,2),16);return t?o-n:i},t.binary.base64.encode=function(e,t){for(var n,i,o,a="",s="",l=0;l<e.byteLength;)n=e[l++],i=e[l++],o=e[l++],a+=r.charAt(n>>2),a+=r.charAt((3&n)<<4|i>>4),isNaN(i)?a+="==":(a+=r.charAt((15&i)<<2|o>>6),a+=isNaN(o)?"=":r.charAt(63&o)),t&&a.length>t&&(s+=a.substr(0,t)+"\r\n",a=a.substr(t));return s+=a},t.binary.base64.decode=function(e,t,n){var i,r,a,s,l=t;l||(l=new Uint8Array(3*Math.ceil(e.length/4))),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var u=0,c=n=n||0;u<e.length;)i=o[e.charCodeAt(u++)-43],r=o[e.charCodeAt(u++)-43],a=o[e.charCodeAt(u++)-43],s=o[e.charCodeAt(u++)-43],l[c++]=i<<2|r>>4,64!==a&&(l[c++]=(15&r)<<4|a>>2,64!==s&&(l[c++]=(3&a)<<6|s));return t?c-n:l.subarray(0,c)},t.binary.base58.encode=function(e,n){return t.binary.baseN.encode(e,a,n)},t.binary.base58.decode=function(e,n){return t.binary.baseN.decode(e,a,n)},t.text={utf8:{},utf16:{}},t.text.utf8.encode=function(e,n,i){e=t.encodeUtf8(e);var r=n;r||(r=new Uint8Array(e.length));for(var o=i=i||0,a=0;a<e.length;++a)r[o++]=e.charCodeAt(a);return n?o-i:r},t.text.utf8.decode=function(e){return t.decodeUtf8(String.fromCharCode.apply(null,e))},t.text.utf16.encode=function(e,t,n){var i=t;i||(i=new Uint8Array(2*e.length));for(var r=new Uint16Array(i.buffer),o=n=n||0,a=n,s=0;s<e.length;++s)r[a++]=e.charCodeAt(s),o+=2;return t?o-n:i},t.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},t.deflate=function(e,n,i){if(n=t.decode64(e.deflate(t.encode64(n)).rval),i){var r=2;32&n.charCodeAt(1)&&(r=6),n=n.substring(r,n.length-4)}return n},t.inflate=function(e,n,i){var r=e.inflate(t.encode64(n)).rval;return null===r?null:t.decode64(r)};var s=function(e,n,i){if(!e)throw new Error("WebStorage not available.");var r;if(null===i?r=e.removeItem(n):(i=t.encode64(JSON.stringify(i)),r=e.setItem(n,i)),void 0!==r&&!0!==r.rval){var o=new Error(r.error.message);throw o.id=r.error.id,o.name=r.error.name,o}},l=function(e,n){if(!e)throw new Error("WebStorage not available.");var i=e.getItem(n);if(e.init)if(null===i.rval){if(i.error){var r=new Error(i.error.message);throw r.id=i.error.id,r.name=i.error.name,r}i=null}else i=i.rval;return null!==i&&(i=JSON.parse(t.decode64(i))),i},u=function(e,t,n,i){var r=l(e,t);null===r&&(r={}),r[n]=i,s(e,t,r)},c=function(e,t,n){var i=l(e,t);return null!==i&&(i=n in i?i[n]:null),i},h=function(e,t,n){var i=l(e,t);if(null!==i&&n in i){delete i[n];var r=!0;for(var o in i){r=!1;break}r&&(i=null),s(e,t,i)}},d=function(e,t){s(e,t,null)},p=function(e,t,n){var i,r=null;void 0===n&&(n=["web","flash"]);var o=!1,a=null;for(var s in n){i=n[s];try{if("flash"===i||"both"===i){if(null===t[0])throw new Error("Flash local storage not available.");r=e.apply(this,t),o="flash"===i}"web"!==i&&"both"!==i||(t[0]=localStorage,r=e.apply(this,t),o=!0)}catch(e){a=e}if(o)break}if(!o)throw a;return r};t.setItem=function(e,t,n,i,r){p(u,arguments,r)},t.getItem=function(e,t,n,i){return p(c,arguments,i)},t.removeItem=function(e,t,n,i){p(h,arguments,i)},t.clearItems=function(e,t,n){p(d,arguments,n)},t.parseUrl=function(e){var t=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;t.lastIndex=0;var n=t.exec(e),i=null===n?null:{full:e,scheme:n[1],host:n[2],port:n[3],path:n[4]};return i&&(i.fullHost=i.host,i.port?(80!==i.port&&"http"===i.scheme||443!==i.port&&"https"===i.scheme)&&(i.fullHost+=":"+i.port):"http"===i.scheme?i.port=80:"https"===i.scheme&&(i.port=443),i.full=i.scheme+"://"+i.fullHost),i};var f=null;t.getQueryVariables=function(e){var t,n=function(e){for(var t={},n=e.split("&"),i=0;i<n.length;i++){var r,o,a=n[i].indexOf("=");a>0?(r=n[i].substring(0,a),o=n[i].substring(a+1)):(r=n[i],o=null),r in t||(t[r]=[]),r in Object.prototype||null===o||t[r].push(unescape(o))}return t};return void 0===e?(null===f&&(f="undefined"!=typeof window&&window.location&&window.location.search?n(window.location.search.substring(1)):{}),t=f):t=n(e),t},t.parseFragment=function(e){var n=e,i="",r=e.indexOf("?");r>0&&(n=e.substring(0,r),i=e.substring(r+1));var o=n.split("/");return o.length>0&&""===o[0]&&o.shift(),{pathString:n,queryString:i,path:o,query:""===i?{}:t.getQueryVariables(i)}},t.makeRequest=function(e){var n=t.parseFragment(e),i={path:n.pathString,query:n.queryString,getPath:function(e){return void 0===e?n.path:n.path[e]},getQuery:function(e,t){var i;return void 0===e?i=n.query:(i=n.query[e])&&void 0!==t&&(i=i[t]),i},getQueryLast:function(e,t){var n=i.getQuery(e);return n?n[n.length-1]:t}};return i},t.makeLink=function(e,t,n){e=jQuery.isArray(e)?e.join("/"):e;var i=jQuery.param(t||{});return n=n||"",e+(i.length>0?"?"+i:"")+(n.length>0?"#"+n:"")},t.setPath=function(e,t,n){if("object"==typeof e&&null!==e)for(var i=0,r=t.length;i<r;){var o=t[i++];if(i==r)e[o]=n;else{var a=o in e;(!a||a&&"object"!=typeof e[o]||a&&null===e[o])&&(e[o]={}),e=e[o]}}},t.getPath=function(e,t,n){for(var i=0,r=t.length,o=!0;o&&i<r&&"object"==typeof e&&null!==e;){var a=t[i++];(o=a in e)&&(e=e[a])}return o?e:n},t.deletePath=function(e,t){if("object"==typeof e&&null!==e)for(var n=0,i=t.length;n<i;){var r=t[n++];if(n==i)delete e[r];else{if(!(r in e)||"object"!=typeof e[r]||null===e[r])break;e=e[r]}}},t.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},t.format=function(e){for(var t,n,i=/%./g,r=0,o=[],a=0;t=i.exec(e);){(n=e.substring(a,i.lastIndex-2)).length>0&&o.push(n),a=i.lastIndex;var s=t[0][1];switch(s){case"s":case"o":r<arguments.length?o.push(arguments[1+r++]):o.push("<?>");break;case"%":o.push("%");break;default:o.push("<%"+s+"?>")}}return o.push(e.substring(a)),o.join("")},t.formatNumber=function(e,t,n,i){var r=e,o=isNaN(t=Math.abs(t))?2:t,a=void 0===n?",":n,s=void 0===i?".":i,l=r<0?"-":"",u=parseInt(r=Math.abs(+r||0).toFixed(o),10)+"",c=u.length>3?u.length%3:0;return l+(c?u.substr(0,c)+s:"")+u.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+s)+(o?a+Math.abs(r-u).toFixed(o).slice(2):"")},t.formatSize=function(e){return e=e>=1073741824?t.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?t.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?t.formatNumber(e/1024,0)+" KiB":t.formatNumber(e,0)+" bytes"},t.bytesFromIP=function(e){return-1!==e.indexOf(".")?t.bytesFromIPv4(e):-1!==e.indexOf(":")?t.bytesFromIPv6(e):null},t.bytesFromIPv4=function(e){if(4!==(e=e.split(".")).length)return null;for(var n=t.createBuffer(),i=0;i<e.length;++i){var r=parseInt(e[i],10);if(isNaN(r))return null;n.putByte(r)}return n.getBytes()},t.bytesFromIPv6=function(e){for(var n=0,i=2*(8-(e=e.split(":").filter((function(e){return 0===e.length&&++n,!0}))).length+n),r=t.createBuffer(),o=0;o<8;++o)if(e[o]&&0!==e[o].length){var a=t.hexToBytes(e[o]);a.length<2&&r.putByte(0),r.putBytes(a)}else r.fillWithByte(0,i),i=0;return r.getBytes()},t.bytesToIP=function(e){return 4===e.length?t.bytesToIPv4(e):16===e.length?t.bytesToIPv6(e):null},t.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t.join(".")},t.bytesToIPv6=function(e){if(16!==e.length)return null;for(var n=[],i=[],r=0,o=0;o<e.length;o+=2){for(var a=t.bytesToHex(e[o]+e[o+1]);"0"===a[0]&&"0"!==a;)a=a.substr(1);if("0"===a){var s=i[i.length-1],l=n.length;s&&l===s.end+1?(s.end=l,s.end-s.start>i[r].end-i[r].start&&(r=i.length-1)):i.push({start:l,end:l})}n.push(a)}if(i.length>0){var u=i[r];u.end-u.start>0&&(n.splice(u.start,u.end-u.start+1,""),0===u.start&&n.unshift(""),7===u.end&&n.push(""))}return n.join(":")},t.estimateCores=function(e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},"cores"in t&&!e.update)return n(null,t.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return t.cores=navigator.hardwareConcurrency,n(null,t.cores);if("undefined"==typeof Worker)return t.cores=1,n(null,t.cores);if("undefined"==typeof Blob)return t.cores=2,n(null,t.cores);var i=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",(function(e){var t=Date.now(),n=t+4;self.postMessage({st:t,et:n})}))}.toString(),")()"],{type:"application/javascript"}));!function e(r,o,a){if(0===o){var s=Math.floor(r.reduce((function(e,t){return e+t}),0)/r.length);return t.cores=Math.max(1,s),URL.revokeObjectURL(i),n(null,t.cores)}!function(e,t){for(var n=[],r=[],o=0;o<e;++o){var a=new Worker(i);a.addEventListener("message",(function(i){if(r.push(i.data),r.length===e){for(var o=0;o<e;++o)n[o].terminate();t(null,r)}})),n.push(a)}for(o=0;o<e;++o)n[o].postMessage(o)}(a,(function(t,n){r.push(function(e,t){for(var n=[],i=0;i<e;++i)for(var r=t[i],o=n[i]=[],a=0;a<e;++a)if(i!==a){var s=t[a];(r.st>s.st&&r.st<s.et||s.st>r.st&&s.st<r.et)&&o.push(a)}return n.reduce((function(e,t){return Math.max(e,t.length)}),0)}(a,n)),e(r,o-1,a)}))}([],5,16)}})),qh.cipher=qh.cipher||{};qh.cipher.algorithms=qh.cipher.algorithms||{},qh.cipher.createCipher=function(e,t){var n=e;if("string"==typeof n&&(n=qh.cipher.getAlgorithm(n))&&(n=n()),!n)throw new Error("Unsupported algorithm: "+e);return new qh.cipher.BlockCipher({algorithm:n,key:t,decrypt:!1})},qh.cipher.createDecipher=function(e,t){var n=e;if("string"==typeof n&&(n=qh.cipher.getAlgorithm(n))&&(n=n()),!n)throw new Error("Unsupported algorithm: "+e);return new qh.cipher.BlockCipher({algorithm:n,key:t,decrypt:!0})},qh.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),qh.cipher.algorithms[e]=t},qh.cipher.getAlgorithm=function(e){return(e=e.toUpperCase())in qh.cipher.algorithms?qh.cipher.algorithms[e]:null};var Wh=qh.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};Wh.prototype.start=function(e){e=e||{};var t={};for(var n in e)t[n]=e[n];t.decrypt=this._decrypt,this._finish=!1,this._input=qh.util.createBuffer(),this.output=e.output||qh.util.createBuffer(),this.mode.start(t)},Wh.prototype.update=function(e){for(e&&this._input.putBuffer(e);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},Wh.prototype.finish=function(e){!e||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(t){return e(this.blockSize,t,!1)},this.mode.unpad=function(t){return e(this.blockSize,t,!0)});var t={};return t.decrypt=this._decrypt,t.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,t))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)))};u((function(e){qh.cipher=qh.cipher||{};var t=e.exports=qh.cipher.modes=qh.cipher.modes||{};function n(e){if("string"==typeof e&&(e=qh.util.createBuffer(e)),qh.util.isArray(e)&&e.length>4){var t=e;e=qh.util.createBuffer();for(var n=0;n<t.length;++n)e.putByte(t[n])}return qh.util.isArray(e)||(e=[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]),e}function i(e){e[e.length-1]=e[e.length-1]+1&4294967295}function r(e){return[e/4294967296|0,4294967295&e]}t.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},t.ecb.prototype.start=function(e){},t.ecb.prototype.encrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(i=0;i<this._ints;++i)t.putInt32(this._outBlock[i])},t.ecb.prototype.decrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(i=0;i<this._ints;++i)t.putInt32(this._outBlock[i])},t.ecb.prototype.pad=function(e,t){var n=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(n,n),!0},t.ecb.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var n=e.length(),i=e.at(n-1);return!(i>this.blockSize<<2)&&(e.truncate(i),!0)},t.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},t.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=n(e.iv),this._prev=this._iv.slice(0)}},t.cbc.prototype.encrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var i=0;i<this._ints;++i)this._inBlock[i]=this._prev[i]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(i=0;i<this._ints;++i)t.putInt32(this._outBlock[i]);this._prev=this._outBlock},t.cbc.prototype.decrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(i=0;i<this._ints;++i)t.putInt32(this._prev[i]^this._outBlock[i]);this._prev=this._inBlock.slice(0)},t.cbc.prototype.pad=function(e,t){var n=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(n,n),!0},t.cbc.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var n=e.length(),i=e.at(n-1);return!(i>this.blockSize<<2)&&(e.truncate(i),!0)},t.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=qh.util.createBuffer(),this._partialBytes=0},t.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=n(e.iv),this._inBlock=this._iv.slice(0),this._partialBytes=0},t.cfb.prototype.encrypt=function(e,t,n){var i=e.length();if(0===i)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&i>=this.blockSize)for(var r=0;r<this._ints;++r)this._inBlock[r]=e.getInt32()^this._outBlock[r],t.putInt32(this._inBlock[r]);else{var o=(this.blockSize-i)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialBlock[r]=e.getInt32()^this._outBlock[r],this._partialOutput.putInt32(this._partialBlock[r]);if(o>0)e.read-=this.blockSize;else for(r=0;r<this._ints;++r)this._inBlock[r]=this._partialBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!n)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0}},t.cfb.prototype.decrypt=function(e,t,n){var i=e.length();if(0===i)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&i>=this.blockSize)for(var r=0;r<this._ints;++r)this._inBlock[r]=e.getInt32(),t.putInt32(this._inBlock[r]^this._outBlock[r]);else{var o=(this.blockSize-i)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialBlock[r]=e.getInt32(),this._partialOutput.putInt32(this._partialBlock[r]^this._outBlock[r]);if(o>0)e.read-=this.blockSize;else for(r=0;r<this._ints;++r)this._inBlock[r]=this._partialBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!n)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0}},t.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=qh.util.createBuffer(),this._partialBytes=0},t.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=n(e.iv),this._inBlock=this._iv.slice(0),this._partialBytes=0},t.ofb.prototype.encrypt=function(e,t,n){var i=e.length();if(0===e.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&i>=this.blockSize)for(var r=0;r<this._ints;++r)t.putInt32(e.getInt32()^this._outBlock[r]),this._inBlock[r]=this._outBlock[r];else{var o=(this.blockSize-i)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialOutput.putInt32(e.getInt32()^this._outBlock[r]);if(o>0)e.read-=this.blockSize;else for(r=0;r<this._ints;++r)this._inBlock[r]=this._outBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!n)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0}},t.ofb.prototype.decrypt=t.ofb.prototype.encrypt,t.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=qh.util.createBuffer(),this._partialBytes=0},t.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=n(e.iv),this._inBlock=this._iv.slice(0),this._partialBytes=0},t.ctr.prototype.encrypt=function(e,t,n){var r=e.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var o=0;o<this._ints;++o)t.putInt32(e.getInt32()^this._outBlock[o]);else{var a=(this.blockSize-r)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(o=0;o<this._ints;++o)this._partialOutput.putInt32(e.getInt32()^this._outBlock[o]);if(a>0&&(e.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!n)return t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}i(this._inBlock)},t.ctr.prototype.decrypt=t.ctr.prototype.encrypt,t.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=qh.util.createBuffer(),this._partialBytes=0,this._R=3774873600},t.gcm.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");var t,n=qh.util.createBuffer(e.iv);if(this._cipherLength=0,t="additionalData"in e?qh.util.createBuffer(e.additionalData):qh.util.createBuffer(),this._tagLength="tagLength"in e?e.tagLength:128,this._tag=null,e.decrypt&&(this._tag=qh.util.createBuffer(e.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var o=n.length();if(12===o)this._j0=[n.getInt32(),n.getInt32(),n.getInt32(),1];else{for(this._j0=[0,0,0,0];n.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[n.getInt32(),n.getInt32(),n.getInt32(),n.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(r(8*o)))}this._inBlock=this._j0.slice(0),i(this._inBlock),this._partialBytes=0,t=qh.util.createBuffer(t),this._aDataLength=r(8*t.length());var a=t.length()%this.blockSize;for(a&&t.fillWithByte(0,this.blockSize-a),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])},t.gcm.prototype.encrypt=function(e,t,n){var r=e.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize){for(var o=0;o<this._ints;++o)t.putInt32(this._outBlock[o]^=e.getInt32());this._cipherLength+=this.blockSize}else{var a=(this.blockSize-r)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(o=0;o<this._ints;++o)this._partialOutput.putInt32(e.getInt32()^this._outBlock[o]);if(0===a||n){if(n){var s=r%this.blockSize;this._cipherLength+=s,this._partialOutput.truncate(this.blockSize-s)}else this._cipherLength+=this.blockSize;for(o=0;o<this._ints;++o)this._outBlock[o]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!n)return e.read-=this.blockSize,t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),i(this._inBlock)},t.gcm.prototype.decrypt=function(e,t,n){var r=e.length();if(r<this.blockSize&&!(n&&r>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),i(this._inBlock),this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var o=0;o<this._ints;++o)t.putInt32(this._outBlock[o]^this._hashBlock[o]);r<this.blockSize?this._cipherLength+=r%this.blockSize:this._cipherLength+=this.blockSize},t.gcm.prototype.afterFinish=function(e,t){var n=!0;t.decrypt&&t.overflow&&e.truncate(this.blockSize-t.overflow),this.tag=qh.util.createBuffer();var i=this._aDataLength.concat(r(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,i);var o=[];this.cipher.encrypt(this._j0,o);for(var a=0;a<this._ints;++a)this.tag.putInt32(this._s[a]^o[a]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),t.decrypt&&this.tag.bytes()!==this._tag&&(n=!1),n},t.gcm.prototype.multiply=function(e,t){for(var n=[0,0,0,0],i=t.slice(0),r=0;r<128;++r){e[r/32|0]&1<<31-r%32&&(n[0]^=i[0],n[1]^=i[1],n[2]^=i[2],n[3]^=i[3]),this.pow(i,i)}return n},t.gcm.prototype.pow=function(e,t){for(var n=1&e[3],i=3;i>0;--i)t[i]=e[i]>>>1|(1&e[i-1])<<31;t[0]=e[0]>>>1,n&&(t[0]^=this._R)},t.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],n=0;n<32;++n){var i=e[n/8|0]>>>4*(7-n%8)&15,r=this._m[n][i];t[0]^=r[0],t[1]^=r[1],t[2]^=r[2],t[3]^=r[3]}return t},t.gcm.prototype.ghash=function(e,t,n){return t[0]^=n[0],t[1]^=n[1],t[2]^=n[2],t[3]^=n[3],this.tableMultiply(t)},t.gcm.prototype.generateHashTable=function(e,t){for(var n=8/t,i=4*n,r=16*n,o=new Array(r),a=0;a<r;++a){var s=[0,0,0,0],l=(i-1-a%i)*t;s[a/i|0]=1<<t-1<<l,o[a]=this.generateSubHashTable(this.multiply(s,e),t)}return o},t.gcm.prototype.generateSubHashTable=function(e,t){var n=1<<t,i=n>>>1,r=new Array(n);r[i]=e.slice(0);for(var o=i>>>1;o>0;)this.pow(r[2*o],r[o]=[]),o>>=1;for(o=2;o<i;){for(var a=1;a<o;++a){var s=r[o],l=r[a];r[o+a]=[s[0]^l[0],s[1]^l[1],s[2]^l[2],s[3]^l[3]]}o*=2}for(r[0]=[0,0,0,0],o=i+1;o<n;++o){var u=r[o^i];r[o]=[e[0]^u[0],e[1]^u[1],e[2]^u[2],e[3]^u[3]]}return r}})),qh.aes=qh.aes||{};function Kh(e,t){qh.cipher.registerAlgorithm(e,(function(){return new qh.aes.Algorithm(e,t)}))}qh.aes.startEncrypting=function(e,t,n,i){var r=id({key:e,output:n,decrypt:!1,mode:i});return r.start(t),r},qh.aes.createEncryptionCipher=function(e,t){return id({key:e,output:null,decrypt:!1,mode:t})},qh.aes.startDecrypting=function(e,t,n,i){var r=id({key:e,output:n,decrypt:!0,mode:i});return r.start(t),r},qh.aes.createDecryptionCipher=function(e,t){return id({key:e,output:null,decrypt:!0,mode:t})},qh.aes.Algorithm=function(e,t){Jh||ed();var n=this;n.name=e,n.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return nd(n._w,e,t,!1)},decrypt:function(e,t){return nd(n._w,e,t,!0)}}}),n._init=!1},qh.aes.Algorithm.prototype.initialize=function(e){if(!this._init){var t,n=e.key;if("string"!=typeof n||16!==n.length&&24!==n.length&&32!==n.length){if(qh.util.isArray(n)&&(16===n.length||24===n.length||32===n.length)){t=n,n=qh.util.createBuffer();for(var i=0;i<t.length;++i)n.putByte(t[i])}}else n=qh.util.createBuffer(n);if(!qh.util.isArray(n)){t=n,n=[];var r=t.length();if(16===r||24===r||32===r){r>>>=2;for(i=0;i<r;++i)n.push(t.getInt32())}}if(!qh.util.isArray(n)||4!==n.length&&6!==n.length&&8!==n.length)throw new Error("Invalid key parameter.");var o=this.mode.name,a=-1!==["CFB","OFB","CTR","GCM"].indexOf(o);this._w=td(n,e.decrypt&&!a),this._init=!0}},qh.aes._expandKey=function(e,t){return Jh||ed(),td(e,t)},qh.aes._updateBlock=nd,Kh("AES-ECB",qh.cipher.modes.ecb),Kh("AES-CBC",qh.cipher.modes.cbc),Kh("AES-CFB",qh.cipher.modes.cfb),Kh("AES-OFB",qh.cipher.modes.ofb),Kh("AES-CTR",qh.cipher.modes.ctr),Kh("AES-GCM",qh.cipher.modes.gcm);var Gh,Zh,Yh,Xh,Qh,Jh=!1;function ed(){Jh=!0,Yh=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;Gh=new Array(256),Zh=new Array(256),Xh=new Array(4),Qh=new Array(4);for(t=0;t<4;++t)Xh[t]=new Array(256),Qh[t]=new Array(256);var n,i,r,o,a,s,l,u=0,c=0;for(t=0;t<256;++t){o=(o=c^c<<1^c<<2^c<<3^c<<4)>>8^255&o^99,Gh[u]=o,Zh[o]=u,s=(a=e[o])<<24^o<<16^o<<8^o^a,l=((n=e[u])^(i=e[n])^(r=e[i]))<<24^(u^r)<<16^(u^i^r)<<8^u^n^r;for(var h=0;h<4;++h)Xh[h][u]=s,Qh[h][o]=l,s=s<<24|s>>>8,l=l<<24|l>>>8;0===u?u=c=1:(u=n^e[e[e[n^r]]],c^=e[e[c]])}}function td(e,t){for(var n,i=e.slice(0),r=1,o=i.length,a=4*(o+6+1),s=o;s<a;++s)n=i[s-1],s%o==0?(n=Gh[n>>>16&255]<<24^Gh[n>>>8&255]<<16^Gh[255&n]<<8^Gh[n>>>24]^Yh[r]<<24,r++):o>6&&s%o==4&&(n=Gh[n>>>24]<<24^Gh[n>>>16&255]<<16^Gh[n>>>8&255]<<8^Gh[255&n]),i[s]=i[s-o]^n;if(t){for(var l,u=Qh[0],c=Qh[1],h=Qh[2],d=Qh[3],p=i.slice(0),f=(s=0,(a=i.length)-4);s<a;s+=4,f-=4)if(0===s||s===a-4)p[s]=i[f],p[s+1]=i[f+3],p[s+2]=i[f+2],p[s+3]=i[f+1];else for(var g=0;g<4;++g)l=i[f+g],p[s+(3&-g)]=u[Gh[l>>>24]]^c[Gh[l>>>16&255]]^h[Gh[l>>>8&255]]^d[Gh[255&l]];i=p}return i}function nd(e,t,n,i){var r,o,a,s,l,u,c,h,d,p,f,g,m=e.length/4-1;i?(r=Qh[0],o=Qh[1],a=Qh[2],s=Qh[3],l=Zh):(r=Xh[0],o=Xh[1],a=Xh[2],s=Xh[3],l=Gh),u=t[0]^e[0],c=t[i?3:1]^e[1],h=t[2]^e[2],d=t[i?1:3]^e[3];for(var v=3,y=1;y<m;++y)p=r[u>>>24]^o[c>>>16&255]^a[h>>>8&255]^s[255&d]^e[++v],f=r[c>>>24]^o[h>>>16&255]^a[d>>>8&255]^s[255&u]^e[++v],g=r[h>>>24]^o[d>>>16&255]^a[u>>>8&255]^s[255&c]^e[++v],d=r[d>>>24]^o[u>>>16&255]^a[c>>>8&255]^s[255&h]^e[++v],u=p,c=f,h=g;n[0]=l[u>>>24]<<24^l[c>>>16&255]<<16^l[h>>>8&255]<<8^l[255&d]^e[++v],n[i?3:1]=l[c>>>24]<<24^l[h>>>16&255]<<16^l[d>>>8&255]<<8^l[255&u]^e[++v],n[2]=l[h>>>24]<<24^l[d>>>16&255]<<16^l[u>>>8&255]<<8^l[255&c]^e[++v],n[i?1:3]=l[d>>>24]<<24^l[u>>>16&255]<<16^l[c>>>8&255]<<8^l[255&h]^e[++v]}function id(e){var t,n="AES-"+((e=e||{}).mode||"CBC").toUpperCase(),i=(t=e.decrypt?qh.cipher.createDecipher(n,e.key):qh.cipher.createCipher(n,e.key)).start;return t.start=function(e,n){var r=null;n instanceof qh.util.ByteBuffer&&(r=n,n={}),(n=n||{}).output=r,n.iv=e,i.call(t,n)},t}u((function(e){qh.pki=qh.pki||{};var t=e.exports=qh.pki.oids=qh.oids=qh.oids||{};function n(e,n){t[e]=n,t[n]=e}function i(e,n){t[e]=n}n("1.2.840.113549.1.1.1","rsaEncryption"),n("1.2.840.113549.1.1.4","md5WithRSAEncryption"),n("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),n("1.2.840.113549.1.1.7","RSAES-OAEP"),n("1.2.840.113549.1.1.8","mgf1"),n("1.2.840.113549.1.1.9","pSpecified"),n("1.2.840.113549.1.1.10","RSASSA-PSS"),n("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),n("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),n("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),n("1.2.840.10040.4.3","dsa-with-sha1"),n("1.3.14.3.2.7","desCBC"),n("1.3.14.3.2.26","sha1"),n("2.16.840.1.101.3.4.2.1","sha256"),n("2.16.840.1.101.3.4.2.2","sha384"),n("2.16.840.1.101.3.4.2.3","sha512"),n("1.2.840.113549.2.5","md5"),n("1.2.840.113549.1.7.1","data"),n("1.2.840.113549.1.7.2","signedData"),n("1.2.840.113549.1.7.3","envelopedData"),n("1.2.840.113549.1.7.4","signedAndEnvelopedData"),n("1.2.840.113549.1.7.5","digestedData"),n("1.2.840.113549.1.7.6","encryptedData"),n("1.2.840.113549.1.9.1","emailAddress"),n("1.2.840.113549.1.9.2","unstructuredName"),n("1.2.840.113549.1.9.3","contentType"),n("1.2.840.113549.1.9.4","messageDigest"),n("1.2.840.113549.1.9.5","signingTime"),n("1.2.840.113549.1.9.6","counterSignature"),n("1.2.840.113549.1.9.7","challengePassword"),n("1.2.840.113549.1.9.8","unstructuredAddress"),n("1.2.840.113549.1.9.14","extensionRequest"),n("1.2.840.113549.1.9.20","friendlyName"),n("1.2.840.113549.1.9.21","localKeyId"),n("1.2.840.113549.1.9.22.1","x509Certificate"),n("1.2.840.113549.1.12.10.1.1","keyBag"),n("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),n("1.2.840.113549.1.12.10.1.3","certBag"),n("1.2.840.113549.1.12.10.1.4","crlBag"),n("1.2.840.113549.1.12.10.1.5","secretBag"),n("1.2.840.113549.1.12.10.1.6","safeContentsBag"),n("1.2.840.113549.1.5.13","pkcs5PBES2"),n("1.2.840.113549.1.5.12","pkcs5PBKDF2"),n("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),n("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),n("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),n("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),n("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),n("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),n("1.2.840.113549.2.7","hmacWithSHA1"),n("1.2.840.113549.2.8","hmacWithSHA224"),n("1.2.840.113549.2.9","hmacWithSHA256"),n("1.2.840.113549.2.10","hmacWithSHA384"),n("1.2.840.113549.2.11","hmacWithSHA512"),n("1.2.840.113549.3.7","des-EDE3-CBC"),n("2.16.840.1.101.3.4.1.2","aes128-CBC"),n("2.16.840.1.101.3.4.1.22","aes192-CBC"),n("2.16.840.1.101.3.4.1.42","aes256-CBC"),n("2.5.4.3","commonName"),n("2.5.4.5","serialName"),n("2.5.4.6","countryName"),n("2.5.4.7","localityName"),n("2.5.4.8","stateOrProvinceName"),n("2.5.4.10","organizationName"),n("2.5.4.11","organizationalUnitName"),n("2.16.840.1.113730.1.1","nsCertType"),i("2.5.29.1","authorityKeyIdentifier"),i("2.5.29.2","keyAttributes"),i("2.5.29.3","certificatePolicies"),i("2.5.29.4","keyUsageRestriction"),i("2.5.29.5","policyMapping"),i("2.5.29.6","subtreesConstraint"),i("2.5.29.7","subjectAltName"),i("2.5.29.8","issuerAltName"),i("2.5.29.9","subjectDirectoryAttributes"),i("2.5.29.10","basicConstraints"),i("2.5.29.11","nameConstraints"),i("2.5.29.12","policyConstraints"),i("2.5.29.13","basicConstraints"),n("2.5.29.14","subjectKeyIdentifier"),n("2.5.29.15","keyUsage"),i("2.5.29.16","privateKeyUsagePeriod"),n("2.5.29.17","subjectAltName"),n("2.5.29.18","issuerAltName"),n("2.5.29.19","basicConstraints"),i("2.5.29.20","cRLNumber"),i("2.5.29.21","cRLReason"),i("2.5.29.22","expirationDate"),i("2.5.29.23","instructionCode"),i("2.5.29.24","invalidityDate"),i("2.5.29.25","cRLDistributionPoints"),i("2.5.29.26","issuingDistributionPoint"),i("2.5.29.27","deltaCRLIndicator"),i("2.5.29.28","issuingDistributionPoint"),i("2.5.29.29","certificateIssuer"),i("2.5.29.30","nameConstraints"),n("2.5.29.31","cRLDistributionPoints"),n("2.5.29.32","certificatePolicies"),i("2.5.29.33","policyMappings"),i("2.5.29.34","policyConstraints"),n("2.5.29.35","authorityKeyIdentifier"),i("2.5.29.36","policyConstraints"),n("2.5.29.37","extKeyUsage"),i("2.5.29.46","freshestCRL"),i("2.5.29.54","inhibitAnyPolicy"),n("1.3.6.1.4.1.11129.2.4.2","timestampList"),n("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),n("1.3.6.1.5.5.7.3.1","serverAuth"),n("1.3.6.1.5.5.7.3.2","clientAuth"),n("1.3.6.1.5.5.7.3.3","codeSigning"),n("1.3.6.1.5.5.7.3.4","emailProtection"),n("1.3.6.1.5.5.7.3.8","timeStamping")})),u((function(e){var t=e.exports=qh.asn1=qh.asn1||{};function n(e,t,n){if(n>t){var i=new Error("Too few bytes to parse DER.");throw i.available=e.length(),i.remaining=t,i.requested=n,i}}t.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},t.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},t.create=function(e,n,i,r,o){if(qh.util.isArray(r)){for(var a=[],s=0;s<r.length;++s)void 0!==r[s]&&a.push(r[s]);r=a}var l={tagClass:e,type:n,constructed:i,composed:i||qh.util.isArray(r),value:r};return o&&"bitStringContents"in o&&(l.bitStringContents=o.bitStringContents,l.original=t.copy(l)),l},t.copy=function(e,n){var i;if(qh.util.isArray(e)){i=[];for(var r=0;r<e.length;++r)i.push(t.copy(e[r],n));return i}return"string"==typeof e?e:(i={tagClass:e.tagClass,type:e.type,constructed:e.constructed,composed:e.composed,value:t.copy(e.value,n)},n&&!n.excludeBitStringContents&&(i.bitStringContents=e.bitStringContents),i)},t.equals=function(e,n,i){if(qh.util.isArray(e)){if(!qh.util.isArray(n))return!1;if(e.length!==n.length)return!1;for(var r=0;r<e.length;++r)if(!t.equals(e[r],n[r]))return!1;return!0}if(typeof e!=typeof n)return!1;if("string"==typeof e)return e===n;var o=e.tagClass===n.tagClass&&e.type===n.type&&e.constructed===n.constructed&&e.composed===n.composed&&t.equals(e.value,n.value);return i&&i.includeBitStringContents&&(o=o&&e.bitStringContents===n.bitStringContents),o},t.getBerValueLength=function(e){var t=e.getByte();if(128!==t)return 128&t?e.getInt((127&t)<<3):t};t.fromDer=function(e,i){return void 0===i&&(i={strict:!0,decodeBitStrings:!0}),"boolean"==typeof i&&(i={strict:i,decodeBitStrings:!0}),"strict"in i||(i.strict=!0),"decodeBitStrings"in i||(i.decodeBitStrings=!0),"string"==typeof e&&(e=qh.util.createBuffer(e)),function e(i,r,o,a){var s;n(i,r,2);var l=i.getByte();r--;var u=192&l,c=31&l;s=i.length();var h,d,p=function(e,t){var i=e.getByte();if(t--,128!==i){var r;if(128&i){var o=127&i;n(e,t,o),r=e.getInt(o<<3)}else r=i;if(r<0)throw new Error("Negative length: "+r);return r}}(i,r);if(r-=s-i.length(),void 0!==p&&p>r){if(a.strict){var f=new Error("Too few bytes to read ASN.1 value.");throw f.available=i.length(),f.remaining=r,f.requested=p,f}p=r}var g=32==(32&l);if(g)if(h=[],void 0===p)for(;;){if(n(i,r,2),i.bytes(2)===String.fromCharCode(0,0)){i.getBytes(2),r-=2;break}s=i.length(),h.push(e(i,r,o+1,a)),r-=s-i.length()}else for(;p>0;)s=i.length(),h.push(e(i,p,o+1,a)),r-=s-i.length(),p-=s-i.length();void 0===h&&u===t.Class.UNIVERSAL&&c===t.Type.BITSTRING&&(d=i.bytes(p));if(void 0===h&&a.decodeBitStrings&&u===t.Class.UNIVERSAL&&c===t.Type.BITSTRING&&p>1){var m=i.read,v=r,y=0;if(c===t.Type.BITSTRING&&(n(i,r,1),y=i.getByte(),r--),0===y)try{s=i.length();var _={verbose:a.verbose,strict:!0,decodeBitStrings:!0},b=e(i,r,o+1,_),w=s-i.length();r-=w,c==t.Type.BITSTRING&&w++;var E=b.tagClass;w!==p||E!==t.Class.UNIVERSAL&&E!==t.Class.CONTEXT_SPECIFIC||(h=[b])}catch(e){}void 0===h&&(i.read=m,r=v)}if(void 0===h){if(void 0===p){if(a.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");p=r}if(c===t.Type.BMPSTRING)for(h="";p>0;p-=2)n(i,r,2),h+=String.fromCharCode(i.getInt16()),r-=2;else h=i.getBytes(p)}var C=void 0===d?null:{bitStringContents:d};return t.create(u,c,g,h,C)}(e,e.length(),0,i)},t.toDer=function(e){var n=qh.util.createBuffer(),i=e.tagClass|e.type,r=qh.util.createBuffer(),o=!1;if("bitStringContents"in e&&(o=!0,e.original&&(o=t.equals(e,e.original))),o)r.putBytes(e.bitStringContents);else if(e.composed){e.constructed?i|=32:r.putByte(0);for(var a=0;a<e.value.length;++a)void 0!==e.value[a]&&r.putBuffer(t.toDer(e.value[a]))}else if(e.type===t.Type.BMPSTRING)for(a=0;a<e.value.length;++a)r.putInt16(e.value.charCodeAt(a));else e.type===t.Type.INTEGER&&e.value.length>1&&(0===e.value.charCodeAt(0)&&0==(128&e.value.charCodeAt(1))||255===e.value.charCodeAt(0)&&128==(128&e.value.charCodeAt(1)))?r.putBytes(e.value.substr(1)):r.putBytes(e.value);if(n.putByte(i),r.length()<=127)n.putByte(127&r.length());else{var s=r.length(),l="";do{l+=String.fromCharCode(255&s),s>>>=8}while(s>0);n.putByte(128|l.length);for(a=l.length-1;a>=0;--a)n.putByte(l.charCodeAt(a))}return n.putBuffer(r),n},t.oidToDer=function(e){var t,n,i,r,o=e.split("."),a=qh.util.createBuffer();a.putByte(40*parseInt(o[0],10)+parseInt(o[1],10));for(var s=2;s<o.length;++s){t=!0,n=[],i=parseInt(o[s],10);do{r=127&i,i>>>=7,t||(r|=128),n.push(r),t=!1}while(i>0);for(var l=n.length-1;l>=0;--l)a.putByte(n[l])}return a},t.derToOid=function(e){var t;"string"==typeof e&&(e=qh.util.createBuffer(e));var n=e.getByte();t=Math.floor(n/40)+"."+n%40;for(var i=0;e.length()>0;)i<<=7,128&(n=e.getByte())?i+=127&n:(t+="."+(i+n),i=0);return t},t.utcTimeToDate=function(e){var t=new Date,n=parseInt(e.substr(0,2),10);n=n>=50?1900+n:2e3+n;var i=parseInt(e.substr(2,2),10)-1,r=parseInt(e.substr(4,2),10),o=parseInt(e.substr(6,2),10),a=parseInt(e.substr(8,2),10),s=0;if(e.length>11){var l=e.charAt(10),u=10;"+"!==l&&"-"!==l&&(s=parseInt(e.substr(10,2),10),u+=2)}if(t.setUTCFullYear(n,i,r),t.setUTCHours(o,a,s,0),u&&("+"===(l=e.charAt(u))||"-"===l)){var c=60*parseInt(e.substr(u+1,2),10)+parseInt(e.substr(u+4,2),10);c*=6e4,"+"===l?t.setTime(+t-c):t.setTime(+t+c)}return t},t.generalizedTimeToDate=function(e){var t=new Date,n=parseInt(e.substr(0,4),10),i=parseInt(e.substr(4,2),10)-1,r=parseInt(e.substr(6,2),10),o=parseInt(e.substr(8,2),10),a=parseInt(e.substr(10,2),10),s=parseInt(e.substr(12,2),10),l=0,u=0,c=!1;"Z"===e.charAt(e.length-1)&&(c=!0);var h=e.length-5,d=e.charAt(h);"+"!==d&&"-"!==d||(u=60*parseInt(e.substr(h+1,2),10)+parseInt(e.substr(h+4,2),10),u*=6e4,"+"===d&&(u*=-1),c=!0);return"."===e.charAt(14)&&(l=1e3*parseFloat(e.substr(14),10)),c?(t.setUTCFullYear(n,i,r),t.setUTCHours(o,a,s,l),t.setTime(+t+u)):(t.setFullYear(n,i,r),t.setHours(o,a,s,l)),t},t.dateToUtcTime=function(e){if("string"==typeof e)return e;var t="",n=[];n.push((""+e.getUTCFullYear()).substr(2)),n.push(""+(e.getUTCMonth()+1)),n.push(""+e.getUTCDate()),n.push(""+e.getUTCHours()),n.push(""+e.getUTCMinutes()),n.push(""+e.getUTCSeconds());for(var i=0;i<n.length;++i)n[i].length<2&&(t+="0"),t+=n[i];return t+="Z"},t.dateToGeneralizedTime=function(e){if("string"==typeof e)return e;var t="",n=[];n.push(""+e.getUTCFullYear()),n.push(""+(e.getUTCMonth()+1)),n.push(""+e.getUTCDate()),n.push(""+e.getUTCHours()),n.push(""+e.getUTCMinutes()),n.push(""+e.getUTCSeconds());for(var i=0;i<n.length;++i)n[i].length<2&&(t+="0"),t+=n[i];return t+="Z"},t.integerToDer=function(e){var t=qh.util.createBuffer();if(e>=-128&&e<128)return t.putSignedInt(e,8);if(e>=-32768&&e<32768)return t.putSignedInt(e,16);if(e>=-8388608&&e<8388608)return t.putSignedInt(e,24);if(e>=-2147483648&&e<2147483648)return t.putSignedInt(e,32);var n=new Error("Integer too large; max is 32-bits.");throw n.integer=e,n},t.derToInteger=function(e){"string"==typeof e&&(e=qh.util.createBuffer(e));var t=8*e.length();if(t>32)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},t.validate=function(e,n,i,r){var o=!1;if(e.tagClass!==n.tagClass&&void 0!==n.tagClass||e.type!==n.type&&void 0!==n.type)r&&(e.tagClass!==n.tagClass&&r.push("["+n.name+'] Expected tag class "'+n.tagClass+'", got "'+e.tagClass+'"'),e.type!==n.type&&r.push("["+n.name+'] Expected type "'+n.type+'", got "'+e.type+'"'));else if(e.constructed===n.constructed||void 0===n.constructed){if(o=!0,n.value&&qh.util.isArray(n.value))for(var a=0,s=0;o&&s<n.value.length;++s)o=n.value[s].optional||!1,e.value[a]&&((o=t.validate(e.value[a],n.value[s],i,r))?++a:n.value[s].optional&&(o=!0)),!o&&r&&r.push("["+n.name+'] Tag class "'+n.tagClass+'", type "'+n.type+'" expected value length "'+n.value.length+'", got "'+e.value.length+'"');if(o&&i&&(n.capture&&(i[n.capture]=e.value),n.captureAsn1&&(i[n.captureAsn1]=e),n.captureBitStringContents&&"bitStringContents"in e&&(i[n.captureBitStringContents]=e.bitStringContents),n.captureBitStringValue&&"bitStringContents"in e))if(e.bitStringContents.length<2)i[n.captureBitStringValue]="";else{if(0!==e.bitStringContents.charCodeAt(0))throw new Error("captureBitStringValue only supported for zero unused bits");i[n.captureBitStringValue]=e.bitStringContents.slice(1)}}else r&&r.push("["+n.name+'] Expected constructed "'+n.constructed+'", got "'+e.constructed+'"');return o};var i=/[^\\u0000-\\u00ff]/;t.prettyPrint=function(e,n,r){var o="";r=r||2,(n=n||0)>0&&(o+="\n");for(var a="",s=0;s<n*r;++s)a+=" ";switch(o+=a+"Tag: ",e.tagClass){case t.Class.UNIVERSAL:o+="Universal:";break;case t.Class.APPLICATION:o+="Application:";break;case t.Class.CONTEXT_SPECIFIC:o+="Context-Specific:";break;case t.Class.PRIVATE:o+="Private:"}if(e.tagClass===t.Class.UNIVERSAL)switch(o+=e.type,e.type){case t.Type.NONE:o+=" (None)";break;case t.Type.BOOLEAN:o+=" (Boolean)";break;case t.Type.INTEGER:o+=" (Integer)";break;case t.Type.BITSTRING:o+=" (Bit string)";break;case t.Type.OCTETSTRING:o+=" (Octet string)";break;case t.Type.NULL:o+=" (Null)";break;case t.Type.OID:o+=" (Object Identifier)";break;case t.Type.ODESC:o+=" (Object Descriptor)";break;case t.Type.EXTERNAL:o+=" (External or Instance of)";break;case t.Type.REAL:o+=" (Real)";break;case t.Type.ENUMERATED:o+=" (Enumerated)";break;case t.Type.EMBEDDED:o+=" (Embedded PDV)";break;case t.Type.UTF8:o+=" (UTF8)";break;case t.Type.ROID:o+=" (Relative Object Identifier)";break;case t.Type.SEQUENCE:o+=" (Sequence)";break;case t.Type.SET:o+=" (Set)";break;case t.Type.PRINTABLESTRING:o+=" (Printable String)";break;case t.Type.IA5String:o+=" (IA5String (ASCII))";break;case t.Type.UTCTIME:o+=" (UTC time)";break;case t.Type.GENERALIZEDTIME:o+=" (Generalized time)";break;case t.Type.BMPSTRING:o+=" (BMP String)"}else o+=e.type;if(o+="\n",o+=a+"Constructed: "+e.constructed+"\n",e.composed){var l=0,u="";for(s=0;s<e.value.length;++s)void 0!==e.value[s]&&(l+=1,u+=t.prettyPrint(e.value[s],n+1,r),s+1<e.value.length&&(u+=","));o+=a+"Sub values: "+l+u}else{if(o+=a+"Value: ",e.type===t.Type.OID){var c=t.derToOid(e.value);o+=c,qh.pki&&qh.pki.oids&&c in qh.pki.oids&&(o+=" ("+qh.pki.oids[c]+") ")}if(e.type===t.Type.INTEGER)try{o+=t.derToInteger(e.value)}catch(t){o+="0x"+qh.util.bytesToHex(e.value)}else if(e.type===t.Type.BITSTRING){if(e.value.length>1?o+="0x"+qh.util.bytesToHex(e.value.slice(1)):o+="(none)",e.value.length>0){var h=e.value.charCodeAt(0);1==h?o+=" (1 unused bit shown)":h>1&&(o+=" ("+h+" unused bits shown)")}}else e.type===t.Type.OCTETSTRING?(i.test(e.value)||(o+="("+e.value+") "),o+="0x"+qh.util.bytesToHex(e.value)):e.type===t.Type.UTF8?o+=qh.util.decodeUtf8(e.value):e.type===t.Type.PRINTABLESTRING||e.type===t.Type.IA5String?o+=e.value:i.test(e.value)?o+="0x"+qh.util.bytesToHex(e.value):0===e.value.length?o+="[null]":o+=e.value}return o}})),qh.md=qh.md||{};qh.md.algorithms=qh.md.algorithms||{};u((function(e){(e.exports=qh.hmac=qh.hmac||{}).create=function(){var e=null,t=null,n=null,i=null,r={start:function(r,o){if(null!==r)if("string"==typeof r){if(!((r=r.toLowerCase())in qh.md.algorithms))throw new Error('Unknown hash algorithm "'+r+'"');t=qh.md.algorithms[r].create()}else t=r;if(null===o)o=e;else{if("string"==typeof o)o=qh.util.createBuffer(o);else if(qh.util.isArray(o)){var a=o;o=qh.util.createBuffer();for(var s=0;s<a.length;++s)o.putByte(a[s])}var l=o.length();l>t.blockLength&&(t.start(),t.update(o.bytes()),o=t.digest()),n=qh.util.createBuffer(),i=qh.util.createBuffer(),l=o.length();for(s=0;s<l;++s){a=o.at(s);n.putByte(54^a),i.putByte(92^a)}if(l<t.blockLength)for(a=t.blockLength-l,s=0;s<a;++s)n.putByte(54),i.putByte(92);e=o,n=n.bytes(),i=i.bytes()}t.start(),t.update(n)},update:function(e){t.update(e)},getMac:function(){var e=t.digest().bytes();return t.start(),t.update(i),t.update(e),t.digest()}};return r.digest=r.getMac,r}})),u((function(e){var t=e.exports=qh.md5=qh.md5||{};qh.md.md5=qh.md.algorithms.md5=t,t.create=function(){a||function(){n=String.fromCharCode(128),n+=qh.util.fillString(String.fromCharCode(0),64),i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],r=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],o=new Array(64);for(var e=0;e<64;++e)o[e]=Math.floor(4294967296*Math.abs(Math.sin(e+1)));a=!0}();var e=null,t=qh.util.createBuffer(),l=new Array(16),u={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){u.messageLength=0,u.fullMessageLength=u.messageLength64=[];for(var n=u.messageLengthSize/4,i=0;i<n;++i)u.fullMessageLength.push(0);return t=qh.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},u}};return u.start(),u.update=function(n,i){"utf8"===i&&(n=qh.util.encodeUtf8(n));var r=n.length;u.messageLength+=r,r=[r/4294967296>>>0,r>>>0];for(var o=u.fullMessageLength.length-1;o>=0;--o)u.fullMessageLength[o]+=r[1],r[1]=r[0]+(u.fullMessageLength[o]/4294967296>>>0),u.fullMessageLength[o]=u.fullMessageLength[o]>>>0,r[0]=r[1]/4294967296>>>0;return t.putBytes(n),s(e,l,t),(t.read>2048||0===t.length())&&t.compact(),u},u.digest=function(){var i=qh.util.createBuffer();i.putBytes(t.bytes());var r=u.fullMessageLength[u.fullMessageLength.length-1]+u.messageLengthSize&u.blockLength-1;i.putBytes(n.substr(0,u.blockLength-r));for(var o,a=0,c=u.fullMessageLength.length-1;c>=0;--c)a=(o=8*u.fullMessageLength[c]+a)/4294967296>>>0,i.putInt32Le(o>>>0);var h={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3};s(h,l,i);var d=qh.util.createBuffer();return d.putInt32Le(h.h0),d.putInt32Le(h.h1),d.putInt32Le(h.h2),d.putInt32Le(h.h3),d},u};var n=null,i=null,r=null,o=null,a=!1;function s(e,t,n){for(var a,s,l,u,c,h,d,p=n.length();p>=64;){for(s=e.h0,l=e.h1,u=e.h2,c=e.h3,d=0;d<16;++d)t[d]=n.getInt32Le(),a=s+(c^l&(u^c))+o[d]+t[d],s=c,c=u,u=l,l+=a<<(h=r[d])|a>>>32-h;for(;d<32;++d)a=s+(u^c&(l^u))+o[d]+t[i[d]],s=c,c=u,u=l,l+=a<<(h=r[d])|a>>>32-h;for(;d<48;++d)a=s+(l^u^c)+o[d]+t[i[d]],s=c,c=u,u=l,l+=a<<(h=r[d])|a>>>32-h;for(;d<64;++d)a=s+(u^(l|~c))+o[d]+t[i[d]],s=c,c=u,u=l,l+=a<<(h=r[d])|a>>>32-h;e.h0=e.h0+s|0,e.h1=e.h1+l|0,e.h2=e.h2+u|0,e.h3=e.h3+c|0,p-=64}}})),u((function(e){var t=e.exports=qh.pem=qh.pem||{};function n(e){for(var t=e.name+": ",n=[],i=function(e,t){return" "+t},r=0;r<e.values.length;++r)n.push(e.values[r].replace(/^(\S+\r\n)/,i));t+=n.join(",")+"\r\n";var o=0,a=-1;for(r=0;r<t.length;++r,++o)if(o>65&&-1!==a){var s=t[a];","===s?(++a,t=t.substr(0,a)+"\r\n "+t.substr(a)):t=t.substr(0,a)+"\r\n"+s+t.substr(a+1),o=r-a-1,a=-1,++r}else" "!==t[r]&&"\t"!==t[r]&&","!==t[r]||(a=r);return t}function i(e){return e.replace(/^\s+/,"")}t.encode=function(e,t){t=t||{};var i,r="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(r+=n(i={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]})),e.contentDomain&&(r+=n(i={name:"Content-Domain",values:[e.contentDomain]})),e.dekInfo&&(i={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&i.values.push(e.dekInfo.parameters),r+=n(i)),e.headers)for(var o=0;o<e.headers.length;++o)r+=n(e.headers[o]);return e.procType&&(r+="\r\n"),r+=qh.util.encode64(e.body,t.maxline||64)+"\r\n",r+="-----END "+e.type+"-----\r\n"},t.decode=function(e){for(var t,n=[],r=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,o=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,a=/\r?\n/;t=r.exec(e);){var s={type:t[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:qh.util.decode64(t[3])};if(n.push(s),t[2]){for(var l=t[2].split(a),u=0;t&&u<l.length;){for(var c=l[u].replace(/\s+$/,""),h=u+1;h<l.length;++h){var d=l[h];if(!/\s/.test(d[0]))break;c+=d,u=h}if(t=c.match(o)){for(var p={name:t[1],values:[]},f=t[2].split(","),g=0;g<f.length;++g)p.values.push(i(f[g]));if(s.procType)if(s.contentDomain||"Content-Domain"!==p.name)if(s.dekInfo||"DEK-Info"!==p.name)s.headers.push(p);else{if(0===p.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');s.dekInfo={algorithm:f[0],parameters:f[1]||null}}else s.contentDomain=f[0]||"";else{if("Proc-Type"!==p.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==p.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');s.procType={version:f[0],type:f[1]}}}++u}if("ENCRYPTED"===s.procType&&!s.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===n.length)throw new Error("Invalid PEM formatted message.");return n}})),qh.des=qh.des||{};function rd(e,t){qh.cipher.registerAlgorithm(e,(function(){return new qh.des.Algorithm(e,t)}))}qh.des.startEncrypting=function(e,t,n,i){var r=fd({key:e,output:n,decrypt:!1,mode:i||(null===t?"ECB":"CBC")});return r.start(t),r},qh.des.createEncryptionCipher=function(e,t){return fd({key:e,output:null,decrypt:!1,mode:t})},qh.des.startDecrypting=function(e,t,n,i){var r=fd({key:e,output:n,decrypt:!0,mode:i||(null===t?"ECB":"CBC")});return r.start(t),r},qh.des.createDecryptionCipher=function(e,t){return fd({key:e,output:null,decrypt:!0,mode:t})},qh.des.Algorithm=function(e,t){var n=this;n.name=e,n.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return pd(n._keys,e,t,!1)},decrypt:function(e,t){return pd(n._keys,e,t,!0)}}}),n._init=!1},qh.des.Algorithm.prototype.initialize=function(e){if(!this._init){var t=qh.util.createBuffer(e.key);if(0===this.name.indexOf("3DES")&&24!==t.length())throw new Error("Invalid Triple-DES key size: "+8*t.length());this._keys=function(e){for(var t,n=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],i=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],r=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],o=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],a=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],s=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],l=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],u=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],c=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],h=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],d=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],p=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],f=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],g=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],m=e.length()>8?3:1,v=[],y=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],_=0,b=0;b<m;b++){var w=e.getInt32(),E=e.getInt32();w^=(t=252645135&(w>>>4^E))<<4,w^=t=65535&((E^=t)>>>-16^w),w^=(t=858993459&(w>>>2^(E^=t<<-16)))<<2,w^=t=65535&((E^=t)>>>-16^w),w^=(t=1431655765&(w>>>1^(E^=t<<-16)))<<1,w^=t=16711935&((E^=t)>>>8^w),t=(w^=(t=1431655765&(w>>>1^(E^=t<<8)))<<1)<<8|(E^=t)>>>20&240,w=E<<24|E<<8&16711680|E>>>8&65280|E>>>24&240,E=t;for(var C=0;C<y.length;++C){y[C]?(w=w<<2|w>>>26,E=E<<2|E>>>26):(w=w<<1|w>>>27,E=E<<1|E>>>27);var S=n[(w&=-15)>>>28]|i[w>>>24&15]|r[w>>>20&15]|o[w>>>16&15]|a[w>>>12&15]|s[w>>>8&15]|l[w>>>4&15],k=u[(E&=-15)>>>28]|c[E>>>24&15]|h[E>>>20&15]|d[E>>>16&15]|p[E>>>12&15]|f[E>>>8&15]|g[E>>>4&15];t=65535&(k>>>16^S),v[_++]=S^t,v[_++]=k^t<<16}}return v}(t),this._init=!0}},rd("DES-ECB",qh.cipher.modes.ecb),rd("DES-CBC",qh.cipher.modes.cbc),rd("DES-CFB",qh.cipher.modes.cfb),rd("DES-OFB",qh.cipher.modes.ofb),rd("DES-CTR",qh.cipher.modes.ctr),rd("3DES-ECB",qh.cipher.modes.ecb),rd("3DES-CBC",qh.cipher.modes.cbc),rd("3DES-CFB",qh.cipher.modes.cfb),rd("3DES-OFB",qh.cipher.modes.ofb),rd("3DES-CTR",qh.cipher.modes.ctr);var od=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],ad=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],sd=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],ld=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],ud=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],cd=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],hd=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],dd=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function pd(e,t,n,i){var r,o,a=32===e.length?3:9;r=3===a?i?[30,-2,-2]:[0,32,2]:i?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var s=t[0],l=t[1];s^=(o=252645135&(s>>>4^l))<<4,s^=(o=65535&(s>>>16^(l^=o)))<<16,s^=o=858993459&((l^=o)>>>2^s),s^=o=16711935&((l^=o<<2)>>>8^s),s=(s^=(o=1431655765&(s>>>1^(l^=o<<8)))<<1)<<1|s>>>31,l=(l^=o)<<1|l>>>31;for(var u=0;u<a;u+=3){for(var c=r[u+1],h=r[u+2],d=r[u];d!=c;d+=h){var p=l^e[d],f=(l>>>4|l<<28)^e[d+1];o=s,s=l,l=o^(ad[p>>>24&63]|ld[p>>>16&63]|cd[p>>>8&63]|dd[63&p]|od[f>>>24&63]|sd[f>>>16&63]|ud[f>>>8&63]|hd[63&f])}o=s,s=l,l=o}l=l>>>1|l<<31,l^=o=1431655765&((s=s>>>1|s<<31)>>>1^l),l^=(o=16711935&(l>>>8^(s^=o<<1)))<<8,l^=(o=858993459&(l>>>2^(s^=o)))<<2,l^=o=65535&((s^=o)>>>16^l),l^=o=252645135&((s^=o<<16)>>>4^l),s^=o<<4,n[0]=s,n[1]=l}function fd(e){var t,n="DES-"+((e=e||{}).mode||"CBC").toUpperCase(),i=(t=e.decrypt?qh.cipher.createDecipher(n,e.key):qh.cipher.createCipher(n,e.key)).start;return t.start=function(e,n){var r=null;n instanceof qh.util.ByteBuffer&&(r=n,n={}),(n=n||{}).output=r,n.iv=e,i.call(t,n)},t}var gd,md,vd=(gd=Object.freeze({__proto__:null,default:{}}))&&gd.default||gd,yd=qh.pkcs5=qh.pkcs5||{};qh.util.isNodejs&&!qh.options.usePureJavaScript&&(md=vd);qh.pbkdf2=yd.pbkdf2=function(e,t,n,i,r,o){if("function"==typeof r&&(o=r,r=null),qh.util.isNodejs&&!qh.options.usePureJavaScript&&md.pbkdf2&&(null===r||"object"!=typeof r)&&(md.pbkdf2Sync.length>4||!r||"sha1"===r))return"string"!=typeof r&&(r="sha1"),e=new Do(e,"binary"),t=new Do(t,"binary"),o?4===md.pbkdf2Sync.length?md.pbkdf2(e,t,n,i,(function(e,t){if(e)return o(e);o(null,t.toString("binary"))})):md.pbkdf2(e,t,n,i,r,(function(e,t){if(e)return o(e);o(null,t.toString("binary"))})):4===md.pbkdf2Sync.length?md.pbkdf2Sync(e,t,n,i).toString("binary"):md.pbkdf2Sync(e,t,n,i,r).toString("binary");if(null==r&&(r="sha1"),"string"==typeof r){if(!(r in qh.md.algorithms))throw new Error("Unknown hash algorithm: "+r);r=qh.md[r].create()}var a=r.digestLength;if(i>4294967295*a){var s=new Error("Derived key is too long.");if(o)return o(s);throw s}var l=Math.ceil(i/a),u=i-(l-1)*a,c=qh.hmac.create();c.start(r,e);var h,d,p,f="";if(!o){for(var g=1;g<=l;++g){c.start(null,null),c.update(t),c.update(qh.util.int32ToBytes(g)),h=p=c.digest().getBytes();for(var m=2;m<=n;++m)c.start(null,null),c.update(p),d=c.digest().getBytes(),h=qh.util.xorBytes(h,d,a),p=d;f+=g<l?h:h.substr(0,u)}return f}g=1;function v(){if(g>l)return o(null,f);c.start(null,null),c.update(t),c.update(qh.util.int32ToBytes(g)),h=p=c.digest().getBytes(),m=2,y()}function y(){if(m<=n)return c.start(null,null),c.update(p),d=c.digest().getBytes(),h=qh.util.xorBytes(h,d,a),p=d,++m,qh.util.setImmediate(y);f+=g<l?h:h.substr(0,u),++g,v()}v()},u((function(e){var t=e.exports=qh.sha256=qh.sha256||{};qh.md.sha256=qh.md.algorithms.sha256=t,t.create=function(){i||(n=String.fromCharCode(128),n+=qh.util.fillString(String.fromCharCode(0),64),r=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],i=!0);var e=null,t=qh.util.createBuffer(),a=new Array(64),s={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){s.messageLength=0,s.fullMessageLength=s.messageLength64=[];for(var n=s.messageLengthSize/4,i=0;i<n;++i)s.fullMessageLength.push(0);return t=qh.util.createBuffer(),e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},s}};return s.start(),s.update=function(n,i){"utf8"===i&&(n=qh.util.encodeUtf8(n));var r=n.length;s.messageLength+=r,r=[r/4294967296>>>0,r>>>0];for(var l=s.fullMessageLength.length-1;l>=0;--l)s.fullMessageLength[l]+=r[1],r[1]=r[0]+(s.fullMessageLength[l]/4294967296>>>0),s.fullMessageLength[l]=s.fullMessageLength[l]>>>0,r[0]=r[1]/4294967296>>>0;return t.putBytes(n),o(e,a,t),(t.read>2048||0===t.length())&&t.compact(),s},s.digest=function(){var i=qh.util.createBuffer();i.putBytes(t.bytes());var r,l=s.fullMessageLength[s.fullMessageLength.length-1]+s.messageLengthSize&s.blockLength-1;i.putBytes(n.substr(0,s.blockLength-l));for(var u=8*s.fullMessageLength[0],c=0;c<s.fullMessageLength.length-1;++c)u+=(r=8*s.fullMessageLength[c+1])/4294967296>>>0,i.putInt32(u>>>0),u=r>>>0;i.putInt32(u);var h={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4,h5:e.h5,h6:e.h6,h7:e.h7};o(h,a,i);var d=qh.util.createBuffer();return d.putInt32(h.h0),d.putInt32(h.h1),d.putInt32(h.h2),d.putInt32(h.h3),d.putInt32(h.h4),d.putInt32(h.h5),d.putInt32(h.h6),d.putInt32(h.h7),d},s};var n=null,i=!1,r=null;function o(e,t,n){for(var i,o,a,s,l,u,c,h,d,p,f,g,m,v=n.length();v>=64;){for(l=0;l<16;++l)t[l]=n.getInt32();for(;l<64;++l)i=((i=t[l-2])>>>17|i<<15)^(i>>>19|i<<13)^i>>>10,o=((o=t[l-15])>>>7|o<<25)^(o>>>18|o<<14)^o>>>3,t[l]=i+t[l-7]+o+t[l-16]|0;for(u=e.h0,c=e.h1,h=e.h2,d=e.h3,p=e.h4,f=e.h5,g=e.h6,m=e.h7,l=0;l<64;++l)a=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),s=u&c|h&(u^c),i=m+((p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(g^p&(f^g))+r[l]+t[l],m=g,g=f,f=p,p=d+i>>>0,d=h,h=c,c=u,u=i+(o=a+s)>>>0;e.h0=e.h0+u|0,e.h1=e.h1+c|0,e.h2=e.h2+h|0,e.h3=e.h3+d|0,e.h4=e.h4+p|0,e.h5=e.h5+f|0,e.h6=e.h6+g|0,e.h7=e.h7+m|0,v-=64}}})),u((function(e){var t=null;!qh.util.isNodejs||qh.options.usePureJavaScript||xn.versions["node-webkit"]||(t=vd),(e.exports=qh.prng=qh.prng||{}).create=function(e){for(var n={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},i=e.md,r=new Array(32),o=0;o<32;++o)r[o]=i.create();function a(){if(n.pools[0].messageLength>=32)return s();var e=32-n.pools[0].messageLength<<5;n.collect(n.seedFileSync(e)),s()}function s(){n.reseeds=4294967295===n.reseeds?0:n.reseeds+1;var e=n.plugin.md.create();e.update(n.keyBytes);for(var t=1,i=0;i<32;++i)n.reseeds%t==0&&(e.update(n.pools[i].digest().getBytes()),n.pools[i].start()),t<<=1;n.keyBytes=e.digest().getBytes(),e.start(),e.update(n.keyBytes);var r=e.digest().getBytes();n.key=n.plugin.formatKey(n.keyBytes),n.seed=n.plugin.formatSeed(r),n.generated=0}function l(e){var t=null;if("undefined"!=typeof window){var n=window.crypto||window.msCrypto;n&&n.getRandomValues&&(t=function(e){return n.getRandomValues(e)})}var i=qh.util.createBuffer();if(t)for(;i.length()<e;){var r=Math.max(1,Math.min(e-i.length(),65536)/4),o=new Uint32Array(Math.floor(r));try{t(o);for(var a=0;a<o.length;++a)i.putInt32(o[a])}catch(e){if(!("undefined"!=typeof QuotaExceededError&&e instanceof QuotaExceededError))throw e}}if(i.length()<e)for(var s,l,u,c=Math.floor(65536*Math.random());i.length()<e;){l=16807*(65535&c),l+=(32767&(s=16807*(c>>16)))<<16,c=4294967295&(l=(2147483647&(l+=s>>15))+(l>>31));for(a=0;a<3;++a)u=c>>>(a<<3),u^=Math.floor(256*Math.random()),i.putByte(String.fromCharCode(255&u))}return i.getBytes(e)}return n.pools=r,n.pool=0,n.generate=function(e,t){if(!t)return n.generateSync(e);var i=n.plugin.cipher,r=n.plugin.increment,o=n.plugin.formatKey,a=n.plugin.formatSeed,l=qh.util.createBuffer();n.key=null,function u(c){if(c)return t(c);if(l.length()>=e)return t(null,l.getBytes(e));n.generated>1048575&&(n.key=null);if(null===n.key)return qh.util.nextTick((function(){!function(e){if(n.pools[0].messageLength>=32)return s(),e();var t=32-n.pools[0].messageLength<<5;n.seedFile(t,(function(t,i){if(t)return e(t);n.collect(i),s(),e()}))}(u)}));var h=i(n.key,n.seed);n.generated+=h.length,l.putBytes(h),n.key=o(i(n.key,r(n.seed))),n.seed=a(i(n.key,n.seed)),qh.util.setImmediate(u)}()},n.generateSync=function(e){var t=n.plugin.cipher,i=n.plugin.increment,r=n.plugin.formatKey,o=n.plugin.formatSeed;n.key=null;for(var s=qh.util.createBuffer();s.length()<e;){n.generated>1048575&&(n.key=null),null===n.key&&a();var l=t(n.key,n.seed);n.generated+=l.length,s.putBytes(l),n.key=r(t(n.key,i(n.seed))),n.seed=o(t(n.key,n.seed))}return s.getBytes(e)},t?(n.seedFile=function(e,n){t.randomBytes(e,(function(e,t){if(e)return n(e);n(null,t.toString())}))},n.seedFileSync=function(e){return t.randomBytes(e).toString()}):(n.seedFile=function(e,t){try{t(null,l(e))}catch(e){t(e)}},n.seedFileSync=l),n.collect=function(e){for(var t=e.length,i=0;i<t;++i)n.pools[n.pool].update(e.substr(i,1)),n.pool=31===n.pool?0:n.pool+1},n.collectInt=function(e,t){for(var i="",r=0;r<t;r+=8)i+=String.fromCharCode(e>>r&255);n.collect(i)},n.registerWorker=function(e){if(e===self)n.seedFile=function(e,t){self.addEventListener("message",(function e(n){var i=n.data;i.forge&&i.forge.prng&&(self.removeEventListener("message",e),t(i.forge.prng.err,i.forge.prng.bytes))})),self.postMessage({forge:{prng:{needed:e}}})};else{e.addEventListener("message",(function(t){var i=t.data;i.forge&&i.forge.prng&&n.seedFile(i.forge.prng.needed,(function(t,n){e.postMessage({forge:{prng:{err:t,bytes:n}}})}))}))}},n}})),u((function(e){qh.random&&qh.random.getBytes?e.exports=qh.random:function(t){var n={},i=new Array(4),r=qh.util.createBuffer();function o(){var e=qh.prng.create(n);return e.getBytes=function(t,n){return e.generate(t,n)},e.getBytesSync=function(t){return e.generate(t)},e}n.formatKey=function(e){var t=qh.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),qh.aes._expandKey(e,!1)},n.formatSeed=function(e){var t=qh.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),e},n.cipher=function(e,t){return qh.aes._updateBlock(e,t,i,!1),r.putInt32(i[0]),r.putInt32(i[1]),r.putInt32(i[2]),r.putInt32(i[3]),r.getBytes()},n.increment=function(e){return++e[3],e},n.md=qh.md.sha256;var a=o(),s=null;if("undefined"!=typeof window){var l=window.crypto||window.msCrypto;l&&l.getRandomValues&&(s=function(e){return l.getRandomValues(e)})}if(!qh.util.isNodejs&&!s){if(a.collectInt(+new Date,32),"undefined"!=typeof navigator){var u="";for(var c in navigator)try{"string"==typeof navigator[c]&&(u+=navigator[c])}catch(e){}a.collect(u),u=null}t&&(t().mousemove((function(e){a.collectInt(e.clientX,16),a.collectInt(e.clientY,16)})),t().keypress((function(e){a.collectInt(e.charCode,8)})))}if(qh.random)for(var c in a)qh.random[c]=a[c];else qh.random=a;qh.random.createInstance=o,e.exports=qh.random}("undefined"!=typeof jQuery?jQuery:null)}));var _d=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],bd=[1,2,3,5],wd=function(e,t){return e<<t&65535|(65535&e)>>16-t},Ed=function(e,t){return(65535&e)>>t|e<<16-t&65535};qh.rc2=qh.rc2||{};qh.rc2.expandKey=function(e,t){"string"==typeof e&&(e=qh.util.createBuffer(e)),t=t||128;var n,i=e,r=e.length(),o=t,a=Math.ceil(o/8),s=255>>(7&o);for(n=r;n<128;n++)i.putByte(_d[i.at(n-1)+i.at(n-r)&255]);for(i.setAt(128-a,_d[i.at(128-a)&s]),n=127-a;n>=0;n--)i.setAt(n,_d[i.at(n+1)^i.at(n+a)]);return i};var Cd=function(e,t,n){var i,r,o,a,s=!1,l=null,u=null,c=null,h=[];for(e=qh.rc2.expandKey(e,t),o=0;o<64;o++)h.push(e.getInt16Le());n?(i=function(e){for(o=0;o<4;o++)e[o]+=h[a]+(e[(o+3)%4]&e[(o+2)%4])+(~e[(o+3)%4]&e[(o+1)%4]),e[o]=wd(e[o],bd[o]),a++},r=function(e){for(o=0;o<4;o++)e[o]+=h[63&e[(o+3)%4]]}):(i=function(e){for(o=3;o>=0;o--)e[o]=Ed(e[o],bd[o]),e[o]-=h[a]+(e[(o+3)%4]&e[(o+2)%4])+(~e[(o+3)%4]&e[(o+1)%4]),a--},r=function(e){for(o=3;o>=0;o--)e[o]-=h[63&e[(o+3)%4]]});var d=function(e){var t=[];for(o=0;o<4;o++){var i=l.getInt16Le();null!==c&&(n?i^=c.getInt16Le():c.putInt16Le(i)),t.push(65535&i)}a=n?0:63;for(var r=0;r<e.length;r++)for(var s=0;s<e[r][0];s++)e[r][1](t);for(o=0;o<4;o++)null!==c&&(n?c.putInt16Le(t[o]):t[o]^=c.getInt16Le()),u.putInt16Le(t[o])},p=null;return p={start:function(e,t){e&&"string"==typeof e&&(e=qh.util.createBuffer(e)),s=!1,l=qh.util.createBuffer(),u=t||new qh.util.createBuffer,c=e,p.output=u},update:function(e){for(s||l.putBuffer(e);l.length()>=8;)d([[5,i],[1,r],[6,i],[1,r],[5,i]])},finish:function(e){var t=!0;if(n)if(e)t=e(8,l,!n);else{var i=8===l.length()?8:8-l.length();l.fillWithByte(i,i)}if(t&&(s=!0,p.update()),!n&&(t=0===l.length()))if(e)t=e(8,u,!n);else{var r=u.length(),o=u.at(r-1);o>r?t=!1:u.truncate(o)}return t}}};qh.rc2.startEncrypting=function(e,t,n){var i=qh.rc2.createEncryptionCipher(e,128);return i.start(t,n),i},qh.rc2.createEncryptionCipher=function(e,t){return Cd(e,t,!0)},qh.rc2.startDecrypting=function(e,t,n){var i=qh.rc2.createDecryptionCipher(e,128);return i.start(t,n),i},qh.rc2.createDecryptionCipher=function(e,t){return Cd(e,t,!1)};var Sd;qh.jsbn=qh.jsbn||{};function kd(e,t,n){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,n):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function Td(){return new kd(null)}function xd(e,t,n,i,r,o){for(var a=16383&t,s=t>>14;--o>=0;){var l=16383&this.data[e],u=this.data[e++]>>14,c=s*l+u*a;r=((l=a*l+((16383&c)<<14)+n.data[i]+r)>>28)+(c>>14)+s*u,n.data[i++]=268435455&l}return r}qh.jsbn.BigInteger=kd,"undefined"==typeof navigator?(kd.prototype.am=xd,Sd=28):"Microsoft Internet Explorer"==navigator.appName?(kd.prototype.am=function(e,t,n,i,r,o){for(var a=32767&t,s=t>>15;--o>=0;){var l=32767&this.data[e],u=this.data[e++]>>15,c=s*l+u*a;r=((l=a*l+((32767&c)<<15)+n.data[i]+(1073741823&r))>>>30)+(c>>>15)+s*u+(r>>>30),n.data[i++]=1073741823&l}return r},Sd=30):"Netscape"!=navigator.appName?(kd.prototype.am=function(e,t,n,i,r,o){for(;--o>=0;){var a=t*this.data[e++]+n.data[i]+r;r=Math.floor(a/67108864),n.data[i++]=67108863&a}return r},Sd=26):(kd.prototype.am=xd,Sd=28),kd.prototype.DB=Sd,kd.prototype.DM=(1<<Sd)-1,kd.prototype.DV=1<<Sd;kd.prototype.FV=Math.pow(2,52),kd.prototype.F1=52-Sd,kd.prototype.F2=2*Sd-52;var Ld,Id,Ad=new Array;for(Ld="0".charCodeAt(0),Id=0;Id<=9;++Id)Ad[Ld++]=Id;for(Ld="a".charCodeAt(0),Id=10;Id<36;++Id)Ad[Ld++]=Id;for(Ld="A".charCodeAt(0),Id=10;Id<36;++Id)Ad[Ld++]=Id;function Dd(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function Nd(e,t){var n=Ad[e.charCodeAt(t)];return null==n?-1:n}function Pd(e){var t=Td();return t.fromInt(e),t}function Bd(e){var t,n=1;return 0!=(t=e>>>16)&&(e=t,n+=16),0!=(t=e>>8)&&(e=t,n+=8),0!=(t=e>>4)&&(e=t,n+=4),0!=(t=e>>2)&&(e=t,n+=2),0!=(t=e>>1)&&(e=t,n+=1),n}function Rd(e){this.m=e}function Md(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function Od(e,t){return e&t}function Ud(e,t){return e|t}function zd(e,t){return e^t}function Fd(e,t){return e&~t}function Vd(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function qd(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function jd(){}function $d(e){return e}function Hd(e){this.r2=Td(),this.q3=Td(),kd.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}Rd.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},Rd.prototype.revert=function(e){return e},Rd.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},Rd.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},Rd.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},Md.prototype.convert=function(e){var t=Td();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(kd.ZERO)>0&&this.m.subTo(t,t),t},Md.prototype.revert=function(e){var t=Td();return e.copyTo(t),this.reduce(t),t},Md.prototype.reduce=function(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e.data[t],i=n*this.mpl+((n*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(n=t+this.m.t,e.data[n]+=this.m.am(0,i,e,t,0,this.m.t);e.data[n]>=e.DV;)e.data[n]-=e.DV,e.data[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},Md.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},Md.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},kd.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s},kd.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this.data[0]=e:e<-1?this.data[0]=e+this.DV:this.t=0},kd.prototype.fromString=function(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;for(var i=e.length,r=!1,o=0;--i>=0;){var a=8==n?255&e[i]:Nd(e,i);a<0?"-"==e.charAt(i)&&(r=!0):(r=!1,0==o?this.data[this.t++]=a:o+n>this.DB?(this.data[this.t-1]|=(a&(1<<this.DB-o)-1)<<o,this.data[this.t++]=a>>this.DB-o):this.data[this.t-1]|=a<<o,(o+=n)>=this.DB&&(o-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,o>0&&(this.data[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),r&&kd.ZERO.subTo(this,this)},kd.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this.data[this.t-1]==e;)--this.t},kd.prototype.dlShiftTo=function(e,t){var n;for(n=this.t-1;n>=0;--n)t.data[n+e]=this.data[n];for(n=e-1;n>=0;--n)t.data[n]=0;t.t=this.t+e,t.s=this.s},kd.prototype.drShiftTo=function(e,t){for(var n=e;n<this.t;++n)t.data[n-e]=this.data[n];t.t=Math.max(this.t-e,0),t.s=this.s},kd.prototype.lShiftTo=function(e,t){var n,i=e%this.DB,r=this.DB-i,o=(1<<r)-1,a=Math.floor(e/this.DB),s=this.s<<i&this.DM;for(n=this.t-1;n>=0;--n)t.data[n+a+1]=this.data[n]>>r|s,s=(this.data[n]&o)<<i;for(n=a-1;n>=0;--n)t.data[n]=0;t.data[a]=s,t.t=this.t+a+1,t.s=this.s,t.clamp()},kd.prototype.rShiftTo=function(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)t.t=0;else{var i=e%this.DB,r=this.DB-i,o=(1<<i)-1;t.data[0]=this.data[n]>>i;for(var a=n+1;a<this.t;++a)t.data[a-n-1]|=(this.data[a]&o)<<r,t.data[a-n]=this.data[a]>>i;i>0&&(t.data[this.t-n-1]|=(this.s&o)<<r),t.t=this.t-n,t.clamp()}},kd.prototype.subTo=function(e,t){for(var n=0,i=0,r=Math.min(e.t,this.t);n<r;)i+=this.data[n]-e.data[n],t.data[n++]=i&this.DM,i>>=this.DB;if(e.t<this.t){for(i-=e.s;n<this.t;)i+=this.data[n],t.data[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<e.t;)i-=e.data[n],t.data[n++]=i&this.DM,i>>=this.DB;i-=e.s}t.s=i<0?-1:0,i<-1?t.data[n++]=this.DV+i:i>0&&(t.data[n++]=i),t.t=n,t.clamp()},kd.prototype.multiplyTo=function(e,t){var n=this.abs(),i=e.abs(),r=n.t;for(t.t=r+i.t;--r>=0;)t.data[r]=0;for(r=0;r<i.t;++r)t.data[r+n.t]=n.am(0,i.data[r],t,r,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&kd.ZERO.subTo(t,t)},kd.prototype.squareTo=function(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e.data[n]=0;for(n=0;n<t.t-1;++n){var i=t.am(n,t.data[n],e,2*n,0,1);(e.data[n+t.t]+=t.am(n+1,2*t.data[n],e,2*n+1,i,t.t-n-1))>=t.DV&&(e.data[n+t.t]-=t.DV,e.data[n+t.t+1]=1)}e.t>0&&(e.data[e.t-1]+=t.am(n,t.data[n],e,2*n,0,1)),e.s=0,e.clamp()},kd.prototype.divRemTo=function(e,t,n){var i=e.abs();if(!(i.t<=0)){var r=this.abs();if(r.t<i.t)return null!=t&&t.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=Td());var o=Td(),a=this.s,s=e.s,l=this.DB-Bd(i.data[i.t-1]);l>0?(i.lShiftTo(l,o),r.lShiftTo(l,n)):(i.copyTo(o),r.copyTo(n));var u=o.t,c=o.data[u-1];if(0!=c){var h=c*(1<<this.F1)+(u>1?o.data[u-2]>>this.F2:0),d=this.FV/h,p=(1<<this.F1)/h,f=1<<this.F2,g=n.t,m=g-u,v=null==t?Td():t;for(o.dlShiftTo(m,v),n.compareTo(v)>=0&&(n.data[n.t++]=1,n.subTo(v,n)),kd.ONE.dlShiftTo(u,v),v.subTo(o,o);o.t<u;)o.data[o.t++]=0;for(;--m>=0;){var y=n.data[--g]==c?this.DM:Math.floor(n.data[g]*d+(n.data[g-1]+f)*p);if((n.data[g]+=o.am(0,y,n,m,0,u))<y)for(o.dlShiftTo(m,v),n.subTo(v,n);n.data[g]<--y;)n.subTo(v,n)}null!=t&&(n.drShiftTo(u,t),a!=s&&kd.ZERO.subTo(t,t)),n.t=u,n.clamp(),l>0&&n.rShiftTo(l,n),a<0&&kd.ZERO.subTo(n,n)}}},kd.prototype.invDigit=function(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},kd.prototype.isEven=function(){return 0==(this.t>0?1&this.data[0]:this.s)},kd.prototype.exp=function(e,t){if(e>4294967295||e<1)return kd.ONE;var n=Td(),i=Td(),r=t.convert(this),o=Bd(e)-1;for(r.copyTo(n);--o>=0;)if(t.sqrTo(n,i),(e&1<<o)>0)t.mulTo(i,r,n);else{var a=n;n=i,i=a}return t.revert(n)},kd.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var n,i=(1<<t)-1,r=!1,o="",a=this.t,s=this.DB-a*this.DB%t;if(a-- >0)for(s<this.DB&&(n=this.data[a]>>s)>0&&(r=!0,o=Dd(n));a>=0;)s<t?(n=(this.data[a]&(1<<s)-1)<<t-s,n|=this.data[--a]>>(s+=this.DB-t)):(n=this.data[a]>>(s-=t)&i,s<=0&&(s+=this.DB,--a)),n>0&&(r=!0),r&&(o+=Dd(n));return r?o:"0"},kd.prototype.negate=function(){var e=Td();return kd.ZERO.subTo(this,e),e},kd.prototype.abs=function(){return this.s<0?this.negate():this},kd.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(0!=(t=n-e.t))return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this.data[n]-e.data[n]))return t;return 0},kd.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+Bd(this.data[this.t-1]^this.s&this.DM)},kd.prototype.mod=function(e){var t=Td();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(kd.ZERO)>0&&e.subTo(t,t),t},kd.prototype.modPowInt=function(e,t){var n;return n=e<256||t.isEven()?new Rd(t):new Md(t),this.exp(e,n)},kd.ZERO=Pd(0),kd.ONE=Pd(1),jd.prototype.convert=$d,jd.prototype.revert=$d,jd.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n)},jd.prototype.sqrTo=function(e,t){e.squareTo(t)},Hd.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=Td();return e.copyTo(t),this.reduce(t),t},Hd.prototype.revert=function(e){return e},Hd.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},Hd.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},Hd.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var Wd=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],Kd=(1<<26)/Wd[Wd.length-1];kd.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},kd.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),i=Pd(n),r=Td(),o=Td(),a="";for(this.divRemTo(i,r,o);r.signum()>0;)a=(n+o.intValue()).toString(e).substr(1)+a,r.divRemTo(i,r,o);return o.intValue().toString(e)+a},kd.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),i=Math.pow(t,n),r=!1,o=0,a=0,s=0;s<e.length;++s){var l=Nd(e,s);l<0?"-"==e.charAt(s)&&0==this.signum()&&(r=!0):(a=t*a+l,++o>=n&&(this.dMultiply(i),this.dAddOffset(a,0),o=0,a=0))}o>0&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(a,0)),r&&kd.ZERO.subTo(this,this)},kd.prototype.fromNumber=function(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(kd.ONE.shiftLeft(e-1),Ud,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(kd.ONE.shiftLeft(e-1),this);else{var i=new Array,r=7&e;i.length=1+(e>>3),t.nextBytes(i),r>0?i[0]&=(1<<r)-1:i[0]=0,this.fromString(i,256)}},kd.prototype.bitwiseTo=function(e,t,n){var i,r,o=Math.min(e.t,this.t);for(i=0;i<o;++i)n.data[i]=t(this.data[i],e.data[i]);if(e.t<this.t){for(r=e.s&this.DM,i=o;i<this.t;++i)n.data[i]=t(this.data[i],r);n.t=this.t}else{for(r=this.s&this.DM,i=o;i<e.t;++i)n.data[i]=t(r,e.data[i]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()},kd.prototype.changeBit=function(e,t){var n=kd.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n},kd.prototype.addTo=function(e,t){for(var n=0,i=0,r=Math.min(e.t,this.t);n<r;)i+=this.data[n]+e.data[n],t.data[n++]=i&this.DM,i>>=this.DB;if(e.t<this.t){for(i+=e.s;n<this.t;)i+=this.data[n],t.data[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<e.t;)i+=e.data[n],t.data[n++]=i&this.DM,i>>=this.DB;i+=e.s}t.s=i<0?-1:0,i>0?t.data[n++]=i:i<-1&&(t.data[n++]=this.DV+i),t.t=n,t.clamp()},kd.prototype.dMultiply=function(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},kd.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}},kd.prototype.multiplyLowerTo=function(e,t,n){var i,r=Math.min(this.t+e.t,t);for(n.s=0,n.t=r;r>0;)n.data[--r]=0;for(i=n.t-this.t;r<i;++r)n.data[r+this.t]=this.am(0,e.data[r],n,r,0,this.t);for(i=Math.min(e.t,t);r<i;++r)this.am(0,e.data[r],n,r,0,t-r);n.clamp()},kd.prototype.multiplyUpperTo=function(e,t,n){--t;var i=n.t=this.t+e.t-t;for(n.s=0;--i>=0;)n.data[i]=0;for(i=Math.max(t-this.t,0);i<e.t;++i)n.data[this.t+i-t]=this.am(t-i,e.data[i],n,0,0,this.t+i-t);n.clamp(),n.drShiftTo(1,n)},kd.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this.data[0]%e;else for(var i=this.t-1;i>=0;--i)n=(t*n+this.data[i])%e;return n},kd.prototype.millerRabin=function(e){var t=this.subtract(kd.ONE),n=t.getLowestSetBit();if(n<=0)return!1;for(var i,r=t.shiftRight(n),o={nextBytes:function(e){for(var t=0;t<e.length;++t)e[t]=Math.floor(256*Math.random())}},a=0;a<e;++a){do{i=new kd(this.bitLength(),o)}while(i.compareTo(kd.ONE)<=0||i.compareTo(t)>=0);var s=i.modPow(r,this);if(0!=s.compareTo(kd.ONE)&&0!=s.compareTo(t)){for(var l=1;l++<n&&0!=s.compareTo(t);)if(0==(s=s.modPowInt(2,this)).compareTo(kd.ONE))return!1;if(0!=s.compareTo(t))return!1}}return!0},kd.prototype.clone=function(){var e=Td();return this.copyTo(e),e},kd.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]},kd.prototype.byteValue=function(){return 0==this.t?this.s:this.data[0]<<24>>24},kd.prototype.shortValue=function(){return 0==this.t?this.s:this.data[0]<<16>>16},kd.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1},kd.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var n,i=this.DB-e*this.DB%8,r=0;if(e-- >0)for(i<this.DB&&(n=this.data[e]>>i)!=(this.s&this.DM)>>i&&(t[r++]=n|this.s<<this.DB-i);e>=0;)i<8?(n=(this.data[e]&(1<<i)-1)<<8-i,n|=this.data[--e]>>(i+=this.DB-8)):(n=this.data[e]>>(i-=8)&255,i<=0&&(i+=this.DB,--e)),0!=(128&n)&&(n|=-256),0==r&&(128&this.s)!=(128&n)&&++r,(r>0||n!=this.s)&&(t[r++]=n);return t},kd.prototype.equals=function(e){return 0==this.compareTo(e)},kd.prototype.min=function(e){return this.compareTo(e)<0?this:e},kd.prototype.max=function(e){return this.compareTo(e)>0?this:e},kd.prototype.and=function(e){var t=Td();return this.bitwiseTo(e,Od,t),t},kd.prototype.or=function(e){var t=Td();return this.bitwiseTo(e,Ud,t),t},kd.prototype.xor=function(e){var t=Td();return this.bitwiseTo(e,zd,t),t},kd.prototype.andNot=function(e){var t=Td();return this.bitwiseTo(e,Fd,t),t},kd.prototype.not=function(){for(var e=Td(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e},kd.prototype.shiftLeft=function(e){var t=Td();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},kd.prototype.shiftRight=function(e){var t=Td();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},kd.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+Vd(this.data[e]);return this.s<0?this.t*this.DB:-1},kd.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=qd(this.data[n]^t);return e},kd.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)},kd.prototype.setBit=function(e){return this.changeBit(e,Ud)},kd.prototype.clearBit=function(e){return this.changeBit(e,Fd)},kd.prototype.flipBit=function(e){return this.changeBit(e,zd)},kd.prototype.add=function(e){var t=Td();return this.addTo(e,t),t},kd.prototype.subtract=function(e){var t=Td();return this.subTo(e,t),t},kd.prototype.multiply=function(e){var t=Td();return this.multiplyTo(e,t),t},kd.prototype.divide=function(e){var t=Td();return this.divRemTo(e,t,null),t},kd.prototype.remainder=function(e){var t=Td();return this.divRemTo(e,null,t),t},kd.prototype.divideAndRemainder=function(e){var t=Td(),n=Td();return this.divRemTo(e,t,n),new Array(t,n)},kd.prototype.modPow=function(e,t){var n,i,r=e.bitLength(),o=Pd(1);if(r<=0)return o;n=r<18?1:r<48?3:r<144?4:r<768?5:6,i=r<8?new Rd(t):t.isEven()?new Hd(t):new Md(t);var a=new Array,s=3,l=n-1,u=(1<<n)-1;if(a[1]=i.convert(this),n>1){var c=Td();for(i.sqrTo(a[1],c);s<=u;)a[s]=Td(),i.mulTo(c,a[s-2],a[s]),s+=2}var h,d,p=e.t-1,f=!0,g=Td();for(r=Bd(e.data[p])-1;p>=0;){for(r>=l?h=e.data[p]>>r-l&u:(h=(e.data[p]&(1<<r+1)-1)<<l-r,p>0&&(h|=e.data[p-1]>>this.DB+r-l)),s=n;0==(1&h);)h>>=1,--s;if((r-=s)<0&&(r+=this.DB,--p),f)a[h].copyTo(o),f=!1;else{for(;s>1;)i.sqrTo(o,g),i.sqrTo(g,o),s-=2;s>0?i.sqrTo(o,g):(d=o,o=g,g=d),i.mulTo(g,a[h],o)}for(;p>=0&&0==(e.data[p]&1<<r);)i.sqrTo(o,g),d=o,o=g,g=d,--r<0&&(r=this.DB-1,--p)}return i.revert(o)},kd.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return kd.ZERO;for(var n=e.clone(),i=this.clone(),r=Pd(1),o=Pd(0),a=Pd(0),s=Pd(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(r.isEven()&&o.isEven()||(r.addTo(this,r),o.subTo(e,o)),r.rShiftTo(1,r)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;i.isEven();)i.rShiftTo(1,i),t?(a.isEven()&&s.isEven()||(a.addTo(this,a),s.subTo(e,s)),a.rShiftTo(1,a)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);n.compareTo(i)>=0?(n.subTo(i,n),t&&r.subTo(a,r),o.subTo(s,o)):(i.subTo(n,i),t&&a.subTo(r,a),s.subTo(o,s))}return 0!=i.compareTo(kd.ONE)?kd.ZERO:s.compareTo(e)>=0?s.subtract(e):s.signum()<0?(s.addTo(e,s),s.signum()<0?s.add(e):s):s},kd.prototype.pow=function(e){return this.exp(e,new jd)},kd.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var i=t;t=n,n=i}var r=t.getLowestSetBit(),o=n.getLowestSetBit();if(o<0)return t;for(r<o&&(o=r),o>0&&(t.rShiftTo(o,t),n.rShiftTo(o,n));t.signum()>0;)(r=t.getLowestSetBit())>0&&t.rShiftTo(r,t),(r=n.getLowestSetBit())>0&&n.rShiftTo(r,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return o>0&&n.lShiftTo(o,n),n},kd.prototype.isProbablePrime=function(e){var t,n=this.abs();if(1==n.t&&n.data[0]<=Wd[Wd.length-1]){for(t=0;t<Wd.length;++t)if(n.data[0]==Wd[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<Wd.length;){for(var i=Wd[t],r=t+1;r<Wd.length&&i<Kd;)i*=Wd[r++];for(i=n.modInt(i);t<r;)if(i%Wd[t++]==0)return!1}return n.millerRabin(e)};u((function(e){var t=e.exports=qh.sha1=qh.sha1||{};qh.md.sha1=qh.md.algorithms.sha1=t,t.create=function(){i||(n=String.fromCharCode(128),n+=qh.util.fillString(String.fromCharCode(0),64),i=!0);var e=null,t=qh.util.createBuffer(),o=new Array(80),a={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){a.messageLength=0,a.fullMessageLength=a.messageLength64=[];for(var n=a.messageLengthSize/4,i=0;i<n;++i)a.fullMessageLength.push(0);return t=qh.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},a}};return a.start(),a.update=function(n,i){"utf8"===i&&(n=qh.util.encodeUtf8(n));var s=n.length;a.messageLength+=s,s=[s/4294967296>>>0,s>>>0];for(var l=a.fullMessageLength.length-1;l>=0;--l)a.fullMessageLength[l]+=s[1],s[1]=s[0]+(a.fullMessageLength[l]/4294967296>>>0),a.fullMessageLength[l]=a.fullMessageLength[l]>>>0,s[0]=s[1]/4294967296>>>0;return t.putBytes(n),r(e,o,t),(t.read>2048||0===t.length())&&t.compact(),a},a.digest=function(){var i=qh.util.createBuffer();i.putBytes(t.bytes());var s,l=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize&a.blockLength-1;i.putBytes(n.substr(0,a.blockLength-l));for(var u=8*a.fullMessageLength[0],c=0;c<a.fullMessageLength.length-1;++c)u+=(s=8*a.fullMessageLength[c+1])/4294967296>>>0,i.putInt32(u>>>0),u=s>>>0;i.putInt32(u);var h={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};r(h,o,i);var d=qh.util.createBuffer();return d.putInt32(h.h0),d.putInt32(h.h1),d.putInt32(h.h2),d.putInt32(h.h3),d.putInt32(h.h4),d},a};var n=null,i=!1;function r(e,t,n){for(var i,r,o,a,s,l,u,c=n.length();c>=64;){for(r=e.h0,o=e.h1,a=e.h2,s=e.h3,l=e.h4,u=0;u<16;++u)i=n.getInt32(),t[u]=i,i=(r<<5|r>>>27)+(s^o&(a^s))+l+1518500249+i,l=s,s=a,a=(o<<30|o>>>2)>>>0,o=r,r=i;for(;u<20;++u)i=(i=t[u-3]^t[u-8]^t[u-14]^t[u-16])<<1|i>>>31,t[u]=i,i=(r<<5|r>>>27)+(s^o&(a^s))+l+1518500249+i,l=s,s=a,a=(o<<30|o>>>2)>>>0,o=r,r=i;for(;u<32;++u)i=(i=t[u-3]^t[u-8]^t[u-14]^t[u-16])<<1|i>>>31,t[u]=i,i=(r<<5|r>>>27)+(o^a^s)+l+1859775393+i,l=s,s=a,a=(o<<30|o>>>2)>>>0,o=r,r=i;for(;u<40;++u)i=(i=t[u-6]^t[u-16]^t[u-28]^t[u-32])<<2|i>>>30,t[u]=i,i=(r<<5|r>>>27)+(o^a^s)+l+1859775393+i,l=s,s=a,a=(o<<30|o>>>2)>>>0,o=r,r=i;for(;u<60;++u)i=(i=t[u-6]^t[u-16]^t[u-28]^t[u-32])<<2|i>>>30,t[u]=i,i=(r<<5|r>>>27)+(o&a|s&(o^a))+l+2400959708+i,l=s,s=a,a=(o<<30|o>>>2)>>>0,o=r,r=i;for(;u<80;++u)i=(i=t[u-6]^t[u-16]^t[u-28]^t[u-32])<<2|i>>>30,t[u]=i,i=(r<<5|r>>>27)+(o^a^s)+l+3395469782+i,l=s,s=a,a=(o<<30|o>>>2)>>>0,o=r,r=i;e.h0=e.h0+r|0,e.h1=e.h1+o|0,e.h2=e.h2+a|0,e.h3=e.h3+s|0,e.h4=e.h4+l|0,c-=64}}})),u((function(e){var t=e.exports=qh.pkcs1=qh.pkcs1||{};function n(e,t,n){n||(n=qh.md.sha1.create());for(var i="",r=Math.ceil(t/n.digestLength),o=0;o<r;++o){var a=String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,255&o);n.start(),n.update(e+a),i+=n.digest().getBytes()}return i.substring(0,t)}t.encode_rsa_oaep=function(e,t,i){var r,o,a,s;"string"==typeof i?(r=i,o=arguments[3]||void 0,a=arguments[4]||void 0):i&&(r=i.label||void 0,o=i.seed||void 0,a=i.md||void 0,i.mgf1&&i.mgf1.md&&(s=i.mgf1.md)),a?a.start():a=qh.md.sha1.create(),s||(s=a);var l=Math.ceil(e.n.bitLength()/8),u=l-2*a.digestLength-2;if(t.length>u)throw(g=new Error("RSAES-OAEP input message length is too long.")).length=t.length,g.maxLength=u,g;r||(r=""),a.update(r,"raw");for(var c=a.digest(),h="",d=u-t.length,p=0;p<d;p++)h+="\0";var f=c.getBytes()+h+""+t;if(o){if(o.length!==a.digestLength){var g;throw(g=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.")).seedLength=o.length,g.digestLength=a.digestLength,g}}else o=qh.random.getBytes(a.digestLength);var m=n(o,l-a.digestLength-1,s),v=qh.util.xorBytes(f,m,f.length),y=n(v,a.digestLength,s),_=qh.util.xorBytes(o,y,o.length);return"\0"+_+v},t.decode_rsa_oaep=function(e,t,i){var r,o,a;"string"==typeof i?(r=i,o=arguments[3]||void 0):i&&(r=i.label||void 0,o=i.md||void 0,i.mgf1&&i.mgf1.md&&(a=i.mgf1.md));var s=Math.ceil(e.n.bitLength()/8);if(t.length!==s)throw(v=new Error("RSAES-OAEP encoded message length is invalid.")).length=t.length,v.expectedLength=s,v;if(void 0===o?o=qh.md.sha1.create():o.start(),a||(a=o),s<2*o.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");r||(r=""),o.update(r,"raw");for(var l=o.digest().getBytes(),u=t.charAt(0),c=t.substring(1,o.digestLength+1),h=t.substring(1+o.digestLength),d=n(h,o.digestLength,a),p=qh.util.xorBytes(c,d,c.length),f=n(p,s-o.digestLength-1,a),g=qh.util.xorBytes(h,f,h.length),m=g.substring(0,o.digestLength),v="\0"!==u,y=0;y<o.digestLength;++y)v|=l.charAt(y)!==m.charAt(y);for(var _=1,b=o.digestLength,w=o.digestLength;w<g.length;w++){var E=g.charCodeAt(w),C=1&E^1,S=_?65534:0;v|=E&S,b+=_&=C}if(v||1!==g.charCodeAt(b))throw new Error("Invalid RSAES-OAEP padding.");return g.substring(b+1)}})),u((function(e){!function(){if(qh.prime)e.exports=qh.prime;else{var t=e.exports=qh.prime=qh.prime||{},n=qh.jsbn.BigInteger,i=[6,4,2,4,2,4,6,2],r=new n(null);r.fromInt(30);var o=function(e,t){return e|t};t.generateProbablePrime=function(e,t,i){"function"==typeof t&&(i=t,t={});var r=(t=t||{}).algorithm||"PRIMEINC";"string"==typeof r&&(r={name:r}),r.options=r.options||{};var o=t.prng||qh.random,l={nextBytes:function(e){for(var t=o.getBytesSync(e.length),n=0;n<e.length;++n)e[n]=t.charCodeAt(n)}};if("PRIMEINC"===r.name)return function(e,t,i,r){if("workers"in i)return function(e,t,i,r){if("undefined"==typeof Worker)return a(e,t,i,r);var o=s(e,t),l=i.workers,u=i.workLoad||100,c=30*u/8,h=i.workerScript||"forge/prime.worker.js";if(-1===l)return qh.util.estimateCores((function(e,t){e&&(t=2),l=t-1,d()}));function d(){l=Math.max(1,l);for(var i=[],a=0;a<l;++a)i[a]=new Worker(h);for(a=0;a<l;++a)i[a].addEventListener("message",p);var d=!1;function p(a){if(!d){var l=a.data;if(l.found){for(var h=0;h<i.length;++h)i[h].terminate();return d=!0,r(null,new n(l.prime,16))}o.bitLength()>e&&(o=s(e,t));var p=o.toString(16);a.target.postMessage({hex:p,workLoad:u}),o.dAddOffset(c,0)}}}d()}(e,t,i,r);return a(e,t,i,r)}(e,l,r.options,i);throw new Error("Invalid prime generation algorithm: "+r.name)}}function a(e,t,n,r){var o=s(e,t),a=function(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}(o.bitLength());"millerRabinTests"in n&&(a=n.millerRabinTests);var l=10;"maxBlockTime"in n&&(l=n.maxBlockTime),function e(t,n,r,o,a,l,u){var c=+new Date;do{if(t.bitLength()>n&&(t=s(n,r)),t.isProbablePrime(a))return u(null,t);t.dAddOffset(i[o++%8],0)}while(l<0||+new Date-c<l);qh.util.setImmediate((function(){e(t,n,r,o,a,l,u)}))}(o,e,t,0,a,l,r)}function s(e,t){var i=new n(e,t),a=e-1;return i.testBit(a)||i.bitwiseTo(n.ONE.shiftLeft(a),o,i),i.dAddOffset(31-i.mod(r).byteValue(),0),i}}()}));if(void 0===Gd)var Gd=qh.jsbn.BigInteger;var Zd=qh.asn1;qh.pki=qh.pki||{};qh.pki.rsa=qh.rsa=qh.rsa||{};var Yd=qh.pki,Xd=[6,4,2,4,2,4,6,2],Qd={name:"PrivateKeyInfo",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},Jd={name:"RSAPrivateKey",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},ep={name:"RSAPublicKey",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},tp=qh.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:Zd.Class.UNIVERSAL,type:Zd.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},np=function(e){var t;if(!(e.algorithm in Yd.oids)){var n=new Error("Unknown message digest algorithm.");throw n.algorithm=e.algorithm,n}t=Yd.oids[e.algorithm];var i=Zd.oidToDer(t).getBytes(),r=Zd.create(Zd.Class.UNIVERSAL,Zd.Type.SEQUENCE,!0,[]),o=Zd.create(Zd.Class.UNIVERSAL,Zd.Type.SEQUENCE,!0,[]);o.value.push(Zd.create(Zd.Class.UNIVERSAL,Zd.Type.OID,!1,i)),o.value.push(Zd.create(Zd.Class.UNIVERSAL,Zd.Type.NULL,!1,""));var a=Zd.create(Zd.Class.UNIVERSAL,Zd.Type.OCTETSTRING,!1,e.digest().getBytes());return r.value.push(o),r.value.push(a),Zd.toDer(r).getBytes()},ip=function(e,t,n){if(n)return e.modPow(t.e,t.n);if(!t.p||!t.q)return e.modPow(t.d,t.n);var i;t.dP||(t.dP=t.d.mod(t.p.subtract(Gd.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(Gd.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));do{i=new Gd(qh.util.bytesToHex(qh.random.getBytes(t.n.bitLength()/8)),16)}while(i.compareTo(t.n)>=0||!i.gcd(t.n).equals(Gd.ONE));for(var r=(e=e.multiply(i.modPow(t.e,t.n)).mod(t.n)).mod(t.p).modPow(t.dP,t.p),o=e.mod(t.q).modPow(t.dQ,t.q);r.compareTo(o)<0;)r=r.add(t.p);var a=r.subtract(o).multiply(t.qInv).mod(t.p).multiply(t.q).add(o);return a=a.multiply(i.modInverse(t.n)).mod(t.n)};function rp(e,t,n){var i=qh.util.createBuffer(),r=Math.ceil(t.n.bitLength()/8);if(e.length>r-11){var o=new Error("Message is too long for PKCS#1 v1.5 padding.");throw o.length=e.length,o.max=r-11,o}i.putByte(0),i.putByte(n);var a,s=r-3-e.length;if(0===n||1===n){a=0===n?0:255;for(var l=0;l<s;++l)i.putByte(a)}else for(;s>0;){var u=0,c=qh.random.getBytes(s);for(l=0;l<s;++l)0===(a=c.charCodeAt(l))?++u:i.putByte(a);s=u}return i.putByte(0),i.putBytes(e),i}function op(e,t,n,i){var r=Math.ceil(t.n.bitLength()/8),o=qh.util.createBuffer(e),a=o.getByte(),s=o.getByte();if(0!==a||n&&0!==s&&1!==s||!n&&2!=s||n&&0===s&&void 0===i)throw new Error("Encryption block is invalid.");var l=0;if(0===s){l=r-3-i;for(var u=0;u<l;++u)if(0!==o.getByte())throw new Error("Encryption block is invalid.")}else if(1===s)for(l=0;o.length()>1;){if(255!==o.getByte()){--o.read;break}++l}else if(2===s)for(l=0;o.length()>1;){if(0===o.getByte()){--o.read;break}++l}if(0!==o.getByte()||l!==r-3-o.length())throw new Error("Encryption block is invalid.");return o.getBytes()}function ap(e,t,n){"function"==typeof t&&(n=t,t={});var i={algorithm:{name:(t=t||{}).algorithm||"PRIMEINC",options:{workers:t.workers||2,workLoad:t.workLoad||100,workerScript:t.workerScript}}};function r(){o(e.pBits,(function(t,i){return t?n(t):(e.p=i,null!==e.q?a(t,e.q):void o(e.qBits,a))}))}function o(e,t){qh.prime.generateProbablePrime(e,i,t)}function a(t,i){if(t)return n(t);if(e.q=i,e.p.compareTo(e.q)<0){var s=e.p;e.p=e.q,e.q=s}if(0!==e.p.subtract(Gd.ONE).gcd(e.e).compareTo(Gd.ONE))return e.p=null,void r();if(0!==e.q.subtract(Gd.ONE).gcd(e.e).compareTo(Gd.ONE))return e.q=null,void o(e.qBits,a);if(e.p1=e.p.subtract(Gd.ONE),e.q1=e.q.subtract(Gd.ONE),e.phi=e.p1.multiply(e.q1),0!==e.phi.gcd(e.e).compareTo(Gd.ONE))return e.p=e.q=null,void r();if(e.n=e.p.multiply(e.q),e.n.bitLength()!==e.bits)return e.q=null,void o(e.qBits,a);var l=e.e.modInverse(e.phi);e.keys={privateKey:Yd.rsa.setPrivateKey(e.n,e.e,l,e.p,e.q,l.mod(e.p1),l.mod(e.q1),e.q.modInverse(e.p)),publicKey:Yd.rsa.setPublicKey(e.n,e.e)},n(null,e.keys)}"prng"in t&&(i.prng=t.prng),r()}function sp(e){var t=e.toString(16);t[0]>="8"&&(t="00"+t);var n=qh.util.hexToBytes(t);return n.length>1&&(0===n.charCodeAt(0)&&0==(128&n.charCodeAt(1))||255===n.charCodeAt(0)&&128==(128&n.charCodeAt(1)))?n.substr(1):n}function lp(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}function up(e){return"undefined"!=typeof window&&"object"==typeof window.crypto&&"object"==typeof window.crypto.subtle&&"function"==typeof window.crypto.subtle[e]}function cp(e){return"undefined"!=typeof window&&"object"==typeof window.msCrypto&&"object"==typeof window.msCrypto.subtle&&"function"==typeof window.msCrypto.subtle[e]}function hp(e){for(var t=qh.util.hexToBytes(e.toString(16)),n=new Uint8Array(t.length),i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}if(Yd.rsa.encrypt=function(e,t,n){var i,r=n,o=Math.ceil(t.n.bitLength()/8);!1!==n&&!0!==n?(r=2===n,i=rp(e,t,n)):(i=qh.util.createBuffer()).putBytes(e);for(var a=new Gd(i.toHex(),16),s=ip(a,t,r).toString(16),l=qh.util.createBuffer(),u=o-Math.ceil(s.length/2);u>0;)l.putByte(0),--u;return l.putBytes(qh.util.hexToBytes(s)),l.getBytes()},Yd.rsa.decrypt=function(e,t,n,i){var r=Math.ceil(t.n.bitLength()/8);if(e.length!==r){var o=new Error("Encrypted message length is invalid.");throw o.length=e.length,o.expected=r,o}var a=new Gd(qh.util.createBuffer(e).toHex(),16);if(a.compareTo(t.n)>=0)throw new Error("Encrypted message is invalid.");for(var s=ip(a,t,n).toString(16),l=qh.util.createBuffer(),u=r-Math.ceil(s.length/2);u>0;)l.putByte(0),--u;return l.putBytes(qh.util.hexToBytes(s)),!1!==i?op(l.getBytes(),t,n):l.getBytes()},Yd.rsa.createKeyPairGenerationState=function(e,t,n){"string"==typeof e&&(e=parseInt(e,10)),e=e||2048;var i,r=(n=n||{}).prng||qh.random,o={nextBytes:function(e){for(var t=r.getBytesSync(e.length),n=0;n<e.length;++n)e[n]=t.charCodeAt(n)}},a=n.algorithm||"PRIMEINC";if("PRIMEINC"!==a)throw new Error("Invalid key generation algorithm: "+a);return(i={algorithm:a,state:0,bits:e,rng:o,eInt:t||65537,e:new Gd(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(i.eInt),i},Yd.rsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var n=new Gd(null);n.fromInt(30);for(var i,r=0,o=function(e,t){return e|t},a=+new Date,s=0;null===e.keys&&(t<=0||s<t);){if(0===e.state){var l=null===e.p?e.pBits:e.qBits,u=l-1;0===e.pqState?(e.num=new Gd(l,e.rng),e.num.testBit(u)||e.num.bitwiseTo(Gd.ONE.shiftLeft(u),o,e.num),e.num.dAddOffset(31-e.num.mod(n).byteValue(),0),r=0,++e.pqState):1===e.pqState?e.num.bitLength()>l?e.pqState=0:e.num.isProbablePrime(lp(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(Xd[r++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(Gd.ONE).gcd(e.e).compareTo(Gd.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(Gd.ONE),e.q1=e.q.subtract(Gd.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(Gd.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var c=e.e.modInverse(e.phi);e.keys={privateKey:Yd.rsa.setPrivateKey(e.n,e.e,c,e.p,e.q,c.mod(e.p1),c.mod(e.q1),e.q.modInverse(e.p)),publicKey:Yd.rsa.setPublicKey(e.n,e.e)}}s+=(i=+new Date)-a,a=i}return null!==e.keys},Yd.rsa.generateKeyPair=function(e,t,n,i){if(1===arguments.length?"object"==typeof e?(n=e,e=void 0):"function"==typeof e&&(i=e,e=void 0):2===arguments.length?"number"==typeof e?"function"==typeof t?(i=t,t=void 0):"number"!=typeof t&&(n=t,t=void 0):(n=e,i=t,e=void 0,t=void 0):3===arguments.length&&("number"==typeof t?"function"==typeof n&&(i=n,n=void 0):(i=n,n=t,t=void 0)),n=n||{},void 0===e&&(e=n.bits||2048),void 0===t&&(t=n.e||65537),i&&e>=256&&e<=16384&&(65537===t||3===t)){if(up("generateKey")&&up("exportKey"))return window.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:hp(t),hash:{name:"SHA-256"}},!0,["sign","verify"]).then((function(e){return window.crypto.subtle.exportKey("pkcs8",e.privateKey)})).then(void 0,(function(e){i(e)})).then((function(e){if(e){var t=Yd.privateKeyFromAsn1(Zd.fromDer(qh.util.createBuffer(e)));i(null,{privateKey:t,publicKey:Yd.setRsaPublicKey(t.n,t.e)})}}));if(cp("generateKey")&&cp("exportKey")){var r=window.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:hp(t),hash:{name:"SHA-256"}},!0,["sign","verify"]);return r.oncomplete=function(e){var t=e.target.result,n=window.msCrypto.subtle.exportKey("pkcs8",t.privateKey);n.oncomplete=function(e){var t=e.target.result,n=Yd.privateKeyFromAsn1(Zd.fromDer(qh.util.createBuffer(t)));i(null,{privateKey:n,publicKey:Yd.setRsaPublicKey(n.n,n.e)})},n.onerror=function(e){i(e)}},void(r.onerror=function(e){i(e)})}}var o=Yd.rsa.createKeyPairGenerationState(e,t,n);if(!i)return Yd.rsa.stepKeyPairGenerationState(o,0),o.keys;ap(o,n,i)},Yd.setRsaPublicKey=Yd.rsa.setPublicKey=function(e,t){var n={n:e,e:t,encrypt:function(e,t,i){if("string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===t)t={encode:function(e,t,n){return rp(e,t,2).getBytes()}};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={encode:function(e,t){return qh.pkcs1.encode_rsa_oaep(t,e,i)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(t))t={encode:function(e){return e}};else if("string"==typeof t)throw new Error('Unsupported encryption scheme: "'+t+'".');var r=t.encode(e,n,!0);return Yd.rsa.encrypt(r,n,!0)},verify:function(e,t,i){"string"==typeof i?i=i.toUpperCase():void 0===i&&(i="RSASSA-PKCS1-V1_5"),"RSASSA-PKCS1-V1_5"===i?i={verify:function(e,t){return t=op(t,n,!0),e===Zd.fromDer(t).value[1].value}}:"NONE"!==i&&"NULL"!==i&&null!==i||(i={verify:function(e,t){return e===(t=op(t,n,!0))}});var r=Yd.rsa.decrypt(t,n,!0,!1);return i.verify(e,r,n.n.bitLength())}};return n},Yd.setRsaPrivateKey=Yd.rsa.setPrivateKey=function(e,t,n,i,r,o,a,s){var l={n:e,e:t,d:n,p:i,q:r,dP:o,dQ:a,qInv:s,decrypt:function(e,t,n){"string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5");var i=Yd.rsa.decrypt(e,l,!1,!1);if("RSAES-PKCS1-V1_5"===t)t={decode:op};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={decode:function(e,t){return qh.pkcs1.decode_rsa_oaep(t,e,n)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(t))throw new Error('Unsupported encryption scheme: "'+t+'".');t={decode:function(e){return e}}}return t.decode(i,l,!1)},sign:function(e,t){var n=!1;"string"==typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:np},n=1):"NONE"!==t&&"NULL"!==t&&null!==t||(t={encode:function(){return e}},n=1);var i=t.encode(e,l.n.bitLength());return Yd.rsa.encrypt(i,l,n)}};return l},Yd.wrapRsaPrivateKey=function(e){return Zd.create(Zd.Class.UNIVERSAL,Zd.Type.SEQUENCE,!0,[Zd.create(Zd.Class.UNIVERSAL,Zd.Type.INTEGER,!1,Zd.integerToDer(0).getBytes()),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.SEQUENCE,!0,[Zd.create(Zd.Class.UNIVERSAL,Zd.Type.OID,!1,Zd.oidToDer(Yd.oids.rsaEncryption).getBytes()),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.NULL,!1,"")]),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.OCTETSTRING,!1,Zd.toDer(e).getBytes())])},Yd.privateKeyFromAsn1=function(e){var t,n,i,r,o,a,s,l,u={},c=[];if(Zd.validate(e,Qd,u,c)&&(e=Zd.fromDer(qh.util.createBuffer(u.privateKey))),u={},c=[],!Zd.validate(e,Jd,u,c)){var h=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw h.errors=c,h}return t=qh.util.createBuffer(u.privateKeyModulus).toHex(),n=qh.util.createBuffer(u.privateKeyPublicExponent).toHex(),i=qh.util.createBuffer(u.privateKeyPrivateExponent).toHex(),r=qh.util.createBuffer(u.privateKeyPrime1).toHex(),o=qh.util.createBuffer(u.privateKeyPrime2).toHex(),a=qh.util.createBuffer(u.privateKeyExponent1).toHex(),s=qh.util.createBuffer(u.privateKeyExponent2).toHex(),l=qh.util.createBuffer(u.privateKeyCoefficient).toHex(),Yd.setRsaPrivateKey(new Gd(t,16),new Gd(n,16),new Gd(i,16),new Gd(r,16),new Gd(o,16),new Gd(a,16),new Gd(s,16),new Gd(l,16))},Yd.privateKeyToAsn1=Yd.privateKeyToRSAPrivateKey=function(e){return Zd.create(Zd.Class.UNIVERSAL,Zd.Type.SEQUENCE,!0,[Zd.create(Zd.Class.UNIVERSAL,Zd.Type.INTEGER,!1,Zd.integerToDer(0).getBytes()),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.INTEGER,!1,sp(e.n)),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.INTEGER,!1,sp(e.e)),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.INTEGER,!1,sp(e.d)),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.INTEGER,!1,sp(e.p)),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.INTEGER,!1,sp(e.q)),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.INTEGER,!1,sp(e.dP)),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.INTEGER,!1,sp(e.dQ)),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.INTEGER,!1,sp(e.qInv))])},Yd.publicKeyFromAsn1=function(e){var t={},n=[];if(Zd.validate(e,tp,t,n)){var i,r=Zd.derToOid(t.publicKeyOid);if(r!==Yd.oids.rsaEncryption)throw(i=new Error("Cannot read public key. Unknown OID.")).oid=r,i;e=t.rsaPublicKey}if(n=[],!Zd.validate(e,ep,t,n))throw(i=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.")).errors=n,i;var o=qh.util.createBuffer(t.publicKeyModulus).toHex(),a=qh.util.createBuffer(t.publicKeyExponent).toHex();return Yd.setRsaPublicKey(new Gd(o,16),new Gd(a,16))},Yd.publicKeyToAsn1=Yd.publicKeyToSubjectPublicKeyInfo=function(e){return Zd.create(Zd.Class.UNIVERSAL,Zd.Type.SEQUENCE,!0,[Zd.create(Zd.Class.UNIVERSAL,Zd.Type.SEQUENCE,!0,[Zd.create(Zd.Class.UNIVERSAL,Zd.Type.OID,!1,Zd.oidToDer(Yd.oids.rsaEncryption).getBytes()),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.NULL,!1,"")]),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.BITSTRING,!1,[Yd.publicKeyToRSAPublicKey(e)])])},Yd.publicKeyToRSAPublicKey=function(e){return Zd.create(Zd.Class.UNIVERSAL,Zd.Type.SEQUENCE,!0,[Zd.create(Zd.Class.UNIVERSAL,Zd.Type.INTEGER,!1,sp(e.n)),Zd.create(Zd.Class.UNIVERSAL,Zd.Type.INTEGER,!1,sp(e.e))])},void 0===dp)var dp=qh.jsbn.BigInteger;var pp=qh.asn1,fp=qh.pki=qh.pki||{},gp=(fp.pbe=qh.pbe=qh.pbe||{},fp.oids),mp={name:"EncryptedPrivateKeyInfo",tagClass:pp.Class.UNIVERSAL,type:pp.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:pp.Class.UNIVERSAL,type:pp.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:pp.Class.UNIVERSAL,type:pp.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:pp.Class.UNIVERSAL,type:pp.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:pp.Class.UNIVERSAL,type:pp.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},vp={name:"PBES2Algorithms",tagClass:pp.Class.UNIVERSAL,type:pp.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:pp.Class.UNIVERSAL,type:pp.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:pp.Class.UNIVERSAL,type:pp.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:pp.Class.UNIVERSAL,type:pp.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:pp.Class.UNIVERSAL,type:pp.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:pp.Class.UNIVERSAL,type:pp.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:pp.Class.UNIVERSAL,type:pp.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:pp.Class.UNIVERSAL,type:pp.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:pp.Class.UNIVERSAL,type:pp.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:pp.Class.UNIVERSAL,type:pp.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:pp.Class.UNIVERSAL,type:pp.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:pp.Class.UNIVERSAL,type:pp.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},yp={name:"pkcs-12PbeParams",tagClass:pp.Class.UNIVERSAL,type:pp.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:pp.Class.UNIVERSAL,type:pp.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:pp.Class.UNIVERSAL,type:pp.Type.INTEGER,constructed:!1,capture:"iterations"}]};function _p(e,t){return e.start().update(t).digest().getBytes()}function bp(e){var t;if(e){if(!(t=fp.oids[pp.derToOid(e)])){var n=new Error("Unsupported PRF OID.");throw n.oid=e,n.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],n}}else t="hmacWithSHA1";return wp(t)}function wp(e){var t=qh.md;switch(e){case"hmacWithSHA224":t=qh.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":e=e.substr(8).toLowerCase();break;default:var n=new Error("Unsupported PRF algorithm.");throw n.algorithm=e,n.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],n}if(!t||!(e in t))throw new Error("Unknown hash algorithm: "+e);return t[e].create()}fp.encryptPrivateKeyInfo=function(e,t,n){(n=n||{}).saltSize=n.saltSize||8,n.count=n.count||2048,n.algorithm=n.algorithm||"aes128",n.prfAlgorithm=n.prfAlgorithm||"sha1";var i,r,o,a=qh.random.getBytesSync(n.saltSize),s=n.count,l=pp.integerToDer(s);if(0===n.algorithm.indexOf("aes")||"des"===n.algorithm){var u,c,h;switch(n.algorithm){case"aes128":i=16,u=16,c=gp["aes128-CBC"],h=qh.aes.createEncryptionCipher;break;case"aes192":i=24,u=16,c=gp["aes192-CBC"],h=qh.aes.createEncryptionCipher;break;case"aes256":i=32,u=16,c=gp["aes256-CBC"],h=qh.aes.createEncryptionCipher;break;case"des":i=8,u=8,c=gp.desCBC,h=qh.des.createEncryptionCipher;break;default:throw(v=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=n.algorithm,v}var d="hmacWith"+n.prfAlgorithm.toUpperCase(),p=wp(d),f=qh.pkcs5.pbkdf2(t,a,s,i,p),g=qh.random.getBytesSync(u);(y=h(f)).start(g),y.update(pp.toDer(e)),y.finish(),o=y.output.getBytes();var m=function(e,t,n,i){var r=pp.create(pp.Class.UNIVERSAL,pp.Type.SEQUENCE,!0,[pp.create(pp.Class.UNIVERSAL,pp.Type.OCTETSTRING,!1,e),pp.create(pp.Class.UNIVERSAL,pp.Type.INTEGER,!1,t.getBytes())]);"hmacWithSHA1"!==i&&r.value.push(pp.create(pp.Class.UNIVERSAL,pp.Type.INTEGER,!1,qh.util.hexToBytes(n.toString(16))),pp.create(pp.Class.UNIVERSAL,pp.Type.SEQUENCE,!0,[pp.create(pp.Class.UNIVERSAL,pp.Type.OID,!1,pp.oidToDer(fp.oids[i]).getBytes()),pp.create(pp.Class.UNIVERSAL,pp.Type.NULL,!1,"")]));return r}(a,l,i,d);r=pp.create(pp.Class.UNIVERSAL,pp.Type.SEQUENCE,!0,[pp.create(pp.Class.UNIVERSAL,pp.Type.OID,!1,pp.oidToDer(gp.pkcs5PBES2).getBytes()),pp.create(pp.Class.UNIVERSAL,pp.Type.SEQUENCE,!0,[pp.create(pp.Class.UNIVERSAL,pp.Type.SEQUENCE,!0,[pp.create(pp.Class.UNIVERSAL,pp.Type.OID,!1,pp.oidToDer(gp.pkcs5PBKDF2).getBytes()),m]),pp.create(pp.Class.UNIVERSAL,pp.Type.SEQUENCE,!0,[pp.create(pp.Class.UNIVERSAL,pp.Type.OID,!1,pp.oidToDer(c).getBytes()),pp.create(pp.Class.UNIVERSAL,pp.Type.OCTETSTRING,!1,g)])])])}else{var v;if("3des"!==n.algorithm)throw(v=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=n.algorithm,v;i=24;var y,_=new qh.util.ByteBuffer(a);f=fp.pbe.generatePkcs12Key(t,_,1,s,i),g=fp.pbe.generatePkcs12Key(t,_,2,s,i);(y=qh.des.createEncryptionCipher(f)).start(g),y.update(pp.toDer(e)),y.finish(),o=y.output.getBytes(),r=pp.create(pp.Class.UNIVERSAL,pp.Type.SEQUENCE,!0,[pp.create(pp.Class.UNIVERSAL,pp.Type.OID,!1,pp.oidToDer(gp["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),pp.create(pp.Class.UNIVERSAL,pp.Type.SEQUENCE,!0,[pp.create(pp.Class.UNIVERSAL,pp.Type.OCTETSTRING,!1,a),pp.create(pp.Class.UNIVERSAL,pp.Type.INTEGER,!1,l.getBytes())])])}return pp.create(pp.Class.UNIVERSAL,pp.Type.SEQUENCE,!0,[r,pp.create(pp.Class.UNIVERSAL,pp.Type.OCTETSTRING,!1,o)])},fp.decryptPrivateKeyInfo=function(e,t){var n=null,i={},r=[];if(!pp.validate(e,mp,i,r)){var o=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw o.errors=r,o}var a=pp.derToOid(i.encryptionOid),s=fp.pbe.getCipher(a,i.encryptionParams,t),l=qh.util.createBuffer(i.encryptedData);return s.update(l),s.finish()&&(n=pp.fromDer(s.output)),n},fp.encryptedPrivateKeyToPem=function(e,t){var n={type:"ENCRYPTED PRIVATE KEY",body:pp.toDer(e).getBytes()};return qh.pem.encode(n,{maxline:t})},fp.encryptedPrivateKeyFromPem=function(e){var t=qh.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==t.type){var n=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw n.headerType=t.type,n}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return pp.fromDer(t.body)},fp.encryptRsaPrivateKey=function(e,t,n){if(!(n=n||{}).legacy){var i=fp.wrapRsaPrivateKey(fp.privateKeyToAsn1(e));return i=fp.encryptPrivateKeyInfo(i,t,n),fp.encryptedPrivateKeyToPem(i)}var r,o,a,s;switch(n.algorithm){case"aes128":r="AES-128-CBC",a=16,o=qh.random.getBytesSync(16),s=qh.aes.createEncryptionCipher;break;case"aes192":r="AES-192-CBC",a=24,o=qh.random.getBytesSync(16),s=qh.aes.createEncryptionCipher;break;case"aes256":r="AES-256-CBC",a=32,o=qh.random.getBytesSync(16),s=qh.aes.createEncryptionCipher;break;case"3des":r="DES-EDE3-CBC",a=24,o=qh.random.getBytesSync(8),s=qh.des.createEncryptionCipher;break;case"des":r="DES-CBC",a=8,o=qh.random.getBytesSync(8),s=qh.des.createEncryptionCipher;break;default:var l=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+n.algorithm+'".');throw l.algorithm=n.algorithm,l}var u=s(qh.pbe.opensslDeriveBytes(t,o.substr(0,8),a));u.start(o),u.update(pp.toDer(fp.privateKeyToAsn1(e))),u.finish();var c={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:r,parameters:qh.util.bytesToHex(o).toUpperCase()},body:u.output.getBytes()};return qh.pem.encode(c)},fp.decryptRsaPrivateKey=function(e,t){var n=null,i=qh.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==i.type&&"PRIVATE KEY"!==i.type&&"RSA PRIVATE KEY"!==i.type)throw(a=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".')).headerType=a,a;if(i.procType&&"ENCRYPTED"===i.procType.type){var r,o;switch(i.dekInfo.algorithm){case"DES-CBC":r=8,o=qh.des.createDecryptionCipher;break;case"DES-EDE3-CBC":r=24,o=qh.des.createDecryptionCipher;break;case"AES-128-CBC":r=16,o=qh.aes.createDecryptionCipher;break;case"AES-192-CBC":r=24,o=qh.aes.createDecryptionCipher;break;case"AES-256-CBC":r=32,o=qh.aes.createDecryptionCipher;break;case"RC2-40-CBC":r=5,o=function(e){return qh.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":r=8,o=function(e){return qh.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":r=16,o=function(e){return qh.rc2.createDecryptionCipher(e,128)};break;default:var a;throw(a=new Error('Could not decrypt private key; unsupported encryption algorithm "'+i.dekInfo.algorithm+'".')).algorithm=i.dekInfo.algorithm,a}var s=qh.util.hexToBytes(i.dekInfo.parameters),l=o(qh.pbe.opensslDeriveBytes(t,s.substr(0,8),r));if(l.start(s),l.update(qh.util.createBuffer(i.body)),!l.finish())return n;n=l.output.getBytes()}else n=i.body;return null!==(n="ENCRYPTED PRIVATE KEY"===i.type?fp.decryptPrivateKeyInfo(pp.fromDer(n),t):pp.fromDer(n))&&(n=fp.privateKeyFromAsn1(n)),n},fp.pbe.generatePkcs12Key=function(e,t,n,i,r,o){var a,s;if(null==o){if(!("sha1"in qh.md))throw new Error('"sha1" hash algorithm unavailable.');o=qh.md.sha1.create()}var l=o.digestLength,u=o.blockLength,c=new qh.util.ByteBuffer,h=new qh.util.ByteBuffer;if(null!=e){for(s=0;s<e.length;s++)h.putInt16(e.charCodeAt(s));h.putInt16(0)}var d=h.length(),p=t.length(),f=new qh.util.ByteBuffer;f.fillWithByte(n,u);var g=u*Math.ceil(p/u),m=new qh.util.ByteBuffer;for(s=0;s<g;s++)m.putByte(t.at(s%p));var v=u*Math.ceil(d/u),y=new qh.util.ByteBuffer;for(s=0;s<v;s++)y.putByte(h.at(s%d));var _=m;_.putBuffer(y);for(var b=Math.ceil(r/l),w=1;w<=b;w++){var E=new qh.util.ByteBuffer;E.putBytes(f.bytes()),E.putBytes(_.bytes());for(var C=0;C<i;C++)o.start(),o.update(E.getBytes()),E=o.digest();var S=new qh.util.ByteBuffer;for(s=0;s<u;s++)S.putByte(E.at(s%l));var k=Math.ceil(p/u)+Math.ceil(d/u),T=new qh.util.ByteBuffer;for(a=0;a<k;a++){var x=new qh.util.ByteBuffer(_.getBytes(u)),L=511;for(s=S.length()-1;s>=0;s--)L>>=8,L+=S.at(s)+x.at(s),x.setAt(s,255&L);T.putBuffer(x)}_=T,c.putBuffer(E)}return c.truncate(c.length()-r),c},fp.pbe.getCipher=function(e,t,n){switch(e){case fp.oids.pkcs5PBES2:return fp.pbe.getCipherForPBES2(e,t,n);case fp.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case fp.oids["pbewithSHAAnd40BitRC2-CBC"]:return fp.pbe.getCipherForPKCS12PBE(e,t,n);default:var i=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw i.oid=e,i.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],i}},fp.pbe.getCipherForPBES2=function(e,t,n){var i,r={},o=[];if(!pp.validate(t,vp,r,o))throw(i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=o,i;if((e=pp.derToOid(r.kdfOid))!==fp.oids.pkcs5PBKDF2)throw(i=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=e,i.supportedOids=["pkcs5PBKDF2"],i;if((e=pp.derToOid(r.encOid))!==fp.oids["aes128-CBC"]&&e!==fp.oids["aes192-CBC"]&&e!==fp.oids["aes256-CBC"]&&e!==fp.oids["des-EDE3-CBC"]&&e!==fp.oids.desCBC)throw(i=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.")).oid=e,i.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],i;var a,s,l=r.kdfSalt,u=qh.util.createBuffer(r.kdfIterationCount);switch(u=u.getInt(u.length()<<3),fp.oids[e]){case"aes128-CBC":a=16,s=qh.aes.createDecryptionCipher;break;case"aes192-CBC":a=24,s=qh.aes.createDecryptionCipher;break;case"aes256-CBC":a=32,s=qh.aes.createDecryptionCipher;break;case"des-EDE3-CBC":a=24,s=qh.des.createDecryptionCipher;break;case"desCBC":a=8,s=qh.des.createDecryptionCipher}var c=bp(r.prfOid),h=qh.pkcs5.pbkdf2(n,l,u,a,c),d=r.encIv,p=s(h);return p.start(d),p},fp.pbe.getCipherForPKCS12PBE=function(e,t,n){var i={},r=[];if(!pp.validate(t,yp,i,r))throw(c=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=r,c;var o,a,s,l=qh.util.createBuffer(i.salt),u=qh.util.createBuffer(i.iterations);switch(u=u.getInt(u.length()<<3),e){case fp.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:o=24,a=8,s=qh.des.startDecrypting;break;case fp.oids["pbewithSHAAnd40BitRC2-CBC"]:o=5,a=8,s=function(e,t){var n=qh.rc2.createDecryptionCipher(e,40);return n.start(t,null),n};break;default:var c;throw(c=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=e,c}var h=bp(i.prfOid),d=fp.pbe.generatePkcs12Key(n,l,1,u,o,h);return h.start(),s(d,fp.pbe.generatePkcs12Key(n,l,2,u,a,h))},fp.pbe.opensslDeriveBytes=function(e,t,n,i){if(null==i){if(!("md5"in qh.md))throw new Error('"md5" hash algorithm unavailable.');i=qh.md.md5.create()}null===t&&(t="");for(var r=[_p(i,e+t)],o=16,a=1;o<n;++a,o+=16)r.push(_p(i,r[a-1]+e+t));return r.join("").substr(0,n)};u((function(e){var t=qh.asn1,n=e.exports=qh.pkcs7asn1=qh.pkcs7asn1||{};qh.pkcs7=qh.pkcs7||{},qh.pkcs7.asn1=n;var i={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};n.contentInfoValidator=i;var r={name:"EncryptedContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};n.envelopedDataValidator={name:"EnvelopedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(r)},n.encryptedDataValidator={name:"EncryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"}].concat(r)};var o={name:"SignerInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};n.signedDataValidator={name:"SignedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},i,{name:"SignedData.Certificates",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,capture:"signerInfos",optional:!0,value:[o]}]},n.recipientInfoValidator={name:"RecipientInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}})),u((function(e){qh.mgf=qh.mgf||{},(e.exports=qh.mgf.mgf1=qh.mgf1=qh.mgf1||{}).create=function(e){return{generate:function(t,n){for(var i=new qh.util.ByteBuffer,r=Math.ceil(n/e.digestLength),o=0;o<r;o++){var a=new qh.util.ByteBuffer;a.putInt32(o),e.start(),e.update(t+a.getBytes()),i.putBuffer(e.digest())}return i.truncate(i.length()-n),i.getBytes()}}}})),qh.mgf=qh.mgf||{};qh.mgf.mgf1=qh.mgf1;u((function(e){(e.exports=qh.pss=qh.pss||{}).create=function(e){3===arguments.length&&(e={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var t,n=e.md,i=e.mgf,r=n.digestLength,o=e.salt||null;if("string"==typeof o&&(o=qh.util.createBuffer(o)),"saltLength"in e)t=e.saltLength;else{if(null===o)throw new Error("Salt length not specified or specific salt not given.");t=o.length()}if(null!==o&&o.length()!==t)throw new Error("Given salt length does not match length of given salt.");var a=e.prng||qh.random,s={encode:function(e,s){var l,u,c=s-1,h=Math.ceil(c/8),d=e.digest().getBytes();if(h<r+t+2)throw new Error("Message is too long to encrypt.");u=null===o?a.getBytesSync(t):o.bytes();var p=new qh.util.ByteBuffer;p.fillWithByte(0,8),p.putBytes(d),p.putBytes(u),n.start(),n.update(p.getBytes());var f=n.digest().getBytes(),g=new qh.util.ByteBuffer;g.fillWithByte(0,h-t-r-2),g.putByte(1),g.putBytes(u);var m=g.getBytes(),v=h-r-1,y=i.generate(f,v),_="";for(l=0;l<v;l++)_+=String.fromCharCode(m.charCodeAt(l)^y.charCodeAt(l));var b=65280>>8*h-c&255;return(_=String.fromCharCode(_.charCodeAt(0)&~b)+_.substr(1))+f+String.fromCharCode(188)},verify:function(e,o,a){var s,l=a-1,u=Math.ceil(l/8);if(o=o.substr(-u),u<r+t+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(188!==o.charCodeAt(u-1))throw new Error("Encoded message does not end in 0xBC.");var c=u-r-1,h=o.substr(0,c),d=o.substr(c,r),p=65280>>8*u-l&255;if(0!=(h.charCodeAt(0)&p))throw new Error("Bits beyond keysize not zero as expected.");var f=i.generate(d,c),g="";for(s=0;s<c;s++)g+=String.fromCharCode(h.charCodeAt(s)^f.charCodeAt(s));g=String.fromCharCode(g.charCodeAt(0)&~p)+g.substr(1);var m=u-r-t-2;for(s=0;s<m;s++)if(0!==g.charCodeAt(s))throw new Error("Leftmost octets not zero as expected");if(1!==g.charCodeAt(m))throw new Error("Inconsistent PSS signature, 0x01 marker not found");var v=g.substr(-t),y=new qh.util.ByteBuffer;return y.fillWithByte(0,8),y.putBytes(e),y.putBytes(v),n.start(),n.update(y.getBytes()),d===n.digest().getBytes()}};return s}})),u((function(e){var t=qh.asn1,n=e.exports=qh.pki=qh.pki||{},i=n.oids,r={};r.CN=i.commonName,r.commonName="CN",r.C=i.countryName,r.countryName="C",r.L=i.localityName,r.localityName="L",r.ST=i.stateOrProvinceName,r.stateOrProvinceName="ST",r.O=i.organizationName,r.organizationName="O",r.OU=i.organizationalUnitName,r.organizationalUnitName="OU",r.E=i.emailAddress,r.emailAddress="E";var o=qh.pki.rsa.publicKeyValidator,a={name:"Certificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},o,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},s={name:"rsapss",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},l={name:"CertificationRequestInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},o,{name:"CertificationRequestInfo.attributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0}]}]}]},u={name:"CertificationRequest",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[l,{name:"CertificationRequest.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};function c(e,t){"string"==typeof t&&(t={shortName:t});for(var n,i=null,r=0;null===i&&r<e.attributes.length;++r)n=e.attributes[r],(t.type&&t.type===n.type||t.name&&t.name===n.name||t.shortName&&t.shortName===n.shortName)&&(i=n);return i}n.RDNAttributesAsArray=function(e,n){for(var o,a,s,l=[],u=0;u<e.value.length;++u){o=e.value[u];for(var c=0;c<o.value.length;++c)s={},a=o.value[c],s.type=t.derToOid(a.value[0].value),s.value=a.value[1].value,s.valueTagClass=a.value[1].type,s.type in i&&(s.name=i[s.type],s.name in r&&(s.shortName=r[s.name])),n&&(n.update(s.type),n.update(s.value)),l.push(s)}return l},n.CRIAttributesAsArray=function(e){for(var o=[],a=0;a<e.length;++a)for(var s=e[a],l=t.derToOid(s.value[0].value),u=s.value[1].value,c=0;c<u.length;++c){var h={};if(h.type=l,h.value=u[c].value,h.valueTagClass=u[c].type,h.type in i&&(h.name=i[h.type],h.name in r&&(h.shortName=r[h.name])),h.type===i.extensionRequest){h.extensions=[];for(var d=0;d<h.value.length;++d)h.extensions.push(n.certificateExtensionFromAsn1(h.value[d]))}o.push(h)}return o};var h=function(e,n,r){var o={};if(e!==i["RSASSA-PSS"])return o;r&&(o={hash:{algorithmOid:i.sha1},mgf:{algorithmOid:i.mgf1,hash:{algorithmOid:i.sha1}},saltLength:20});var a={},l=[];if(!t.validate(n,s,a,l)){var u=new Error("Cannot read RSASSA-PSS parameter block.");throw u.errors=l,u}return void 0!==a.hashOid&&(o.hash=o.hash||{},o.hash.algorithmOid=t.derToOid(a.hashOid)),void 0!==a.maskGenOid&&(o.mgf=o.mgf||{},o.mgf.algorithmOid=t.derToOid(a.maskGenOid),o.mgf.hash=o.mgf.hash||{},o.mgf.hash.algorithmOid=t.derToOid(a.maskGenHashOid)),void 0!==a.saltLength&&(o.saltLength=a.saltLength.charCodeAt(0)),o};function d(e){for(var n,i,r=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),o=e.attributes,a=0;a<o.length;++a){var s=(n=o[a]).value,l=t.Type.PRINTABLESTRING;"valueTagClass"in n&&(l=n.valueTagClass)===t.Type.UTF8&&(s=qh.util.encodeUtf8(s)),i=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.type).getBytes()),t.create(t.Class.UNIVERSAL,l,!1,s)])]),r.value.push(i)}return r}function p(e){for(var o,a=0;a<e.length;++a){if(void 0===(o=e[a]).name&&(o.type&&o.type in n.oids?o.name=n.oids[o.type]:o.shortName&&o.shortName in r&&(o.name=n.oids[r[o.shortName]])),void 0===o.type){if(!o.name||!(o.name in n.oids))throw(l=new Error("Attribute type not specified.")).attribute=o,l;o.type=n.oids[o.name]}if(void 0===o.shortName&&o.name&&o.name in r&&(o.shortName=r[o.name]),o.type===i.extensionRequest&&(o.valueConstructed=!0,o.valueTagClass=t.Type.SEQUENCE,!o.value&&o.extensions)){o.value=[];for(var s=0;s<o.extensions.length;++s)o.value.push(n.certificateExtensionToAsn1(f(o.extensions[s])))}var l;if(void 0===o.value)throw(l=new Error("Attribute value not specified.")).attribute=o,l}}function f(e,r){if(r=r||{},void 0===e.name&&e.id&&e.id in n.oids&&(e.name=n.oids[e.id]),void 0===e.id){if(!e.name||!(e.name in n.oids))throw(b=new Error("Extension ID not specified.")).extension=e,b;e.id=n.oids[e.name]}if(void 0!==e.value)return e;if("keyUsage"===e.name){var o=0,a=0,s=0;e.digitalSignature&&(a|=128,o=7),e.nonRepudiation&&(a|=64,o=6),e.keyEncipherment&&(a|=32,o=5),e.dataEncipherment&&(a|=16,o=4),e.keyAgreement&&(a|=8,o=3),e.keyCertSign&&(a|=4,o=2),e.cRLSign&&(a|=2,o=1),e.encipherOnly&&(a|=1,o=0),e.decipherOnly&&(s|=128,o=7);var l=String.fromCharCode(o);0!==s?l+=String.fromCharCode(a)+String.fromCharCode(s):0!==a&&(l+=String.fromCharCode(a)),e.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,l)}else if("basicConstraints"===e.name)e.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),e.cA&&e.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in e&&e.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(e.pathLenConstraint).getBytes()));else if("extKeyUsage"===e.name){e.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);var u=e.value.value;for(var c in e)!0===e[c]&&(c in i?u.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i[c]).getBytes())):-1!==c.indexOf(".")&&u.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(c).getBytes())))}else if("nsCertType"===e.name){o=0,a=0;e.client&&(a|=128,o=7),e.server&&(a|=64,o=6),e.email&&(a|=32,o=5),e.objsign&&(a|=16,o=4),e.reserved&&(a|=8,o=3),e.sslCA&&(a|=4,o=2),e.emailCA&&(a|=2,o=1),e.objCA&&(a|=1,o=0);l=String.fromCharCode(o);0!==a&&(l+=String.fromCharCode(a)),e.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,l)}else if("subjectAltName"===e.name||"issuerAltName"===e.name){e.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);for(var h=0;h<e.altNames.length;++h){l=(v=e.altNames[h]).value;if(7===v.type&&v.ip){if(null===(l=qh.util.bytesFromIP(v.ip)))throw(b=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,b}else 8===v.type&&(l=v.oid?t.oidToDer(t.oidToDer(v.oid)):t.oidToDer(l));e.value.value.push(t.create(t.Class.CONTEXT_SPECIFIC,v.type,!1,l))}}else if("subjectKeyIdentifier"===e.name&&r.cert){var p=r.cert.generateSubjectKeyIdentifier();e.subjectKeyIdentifier=p.toHex(),e.value=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,p.getBytes())}else if("authorityKeyIdentifier"===e.name&&r.cert){e.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);u=e.value.value;if(e.keyIdentifier){var f=!0===e.keyIdentifier?r.cert.generateSubjectKeyIdentifier().getBytes():e.keyIdentifier;u.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!1,f))}if(e.authorityCertIssuer){var g=[t.create(t.Class.CONTEXT_SPECIFIC,4,!0,[d(!0===e.authorityCertIssuer?r.cert.issuer:e.authorityCertIssuer)])];u.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,g))}if(e.serialNumber){var m=qh.util.hexToBytes(!0===e.serialNumber?r.cert.serialNumber:e.serialNumber);u.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!1,m))}}else if("cRLDistributionPoints"===e.name){e.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);u=e.value.value;var v,y=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),_=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]);for(h=0;h<e.altNames.length;++h){l=(v=e.altNames[h]).value;if(7===v.type&&v.ip){if(null===(l=qh.util.bytesFromIP(v.ip)))throw(b=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,b}else 8===v.type&&(l=v.oid?t.oidToDer(t.oidToDer(v.oid)):t.oidToDer(l));_.value.push(t.create(t.Class.CONTEXT_SPECIFIC,v.type,!1,l))}y.value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[_])),u.push(y)}var b;if(void 0===e.value)throw(b=new Error("Extension value not specified.")).extension=e,b;return e}function g(e,n){switch(e){case i["RSASSA-PSS"]:var r=[];return void 0!==n.hash.algorithmOid&&r.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])),void 0!==n.mgf.algorithmOid&&r.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.mgf.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.mgf.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])])),void 0!==n.saltLength&&r.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(n.saltLength).getBytes())])),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,r);default:return t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")}}function m(e){var n=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===e.attributes.length)return n;for(var i=e.attributes,r=0;r<i.length;++r){var o=i[r],a=o.value,s=t.Type.UTF8;"valueTagClass"in o&&(s=o.valueTagClass),s===t.Type.UTF8&&(a=qh.util.encodeUtf8(a));var l=!1;"valueConstructed"in o&&(l=o.valueConstructed);var u=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(o.type).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,s,l,a)])]);n.value.push(u)}return n}n.certificateFromPem=function(e,i,r){var o=qh.pem.decode(e)[0];if("CERTIFICATE"!==o.type&&"X509 CERTIFICATE"!==o.type&&"TRUSTED CERTIFICATE"!==o.type){var a=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw a.headerType=o.type,a}if(o.procType&&"ENCRYPTED"===o.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var s=t.fromDer(o.body,r);return n.certificateFromAsn1(s,i)},n.certificateToPem=function(e,i){var r={type:"CERTIFICATE",body:t.toDer(n.certificateToAsn1(e)).getBytes()};return qh.pem.encode(r,{maxline:i})},n.publicKeyFromPem=function(e){var i=qh.pem.decode(e)[0];if("PUBLIC KEY"!==i.type&&"RSA PUBLIC KEY"!==i.type){var r=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw r.headerType=i.type,r}if(i.procType&&"ENCRYPTED"===i.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");var o=t.fromDer(i.body);return n.publicKeyFromAsn1(o)},n.publicKeyToPem=function(e,i){var r={type:"PUBLIC KEY",body:t.toDer(n.publicKeyToAsn1(e)).getBytes()};return qh.pem.encode(r,{maxline:i})},n.publicKeyToRSAPublicKeyPem=function(e,i){var r={type:"RSA PUBLIC KEY",body:t.toDer(n.publicKeyToRSAPublicKey(e)).getBytes()};return qh.pem.encode(r,{maxline:i})},n.getPublicKeyFingerprint=function(e,i){var r,o=(i=i||{}).md||qh.md.sha1.create();switch(i.type||"RSAPublicKey"){case"RSAPublicKey":r=t.toDer(n.publicKeyToRSAPublicKey(e)).getBytes();break;case"SubjectPublicKeyInfo":r=t.toDer(n.publicKeyToAsn1(e)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+i.type+'".')}o.start(),o.update(r);var a=o.digest();if("hex"===i.encoding){var s=a.toHex();return i.delimiter?s.match(/.{2}/g).join(i.delimiter):s}if("binary"===i.encoding)return a.getBytes();if(i.encoding)throw new Error('Unknown encoding "'+i.encoding+'".');return a},n.certificationRequestFromPem=function(e,i,r){var o=qh.pem.decode(e)[0];if("CERTIFICATE REQUEST"!==o.type){var a=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw a.headerType=o.type,a}if(o.procType&&"ENCRYPTED"===o.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var s=t.fromDer(o.body,r);return n.certificationRequestFromAsn1(s,i)},n.certificationRequestToPem=function(e,i){var r={type:"CERTIFICATE REQUEST",body:t.toDer(n.certificationRequestToAsn1(e)).getBytes()};return qh.pem.encode(r,{maxline:i})},n.createCertificate=function(){var e={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.validity={},e.validity.notBefore=new Date,e.validity.notAfter=new Date,e.issuer={},e.issuer.getField=function(t){return c(e.issuer,t)},e.issuer.addField=function(t){p([t]),e.issuer.attributes.push(t)},e.issuer.attributes=[],e.issuer.hash=null,e.subject={},e.subject.getField=function(t){return c(e.subject,t)},e.subject.addField=function(t){p([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.extensions=[],e.publicKey=null,e.md=null,e.setSubject=function(t,n){p(t),e.subject.attributes=t,delete e.subject.uniqueId,n&&(e.subject.uniqueId=n),e.subject.hash=null},e.setIssuer=function(t,n){p(t),e.issuer.attributes=t,delete e.issuer.uniqueId,n&&(e.issuer.uniqueId=n),e.issuer.hash=null},e.setExtensions=function(t){for(var n=0;n<t.length;++n)f(t[n],{cert:e});e.extensions=t},e.getExtension=function(t){"string"==typeof t&&(t={name:t});for(var n,i=null,r=0;null===i&&r<e.extensions.length;++r)n=e.extensions[r],(t.id&&n.id===t.id||t.name&&n.name===t.name)&&(i=n);return i},e.sign=function(r,o){e.md=o||qh.md.sha1.create();var a=i[e.md.algorithm+"WithRSAEncryption"];if(!a){var s=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw s.algorithm=e.md.algorithm,s}e.signatureOid=e.siginfo.algorithmOid=a,e.tbsCertificate=n.getTBSCertificate(e);var l=t.toDer(e.tbsCertificate);e.md.update(l.getBytes()),e.signature=r.sign(e.md)},e.verify=function(r){var o=!1;if(!e.issued(r)){var a=r.issuer,s=e.subject;throw(f=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.")).expectedIssuer=a.attributes,f.actualIssuer=s.attributes,f}var l=r.md;if(null===l){if(r.signatureOid in i)switch(i[r.signatureOid]){case"sha1WithRSAEncryption":l=qh.md.sha1.create();break;case"md5WithRSAEncryption":l=qh.md.md5.create();break;case"sha256WithRSAEncryption":l=qh.md.sha256.create();break;case"sha384WithRSAEncryption":l=qh.md.sha384.create();break;case"sha512WithRSAEncryption":l=qh.md.sha512.create();break;case"RSASSA-PSS":l=qh.md.sha256.create()}if(null===l)throw(f=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=r.signatureOid,f;var u=r.tbsCertificate||n.getTBSCertificate(r),c=t.toDer(u);l.update(c.getBytes())}if(null!==l){var h;switch(r.signatureOid){case i.sha1WithRSAEncryption:h=void 0;break;case i["RSASSA-PSS"]:var d,p,f;if(void 0===(d=i[r.signatureParameters.mgf.hash.algorithmOid])||void 0===qh.md[d])throw(f=new Error("Unsupported MGF hash function.")).oid=r.signatureParameters.mgf.hash.algorithmOid,f.name=d,f;if(void 0===(p=i[r.signatureParameters.mgf.algorithmOid])||void 0===qh.mgf[p])throw(f=new Error("Unsupported MGF function.")).oid=r.signatureParameters.mgf.algorithmOid,f.name=p,f;if(p=qh.mgf[p].create(qh.md[d].create()),void 0===(d=i[r.signatureParameters.hash.algorithmOid])||void 0===qh.md[d])throw{message:"Unsupported RSASSA-PSS hash function.",oid:r.signatureParameters.hash.algorithmOid,name:d};h=qh.pss.create(qh.md[d].create(),p,r.signatureParameters.saltLength)}o=e.publicKey.verify(l.digest().getBytes(),r.signature,h)}return o},e.isIssuer=function(t){var n=!1,i=e.issuer,r=t.subject;if(i.hash&&r.hash)n=i.hash===r.hash;else if(i.attributes.length===r.attributes.length){var o,a;n=!0;for(var s=0;n&&s<i.attributes.length;++s)o=i.attributes[s],a=r.attributes[s],o.type===a.type&&o.value===a.value||(n=!1)}return n},e.issued=function(t){return t.isIssuer(e)},e.generateSubjectKeyIdentifier=function(){return n.getPublicKeyFingerprint(e.publicKey,{type:"RSAPublicKey"})},e.verifySubjectKeyIdentifier=function(){for(var t=i.subjectKeyIdentifier,n=0;n<e.extensions.length;++n){var r=e.extensions[n];if(r.id===t){var o=e.generateSubjectKeyIdentifier().getBytes();return qh.util.hexToBytes(r.subjectKeyIdentifier)===o}}return!1},e},n.certificateFromAsn1=function(e,r){var o={},s=[];if(!t.validate(e,a,o,s))throw(f=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.")).errors=s,f;if(t.derToOid(o.publicKeyOid)!==n.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var l=n.createCertificate();l.version=o.certVersion?o.certVersion.charCodeAt(0):0;var u=qh.util.createBuffer(o.certSerialNumber);l.serialNumber=u.toHex(),l.signatureOid=qh.asn1.derToOid(o.certSignatureOid),l.signatureParameters=h(l.signatureOid,o.certSignatureParams,!0),l.siginfo.algorithmOid=qh.asn1.derToOid(o.certinfoSignatureOid),l.siginfo.parameters=h(l.siginfo.algorithmOid,o.certinfoSignatureParams,!1),l.signature=o.certSignature;var d=[];if(void 0!==o.certValidity1UTCTime&&d.push(t.utcTimeToDate(o.certValidity1UTCTime)),void 0!==o.certValidity2GeneralizedTime&&d.push(t.generalizedTimeToDate(o.certValidity2GeneralizedTime)),void 0!==o.certValidity3UTCTime&&d.push(t.utcTimeToDate(o.certValidity3UTCTime)),void 0!==o.certValidity4GeneralizedTime&&d.push(t.generalizedTimeToDate(o.certValidity4GeneralizedTime)),d.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(d.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(l.validity.notBefore=d[0],l.validity.notAfter=d[1],l.tbsCertificate=o.tbsCertificate,r){var f;if(l.md=null,l.signatureOid in i)switch(i[l.signatureOid]){case"sha1WithRSAEncryption":l.md=qh.md.sha1.create();break;case"md5WithRSAEncryption":l.md=qh.md.md5.create();break;case"sha256WithRSAEncryption":l.md=qh.md.sha256.create();break;case"sha384WithRSAEncryption":l.md=qh.md.sha384.create();break;case"sha512WithRSAEncryption":l.md=qh.md.sha512.create();break;case"RSASSA-PSS":l.md=qh.md.sha256.create()}if(null===l.md)throw(f=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=l.signatureOid,f;var g=t.toDer(l.tbsCertificate);l.md.update(g.getBytes())}var m=qh.md.sha1.create();l.issuer.getField=function(e){return c(l.issuer,e)},l.issuer.addField=function(e){p([e]),l.issuer.attributes.push(e)},l.issuer.attributes=n.RDNAttributesAsArray(o.certIssuer,m),o.certIssuerUniqueId&&(l.issuer.uniqueId=o.certIssuerUniqueId),l.issuer.hash=m.digest().toHex();var v=qh.md.sha1.create();return l.subject.getField=function(e){return c(l.subject,e)},l.subject.addField=function(e){p([e]),l.subject.attributes.push(e)},l.subject.attributes=n.RDNAttributesAsArray(o.certSubject,v),o.certSubjectUniqueId&&(l.subject.uniqueId=o.certSubjectUniqueId),l.subject.hash=v.digest().toHex(),o.certExtensions?l.extensions=n.certificateExtensionsFromAsn1(o.certExtensions):l.extensions=[],l.publicKey=n.publicKeyFromAsn1(o.subjectPublicKeyInfo),l},n.certificateExtensionsFromAsn1=function(e){for(var t=[],i=0;i<e.value.length;++i)for(var r=e.value[i],o=0;o<r.value.length;++o)t.push(n.certificateExtensionFromAsn1(r.value[o]));return t},n.certificateExtensionFromAsn1=function(e){var n={};if(n.id=t.derToOid(e.value[0].value),n.critical=!1,e.value[1].type===t.Type.BOOLEAN?(n.critical=0!==e.value[1].value.charCodeAt(0),n.value=e.value[2].value):n.value=e.value[1].value,n.id in i)if(n.name=i[n.id],"keyUsage"===n.name){var r=0,o=0;(s=t.fromDer(n.value)).value.length>1&&(r=s.value.charCodeAt(1),o=s.value.length>2?s.value.charCodeAt(2):0),n.digitalSignature=128==(128&r),n.nonRepudiation=64==(64&r),n.keyEncipherment=32==(32&r),n.dataEncipherment=16==(16&r),n.keyAgreement=8==(8&r),n.keyCertSign=4==(4&r),n.cRLSign=2==(2&r),n.encipherOnly=1==(1&r),n.decipherOnly=128==(128&o)}else if("basicConstraints"===n.name){(s=t.fromDer(n.value)).value.length>0&&s.value[0].type===t.Type.BOOLEAN?n.cA=0!==s.value[0].value.charCodeAt(0):n.cA=!1;var a=null;s.value.length>0&&s.value[0].type===t.Type.INTEGER?a=s.value[0].value:s.value.length>1&&(a=s.value[1].value),null!==a&&(n.pathLenConstraint=t.derToInteger(a))}else if("extKeyUsage"===n.name)for(var s=t.fromDer(n.value),l=0;l<s.value.length;++l){var u=t.derToOid(s.value[l].value);u in i?n[i[u]]=!0:n[u]=!0}else if("nsCertType"===n.name){r=0;(s=t.fromDer(n.value)).value.length>1&&(r=s.value.charCodeAt(1)),n.client=128==(128&r),n.server=64==(64&r),n.email=32==(32&r),n.objsign=16==(16&r),n.reserved=8==(8&r),n.sslCA=4==(4&r),n.emailCA=2==(2&r),n.objCA=1==(1&r)}else if("subjectAltName"===n.name||"issuerAltName"===n.name){var c;n.altNames=[];s=t.fromDer(n.value);for(var h=0;h<s.value.length;++h){var d={type:(c=s.value[h]).type,value:c.value};switch(n.altNames.push(d),c.type){case 1:case 2:case 6:break;case 7:d.ip=qh.util.bytesToIP(c.value);break;case 8:d.oid=t.derToOid(c.value)}}}else if("subjectKeyIdentifier"===n.name){s=t.fromDer(n.value);n.subjectKeyIdentifier=qh.util.bytesToHex(s.value)}return n},n.certificationRequestFromAsn1=function(e,r){var o={},a=[];if(!t.validate(e,u,o,a))throw(l=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.")).errors=a,l;if(t.derToOid(o.publicKeyOid)!==n.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var s=n.createCertificationRequest();if(s.version=o.csrVersion?o.csrVersion.charCodeAt(0):0,s.signatureOid=qh.asn1.derToOid(o.csrSignatureOid),s.signatureParameters=h(s.signatureOid,o.csrSignatureParams,!0),s.siginfo.algorithmOid=qh.asn1.derToOid(o.csrSignatureOid),s.siginfo.parameters=h(s.siginfo.algorithmOid,o.csrSignatureParams,!1),s.signature=o.csrSignature,s.certificationRequestInfo=o.certificationRequestInfo,r){var l;if(s.md=null,s.signatureOid in i)switch(i[s.signatureOid]){case"sha1WithRSAEncryption":s.md=qh.md.sha1.create();break;case"md5WithRSAEncryption":s.md=qh.md.md5.create();break;case"sha256WithRSAEncryption":s.md=qh.md.sha256.create();break;case"sha384WithRSAEncryption":s.md=qh.md.sha384.create();break;case"sha512WithRSAEncryption":s.md=qh.md.sha512.create();break;case"RSASSA-PSS":s.md=qh.md.sha256.create()}if(null===s.md)throw(l=new Error("Could not compute certification request digest. Unknown signature OID.")).signatureOid=s.signatureOid,l;var d=t.toDer(s.certificationRequestInfo);s.md.update(d.getBytes())}var f=qh.md.sha1.create();return s.subject.getField=function(e){return c(s.subject,e)},s.subject.addField=function(e){p([e]),s.subject.attributes.push(e)},s.subject.attributes=n.RDNAttributesAsArray(o.certificationRequestInfoSubject,f),s.subject.hash=f.digest().toHex(),s.publicKey=n.publicKeyFromAsn1(o.subjectPublicKeyInfo),s.getAttribute=function(e){return c(s,e)},s.addAttribute=function(e){p([e]),s.attributes.push(e)},s.attributes=n.CRIAttributesAsArray(o.certificationRequestInfoAttributes||[]),s},n.createCertificationRequest=function(){var e={version:0,signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.subject={},e.subject.getField=function(t){return c(e.subject,t)},e.subject.addField=function(t){p([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.publicKey=null,e.attributes=[],e.getAttribute=function(t){return c(e,t)},e.addAttribute=function(t){p([t]),e.attributes.push(t)},e.md=null,e.setSubject=function(t){p(t),e.subject.attributes=t,e.subject.hash=null},e.setAttributes=function(t){p(t),e.attributes=t},e.sign=function(r,o){e.md=o||qh.md.sha1.create();var a=i[e.md.algorithm+"WithRSAEncryption"];if(!a){var s=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw s.algorithm=e.md.algorithm,s}e.signatureOid=e.siginfo.algorithmOid=a,e.certificationRequestInfo=n.getCertificationRequestInfo(e);var l=t.toDer(e.certificationRequestInfo);e.md.update(l.getBytes()),e.signature=r.sign(e.md)},e.verify=function(){var r=!1,o=e.md;if(null===o){if(e.signatureOid in i)switch(i[e.signatureOid]){case"sha1WithRSAEncryption":o=qh.md.sha1.create();break;case"md5WithRSAEncryption":o=qh.md.md5.create();break;case"sha256WithRSAEncryption":o=qh.md.sha256.create();break;case"sha384WithRSAEncryption":o=qh.md.sha384.create();break;case"sha512WithRSAEncryption":o=qh.md.sha512.create();break;case"RSASSA-PSS":o=qh.md.sha256.create()}if(null===o)throw(h=new Error("Could not compute certification request digest. Unknown signature OID.")).signatureOid=e.signatureOid,h;var a=e.certificationRequestInfo||n.getCertificationRequestInfo(e),s=t.toDer(a);o.update(s.getBytes())}if(null!==o){var l;switch(e.signatureOid){case i.sha1WithRSAEncryption:break;case i["RSASSA-PSS"]:var u,c,h;if(void 0===(u=i[e.signatureParameters.mgf.hash.algorithmOid])||void 0===qh.md[u])throw(h=new Error("Unsupported MGF hash function.")).oid=e.signatureParameters.mgf.hash.algorithmOid,h.name=u,h;if(void 0===(c=i[e.signatureParameters.mgf.algorithmOid])||void 0===qh.mgf[c])throw(h=new Error("Unsupported MGF function.")).oid=e.signatureParameters.mgf.algorithmOid,h.name=c,h;if(c=qh.mgf[c].create(qh.md[u].create()),void 0===(u=i[e.signatureParameters.hash.algorithmOid])||void 0===qh.md[u])throw(h=new Error("Unsupported RSASSA-PSS hash function.")).oid=e.signatureParameters.hash.algorithmOid,h.name=u,h;l=qh.pss.create(qh.md[u].create(),c,e.signatureParameters.saltLength)}r=e.publicKey.verify(o.digest().getBytes(),e.signature,l)}return r},e},n.getTBSCertificate=function(e){var i=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(e.version).getBytes())]),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,qh.util.hexToBytes(e.serialNumber)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.siginfo.algorithmOid).getBytes()),g(e.siginfo.algorithmOid,e.siginfo.parameters)]),d(e.issuer),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(e.validity.notBefore)),t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(e.validity.notAfter))]),d(e.subject),n.publicKeyToAsn1(e.publicKey)]);return e.issuer.uniqueId&&i.value.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+e.issuer.uniqueId)])),e.subject.uniqueId&&i.value.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+e.subject.uniqueId)])),e.extensions.length>0&&i.value.push(n.certificateExtensionsToAsn1(e.extensions)),i},n.getCertificationRequestInfo=function(e){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(e.version).getBytes()),d(e.subject),n.publicKeyToAsn1(e.publicKey),m(e)])},n.distinguishedNameToAsn1=function(e){return d(e)},n.certificateToAsn1=function(e){var i=e.tbsCertificate||n.getTBSCertificate(e);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[i,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.signatureOid).getBytes()),g(e.signatureOid,e.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},n.certificateExtensionsToAsn1=function(e){var i=t.create(t.Class.CONTEXT_SPECIFIC,3,!0,[]),r=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);i.value.push(r);for(var o=0;o<e.length;++o)r.value.push(n.certificateExtensionToAsn1(e[o]));return i},n.certificateExtensionToAsn1=function(e){var n=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);n.value.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.id).getBytes())),e.critical&&n.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255)));var i=e.value;return"string"!=typeof e.value&&(i=t.toDer(i).getBytes()),n.value.push(t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,i)),n},n.certificationRequestToAsn1=function(e){var i=e.certificationRequestInfo||n.getCertificationRequestInfo(e);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[i,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.signatureOid).getBytes()),g(e.signatureOid,e.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},n.createCaStore=function(e){var i={certs:{}};function r(e){return o(e),i.certs[e.hash]||null}function o(e){if(!e.hash){var t=qh.md.sha1.create();e.attributes=n.RDNAttributesAsArray(d(e),t),e.hash=t.digest().toHex()}}if(i.getIssuer=function(e){return r(e.issuer)},i.addCertificate=function(e){if("string"==typeof e&&(e=qh.pki.certificateFromPem(e)),o(e.subject),!i.hasCertificate(e))if(e.subject.hash in i.certs){var t=i.certs[e.subject.hash];qh.util.isArray(t)||(t=[t]),t.push(e),i.certs[e.subject.hash]=t}else i.certs[e.subject.hash]=e},i.hasCertificate=function(e){"string"==typeof e&&(e=qh.pki.certificateFromPem(e));var i=r(e.subject);if(!i)return!1;qh.util.isArray(i)||(i=[i]);for(var o=t.toDer(n.certificateToAsn1(e)).getBytes(),a=0;a<i.length;++a){if(o===t.toDer(n.certificateToAsn1(i[a])).getBytes())return!0}return!1},i.listAllCertificates=function(){var e=[];for(var t in i.certs)if(i.certs.hasOwnProperty(t)){var n=i.certs[t];if(qh.util.isArray(n))for(var r=0;r<n.length;++r)e.push(n[r]);else e.push(n)}return e},i.removeCertificate=function(e){var a;if("string"==typeof e&&(e=qh.pki.certificateFromPem(e)),o(e.subject),!i.hasCertificate(e))return null;var s=r(e.subject);if(!qh.util.isArray(s))return a=i.certs[e.subject.hash],delete i.certs[e.subject.hash],a;for(var l=t.toDer(n.certificateToAsn1(e)).getBytes(),u=0;u<s.length;++u){l===t.toDer(n.certificateToAsn1(s[u])).getBytes()&&(a=s[u],s.splice(u,1))}return 0===s.length&&delete i.certs[e.subject.hash],a},e)for(var a=0;a<e.length;++a){var s=e[a];i.addCertificate(s)}return i},n.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},n.verifyCertificateChain=function(e,t,i){var r=(t=t.slice(0)).slice(0),o=new Date,a=!0,s=null,l=0;do{var u=t.shift(),c=null,h=!1;if((o<u.validity.notBefore||o>u.validity.notAfter)&&(s={message:"Certificate is not valid yet or has expired.",error:n.certificateError.certificate_expired,notBefore:u.validity.notBefore,notAfter:u.validity.notAfter,now:o}),null===s){if(null===(c=t[0]||e.getIssuer(u))&&u.isIssuer(u)&&(h=!0,c=u),c){var d=c;qh.util.isArray(d)||(d=[d]);for(var p=!1;!p&&d.length>0;){c=d.shift();try{p=c.verify(u)}catch(e){}}p||(s={message:"Certificate signature is invalid.",error:n.certificateError.bad_certificate})}null!==s||c&&!h||e.hasCertificate(u)||(s={message:"Certificate is not trusted.",error:n.certificateError.unknown_ca})}if(null===s&&c&&!u.isIssuer(c)&&(s={message:"Certificate issuer is invalid.",error:n.certificateError.bad_certificate}),null===s)for(var f={keyUsage:!0,basicConstraints:!0},g=0;null===s&&g<u.extensions.length;++g){var m=u.extensions[g];m.critical&&!(m.name in f)&&(s={message:"Certificate has an unsupported critical extension.",error:n.certificateError.unsupported_certificate})}if(null===s&&(!a||0===t.length&&(!c||h))){var v=u.getExtension("basicConstraints"),y=u.getExtension("keyUsage");if(null!==y&&(y.keyCertSign&&null!==v||(s={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:n.certificateError.bad_certificate})),null!==s||null===v||v.cA||(s={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:n.certificateError.bad_certificate}),null===s&&null!==y&&"pathLenConstraint"in v)l-1>v.pathLenConstraint&&(s={message:"Certificate basicConstraints pathLenConstraint violated.",error:n.certificateError.bad_certificate})}var _=null===s||s.error,b=i?i(_,l,r):_;if(!0!==b)throw!0===_&&(s={message:"The application rejected the certificate.",error:n.certificateError.bad_certificate}),(b||0===b)&&("object"!=typeof b||qh.util.isArray(b)?"string"==typeof b&&(s.error=b):(b.message&&(s.message=b.message),b.error&&(s.error=b.error))),s;s=null,a=!1,++l}while(t.length>0);return!0}})),u((function(e){var t=qh.asn1,n=qh.pki,i=e.exports=qh.pkcs12=qh.pkcs12||{},r={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},o={name:"PFX",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},r,{name:"PFX.macData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:t.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},a={name:"SafeBag",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:t.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},s={name:"Attribute",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,capture:"values"}]},l={name:"CertBag",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:t.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:t.Class.UNIVERSAL,type:t.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};function u(e,t,n,i){for(var r=[],o=0;o<e.length;o++)for(var a=0;a<e[o].safeBags.length;a++){var s=e[o].safeBags[a];void 0!==i&&s.type!==i||(null!==t?void 0!==s.attributes[t]&&s.attributes[t].indexOf(n)>=0&&r.push(s):r.push(s))}return r}function c(e){if(e.composed||e.constructed){for(var t=qh.util.createBuffer(),n=0;n<e.value.length;++n)t.putBytes(e.value[n].value);e.composed=e.constructed=!1,e.value=t.getBytes()}return e}function h(e,i){var r={},o=[];if(!t.validate(e,qh.pkcs7.asn1.encryptedDataValidator,r,o))throw(a=new Error("Cannot read EncryptedContentInfo.")).errors=o,a;var a,s=t.derToOid(r.contentType);if(s!==n.oids.data)throw(a=new Error("PKCS#12 EncryptedContentInfo ContentType is not Data.")).oid=s,a;s=t.derToOid(r.encAlgorithm);var l=n.pbe.getCipher(s,r.encParameter,i),u=c(r.encryptedContentAsn1),h=qh.util.createBuffer(u.value);if(l.update(h),!l.finish())throw new Error("Failed to decrypt PKCS#12 SafeContents.");return l.output.getBytes()}function d(e,i,r){if(!i&&0===e.length)return[];if((e=t.fromDer(e,i)).tagClass!==t.Class.UNIVERSAL||e.type!==t.Type.SEQUENCE||!0!==e.constructed)throw new Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(var o=[],s=0;s<e.value.length;s++){var u=e.value[s],c={},h=[];if(!t.validate(u,a,c,h))throw(v=new Error("Cannot read SafeBag.")).errors=h,v;var d,f,g={type:t.derToOid(c.bagId),attributes:p(c.bagAttributes)};o.push(g);var m=c.bagValue.value[0];switch(g.type){case n.oids.pkcs8ShroudedKeyBag:if(null===(m=n.decryptPrivateKeyInfo(m,r)))throw new Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case n.oids.keyBag:try{g.key=n.privateKeyFromAsn1(m)}catch(e){g.key=null,g.asn1=m}continue;case n.oids.certBag:d=l,f=function(){if(t.derToOid(c.certId)!==n.oids.x509Certificate){var e=new Error("Unsupported certificate type, only X.509 supported.");throw e.oid=t.derToOid(c.certId),e}var r=t.fromDer(c.cert,i);try{g.cert=n.certificateFromAsn1(r,!0)}catch(e){g.cert=null,g.asn1=r}};break;default:var v;throw(v=new Error("Unsupported PKCS#12 SafeBag type.")).oid=g.type,v}if(void 0!==d&&!t.validate(m,d,c,h))throw(v=new Error("Cannot read PKCS#12 "+d.name)).errors=h,v;f()}return o}function p(e){var i={};if(void 0!==e)for(var r=0;r<e.length;++r){var o={},a=[];if(!t.validate(e[r],s,o,a)){var l=new Error("Cannot read PKCS#12 BagAttribute.");throw l.errors=a,l}var u=t.derToOid(o.oid);if(void 0!==n.oids[u]){i[n.oids[u]]=[];for(var c=0;c<o.values.length;++c)i[n.oids[u]].push(o.values[c].value)}}return i}i.pkcs12FromAsn1=function(e,a,s){"string"==typeof a?(s=a,a=!0):void 0===a&&(a=!0);var l={};if(!t.validate(e,o,l,[]))throw(p=new Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.")).errors=p,p;var p,f={version:l.version.charCodeAt(0),safeContents:[],getBags:function(e){var t,n={};return"localKeyId"in e?t=e.localKeyId:"localKeyIdHex"in e&&(t=qh.util.hexToBytes(e.localKeyIdHex)),void 0===t&&!("friendlyName"in e)&&"bagType"in e&&(n[e.bagType]=u(f.safeContents,null,null,e.bagType)),void 0!==t&&(n.localKeyId=u(f.safeContents,"localKeyId",t,e.bagType)),"friendlyName"in e&&(n.friendlyName=u(f.safeContents,"friendlyName",e.friendlyName,e.bagType)),n},getBagsByFriendlyName:function(e,t){return u(f.safeContents,"friendlyName",e,t)},getBagsByLocalKeyId:function(e,t){return u(f.safeContents,"localKeyId",e,t)}};if(3!==l.version.charCodeAt(0))throw(p=new Error("PKCS#12 PFX of version other than 3 not supported.")).version=l.version.charCodeAt(0),p;if(t.derToOid(l.contentType)!==n.oids.data)throw(p=new Error("Only PKCS#12 PFX in password integrity mode supported.")).oid=t.derToOid(l.contentType),p;var g=l.content.value[0];if(g.tagClass!==t.Class.UNIVERSAL||g.type!==t.Type.OCTETSTRING)throw new Error("PKCS#12 authSafe content data is not an OCTET STRING.");if(g=c(g),l.mac){var m=null,v=0,y=t.derToOid(l.macAlgorithm);switch(y){case n.oids.sha1:m=qh.md.sha1.create(),v=20;break;case n.oids.sha256:m=qh.md.sha256.create(),v=32;break;case n.oids.sha384:m=qh.md.sha384.create(),v=48;break;case n.oids.sha512:m=qh.md.sha512.create(),v=64;break;case n.oids.md5:m=qh.md.md5.create(),v=16}if(null===m)throw new Error("PKCS#12 uses unsupported MAC algorithm: "+y);var _=new qh.util.ByteBuffer(l.macSalt),b="macIterations"in l?parseInt(qh.util.bytesToHex(l.macIterations),16):1,w=i.generateKey(s,_,3,b,v,m),E=qh.hmac.create();if(E.start(m,w),E.update(g.value),E.getMac().getBytes()!==l.macDigest)throw new Error("PKCS#12 MAC could not be verified. Invalid password?")}return function(e,i,o,a){if((i=t.fromDer(i,o)).tagClass!==t.Class.UNIVERSAL||i.type!==t.Type.SEQUENCE||!0!==i.constructed)throw new Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var s=0;s<i.value.length;s++){var l=i.value[s],u={},p=[];if(!t.validate(l,r,u,p))throw(v=new Error("Cannot read ContentInfo.")).errors=p,v;var f={encrypted:!1},g=null,m=u.content.value[0];switch(t.derToOid(u.contentType)){case n.oids.data:if(m.tagClass!==t.Class.UNIVERSAL||m.type!==t.Type.OCTETSTRING)throw new Error("PKCS#12 SafeContents Data is not an OCTET STRING.");g=c(m).value;break;case n.oids.encryptedData:g=h(m,a),f.encrypted=!0;break;default:var v;throw(v=new Error("Unsupported PKCS#12 contentType.")).contentType=t.derToOid(u.contentType),v}f.safeBags=d(g,o,a),e.safeContents.push(f)}}(f,g.value,a,s),f},i.toPkcs12Asn1=function(e,r,o,a){(a=a||{}).saltSize=a.saltSize||8,a.count=a.count||2048,a.algorithm=a.algorithm||a.encAlgorithm||"aes128","useMac"in a||(a.useMac=!0),"localKeyId"in a||(a.localKeyId=null),"generateLocalKeyId"in a||(a.generateLocalKeyId=!0);var s,l=a.localKeyId;if(null!==l)l=qh.util.hexToBytes(l);else if(a.generateLocalKeyId)if(r){var u=qh.util.isArray(r)?r[0]:r;"string"==typeof u&&(u=n.certificateFromPem(u)),(T=qh.md.sha1.create()).update(t.toDer(n.certificateToAsn1(u)).getBytes()),l=T.digest().getBytes()}else l=qh.random.getBytes(20);var c=[];null!==l&&c.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.localKeyId).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,l)])])),"friendlyName"in a&&c.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.friendlyName).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.BMPSTRING,!1,a.friendlyName)])])),c.length>0&&(s=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,c));var h=[],d=[];null!==r&&(d=qh.util.isArray(r)?r:[r]);for(var p=[],f=0;f<d.length;++f){"string"==typeof(r=d[f])&&(r=n.certificateFromPem(r));var g=0===f?s:void 0,m=n.certificateToAsn1(r),v=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.certBag).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.x509Certificate).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(m).getBytes())])])]),g]);p.push(v)}if(p.length>0){var y=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,p),_=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.data).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(y).getBytes())])]);h.push(_)}var b=null;if(null!==e){var w=n.wrapRsaPrivateKey(n.privateKeyToAsn1(e));b=null===o?t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.keyBag).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[w]),s]):t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.pkcs8ShroudedKeyBag).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[n.encryptPrivateKeyInfo(w,o,a)]),s]);var E=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[b]),C=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.data).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(E).getBytes())])]);h.push(C)}var S,k=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,h);if(a.useMac){var T=qh.md.sha1.create(),x=new qh.util.ByteBuffer(qh.random.getBytes(a.saltSize)),L=a.count,I=(e=i.generateKey(o,x,3,L,20),qh.hmac.create());I.start(T,e),I.update(t.toDer(k).getBytes());var A=I.getMac();S=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.sha1).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,A.getBytes())]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,x.getBytes()),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(L).getBytes())])}return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(3).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.data).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(k).getBytes())])]),S])},i.generateKey=qh.pbe.generatePkcs12Key})),u((function(e){var t=qh.asn1,n=e.exports=qh.pki=qh.pki||{};n.pemToDer=function(e){var t=qh.pem.decode(e)[0];if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PEM to DER; PEM is encrypted.");return qh.util.createBuffer(t.body)},n.privateKeyFromPem=function(e){var i=qh.pem.decode(e)[0];if("PRIVATE KEY"!==i.type&&"RSA PRIVATE KEY"!==i.type){var r=new Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY".');throw r.headerType=i.type,r}if(i.procType&&"ENCRYPTED"===i.procType.type)throw new Error("Could not convert private key from PEM; PEM is encrypted.");var o=t.fromDer(i.body);return n.privateKeyFromAsn1(o)},n.privateKeyToPem=function(e,i){var r={type:"RSA PRIVATE KEY",body:t.toDer(n.privateKeyToAsn1(e)).getBytes()};return qh.pem.encode(r,{maxline:i})},n.privateKeyInfoToPem=function(e,n){var i={type:"PRIVATE KEY",body:t.toDer(e).getBytes()};return qh.pem.encode(i,{maxline:n})}}));var Ep=function(e,t,n,i){var r=qh.util.createBuffer(),o=e.length>>1,a=o+(1&e.length),s=e.substr(0,a),l=e.substr(o,a),u=qh.util.createBuffer(),c=qh.hmac.create();n=t+n;var h=Math.ceil(i/16),d=Math.ceil(i/20);c.start("MD5",s);var p=qh.util.createBuffer();u.putBytes(n);for(var f=0;f<h;++f)c.start(null,null),c.update(u.getBytes()),u.putBuffer(c.digest()),c.start(null,null),c.update(u.bytes()+n),p.putBuffer(c.digest());c.start("SHA1",l);var g=qh.util.createBuffer();u.clear(),u.putBytes(n);for(f=0;f<d;++f)c.start(null,null),c.update(u.getBytes()),u.putBuffer(c.digest()),c.start(null,null),c.update(u.bytes()+n),g.putBuffer(c.digest());return r.putBytes(qh.util.xorBytes(p.getBytes(),g.getBytes(),i)),r},Cp=function(e,t,n){var i=!1;try{var r=e.deflate(t.fragment.getBytes());t.fragment=qh.util.createBuffer(r),t.length=r.length,i=!0}catch(e){}return i},Sp=function(e,t,n){var i=!1;try{var r=e.inflate(t.fragment.getBytes());t.fragment=qh.util.createBuffer(r),t.length=r.length,i=!0}catch(e){}return i},kp=function(e,t){var n=0;switch(t){case 1:n=e.getByte();break;case 2:n=e.getInt16();break;case 3:n=e.getInt24();break;case 4:n=e.getInt32()}return qh.util.createBuffer(e.getBytes(n))},Tp=function(e,t,n){e.putInt(n.length(),t<<3),e.putBuffer(n)},xp={Versions:{TLS_1_0:{major:3,minor:1},TLS_1_1:{major:3,minor:2},TLS_1_2:{major:3,minor:3}}};xp.SupportedVersions=[xp.Versions.TLS_1_1,xp.Versions.TLS_1_0],xp.Version=xp.SupportedVersions[0],xp.MaxFragment=15360,xp.ConnectionEnd={server:0,client:1},xp.PRFAlgorithm={tls_prf_sha256:0},xp.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2},xp.CipherType={stream:0,block:1,aead:2},xp.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4},xp.CompressionMethod={none:0,deflate:1},xp.ContentType={change_cipher_spec:20,alert:21,handshake:22,application_data:23,heartbeat:24},xp.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,finished:20},xp.Alert={},xp.Alert.Level={warning:1,fatal:2},xp.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,user_canceled:90,no_renegotiation:100},xp.HeartbeatMessageType={heartbeat_request:1,heartbeat_response:2},xp.CipherSuites={},xp.getCipherSuite=function(e){var t=null;for(var n in xp.CipherSuites){var i=xp.CipherSuites[n];if(i.id[0]===e.charCodeAt(0)&&i.id[1]===e.charCodeAt(1)){t=i;break}}return t},xp.handleUnexpected=function(e,t){!e.open&&e.entity===xp.ConnectionEnd.client||e.error(e,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.unexpected_message}})},xp.handleHelloRequest=function(e,t,n){!e.handshaking&&e.handshakes>0&&(xp.queue(e,xp.createAlert(e,{level:xp.Alert.Level.warning,description:xp.Alert.Description.no_renegotiation})),xp.flush(e)),e.process()},xp.parseHelloMessage=function(e,t,n){var i=null,r=e.entity===xp.ConnectionEnd.client;if(n<38)e.error(e,{message:r?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.illegal_parameter}});else{var o=t.fragment,a=o.length();if(i={version:{major:o.getByte(),minor:o.getByte()},random:qh.util.createBuffer(o.getBytes(32)),session_id:kp(o,1),extensions:[]},r?(i.cipher_suite=o.getBytes(2),i.compression_method=o.getByte()):(i.cipher_suites=kp(o,2),i.compression_methods=kp(o,1)),(a=n-(a-o.length()))>0){for(var s=kp(o,2);s.length()>0;)i.extensions.push({type:[s.getByte(),s.getByte()],data:kp(s,2)});if(!r)for(var l=0;l<i.extensions.length;++l){var u=i.extensions[l];if(0===u.type[0]&&0===u.type[1])for(var c=kp(u.data,2);c.length()>0;){if(0!==c.getByte())break;e.session.extensions.server_name.serverNameList.push(kp(c,2).getBytes())}}}if(e.session.version&&(i.version.major!==e.session.version.major||i.version.minor!==e.session.version.minor))return e.error(e,{message:"TLS version change is disallowed during renegotiation.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.protocol_version}});if(r)e.session.cipherSuite=xp.getCipherSuite(i.cipher_suite);else for(var h=qh.util.createBuffer(i.cipher_suites.bytes());h.length()>0&&(e.session.cipherSuite=xp.getCipherSuite(h.getBytes(2)),null===e.session.cipherSuite););if(null===e.session.cipherSuite)return e.error(e,{message:"No cipher suites in common.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.handshake_failure},cipherSuite:qh.util.bytesToHex(i.cipher_suite)});e.session.compressionMethod=r?i.compression_method:xp.CompressionMethod.none}return i},xp.createSecurityParameters=function(e,t){var n=e.entity===xp.ConnectionEnd.client,i=t.random.bytes(),r=n?e.session.sp.client_random:i,o=n?i:xp.createRandom().getBytes();e.session.sp={entity:e.entity,prf_algorithm:xp.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,compression_algorithm:e.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:r,server_random:o}},xp.handleServerHello=function(e,t,n){var i=xp.parseHelloMessage(e,t,n);if(!e.fail){if(!(i.version.minor<=e.version.minor))return e.error(e,{message:"Incompatible TLS version.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.protocol_version}});e.version.minor=i.version.minor,e.session.version=e.version;var r=i.session_id.bytes();r.length>0&&r===e.session.id?(e.expect=Np,e.session.resuming=!0,e.session.sp.server_random=i.random.bytes()):(e.expect=Lp,e.session.resuming=!1,xp.createSecurityParameters(e,i)),e.session.id=r,e.process()}},xp.handleClientHello=function(e,t,n){var i=xp.parseHelloMessage(e,t,n);if(!e.fail){var r=i.session_id.bytes(),o=null;if(e.sessionCache&&(null===(o=e.sessionCache.getSession(r))?r="":(o.version.major!==i.version.major||o.version.minor>i.version.minor)&&(o=null,r="")),0===r.length&&(r=qh.random.getBytes(32)),e.session.id=r,e.session.clientHelloVersion=i.version,e.session.sp={},o)e.version=e.session.version=o.version,e.session.sp=o.sp;else{for(var a,s=1;s<xp.SupportedVersions.length&&!((a=xp.SupportedVersions[s]).minor<=i.version.minor);++s);e.version={major:a.major,minor:a.minor},e.session.version=e.version}null!==o?(e.expect=zp,e.session.resuming=!0,e.session.sp.client_random=i.random.bytes()):(e.expect=!1!==e.verifyClient?Mp:Op,e.session.resuming=!1,xp.createSecurityParameters(e,i)),e.open=!0,xp.queue(e,xp.createRecord(e,{type:xp.ContentType.handshake,data:xp.createServerHello(e)})),e.session.resuming?(xp.queue(e,xp.createRecord(e,{type:xp.ContentType.change_cipher_spec,data:xp.createChangeCipherSpec()})),e.state.pending=xp.createConnectionState(e),e.state.current.write=e.state.pending.write,xp.queue(e,xp.createRecord(e,{type:xp.ContentType.handshake,data:xp.createFinished(e)}))):(xp.queue(e,xp.createRecord(e,{type:xp.ContentType.handshake,data:xp.createCertificate(e)})),e.fail||(xp.queue(e,xp.createRecord(e,{type:xp.ContentType.handshake,data:xp.createServerKeyExchange(e)})),!1!==e.verifyClient&&xp.queue(e,xp.createRecord(e,{type:xp.ContentType.handshake,data:xp.createCertificateRequest(e)})),xp.queue(e,xp.createRecord(e,{type:xp.ContentType.handshake,data:xp.createServerHelloDone(e)})))),xp.flush(e),e.process()}},xp.handleCertificate=function(e,t,n){if(n<3)return e.error(e,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.illegal_parameter}});var i,r,o=t.fragment,a={certificate_list:kp(o,3)},s=[];try{for(;a.certificate_list.length()>0;)i=kp(a.certificate_list,3),r=qh.asn1.fromDer(i),i=qh.pki.certificateFromAsn1(r,!0),s.push(i)}catch(t){return e.error(e,{message:"Could not parse certificate list.",cause:t,send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.bad_certificate}})}var l=e.entity===xp.ConnectionEnd.client;!l&&!0!==e.verifyClient||0!==s.length?0===s.length?e.expect=l?Ip:Op:(l?e.session.serverCertificate=s[0]:e.session.clientCertificate=s[0],xp.verifyCertificateChain(e,s)&&(e.expect=l?Ip:Op)):e.error(e,{message:l?"No server certificate provided.":"No client certificate provided.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.illegal_parameter}}),e.process()},xp.handleServerKeyExchange=function(e,t,n){if(n>0)return e.error(e,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.unsupported_certificate}});e.expect=Ap,e.process()},xp.handleClientKeyExchange=function(e,t,n){if(n<48)return e.error(e,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.unsupported_certificate}});var i=t.fragment,r={enc_pre_master_secret:kp(i,2).getBytes()},o=null;if(e.getPrivateKey)try{o=e.getPrivateKey(e,e.session.serverCertificate),o=qh.pki.privateKeyFromPem(o)}catch(t){e.error(e,{message:"Could not get private key.",cause:t,send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.internal_error}})}if(null===o)return e.error(e,{message:"No private key set.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.internal_error}});try{var a=e.session.sp;a.pre_master_secret=o.decrypt(r.enc_pre_master_secret);var s=e.session.clientHelloVersion;if(s.major!==a.pre_master_secret.charCodeAt(0)||s.minor!==a.pre_master_secret.charCodeAt(1))throw new Error("TLS version rollback attack detected.")}catch(e){a.pre_master_secret=qh.random.getBytes(48)}e.expect=zp,null!==e.session.clientCertificate&&(e.expect=Up),e.process()},xp.handleCertificateRequest=function(e,t,n){if(n<3)return e.error(e,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.illegal_parameter}});var i=t.fragment,r={certificate_types:kp(i,1),certificate_authorities:kp(i,2)};e.session.certificateRequest=r,e.expect=Dp,e.process()},xp.handleCertificateVerify=function(e,t,n){if(n<2)return e.error(e,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.illegal_parameter}});var i=t.fragment;i.read-=4;var r=i.bytes();i.read+=4;var o={signature:kp(i,2).getBytes()},a=qh.util.createBuffer();a.putBuffer(e.session.md5.digest()),a.putBuffer(e.session.sha1.digest()),a=a.getBytes();try{if(!e.session.clientCertificate.publicKey.verify(a,o.signature,"NONE"))throw new Error("CertificateVerify signature does not match.");e.session.md5.update(r),e.session.sha1.update(r)}catch(t){return e.error(e,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.handshake_failure}})}e.expect=zp,e.process()},xp.handleServerHelloDone=function(e,t,n){if(n>0)return e.error(e,{message:"Invalid ServerHelloDone message. Invalid length.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.record_overflow}});if(null===e.serverCertificate){var i={message:"No server certificate provided. Not enough security.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.insufficient_security}},r=e.verify(e,i.alert.description,0,[]);if(!0!==r)return(r||0===r)&&("object"!=typeof r||qh.util.isArray(r)?"number"==typeof r&&(i.alert.description=r):(r.message&&(i.message=r.message),r.alert&&(i.alert.description=r.alert))),e.error(e,i)}null!==e.session.certificateRequest&&(t=xp.createRecord(e,{type:xp.ContentType.handshake,data:xp.createCertificate(e)}),xp.queue(e,t)),t=xp.createRecord(e,{type:xp.ContentType.handshake,data:xp.createClientKeyExchange(e)}),xp.queue(e,t),e.expect=Rp;var o=function(e,t){null!==e.session.certificateRequest&&null!==e.session.clientCertificate&&xp.queue(e,xp.createRecord(e,{type:xp.ContentType.handshake,data:xp.createCertificateVerify(e,t)})),xp.queue(e,xp.createRecord(e,{type:xp.ContentType.change_cipher_spec,data:xp.createChangeCipherSpec()})),e.state.pending=xp.createConnectionState(e),e.state.current.write=e.state.pending.write,xp.queue(e,xp.createRecord(e,{type:xp.ContentType.handshake,data:xp.createFinished(e)})),e.expect=Np,xp.flush(e),e.process()};if(null===e.session.certificateRequest||null===e.session.clientCertificate)return o(e,null);xp.getClientSignature(e,o)},xp.handleChangeCipherSpec=function(e,t){if(1!==t.fragment.getByte())return e.error(e,{message:"Invalid ChangeCipherSpec message received.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.illegal_parameter}});var n=e.entity===xp.ConnectionEnd.client;(e.session.resuming&&n||!e.session.resuming&&!n)&&(e.state.pending=xp.createConnectionState(e)),e.state.current.read=e.state.pending.read,(!e.session.resuming&&n||e.session.resuming&&!n)&&(e.state.pending=null),e.expect=n?Pp:Fp,e.process()},xp.handleFinished=function(e,t,n){var i=t.fragment;i.read-=4;var r=i.bytes();i.read+=4;var o=t.fragment.getBytes();(i=qh.util.createBuffer()).putBuffer(e.session.md5.digest()),i.putBuffer(e.session.sha1.digest());var a=e.entity===xp.ConnectionEnd.client,s=a?"server finished":"client finished",l=e.session.sp;if((i=Ep(l.master_secret,s,i.getBytes(),12)).getBytes()!==o)return e.error(e,{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.decrypt_error}});e.session.md5.update(r),e.session.sha1.update(r),(e.session.resuming&&a||!e.session.resuming&&!a)&&(xp.queue(e,xp.createRecord(e,{type:xp.ContentType.change_cipher_spec,data:xp.createChangeCipherSpec()})),e.state.current.write=e.state.pending.write,e.state.pending=null,xp.queue(e,xp.createRecord(e,{type:xp.ContentType.handshake,data:xp.createFinished(e)}))),e.expect=a?Bp:Vp,e.handshaking=!1,++e.handshakes,e.peerCertificate=a?e.session.serverCertificate:e.session.clientCertificate,xp.flush(e),e.isConnected=!0,e.connected(e),e.process()},xp.handleAlert=function(e,t){var n,i=t.fragment,r={level:i.getByte(),description:i.getByte()};switch(r.description){case xp.Alert.Description.close_notify:n="Connection closed.";break;case xp.Alert.Description.unexpected_message:n="Unexpected message.";break;case xp.Alert.Description.bad_record_mac:n="Bad record MAC.";break;case xp.Alert.Description.decryption_failed:n="Decryption failed.";break;case xp.Alert.Description.record_overflow:n="Record overflow.";break;case xp.Alert.Description.decompression_failure:n="Decompression failed.";break;case xp.Alert.Description.handshake_failure:n="Handshake failure.";break;case xp.Alert.Description.bad_certificate:n="Bad certificate.";break;case xp.Alert.Description.unsupported_certificate:n="Unsupported certificate.";break;case xp.Alert.Description.certificate_revoked:n="Certificate revoked.";break;case xp.Alert.Description.certificate_expired:n="Certificate expired.";break;case xp.Alert.Description.certificate_unknown:n="Certificate unknown.";break;case xp.Alert.Description.illegal_parameter:n="Illegal parameter.";break;case xp.Alert.Description.unknown_ca:n="Unknown certificate authority.";break;case xp.Alert.Description.access_denied:n="Access denied.";break;case xp.Alert.Description.decode_error:n="Decode error.";break;case xp.Alert.Description.decrypt_error:n="Decrypt error.";break;case xp.Alert.Description.export_restriction:n="Export restriction.";break;case xp.Alert.Description.protocol_version:n="Unsupported protocol version.";break;case xp.Alert.Description.insufficient_security:n="Insufficient security.";break;case xp.Alert.Description.internal_error:n="Internal error.";break;case xp.Alert.Description.user_canceled:n="User canceled.";break;case xp.Alert.Description.no_renegotiation:n="Renegotiation not supported.";break;default:n="Unknown error."}if(r.description===xp.Alert.Description.close_notify)return e.close();e.error(e,{message:n,send:!1,origin:e.entity===xp.ConnectionEnd.client?"server":"client",alert:r}),e.process()},xp.handleHandshake=function(e,t){var n=t.fragment,i=n.getByte(),r=n.getInt24();if(r>n.length())return e.fragmented=t,t.fragment=qh.util.createBuffer(),n.read-=4,e.process();e.fragmented=null,n.read-=4;var o=n.bytes(r+4);n.read+=4,i in nf[e.entity][e.expect]?(e.entity!==xp.ConnectionEnd.server||e.open||e.fail||(e.handshaking=!0,e.session={version:null,extensions:{server_name:{serverNameList:[]}},cipherSuite:null,compressionMethod:null,serverCertificate:null,clientCertificate:null,md5:qh.md.md5.create(),sha1:qh.md.sha1.create()}),i!==xp.HandshakeType.hello_request&&i!==xp.HandshakeType.certificate_verify&&i!==xp.HandshakeType.finished&&(e.session.md5.update(o),e.session.sha1.update(o)),nf[e.entity][e.expect][i](e,t,r)):xp.handleUnexpected(e,t)},xp.handleApplicationData=function(e,t){e.data.putBuffer(t.fragment),e.dataReady(e),e.process()},xp.handleHeartbeat=function(e,t){var n=t.fragment,i=n.getByte(),r=n.getInt16(),o=n.getBytes(r);if(i===xp.HeartbeatMessageType.heartbeat_request){if(e.handshaking||r>o.length)return e.process();xp.queue(e,xp.createRecord(e,{type:xp.ContentType.heartbeat,data:xp.createHeartbeat(xp.HeartbeatMessageType.heartbeat_response,o)})),xp.flush(e)}else if(i===xp.HeartbeatMessageType.heartbeat_response){if(o!==e.expectedHeartbeatPayload)return e.process();e.heartbeatReceived&&e.heartbeatReceived(e,qh.util.createBuffer(o))}e.process()};var Lp=1,Ip=2,Ap=3,Dp=4,Np=5,Pp=6,Bp=7,Rp=8,Mp=1,Op=2,Up=3,zp=4,Fp=5,Vp=6,qp=xp.handleUnexpected,jp=xp.handleChangeCipherSpec,$p=xp.handleAlert,Hp=xp.handleHandshake,Wp=xp.handleApplicationData,Kp=xp.handleHeartbeat,Gp=[];Gp[xp.ConnectionEnd.client]=[[qp,$p,Hp,qp,Kp],[qp,$p,Hp,qp,Kp],[qp,$p,Hp,qp,Kp],[qp,$p,Hp,qp,Kp],[qp,$p,Hp,qp,Kp],[jp,$p,qp,qp,Kp],[qp,$p,Hp,qp,Kp],[qp,$p,Hp,Wp,Kp],[qp,$p,Hp,qp,Kp]],Gp[xp.ConnectionEnd.server]=[[qp,$p,Hp,qp,Kp],[qp,$p,Hp,qp,Kp],[qp,$p,Hp,qp,Kp],[qp,$p,Hp,qp,Kp],[jp,$p,qp,qp,Kp],[qp,$p,Hp,qp,Kp],[qp,$p,Hp,Wp,Kp],[qp,$p,Hp,qp,Kp]];var Zp=xp.handleHelloRequest,Yp=xp.handleServerHello,Xp=xp.handleCertificate,Qp=xp.handleServerKeyExchange,Jp=xp.handleCertificateRequest,ef=xp.handleServerHelloDone,tf=xp.handleFinished,nf=[];nf[xp.ConnectionEnd.client]=[[qp,qp,Yp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp],[Zp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,Xp,Qp,Jp,ef,qp,qp,qp,qp,qp,qp],[Zp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,Qp,Jp,ef,qp,qp,qp,qp,qp,qp],[Zp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,Jp,ef,qp,qp,qp,qp,qp,qp],[Zp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,ef,qp,qp,qp,qp,qp,qp],[Zp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp],[Zp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,tf],[Zp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp],[Zp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp]];var rf=xp.handleClientHello,of=xp.handleClientKeyExchange,af=xp.handleCertificateVerify;nf[xp.ConnectionEnd.server]=[[qp,rf,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp],[qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,Xp,qp,qp,qp,qp,qp,qp,qp,qp,qp],[qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,of,qp,qp,qp,qp],[qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,af,qp,qp,qp,qp,qp],[qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp],[qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,tf],[qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp],[qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp,qp]],xp.generateKeys=function(e,t){var n=Ep,i=t.client_random+t.server_random;e.session.resuming||(t.master_secret=n(t.pre_master_secret,"master secret",i,48).bytes(),t.pre_master_secret=null),i=t.server_random+t.client_random;var r=2*t.mac_key_length+2*t.enc_key_length,o=e.version.major===xp.Versions.TLS_1_0.major&&e.version.minor===xp.Versions.TLS_1_0.minor;o&&(r+=2*t.fixed_iv_length);var a=n(t.master_secret,"key expansion",i,r),s={client_write_MAC_key:a.getBytes(t.mac_key_length),server_write_MAC_key:a.getBytes(t.mac_key_length),client_write_key:a.getBytes(t.enc_key_length),server_write_key:a.getBytes(t.enc_key_length)};return o&&(s.client_write_IV=a.getBytes(t.fixed_iv_length),s.server_write_IV=a.getBytes(t.fixed_iv_length)),s},xp.createConnectionState=function(e){var t=e.entity===xp.ConnectionEnd.client,n=function(){var e={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,cipherState:null,cipherFunction:function(e){return!0},compressionState:null,compressFunction:function(e){return!0},updateSequenceNumber:function(){4294967295===e.sequenceNumber[1]?(e.sequenceNumber[1]=0,++e.sequenceNumber[0]):++e.sequenceNumber[1]}};return e},i={read:n(),write:n()};if(i.read.update=function(e,t){return i.read.cipherFunction(t,i.read)?i.read.compressFunction(e,t,i.read)||e.error(e,{message:"Could not decompress record.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.decompression_failure}}):e.error(e,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.bad_record_mac}}),!e.fail},i.write.update=function(e,t){return i.write.compressFunction(e,t,i.write)?i.write.cipherFunction(t,i.write)||e.error(e,{message:"Could not encrypt record.",send:!1,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.internal_error}}):e.error(e,{message:"Could not compress record.",send:!1,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.internal_error}}),!e.fail},e.session){var r=e.session.sp;switch(e.session.cipherSuite.initSecurityParameters(r),r.keys=xp.generateKeys(e,r),i.read.macKey=t?r.keys.server_write_MAC_key:r.keys.client_write_MAC_key,i.write.macKey=t?r.keys.client_write_MAC_key:r.keys.server_write_MAC_key,e.session.cipherSuite.initConnectionState(i,e,r),r.compression_algorithm){case xp.CompressionMethod.none:break;case xp.CompressionMethod.deflate:i.read.compressFunction=Sp,i.write.compressFunction=Cp;break;default:throw new Error("Unsupported compression algorithm.")}}return i},xp.createRandom=function(){var e=new Date,t=+e+6e4*e.getTimezoneOffset(),n=qh.util.createBuffer();return n.putInt32(t),n.putBytes(qh.random.getBytes(28)),n},xp.createRecord=function(e,t){return t.data?{type:t.type,version:{major:e.version.major,minor:e.version.minor},length:t.data.length(),fragment:t.data}:null},xp.createAlert=function(e,t){var n=qh.util.createBuffer();return n.putByte(t.level),n.putByte(t.description),xp.createRecord(e,{type:xp.ContentType.alert,data:n})},xp.createClientHello=function(e){e.session.clientHelloVersion={major:e.version.major,minor:e.version.minor};for(var t=qh.util.createBuffer(),n=0;n<e.cipherSuites.length;++n){var i=e.cipherSuites[n];t.putByte(i.id[0]),t.putByte(i.id[1])}var r=t.length(),o=qh.util.createBuffer();o.putByte(xp.CompressionMethod.none);var a=o.length(),s=qh.util.createBuffer();if(e.virtualHost){var l=qh.util.createBuffer();l.putByte(0),l.putByte(0);var u=qh.util.createBuffer();u.putByte(0),Tp(u,2,qh.util.createBuffer(e.virtualHost));var c=qh.util.createBuffer();Tp(c,2,u),Tp(l,2,c),s.putBuffer(l)}var h=s.length();h>0&&(h+=2);var d=e.session.id,p=d.length+1+2+4+28+2+r+1+a+h,f=qh.util.createBuffer();return f.putByte(xp.HandshakeType.client_hello),f.putInt24(p),f.putByte(e.version.major),f.putByte(e.version.minor),f.putBytes(e.session.sp.client_random),Tp(f,1,qh.util.createBuffer(d)),Tp(f,2,t),Tp(f,1,o),h>0&&Tp(f,2,s),f},xp.createServerHello=function(e){var t=e.session.id,n=t.length+1+2+4+28+2+1,i=qh.util.createBuffer();return i.putByte(xp.HandshakeType.server_hello),i.putInt24(n),i.putByte(e.version.major),i.putByte(e.version.minor),i.putBytes(e.session.sp.server_random),Tp(i,1,qh.util.createBuffer(t)),i.putByte(e.session.cipherSuite.id[0]),i.putByte(e.session.cipherSuite.id[1]),i.putByte(e.session.compressionMethod),i},xp.createCertificate=function(e){var t,n=e.entity===xp.ConnectionEnd.client,i=null;e.getCertificate&&(t=n?e.session.certificateRequest:e.session.extensions.server_name.serverNameList,i=e.getCertificate(e,t));var r=qh.util.createBuffer();if(null!==i)try{qh.util.isArray(i)||(i=[i]);for(var o=null,a=0;a<i.length;++a){var s=qh.pem.decode(i[a])[0];if("CERTIFICATE"!==s.type&&"X509 CERTIFICATE"!==s.type&&"TRUSTED CERTIFICATE"!==s.type){var l=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw l.headerType=s.type,l}if(s.procType&&"ENCRYPTED"===s.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var u=qh.util.createBuffer(s.body);null===o&&(o=qh.asn1.fromDer(u.bytes(),!1));var c=qh.util.createBuffer();Tp(c,3,u),r.putBuffer(c)}i=qh.pki.certificateFromAsn1(o),n?e.session.clientCertificate=i:e.session.serverCertificate=i}catch(t){return e.error(e,{message:"Could not send certificate list.",cause:t,send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.bad_certificate}})}var h=3+r.length(),d=qh.util.createBuffer();return d.putByte(xp.HandshakeType.certificate),d.putInt24(h),Tp(d,3,r),d},xp.createClientKeyExchange=function(e){var t=qh.util.createBuffer();t.putByte(e.session.clientHelloVersion.major),t.putByte(e.session.clientHelloVersion.minor),t.putBytes(qh.random.getBytes(46));var n=e.session.sp;n.pre_master_secret=t.getBytes();var i=(t=e.session.serverCertificate.publicKey.encrypt(n.pre_master_secret)).length+2,r=qh.util.createBuffer();return r.putByte(xp.HandshakeType.client_key_exchange),r.putInt24(i),r.putInt16(t.length),r.putBytes(t),r},xp.createServerKeyExchange=function(e){return qh.util.createBuffer()},xp.getClientSignature=function(e,t){var n=qh.util.createBuffer();n.putBuffer(e.session.md5.digest()),n.putBuffer(e.session.sha1.digest()),n=n.getBytes(),e.getSignature=e.getSignature||function(e,t,n){var i=null;if(e.getPrivateKey)try{i=e.getPrivateKey(e,e.session.clientCertificate),i=qh.pki.privateKeyFromPem(i)}catch(t){e.error(e,{message:"Could not get private key.",cause:t,send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.internal_error}})}null===i?e.error(e,{message:"No private key set.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.internal_error}}):t=i.sign(t,null),n(e,t)},e.getSignature(e,n,t)},xp.createCertificateVerify=function(e,t){var n=t.length+2,i=qh.util.createBuffer();return i.putByte(xp.HandshakeType.certificate_verify),i.putInt24(n),i.putInt16(t.length),i.putBytes(t),i},xp.createCertificateRequest=function(e){var t=qh.util.createBuffer();t.putByte(1);var n=qh.util.createBuffer();for(var i in e.caStore.certs){var r=e.caStore.certs[i],o=qh.pki.distinguishedNameToAsn1(r.subject),a=qh.asn1.toDer(o);n.putInt16(a.length()),n.putBuffer(a)}var s=1+t.length()+2+n.length(),l=qh.util.createBuffer();return l.putByte(xp.HandshakeType.certificate_request),l.putInt24(s),Tp(l,1,t),Tp(l,2,n),l},xp.createServerHelloDone=function(e){var t=qh.util.createBuffer();return t.putByte(xp.HandshakeType.server_hello_done),t.putInt24(0),t},xp.createChangeCipherSpec=function(){var e=qh.util.createBuffer();return e.putByte(1),e},xp.createFinished=function(e){var t=qh.util.createBuffer();t.putBuffer(e.session.md5.digest()),t.putBuffer(e.session.sha1.digest());var n=e.entity===xp.ConnectionEnd.client,i=e.session.sp,r=n?"client finished":"server finished";t=Ep(i.master_secret,r,t.getBytes(),12);var o=qh.util.createBuffer();return o.putByte(xp.HandshakeType.finished),o.putInt24(t.length()),o.putBuffer(t),o},xp.createHeartbeat=function(e,t,n){void 0===n&&(n=t.length);var i=qh.util.createBuffer();i.putByte(e),i.putInt16(n),i.putBytes(t);var r=i.length(),o=Math.max(16,r-n-3);return i.putBytes(qh.random.getBytes(o)),i},xp.queue=function(e,t){if(t&&(0!==t.fragment.length()||t.type!==xp.ContentType.handshake&&t.type!==xp.ContentType.alert&&t.type!==xp.ContentType.change_cipher_spec)){if(t.type===xp.ContentType.handshake){var n=t.fragment.bytes();e.session.md5.update(n),e.session.sha1.update(n),n=null}var i;if(t.fragment.length()<=xp.MaxFragment)i=[t];else{i=[];for(var r=t.fragment.bytes();r.length>xp.MaxFragment;)i.push(xp.createRecord(e,{type:t.type,data:qh.util.createBuffer(r.slice(0,xp.MaxFragment))})),r=r.slice(xp.MaxFragment);r.length>0&&i.push(xp.createRecord(e,{type:t.type,data:qh.util.createBuffer(r)}))}for(var o=0;o<i.length&&!e.fail;++o){var a=i[o];e.state.current.write.update(e,a)&&e.records.push(a)}}},xp.flush=function(e){for(var t=0;t<e.records.length;++t){var n=e.records[t];e.tlsData.putByte(n.type),e.tlsData.putByte(n.version.major),e.tlsData.putByte(n.version.minor),e.tlsData.putInt16(n.fragment.length()),e.tlsData.putBuffer(e.records[t].fragment)}return e.records=[],e.tlsDataReady(e)};var sf=function(e){switch(e){case!0:return!0;case qh.pki.certificateError.bad_certificate:return xp.Alert.Description.bad_certificate;case qh.pki.certificateError.unsupported_certificate:return xp.Alert.Description.unsupported_certificate;case qh.pki.certificateError.certificate_revoked:return xp.Alert.Description.certificate_revoked;case qh.pki.certificateError.certificate_expired:return xp.Alert.Description.certificate_expired;case qh.pki.certificateError.certificate_unknown:return xp.Alert.Description.certificate_unknown;case qh.pki.certificateError.unknown_ca:return xp.Alert.Description.unknown_ca;default:return xp.Alert.Description.bad_certificate}};xp.verifyCertificateChain=function(e,t){try{qh.pki.verifyCertificateChain(e.caStore,t,(function(t,n,i){sf(t);var r=e.verify(e,t,n,i);if(!0!==r){if("object"==typeof r&&!qh.util.isArray(r)){var o=new Error("The application rejected the certificate.");throw o.send=!0,o.alert={level:xp.Alert.Level.fatal,description:xp.Alert.Description.bad_certificate},r.message&&(o.message=r.message),r.alert&&(o.alert.description=r.alert),o}r!==t&&(r=function(e){switch(e){case!0:return!0;case xp.Alert.Description.bad_certificate:return qh.pki.certificateError.bad_certificate;case xp.Alert.Description.unsupported_certificate:return qh.pki.certificateError.unsupported_certificate;case xp.Alert.Description.certificate_revoked:return qh.pki.certificateError.certificate_revoked;case xp.Alert.Description.certificate_expired:return qh.pki.certificateError.certificate_expired;case xp.Alert.Description.certificate_unknown:return qh.pki.certificateError.certificate_unknown;case xp.Alert.Description.unknown_ca:return qh.pki.certificateError.unknown_ca;default:return qh.pki.certificateError.bad_certificate}}(r))}return r}))}catch(t){var n=t;("object"!=typeof n||qh.util.isArray(n))&&(n={send:!0,alert:{level:xp.Alert.Level.fatal,description:sf(t)}}),"send"in n||(n.send=!0),"alert"in n||(n.alert={level:xp.Alert.Level.fatal,description:sf(n.error)}),e.error(e,n)}return!e.fail},xp.createSessionCache=function(e,t){var n=null;if(e&&e.getSession&&e.setSession&&e.order)n=e;else{for(var i in(n={}).cache=e||{},n.capacity=Math.max(t||100,1),n.order=[],e)n.order.length<=t?n.order.push(i):delete e[i];n.getSession=function(e){var t=null,i=null;if(e?i=qh.util.bytesToHex(e):n.order.length>0&&(i=n.order[0]),null!==i&&i in n.cache)for(var r in t=n.cache[i],delete n.cache[i],n.order)if(n.order[r]===i){n.order.splice(r,1);break}return t},n.setSession=function(e,t){if(n.order.length===n.capacity){var i=n.order.shift();delete n.cache[i]}i=qh.util.bytesToHex(e);n.order.push(i),n.cache[i]=t}}return n},xp.createConnection=function(e){var t=null;t=e.caStore?qh.util.isArray(e.caStore)?qh.pki.createCaStore(e.caStore):e.caStore:qh.pki.createCaStore();var n=e.cipherSuites||null;if(null===n)for(var i in n=[],xp.CipherSuites)n.push(xp.CipherSuites[i]);var r=e.server?xp.ConnectionEnd.server:xp.ConnectionEnd.client,o=e.sessionCache?xp.createSessionCache(e.sessionCache):null,a={version:{major:xp.Version.major,minor:xp.Version.minor},entity:r,sessionId:e.sessionId,caStore:t,sessionCache:o,cipherSuites:n,connected:e.connected,virtualHost:e.virtualHost||null,verifyClient:e.verifyClient||!1,verify:e.verify||function(e,t,n,i){return t},getCertificate:e.getCertificate||null,getPrivateKey:e.getPrivateKey||null,getSignature:e.getSignature||null,input:qh.util.createBuffer(),tlsData:qh.util.createBuffer(),data:qh.util.createBuffer(),tlsDataReady:e.tlsDataReady,dataReady:e.dataReady,heartbeatReceived:e.heartbeatReceived,closed:e.closed,error:function(t,n){n.origin=n.origin||(t.entity===xp.ConnectionEnd.client?"client":"server"),n.send&&(xp.queue(t,xp.createAlert(t,n.alert)),xp.flush(t));var i=!1!==n.fatal;i&&(t.fail=!0),e.error(t,n),i&&t.close(!1)},deflate:e.deflate||null,inflate:e.inflate||null,reset:function(e){a.version={major:xp.Version.major,minor:xp.Version.minor},a.record=null,a.session=null,a.peerCertificate=null,a.state={pending:null,current:null},a.expect=(a.entity,xp.ConnectionEnd.client,0),a.fragmented=null,a.records=[],a.open=!1,a.handshakes=0,a.handshaking=!1,a.isConnected=!1,a.fail=!(e||void 0===e),a.input.clear(),a.tlsData.clear(),a.data.clear(),a.state.current=xp.createConnectionState(a)}};a.reset();return a.handshake=function(e){if(a.entity!==xp.ConnectionEnd.client)a.error(a,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(a.handshaking)a.error(a,{message:"Handshake already in progress.",fatal:!1});else{a.fail&&!a.open&&0===a.handshakes&&(a.fail=!1),a.handshaking=!0;var t=null;(e=e||"").length>0&&(a.sessionCache&&(t=a.sessionCache.getSession(e)),null===t&&(e="")),0===e.length&&a.sessionCache&&null!==(t=a.sessionCache.getSession())&&(e=t.id),a.session={id:e,version:null,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:{},md5:qh.md.md5.create(),sha1:qh.md.sha1.create()},t&&(a.version=t.version,a.session.sp=t.sp),a.session.sp.client_random=xp.createRandom().getBytes(),a.open=!0,xp.queue(a,xp.createRecord(a,{type:xp.ContentType.handshake,data:xp.createClientHello(a)})),xp.flush(a)}},a.process=function(e){var t=0;return e&&a.input.putBytes(e),a.fail||(null!==a.record&&a.record.ready&&a.record.fragment.isEmpty()&&(a.record=null),null===a.record&&(t=function(e){var t=0,n=e.input,i=n.length();if(i<5)t=5-i;else{e.record={type:n.getByte(),version:{major:n.getByte(),minor:n.getByte()},length:n.getInt16(),fragment:qh.util.createBuffer(),ready:!1};var r=e.record.version.major===e.version.major;r&&e.session&&e.session.version&&(r=e.record.version.minor===e.version.minor),r||e.error(e,{message:"Incompatible TLS version.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.protocol_version}})}return t}(a)),a.fail||null===a.record||a.record.ready||(t=function(e){var t=0,n=e.input,i=n.length();i<e.record.length?t=e.record.length-i:(e.record.fragment.putBytes(n.getBytes(e.record.length)),n.compact(),e.state.current.read.update(e,e.record)&&(null!==e.fragmented&&(e.fragmented.type===e.record.type?(e.fragmented.fragment.putBuffer(e.record.fragment),e.record=e.fragmented):e.error(e,{message:"Invalid fragmented record.",send:!0,alert:{level:xp.Alert.Level.fatal,description:xp.Alert.Description.unexpected_message}})),e.record.ready=!0));return t}(a)),!a.fail&&null!==a.record&&a.record.ready&&function(e,t){var n=t.type-xp.ContentType.change_cipher_spec,i=Gp[e.entity][e.expect];n in i?i[n](e,t):xp.handleUnexpected(e,t)}(a,a.record)),t},a.prepare=function(e){return xp.queue(a,xp.createRecord(a,{type:xp.ContentType.application_data,data:qh.util.createBuffer(e)})),xp.flush(a)},a.prepareHeartbeatRequest=function(e,t){return e instanceof qh.util.ByteBuffer&&(e=e.bytes()),void 0===t&&(t=e.length),a.expectedHeartbeatPayload=e,xp.queue(a,xp.createRecord(a,{type:xp.ContentType.heartbeat,data:xp.createHeartbeat(xp.HeartbeatMessageType.heartbeat_request,e,t)})),xp.flush(a)},a.close=function(e){if(!a.fail&&a.sessionCache&&a.session){var t={id:a.session.id,version:a.session.version,sp:a.session.sp};t.sp.keys=null,a.sessionCache.setSession(t.id,t)}a.open&&(a.open=!1,a.input.clear(),(a.isConnected||a.handshaking)&&(a.isConnected=a.handshaking=!1,xp.queue(a,xp.createAlert(a,{level:xp.Alert.Level.warning,description:xp.Alert.Description.close_notify})),xp.flush(a)),a.closed(a)),a.reset(e)},a};qh.tls=qh.tls||{};for(var lf in xp)"function"!=typeof xp[lf]&&(qh.tls[lf]=xp[lf]);qh.tls.prf_tls1=Ep,qh.tls.hmac_sha1=function(e,t,n){var i=qh.hmac.create();i.start("SHA1",e);var r=qh.util.createBuffer();return r.putInt32(t[0]),r.putInt32(t[1]),r.putByte(n.type),r.putByte(n.version.major),r.putByte(n.version.minor),r.putInt16(n.length),r.putBytes(n.fragment.bytes()),i.update(r.getBytes()),i.digest().getBytes()},qh.tls.createSessionCache=xp.createSessionCache,qh.tls.createConnection=xp.createConnection;u((function(e){var t=e.exports=qh.tls;function n(e,n,r){var o=n.entity===qh.tls.ConnectionEnd.client;e.read.cipherState={init:!1,cipher:qh.cipher.createDecipher("AES-CBC",o?r.keys.server_write_key:r.keys.client_write_key),iv:o?r.keys.server_write_IV:r.keys.client_write_IV},e.write.cipherState={init:!1,cipher:qh.cipher.createCipher("AES-CBC",o?r.keys.client_write_key:r.keys.server_write_key),iv:o?r.keys.client_write_IV:r.keys.server_write_IV},e.read.cipherFunction=a,e.write.cipherFunction=i,e.read.macLength=e.write.macLength=r.mac_length,e.read.macFunction=e.write.macFunction=t.hmac_sha1}function i(e,n){var i,o=!1,a=n.macFunction(n.macKey,n.sequenceNumber,e);e.fragment.putBytes(a),n.updateSequenceNumber(),i=e.version.minor===t.Versions.TLS_1_0.minor?n.cipherState.init?null:n.cipherState.iv:qh.random.getBytesSync(16),n.cipherState.init=!0;var s=n.cipherState.cipher;return s.start({iv:i}),e.version.minor>=t.Versions.TLS_1_1.minor&&s.output.putBytes(i),s.update(e.fragment),s.finish(r)&&(e.fragment=s.output,e.length=e.fragment.length(),o=!0),o}function r(e,t,n){if(!n){var i=e-t.length()%e;t.fillWithByte(i-1,i)}return!0}function o(e,t,n){var i=!0;if(n){for(var r=t.length(),o=t.last(),a=r-1-o;a<r-1;++a)i=i&&t.at(a)==o;i&&t.truncate(o+1)}return i}function a(e,n){var i,r=!1;i=e.version.minor===t.Versions.TLS_1_0.minor?n.cipherState.init?null:n.cipherState.iv:e.fragment.getBytes(16),n.cipherState.init=!0;var a=n.cipherState.cipher;a.start({iv:i}),a.update(e.fragment),r=a.finish(o);var s=n.macLength,l=qh.random.getBytesSync(s),u=a.output.length();u>=s?(e.fragment=a.output.getBytes(u-s),l=a.output.getBytes(s)):e.fragment=a.output.getBytes(),e.fragment=qh.util.createBuffer(e.fragment),e.length=e.fragment.length();var c=n.macFunction(n.macKey,n.sequenceNumber,e);return n.updateSequenceNumber(),r=function(e,t,n){var i=qh.hmac.create();return i.start("SHA1",e),i.update(t),t=i.digest().getBytes(),i.start(null,null),i.update(n),n=i.digest().getBytes(),t===n}(n.macKey,l,c)&&r}t.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=t.BulkCipherAlgorithm.aes,e.cipher_type=t.CipherType.block,e.enc_key_length=16,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=t.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:n},t.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=t.BulkCipherAlgorithm.aes,e.cipher_type=t.CipherType.block,e.enc_key_length=32,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=t.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:n}})),qh.debug=qh.debug||{};qh.debug.storage={},qh.debug.get=function(e,t){var n;return void 0===e?n=qh.debug.storage:e in qh.debug.storage&&(n=void 0===t?qh.debug.storage[e]:qh.debug.storage[e][t]),n},qh.debug.set=function(e,t,n){e in qh.debug.storage||(qh.debug.storage[e]={}),qh.debug.storage[e][t]=n},qh.debug.clear=function(e,t){void 0===e?qh.debug.storage={}:e in qh.debug.storage&&(void 0===t?delete qh.debug.storage[e]:delete qh.debug.storage[e][t])};u((function(e){var t=e.exports=qh.sha512=qh.sha512||{};qh.md.sha512=qh.md.algorithms.sha512=t;var n=qh.sha384=qh.sha512.sha384=qh.sha512.sha384||{};n.create=function(){return t.create("SHA-384")},qh.md.sha384=qh.md.algorithms.sha384=n,qh.sha512.sha256=qh.sha512.sha256||{create:function(){return t.create("SHA-512/256")}},qh.md["sha512/256"]=qh.md.algorithms["sha512/256"]=qh.sha512.sha256,qh.sha512.sha224=qh.sha512.sha224||{create:function(){return t.create("SHA-512/224")}},qh.md["sha512/224"]=qh.md.algorithms["sha512/224"]=qh.sha512.sha224,t.create=function(e){if(r||(i=String.fromCharCode(128),i+=qh.util.fillString(String.fromCharCode(0),128),o=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],(a={})["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],a["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],a["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],a["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],r=!0),void 0===e&&(e="SHA-512"),!(e in a))throw new Error("Invalid SHA-512 algorithm: "+e);for(var t=a[e],n=null,l=qh.util.createBuffer(),u=new Array(80),c=0;c<80;++c)u[c]=new Array(2);var h=64;switch(e){case"SHA-384":h=48;break;case"SHA-512/256":h=32;break;case"SHA-512/224":h=28}var d={algorithm:e.replace("-","").toLowerCase(),blockLength:128,digestLength:h,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){d.messageLength=0,d.fullMessageLength=d.messageLength128=[];for(var e=d.messageLengthSize/4,i=0;i<e;++i)d.fullMessageLength.push(0);l=qh.util.createBuffer(),n=new Array(t.length);for(i=0;i<t.length;++i)n[i]=t[i].slice(0);return d}};return d.start(),d.update=function(e,t){"utf8"===t&&(e=qh.util.encodeUtf8(e));var i=e.length;d.messageLength+=i,i=[i/4294967296>>>0,i>>>0];for(var r=d.fullMessageLength.length-1;r>=0;--r)d.fullMessageLength[r]+=i[1],i[1]=i[0]+(d.fullMessageLength[r]/4294967296>>>0),d.fullMessageLength[r]=d.fullMessageLength[r]>>>0,i[0]=i[1]/4294967296>>>0;return l.putBytes(e),s(n,u,l),(l.read>2048||0===l.length())&&l.compact(),d},d.digest=function(){var t=qh.util.createBuffer();t.putBytes(l.bytes());var r,o=d.fullMessageLength[d.fullMessageLength.length-1]+d.messageLengthSize&d.blockLength-1;t.putBytes(i.substr(0,d.blockLength-o));for(var a=8*d.fullMessageLength[0],c=0;c<d.fullMessageLength.length-1;++c)a+=(r=8*d.fullMessageLength[c+1])/4294967296>>>0,t.putInt32(a>>>0),a=r>>>0;t.putInt32(a);var h=new Array(n.length);for(c=0;c<n.length;++c)h[c]=n[c].slice(0);s(h,u,t);var p,f=qh.util.createBuffer();p="SHA-512"===e?h.length:"SHA-384"===e?h.length-2:h.length-4;for(c=0;c<p;++c)f.putInt32(h[c][0]),c===p-1&&"SHA-512/224"===e||f.putInt32(h[c][1]);return f},d};var i=null,r=!1,o=null,a=null;function s(e,t,n){for(var i,r,a,s,l,u,c,h,d,p,f,g,m,v,y,_,b,w,E,C,S,k,T,x,L,I,A,D,N,P,B,R,M,O=n.length();O>=128;){for(A=0;A<16;++A)t[A][0]=n.getInt32()>>>0,t[A][1]=n.getInt32()>>>0;for(;A<80;++A)i=(((D=(P=t[A-2])[0])>>>19|(N=P[1])<<13)^(N>>>29|D<<3)^D>>>6)>>>0,r=((D<<13|N>>>19)^(N<<3|D>>>29)^(D<<26|N>>>6))>>>0,a=(((D=(R=t[A-15])[0])>>>1|(N=R[1])<<31)^(D>>>8|N<<24)^D>>>7)>>>0,s=((D<<31|N>>>1)^(D<<24|N>>>8)^(D<<25|N>>>7))>>>0,B=t[A-7],M=t[A-16],N=r+B[1]+s+M[1],t[A][0]=i+B[0]+a+M[0]+(N/4294967296>>>0)>>>0,t[A][1]=N>>>0;for(f=e[0][0],g=e[0][1],m=e[1][0],v=e[1][1],y=e[2][0],_=e[2][1],b=e[3][0],w=e[3][1],E=e[4][0],C=e[4][1],S=e[5][0],k=e[5][1],T=e[6][0],x=e[6][1],L=e[7][0],I=e[7][1],A=0;A<80;++A)c=((E>>>14|C<<18)^(E>>>18|C<<14)^(C>>>9|E<<23))>>>0,h=(T^E&(S^T))>>>0,l=((f>>>28|g<<4)^(g>>>2|f<<30)^(g>>>7|f<<25))>>>0,u=((f<<4|g>>>28)^(g<<30|f>>>2)^(g<<25|f>>>7))>>>0,d=(f&m|y&(f^m))>>>0,p=(g&v|_&(g^v))>>>0,N=I+(((E<<18|C>>>14)^(E<<14|C>>>18)^(C<<23|E>>>9))>>>0)+((x^C&(k^x))>>>0)+o[A][1]+t[A][1],i=L+c+h+o[A][0]+t[A][0]+(N/4294967296>>>0)>>>0,r=N>>>0,a=l+d+((N=u+p)/4294967296>>>0)>>>0,s=N>>>0,L=T,I=x,T=S,x=k,S=E,k=C,E=b+i+((N=w+r)/4294967296>>>0)>>>0,C=N>>>0,b=y,w=_,y=m,_=v,m=f,v=g,f=i+a+((N=r+s)/4294967296>>>0)>>>0,g=N>>>0;N=e[0][1]+g,e[0][0]=e[0][0]+f+(N/4294967296>>>0)>>>0,e[0][1]=N>>>0,N=e[1][1]+v,e[1][0]=e[1][0]+m+(N/4294967296>>>0)>>>0,e[1][1]=N>>>0,N=e[2][1]+_,e[2][0]=e[2][0]+y+(N/4294967296>>>0)>>>0,e[2][1]=N>>>0,N=e[3][1]+w,e[3][0]=e[3][0]+b+(N/4294967296>>>0)>>>0,e[3][1]=N>>>0,N=e[4][1]+C,e[4][0]=e[4][0]+E+(N/4294967296>>>0)>>>0,e[4][1]=N>>>0,N=e[5][1]+k,e[5][0]=e[5][0]+S+(N/4294967296>>>0)>>>0,e[5][1]=N>>>0,N=e[6][1]+x,e[6][0]=e[6][0]+T+(N/4294967296>>>0)>>>0,e[6][1]=N>>>0,N=e[7][1]+I,e[7][0]=e[7][0]+L+(N/4294967296>>>0)>>>0,e[7][1]=N>>>0,O-=128}}}));if(void 0===uf)var uf=qh.jsbn.BigInteger;var cf=qh.util.ByteBuffer,hf=void 0===Do?Uint8Array:Do;qh.pki=qh.pki||{};qh.pki.ed25519=qh.ed25519=qh.ed25519||{};var df=qh.ed25519;function pf(e){var t=e.message;if(t instanceof Uint8Array)return t;var n=e.encoding;if(void 0===t){if(!e.md)throw new TypeError('"options.message" or "options.md" not specified.');t=e.md.digest().getBytes(),n="binary"}if("string"==typeof t&&!n)throw new TypeError('"options.encoding" must be "binary" or "utf8".');if("string"==typeof t){if(void 0!==Do)return new Do(t,n);t=new cf(t,n)}else if(!(t instanceof cf))throw new TypeError('"options.message" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a string with "options.encoding" specifying its encoding.');for(var i=new hf(t.length()),r=0;r<i.length;++r)i[r]=t.at(r);return i}df.constants={},df.constants.PUBLIC_KEY_BYTE_LENGTH=32,df.constants.PRIVATE_KEY_BYTE_LENGTH=64,df.constants.SEED_BYTE_LENGTH=32,df.constants.SIGN_BYTE_LENGTH=64,df.constants.HASH_BYTE_LENGTH=64,df.generateKeyPair=function(e){var t=(e=e||{}).seed;if(void 0===t)t=qh.random.getBytesSync(df.constants.SEED_BYTE_LENGTH);else if("string"==typeof t){if(t.length!==df.constants.SEED_BYTE_LENGTH)throw new TypeError('"seed" must be '+df.constants.SEED_BYTE_LENGTH+" bytes in length.")}else if(!(t instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, Uint8Array, or a binary string.');t=pf({message:t,encoding:"binary"});for(var n=new hf(df.constants.PUBLIC_KEY_BYTE_LENGTH),i=new hf(df.constants.PRIVATE_KEY_BYTE_LENGTH),r=0;r<32;++r)i[r]=t[r];return function(e,t){var n,i=[Of(),Of(),Of(),Of()],r=Ef(t,32);for(r[0]&=248,r[31]&=127,r[31]|=64,Pf(i,r),xf(e,i),n=0;n<32;++n)t[n+32]=e[n]}(n,i),{publicKey:n,privateKey:i}},df.publicKeyFromPrivateKey=function(e){var t=pf({message:(e=e||{}).privateKey,encoding:"binary"});if(t.length!==df.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+df.constants.PRIVATE_KEY_BYTE_LENGTH);for(var n=new hf(df.constants.PUBLIC_KEY_BYTE_LENGTH),i=0;i<n.length;++i)n[i]=t[32+i];return n},df.sign=function(e){var t=pf(e=e||{}),n=pf({message:e.privateKey,encoding:"binary"});if(n.length!==df.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+df.constants.PRIVATE_KEY_BYTE_LENGTH);var i=new hf(df.constants.SIGN_BYTE_LENGTH+t.length);!function(e,t,n,i){var r,o,a=new Float64Array(64),s=[Of(),Of(),Of(),Of()],l=Ef(i,32);l[0]&=248,l[31]&=127,l[31]|=64;var u=n+64;for(r=0;r<n;++r)e[64+r]=t[r];for(r=0;r<32;++r)e[32+r]=l[32+r];var c=Ef(e.subarray(32),n+32);for(Sf(c),Pf(s,c),xf(e,s),r=32;r<64;++r)e[r]=i[r];var h=Ef(e,n+64);for(Sf(h),r=32;r<64;++r)a[r]=0;for(r=0;r<32;++r)a[r]=c[r];for(r=0;r<32;++r)for(o=0;o<32;o++)a[r+o]+=h[r]*l[o];Cf(e.subarray(32),a)}(i,t,t.length,n);for(var r=new hf(df.constants.SIGN_BYTE_LENGTH),o=0;o<r.length;++o)r[o]=i[o];return r},df.verify=function(e){var t=pf(e=e||{});if(void 0===e.signature)throw new TypeError('"options.signature" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a binary string.');var n=pf({message:e.signature,encoding:"binary"});if(n.length!==df.constants.SIGN_BYTE_LENGTH)throw new TypeError('"options.signature" must have a byte length of '+df.constants.SIGN_BYTE_LENGTH);var i=pf({message:e.publicKey,encoding:"binary"});if(i.length!==df.constants.PUBLIC_KEY_BYTE_LENGTH)throw new TypeError('"options.publicKey" must have a byte length of '+df.constants.PUBLIC_KEY_BYTE_LENGTH);var r,o=new hf(df.constants.SIGN_BYTE_LENGTH+t.length),a=new hf(df.constants.SIGN_BYTE_LENGTH+t.length);for(r=0;r<df.constants.SIGN_BYTE_LENGTH;++r)o[r]=n[r];for(r=0;r<t.length;++r)o[r+df.constants.SIGN_BYTE_LENGTH]=t[r];return function(e,t,n,i){var r,o=new hf(32),a=[Of(),Of(),Of(),Of()],s=[Of(),Of(),Of(),Of()];if(-1,n<64)return-1;if(function(e,t){var n=Of(),i=Of(),r=Of(),o=Of(),a=Of(),s=Of(),l=Of();Bf(e[2],gf),function(e,t){var n;for(n=0;n<16;++n)e[n]=t[2*n]+(t[2*n+1]<<8);e[15]&=32767}(e[1],t),Ff(r,e[1]),Vf(o,r,mf),zf(r,r,e[2]),Uf(o,e[2],o),Ff(a,o),Ff(s,a),Vf(l,s,a),Vf(n,l,r),Vf(n,n,o),function(e,t){var n,i=Of();for(n=0;n<16;++n)i[n]=t[n];for(n=250;n>=0;--n)Ff(i,i),1!==n&&Vf(i,i,t);for(n=0;n<16;++n)e[n]=i[n]}(n,n),Vf(n,n,r),Vf(n,n,o),Vf(n,n,o),Vf(e[0],n,o),Ff(i,e[0]),Vf(i,i,o),If(i,r)&&Vf(e[0],e[0],wf);if(Ff(i,e[0]),Vf(i,i,o),If(i,r))return-1;Df(e[0])===t[31]>>7&&zf(e[0],ff,e[0]);return Vf(e[3],e[0],e[1]),0}(s,i))return-1;for(r=0;r<n;++r)e[r]=t[r];for(r=0;r<32;++r)e[r+32]=i[r];var l=Ef(e,n);if(Sf(l),Nf(a,s,l),Pf(s,t.subarray(32)),kf(a,s),xf(o,a),n-=64,Af(t,0,o,0)){for(r=0;r<n;++r)e[r]=0;return-1}for(r=0;r<n;++r)e[r]=t[r+64];return n}(a,o,o.length,i)>=0};var ff=Of(),gf=Of([1]),mf=Of([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),vf=Of([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),yf=Of([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),_f=Of([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),bf=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]),wf=Of([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function Ef(e,t){var n=qh.md.sha512.create(),i=new cf(e);n.update(i.getBytes(t),"binary");var r=n.digest().getBytes();if(void 0!==Do)return new Do(r,"binary");for(var o=new hf(df.constants.HASH_BYTE_LENGTH),a=0;a<64;++a)o[a]=r.charCodeAt(a);return o}function Cf(e,t){var n,i,r,o;for(i=63;i>=32;--i){for(n=0,r=i-32,o=i-12;r<o;++r)t[r]+=n-16*t[i]*bf[r-(i-32)],n=t[r]+128>>8,t[r]-=256*n;t[r]+=n,t[i]=0}for(n=0,r=0;r<32;++r)t[r]+=n-(t[31]>>4)*bf[r],n=t[r]>>8,t[r]&=255;for(r=0;r<32;++r)t[r]-=n*bf[r];for(i=0;i<32;++i)t[i+1]+=t[i]>>8,e[i]=255&t[i]}function Sf(e){for(var t=new Float64Array(64),n=0;n<64;++n)t[n]=e[n],e[n]=0;Cf(e,t)}function kf(e,t){var n=Of(),i=Of(),r=Of(),o=Of(),a=Of(),s=Of(),l=Of(),u=Of(),c=Of();zf(n,e[1],e[0]),zf(c,t[1],t[0]),Vf(n,n,c),Uf(i,e[0],e[1]),Uf(c,t[0],t[1]),Vf(i,i,c),Vf(r,e[3],t[3]),Vf(r,r,vf),Vf(o,e[2],t[2]),Uf(o,o,o),zf(a,i,n),zf(s,o,r),Uf(l,o,r),Uf(u,i,n),Vf(e[0],a,s),Vf(e[1],u,l),Vf(e[2],l,s),Vf(e[3],a,u)}function Tf(e,t,n){for(var i=0;i<4;++i)Mf(e[i],t[i],n)}function xf(e,t){var n=Of(),i=Of(),r=Of();!function(e,t){var n,i=Of();for(n=0;n<16;++n)i[n]=t[n];for(n=253;n>=0;--n)Ff(i,i),2!==n&&4!==n&&Vf(i,i,t);for(n=0;n<16;++n)e[n]=i[n]}(r,t[2]),Vf(n,t[0],r),Vf(i,t[1],r),Lf(e,i),e[31]^=Df(n)<<7}function Lf(e,t){var n,i,r,o=Of(),a=Of();for(n=0;n<16;++n)a[n]=t[n];for(Rf(a),Rf(a),Rf(a),i=0;i<2;++i){for(o[0]=a[0]-65517,n=1;n<15;++n)o[n]=a[n]-65535-(o[n-1]>>16&1),o[n-1]&=65535;o[15]=a[15]-32767-(o[14]>>16&1),r=o[15]>>16&1,o[14]&=65535,Mf(a,o,1-r)}for(n=0;n<16;n++)e[2*n]=255&a[n],e[2*n+1]=a[n]>>8}function If(e,t){var n=new hf(32),i=new hf(32);return Lf(n,e),Lf(i,t),Af(n,0,i,0)}function Af(e,t,n,i){return function(e,t,n,i,r){var o,a=0;for(o=0;o<r;++o)a|=e[t+o]^n[i+o];return(1&a-1>>>8)-1}(e,t,n,i,32)}function Df(e){var t=new hf(32);return Lf(t,e),1&t[0]}function Nf(e,t,n){var i,r;for(Bf(e[0],ff),Bf(e[1],gf),Bf(e[2],gf),Bf(e[3],ff),r=255;r>=0;--r)Tf(e,t,i=n[r/8|0]>>(7&r)&1),kf(t,e),kf(e,e),Tf(e,t,i)}function Pf(e,t){var n=[Of(),Of(),Of(),Of()];Bf(n[0],yf),Bf(n[1],_f),Bf(n[2],gf),Vf(n[3],yf,_f),Nf(e,n,t)}function Bf(e,t){var n;for(n=0;n<16;n++)e[n]=0|t[n]}function Rf(e){var t,n,i=1;for(t=0;t<16;++t)n=e[t]+i+65535,i=Math.floor(n/65536),e[t]=n-65536*i;e[0]+=i-1+37*(i-1)}function Mf(e,t,n){for(var i,r=~(n-1),o=0;o<16;++o)i=r&(e[o]^t[o]),e[o]^=i,t[o]^=i}function Of(e){var t,n=new Float64Array(16);if(e)for(t=0;t<e.length;++t)n[t]=e[t];return n}function Uf(e,t,n){for(var i=0;i<16;++i)e[i]=t[i]+n[i]}function zf(e,t,n){for(var i=0;i<16;++i)e[i]=t[i]-n[i]}function Ff(e,t){Vf(e,t,t)}function Vf(e,t,n){var i,r,o=0,a=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,f=0,g=0,m=0,v=0,y=0,_=0,b=0,w=0,E=0,C=0,S=0,k=0,T=0,x=0,L=0,I=0,A=0,D=0,N=0,P=0,B=0,R=0,M=n[0],O=n[1],U=n[2],z=n[3],F=n[4],V=n[5],q=n[6],j=n[7],$=n[8],H=n[9],W=n[10],K=n[11],G=n[12],Z=n[13],Y=n[14],X=n[15];o+=(i=t[0])*M,a+=i*O,s+=i*U,l+=i*z,u+=i*F,c+=i*V,h+=i*q,d+=i*j,p+=i*$,f+=i*H,g+=i*W,m+=i*K,v+=i*G,y+=i*Z,_+=i*Y,b+=i*X,a+=(i=t[1])*M,s+=i*O,l+=i*U,u+=i*z,c+=i*F,h+=i*V,d+=i*q,p+=i*j,f+=i*$,g+=i*H,m+=i*W,v+=i*K,y+=i*G,_+=i*Z,b+=i*Y,w+=i*X,s+=(i=t[2])*M,l+=i*O,u+=i*U,c+=i*z,h+=i*F,d+=i*V,p+=i*q,f+=i*j,g+=i*$,m+=i*H,v+=i*W,y+=i*K,_+=i*G,b+=i*Z,w+=i*Y,E+=i*X,l+=(i=t[3])*M,u+=i*O,c+=i*U,h+=i*z,d+=i*F,p+=i*V,f+=i*q,g+=i*j,m+=i*$,v+=i*H,y+=i*W,_+=i*K,b+=i*G,w+=i*Z,E+=i*Y,C+=i*X,u+=(i=t[4])*M,c+=i*O,h+=i*U,d+=i*z,p+=i*F,f+=i*V,g+=i*q,m+=i*j,v+=i*$,y+=i*H,_+=i*W,b+=i*K,w+=i*G,E+=i*Z,C+=i*Y,S+=i*X,c+=(i=t[5])*M,h+=i*O,d+=i*U,p+=i*z,f+=i*F,g+=i*V,m+=i*q,v+=i*j,y+=i*$,_+=i*H,b+=i*W,w+=i*K,E+=i*G,C+=i*Z,S+=i*Y,k+=i*X,h+=(i=t[6])*M,d+=i*O,p+=i*U,f+=i*z,g+=i*F,m+=i*V,v+=i*q,y+=i*j,_+=i*$,b+=i*H,w+=i*W,E+=i*K,C+=i*G,S+=i*Z,k+=i*Y,T+=i*X,d+=(i=t[7])*M,p+=i*O,f+=i*U,g+=i*z,m+=i*F,v+=i*V,y+=i*q,_+=i*j,b+=i*$,w+=i*H,E+=i*W,C+=i*K,S+=i*G,k+=i*Z,T+=i*Y,x+=i*X,p+=(i=t[8])*M,f+=i*O,g+=i*U,m+=i*z,v+=i*F,y+=i*V,_+=i*q,b+=i*j,w+=i*$,E+=i*H,C+=i*W,S+=i*K,k+=i*G,T+=i*Z,x+=i*Y,L+=i*X,f+=(i=t[9])*M,g+=i*O,m+=i*U,v+=i*z,y+=i*F,_+=i*V,b+=i*q,w+=i*j,E+=i*$,C+=i*H,S+=i*W,k+=i*K,T+=i*G,x+=i*Z,L+=i*Y,I+=i*X,g+=(i=t[10])*M,m+=i*O,v+=i*U,y+=i*z,_+=i*F,b+=i*V,w+=i*q,E+=i*j,C+=i*$,S+=i*H,k+=i*W,T+=i*K,x+=i*G,L+=i*Z,I+=i*Y,A+=i*X,m+=(i=t[11])*M,v+=i*O,y+=i*U,_+=i*z,b+=i*F,w+=i*V,E+=i*q,C+=i*j,S+=i*$,k+=i*H,T+=i*W,x+=i*K,L+=i*G,I+=i*Z,A+=i*Y,D+=i*X,v+=(i=t[12])*M,y+=i*O,_+=i*U,b+=i*z,w+=i*F,E+=i*V,C+=i*q,S+=i*j,k+=i*$,T+=i*H,x+=i*W,L+=i*K,I+=i*G,A+=i*Z,D+=i*Y,N+=i*X,y+=(i=t[13])*M,_+=i*O,b+=i*U,w+=i*z,E+=i*F,C+=i*V,S+=i*q,k+=i*j,T+=i*$,x+=i*H,L+=i*W,I+=i*K,A+=i*G,D+=i*Z,N+=i*Y,P+=i*X,_+=(i=t[14])*M,b+=i*O,w+=i*U,E+=i*z,C+=i*F,S+=i*V,k+=i*q,T+=i*j,x+=i*$,L+=i*H,I+=i*W,A+=i*K,D+=i*G,N+=i*Z,P+=i*Y,B+=i*X,b+=(i=t[15])*M,a+=38*(E+=i*U),s+=38*(C+=i*z),l+=38*(S+=i*F),u+=38*(k+=i*V),c+=38*(T+=i*q),h+=38*(x+=i*j),d+=38*(L+=i*$),p+=38*(I+=i*H),f+=38*(A+=i*W),g+=38*(D+=i*K),m+=38*(N+=i*G),v+=38*(P+=i*Z),y+=38*(B+=i*Y),_+=38*(R+=i*X),o=(i=(o+=38*(w+=i*O))+(r=1)+65535)-65536*(r=Math.floor(i/65536)),a=(i=a+r+65535)-65536*(r=Math.floor(i/65536)),s=(i=s+r+65535)-65536*(r=Math.floor(i/65536)),l=(i=l+r+65535)-65536*(r=Math.floor(i/65536)),u=(i=u+r+65535)-65536*(r=Math.floor(i/65536)),c=(i=c+r+65535)-65536*(r=Math.floor(i/65536)),h=(i=h+r+65535)-65536*(r=Math.floor(i/65536)),d=(i=d+r+65535)-65536*(r=Math.floor(i/65536)),p=(i=p+r+65535)-65536*(r=Math.floor(i/65536)),f=(i=f+r+65535)-65536*(r=Math.floor(i/65536)),g=(i=g+r+65535)-65536*(r=Math.floor(i/65536)),m=(i=m+r+65535)-65536*(r=Math.floor(i/65536)),v=(i=v+r+65535)-65536*(r=Math.floor(i/65536)),y=(i=y+r+65535)-65536*(r=Math.floor(i/65536)),_=(i=_+r+65535)-65536*(r=Math.floor(i/65536)),b=(i=b+r+65535)-65536*(r=Math.floor(i/65536)),o=(i=(o+=r-1+37*(r-1))+(r=1)+65535)-65536*(r=Math.floor(i/65536)),a=(i=a+r+65535)-65536*(r=Math.floor(i/65536)),s=(i=s+r+65535)-65536*(r=Math.floor(i/65536)),l=(i=l+r+65535)-65536*(r=Math.floor(i/65536)),u=(i=u+r+65535)-65536*(r=Math.floor(i/65536)),c=(i=c+r+65535)-65536*(r=Math.floor(i/65536)),h=(i=h+r+65535)-65536*(r=Math.floor(i/65536)),d=(i=d+r+65535)-65536*(r=Math.floor(i/65536)),p=(i=p+r+65535)-65536*(r=Math.floor(i/65536)),f=(i=f+r+65535)-65536*(r=Math.floor(i/65536)),g=(i=g+r+65535)-65536*(r=Math.floor(i/65536)),m=(i=m+r+65535)-65536*(r=Math.floor(i/65536)),v=(i=v+r+65535)-65536*(r=Math.floor(i/65536)),y=(i=y+r+65535)-65536*(r=Math.floor(i/65536)),_=(i=_+r+65535)-65536*(r=Math.floor(i/65536)),b=(i=b+r+65535)-65536*(r=Math.floor(i/65536)),o+=r-1+37*(r-1),e[0]=o,e[1]=a,e[2]=s,e[3]=l,e[4]=u,e[5]=c,e[6]=h,e[7]=d,e[8]=p,e[9]=f,e[10]=g,e[11]=m,e[12]=v,e[13]=y,e[14]=_,e[15]=b}qh.kem=qh.kem||{};var qf=qh.jsbn.BigInteger;function jf(e,t,n,i){e.generate=function(e,r){for(var o=new qh.util.ByteBuffer,a=Math.ceil(r/i)+n,s=new qh.util.ByteBuffer,l=n;l<a;++l){s.putInt32(l),t.start(),t.update(e+s.getBytes());var u=t.digest();o.putBytes(u.getBytes(i))}return o.truncate(o.length()-r),o.getBytes()}}qh.kem.rsa={},qh.kem.rsa.create=function(e,t){var n=(t=t||{}).prng||qh.random,i={encrypt:function(t,i){var r,o=Math.ceil(t.n.bitLength()/8);do{r=new qf(qh.util.bytesToHex(n.getBytesSync(o)),16).mod(t.n)}while(r.equals(qf.ZERO));var a=o-(r=qh.util.hexToBytes(r.toString(16))).length;return a>0&&(r=qh.util.fillString(String.fromCharCode(0),a)+r),{encapsulation:t.encrypt(r,"NONE"),key:e.generate(r,i)}},decrypt:function(t,n,i){var r=t.decrypt(n,"NONE");return e.generate(r,i)}};return i},qh.kem.kdf1=function(e,t){jf(this,e,0,t||e.digestLength)},qh.kem.kdf2=function(e,t){jf(this,e,1,t||e.digestLength)};qh.log=qh.log||{};qh.log.levels=["none","error","warning","info","debug","verbose","max"];var $f={},Hf=[],Wf=null;qh.log.LEVEL_LOCKED=2,qh.log.NO_LEVEL_CHECK=4,qh.log.INTERPOLATE=8;for(var Kf=0;Kf<qh.log.levels.length;++Kf){var Gf=qh.log.levels[Kf];$f[Gf]={index:Kf,name:Gf.toUpperCase()}}qh.log.logMessage=function(e){for(var t=$f[e.level].index,n=0;n<Hf.length;++n){var i=Hf[n];if(i.flags&qh.log.NO_LEVEL_CHECK)i.f(e);else t<=$f[i.level].index&&i.f(i,e)}},qh.log.prepareStandard=function(e){"standard"in e||(e.standard=$f[e.level].name+" ["+e.category+"] "+e.message)},qh.log.prepareFull=function(e){if(!("full"in e)){var t=[e.message];t=t.concat([]||e.arguments),e.full=qh.util.format.apply(this,t)}},qh.log.prepareStandardFull=function(e){"standardFull"in e||(qh.log.prepareStandard(e),e.standardFull=e.standard)};var Zf=["error","warning","info","debug","verbose"];for(Kf=0;Kf<Zf.length;++Kf)!function(e){qh.log[e]=function(t,n){var i=Array.prototype.slice.call(arguments).slice(2),r={timestamp:new Date,level:e,category:t,message:n,arguments:i};qh.log.logMessage(r)}}(Zf[Kf]);if(qh.log.makeLogger=function(e){var t={flags:0,f:e};return qh.log.setLevel(t,"none"),t},qh.log.setLevel=function(e,t){var n=!1;if(e&&!(e.flags&qh.log.LEVEL_LOCKED))for(var i=0;i<qh.log.levels.length;++i){if(t==qh.log.levels[i]){e.level=t,n=!0;break}}return n},qh.log.lock=function(e,t){void 0===t||t?e.flags|=qh.log.LEVEL_LOCKED:e.flags&=~qh.log.LEVEL_LOCKED},qh.log.addLogger=function(e){Hf.push(e)},"undefined"!=typeof console&&"log"in console){var Yf;if(console.error&&console.warn&&console.info&&console.debug){var Xf={error:console.error,warning:console.warn,info:console.info,debug:console.debug,verbose:console.debug},Qf=function(e,t){qh.log.prepareStandard(t);var n=Xf[t.level],i=[t.standard];i=i.concat(t.arguments.slice()),n.apply(console,i)};Yf=qh.log.makeLogger(Qf)}else{Qf=function(e,t){qh.log.prepareStandardFull(t),console.log(t.standardFull)};Yf=qh.log.makeLogger(Qf)}qh.log.setLevel(Yf,"debug"),qh.log.addLogger(Yf),Wf=Yf}else console={log:function(){}};if(null!==Wf){var Jf=qh.util.getQueryVariables();if("console.level"in Jf&&qh.log.setLevel(Wf,Jf["console.level"].slice(-1)[0]),"console.lock"in Jf)"true"==Jf["console.lock"].slice(-1)[0]&&qh.log.lock(Wf)}qh.log.consoleLogger=Wf;u((function(e){var t=qh.asn1,n=e.exports=qh.pkcs7=qh.pkcs7||{};function i(e){var i={},r=[];if(!t.validate(e,n.asn1.recipientInfoValidator,i,r)){var o=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw o.errors=r,o}return{version:i.version.charCodeAt(0),issuer:qh.pki.RDNAttributesAsArray(i.issuer),serialNumber:qh.util.createBuffer(i.serial).toHex(),encryptedContent:{algorithm:t.derToOid(i.encAlgorithm),parameter:i.encParameter.value,content:i.encKey}}}function r(e){for(var n,i=[],r=0;r<e.length;++r)i.push((n=e[r],t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(n.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[qh.pki.distinguishedNameToAsn1({attributes:n.issuer}),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,qh.util.hexToBytes(n.serialNumber))]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.encryptedContent.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,n.encryptedContent.content)])));return i}function o(e){var n=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(e.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[qh.pki.distinguishedNameToAsn1({attributes:e.issuer}),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,qh.util.hexToBytes(e.serialNumber))]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.digestAlgorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])]);if(e.authenticatedAttributesAsn1&&n.value.push(e.authenticatedAttributesAsn1),n.value.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.signatureAlgorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])),n.value.push(t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,e.signature)),e.unauthenticatedAttributes.length>0){for(var i=t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[]),r=0;r<e.unauthenticatedAttributes.length;++r){var o=e.unauthenticatedAttributes[r];i.values.push(a(o))}n.value.push(i)}return n}function a(e){var n;if(e.type===qh.pki.oids.contentType)n=t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.value).getBytes());else if(e.type===qh.pki.oids.messageDigest)n=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,e.value.bytes());else if(e.type===qh.pki.oids.signingTime){var i=new Date("1950-01-01T00:00:00Z"),r=new Date("2050-01-01T00:00:00Z"),o=e.value;if("string"==typeof o){var a=Date.parse(o);o=isNaN(a)?13===o.length?t.utcTimeToDate(o):t.generalizedTimeToDate(o):new Date(a)}n=o>=i&&o<r?t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(o)):t.create(t.Class.UNIVERSAL,t.Type.GENERALIZEDTIME,!1,t.dateToGeneralizedTime(o))}return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.type).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[n])])}function s(e,n,i){var r={};if(!t.validate(n,i,r,[])){var o=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw o.errors=o,o}if(t.derToOid(r.contentType)!==qh.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(r.encryptedContent){var a="";if(qh.util.isArray(r.encryptedContent))for(var s=0;s<r.encryptedContent.length;++s){if(r.encryptedContent[s].type!==t.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");a+=r.encryptedContent[s].value}else a=r.encryptedContent;e.encryptedContent={algorithm:t.derToOid(r.encAlgorithm),parameter:qh.util.createBuffer(r.encParameter.value),content:qh.util.createBuffer(a)}}if(r.content){a="";if(qh.util.isArray(r.content))for(s=0;s<r.content.length;++s){if(r.content[s].type!==t.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");a+=r.content[s].value}else a=r.content;e.content=qh.util.createBuffer(a)}return e.version=r.version.charCodeAt(0),e.rawCapture=r,r}function l(e){if(void 0===e.encryptedContent.key)throw new Error("Symmetric key not available.");if(void 0===e.content){var t;switch(e.encryptedContent.algorithm){case qh.pki.oids["aes128-CBC"]:case qh.pki.oids["aes192-CBC"]:case qh.pki.oids["aes256-CBC"]:t=qh.aes.createDecryptionCipher(e.encryptedContent.key);break;case qh.pki.oids.desCBC:case qh.pki.oids["des-EDE3-CBC"]:t=qh.des.createDecryptionCipher(e.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+e.encryptedContent.algorithm)}if(t.start(e.encryptedContent.parameter),t.update(e.encryptedContent.content),!t.finish())throw new Error("Symmetric decryption failed.");e.content=t.output}}n.messageFromPem=function(e){var i=qh.pem.decode(e)[0];if("PKCS7"!==i.type){var r=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw r.headerType=i.type,r}if(i.procType&&"ENCRYPTED"===i.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var o=t.fromDer(i.body);return n.messageFromAsn1(o)},n.messageToPem=function(e,n){var i={type:"PKCS7",body:t.toDer(e.toAsn1()).getBytes()};return qh.pem.encode(i,{maxline:n})},n.messageFromAsn1=function(e){var i={},r=[];if(!t.validate(e,n.asn1.contentInfoValidator,i,r)){var o=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw o.errors=r,o}var a,s=t.derToOid(i.contentType);switch(s){case qh.pki.oids.envelopedData:a=n.createEnvelopedData();break;case qh.pki.oids.encryptedData:a=n.createEncryptedData();break;case qh.pki.oids.signedData:a=n.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+s+" is not (yet) supported.")}return a.fromAsn1(i.content.value[0]),a},n.createSignedData=function(){var e=null;return e={type:qh.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(t){if(s(e,t,n.asn1.signedDataValidator),e.certificates=[],e.crls=[],e.digestAlgorithmIdentifiers=[],e.contentInfo=null,e.signerInfos=[],e.rawCapture.certificates)for(var i=e.rawCapture.certificates.value,r=0;r<i.length;++r)e.certificates.push(qh.pki.certificateFromAsn1(i[r]))},toAsn1:function(){e.contentInfo||e.sign();for(var n=[],i=0;i<e.certificates.length;++i)n.push(qh.pki.certificateToAsn1(e.certificates[i]));var r=[],o=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(e.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,e.digestAlgorithmIdentifiers),e.contentInfo])]);return n.length>0&&o.value[0].value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,n)),r.length>0&&o.value[0].value.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,r)),o.value[0].value.push(t.create(t.Class.UNIVERSAL,t.Type.SET,!0,e.signerInfos)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.type).getBytes()),o])},addSigner:function(t){var n=t.issuer,i=t.serialNumber;if(t.certificate){var r=t.certificate;"string"==typeof r&&(r=qh.pki.certificateFromPem(r)),n=r.issuer.attributes,i=r.serialNumber}var o=t.key;if(!o)throw new Error("Could not add PKCS#7 signer; no private key specified.");"string"==typeof o&&(o=qh.pki.privateKeyFromPem(o));var a=t.digestAlgorithm||qh.pki.oids.sha1;switch(a){case qh.pki.oids.sha1:case qh.pki.oids.sha256:case qh.pki.oids.sha384:case qh.pki.oids.sha512:case qh.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+a)}var s=t.authenticatedAttributes||[];if(s.length>0){for(var l=!1,u=!1,c=0;c<s.length;++c){var h=s[c];if(l||h.type!==qh.pki.oids.contentType){if(u||h.type!==qh.pki.oids.messageDigest);else if(u=!0,l)break}else if(l=!0,u)break}if(!l||!u)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}e.signers.push({key:o,version:1,issuer:n,serialNumber:i,digestAlgorithm:a,signatureAlgorithm:qh.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:s,unauthenticatedAttributes:[]})},sign:function(n){var i;(n=n||{},"object"!=typeof e.content||null===e.contentInfo)&&(e.contentInfo=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(qh.pki.oids.data).getBytes())]),"content"in e&&(e.content instanceof qh.util.ByteBuffer?i=e.content.bytes():"string"==typeof e.content&&(i=qh.util.encodeUtf8(e.content)),n.detached?e.detachedContent=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,i):e.contentInfo.value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,i)]))));0!==e.signers.length&&function(n){var i;i=e.detachedContent?e.detachedContent:(i=e.contentInfo.value[1]).value[0];if(!i)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var r=t.derToOid(e.contentInfo.value[0].value),s=t.toDer(i);for(var l in s.getByte(),t.getBerValueLength(s),s=s.getBytes(),n)n[l].start().update(s);for(var u=new Date,c=0;c<e.signers.length;++c){var h=e.signers[c];if(0===h.authenticatedAttributes.length){if(r!==qh.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{h.authenticatedAttributesAsn1=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var d=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[]),p=0;p<h.authenticatedAttributes.length;++p){var f=h.authenticatedAttributes[p];f.type===qh.pki.oids.messageDigest?f.value=n[h.digestAlgorithm].digest():f.type===qh.pki.oids.signingTime&&(f.value||(f.value=u)),d.value.push(a(f)),h.authenticatedAttributesAsn1.value.push(a(f))}s=t.toDer(d).getBytes(),h.md.start().update(s)}h.signature=h.key.sign(h.md,"RSASSA-PKCS1-V1_5")}e.signerInfos=function(e){for(var t=[],n=0;n<e.length;++n)t.push(o(e[n]));return t}(e.signers)}(function(){for(var n={},i=0;i<e.signers.length;++i){var r=e.signers[i];(o=r.digestAlgorithm)in n||(n[o]=qh.md[qh.pki.oids[o]].create()),0===r.authenticatedAttributes.length?r.md=n[o]:r.md=qh.md[qh.pki.oids[o]].create()}for(var o in e.digestAlgorithmIdentifiers=[],n)e.digestAlgorithmIdentifiers.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(o).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]));return n}())},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(t){"string"==typeof t&&(t=qh.pki.certificateFromPem(t)),e.certificates.push(t)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")}}},n.createEncryptedData=function(){var e=null;return e={type:qh.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:qh.pki.oids["aes256-CBC"]},fromAsn1:function(t){s(e,t,n.asn1.encryptedDataValidator)},decrypt:function(t){void 0!==t&&(e.encryptedContent.key=t),l(e)}}},n.createEnvelopedData=function(){var e=null;return e={type:qh.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:qh.pki.oids["aes256-CBC"]},fromAsn1:function(t){var r=s(e,t,n.asn1.envelopedDataValidator);e.recipients=function(e){for(var t=[],n=0;n<e.length;++n)t.push(i(e[n]));return t}(r.recipientInfos.value)},toAsn1:function(){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.type).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(e.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,r(e.recipients)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,(n=e.encryptedContent,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(qh.pki.oids.data).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,n.parameter.getBytes())]),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,n.content.getBytes())])]))])])]);var n},findRecipient:function(t){for(var n=t.issuer.attributes,i=0;i<e.recipients.length;++i){var r=e.recipients[i],o=r.issuer;if(r.serialNumber===t.serialNumber&&o.length===n.length){for(var a=!0,s=0;s<n.length;++s)if(o[s].type!==n[s].type||o[s].value!==n[s].value){a=!1;break}if(a)return r}}return null},decrypt:function(t,n){if(void 0===e.encryptedContent.key&&void 0!==t&&void 0!==n)switch(t.encryptedContent.algorithm){case qh.pki.oids.rsaEncryption:case qh.pki.oids.desCBC:var i=n.decrypt(t.encryptedContent.content);e.encryptedContent.key=qh.util.createBuffer(i);break;default:throw new Error("Unsupported asymmetric cipher, OID "+t.encryptedContent.algorithm)}l(e)},addRecipient:function(t){e.recipients.push({version:0,issuer:t.issuer.attributes,serialNumber:t.serialNumber,encryptedContent:{algorithm:qh.pki.oids.rsaEncryption,key:t.publicKey}})},encrypt:function(t,n){if(void 0===e.encryptedContent.content){var i,r,o;switch(n=n||e.encryptedContent.algorithm,t=t||e.encryptedContent.key,n){case qh.pki.oids["aes128-CBC"]:i=16,r=16,o=qh.aes.createEncryptionCipher;break;case qh.pki.oids["aes192-CBC"]:i=24,r=16,o=qh.aes.createEncryptionCipher;break;case qh.pki.oids["aes256-CBC"]:i=32,r=16,o=qh.aes.createEncryptionCipher;break;case qh.pki.oids["des-EDE3-CBC"]:i=24,r=8,o=qh.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+n)}if(void 0===t)t=qh.util.createBuffer(qh.random.getBytes(i));else if(t.length()!=i)throw new Error("Symmetric key has wrong length; got "+t.length()+" bytes, expected "+i+".");e.encryptedContent.algorithm=n,e.encryptedContent.key=t,e.encryptedContent.parameter=qh.util.createBuffer(qh.random.getBytes(r));var a=o(t);if(a.start(e.encryptedContent.parameter.copy()),a.update(e.content),!a.finish())throw new Error("Symmetric encryption failed.");e.encryptedContent.content=a.output}for(var s=0;s<e.recipients.length;++s){var l=e.recipients[s];if(void 0===l.encryptedContent.content)switch(l.encryptedContent.algorithm){case qh.pki.oids.rsaEncryption:l.encryptedContent.content=l.encryptedContent.key.encrypt(e.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+l.encryptedContent.algorithm)}}}}}})),u((function(e){var t=e.exports=qh.ssh=qh.ssh||{};function n(e,t){var n=t.toString(16);n[0]>="8"&&(n="00"+n);var i=qh.util.hexToBytes(n);e.putInt32(i.length),e.putBytes(i)}function i(e,t){e.putInt32(t.length),e.putString(t)}function r(){for(var e=qh.md.sha1.create(),t=arguments.length,n=0;n<t;++n)e.update(arguments[n]);return e.digest()}t.privateKeyToPutty=function(e,t,o){var a=""===(t=t||"")?"none":"aes256-cbc",s="PuTTY-User-Key-File-2: ssh-rsa\r\n";s+="Encryption: "+a+"\r\n",s+="Comment: "+(o=o||"")+"\r\n";var l=qh.util.createBuffer();i(l,"ssh-rsa"),n(l,e.e),n(l,e.n);var u=qh.util.encode64(l.bytes(),64),c=Math.floor(u.length/66)+1;s+="Public-Lines: "+c+"\r\n",s+=u;var h,d=qh.util.createBuffer();if(n(d,e.d),n(d,e.p),n(d,e.q),n(d,e.qInv),t){var p=d.length()+16-1;p-=p%16;var f=r(d.bytes());f.truncate(f.length()-p+d.length()),d.putBuffer(f);var g=qh.util.createBuffer();g.putBuffer(r("\0\0\0\0",t)),g.putBuffer(r("\0\0\0",t));var m=qh.aes.createEncryptionCipher(g.truncate(8),"CBC");m.start(qh.util.createBuffer().fillWithByte(0,16)),m.update(d.copy()),m.finish();var v=m.output;v.truncate(16),h=qh.util.encode64(v.bytes(),64)}else h=qh.util.encode64(d.bytes(),64);s+="\r\nPrivate-Lines: "+(c=Math.floor(h.length/66)+1)+"\r\n",s+=h;var y=r("putty-private-key-file-mac-key",t),_=qh.util.createBuffer();i(_,"ssh-rsa"),i(_,a),i(_,o),_.putInt32(l.length()),_.putBuffer(l),_.putInt32(d.length()),_.putBuffer(d);var b=qh.hmac.create();return b.start("sha1",y),b.update(_.bytes()),s+="\r\nPrivate-MAC: "+b.digest().toHex()+"\r\n"},t.publicKeyToOpenSSH=function(e,t){t=t||"";var r=qh.util.createBuffer();return i(r,"ssh-rsa"),n(r,e.e),n(r,e.n),"ssh-rsa "+qh.util.encode64(r.bytes())+" "+t},t.privateKeyToOpenSSH=function(e,t){return t?qh.pki.encryptRsaPrivateKey(e,t,{legacy:!0,algorithm:"aes128"}):qh.pki.privateKeyToPem(e)},t.getPublicKeyFingerprint=function(e,t){var r=(t=t||{}).md||qh.md.md5.create(),o=qh.util.createBuffer();i(o,"ssh-rsa"),n(o,e.e),n(o,e.n),r.start(),r.update(o.getBytes());var a=r.digest();if("hex"===t.encoding){var s=a.toHex();return t.delimiter?s.match(/.{2}/g).join(t.delimiter):s}if("binary"===t.encoding)return a.getBytes();if(t.encoding)throw new Error('Unknown encoding "'+t.encoding+'".');return a}}));var eg="forge.task",tg={},ng=0;qh.debug.set(eg,"tasks",tg);var ig={};qh.debug.set(eg,"queues",ig);var rg="ready",og="running",ag="blocked",sg="sleeping",lg="error",ug={ready:{}};ug[rg].stop=rg,ug[rg].start=og,ug[rg].cancel="done",ug[rg].fail=lg,ug[og]={},ug[og].stop=rg,ug[og].start=og,ug[og].block=ag,ug[og].unblock=og,ug[og].sleep=sg,ug[og].wakeup=og,ug[og].cancel="done",ug[og].fail=lg,ug[ag]={},ug[ag].stop=ag,ug[ag].start=ag,ug[ag].block=ag,ug[ag].unblock=ag,ug[ag].sleep=ag,ug[ag].wakeup=ag,ug[ag].cancel="done",ug[ag].fail=lg,ug[sg]={},ug[sg].stop=sg,ug[sg].start=sg,ug[sg].block=sg,ug[sg].unblock=sg,ug[sg].sleep=sg,ug[sg].wakeup=sg,ug[sg].cancel="done",ug[sg].fail=lg,ug.done={},ug.done.stop="done",ug.done.start="done",ug.done.block="done",ug.done.unblock="done",ug.done.sleep="done",ug.done.wakeup="done",ug.done.cancel="done",ug.done.fail=lg,ug[lg]={},ug[lg].stop=lg,ug[lg].start=lg,ug[lg].block=lg,ug[lg].unblock=lg,ug[lg].sleep=lg,ug[lg].wakeup=lg,ug[lg].cancel=lg,ug[lg].fail=lg;var cg=function(e){this.id=-1,this.name=e.name||"?",this.parent=e.parent||null,this.run=e.run,this.subtasks=[],this.error=!1,this.state=rg,this.blocks=0,this.timeoutId=null,this.swapTime=null,this.userData=null,this.id=ng++,tg[this.id]=this};cg.prototype.debug=function(e){e=e||"",qh.log.debug(eg,e,"[%s][%s] task:",this.id,this.name,this,"subtasks:",this.subtasks.length,"queue:",ig)},cg.prototype.next=function(e,t){"function"==typeof e&&(t=e,e=this.name);var n=new cg({run:t,name:e,parent:this});return n.state=og,n.type=this.type,n.successCallback=this.successCallback||null,n.failureCallback=this.failureCallback||null,this.subtasks.push(n),this},cg.prototype.parallel=function(e,t){return qh.util.isArray(e)&&(t=e,e=this.name),this.next(e,(function(n){var i=n;i.block(t.length);for(var r=function(e,n){qh.task.start({type:e,run:function(e){t[n](e)},success:function(e){i.unblock()},failure:function(e){i.unblock()}})},o=0;o<t.length;o++){r(e+"__parallel-"+n.id+"-"+o,o)}}))},cg.prototype.stop=function(){this.state=ug[this.state].stop},cg.prototype.start=function(){this.error=!1,this.state=ug[this.state].start,this.state===og&&(this.start=new Date,this.run(this),hg(this,0))},cg.prototype.block=function(e){e=void 0===e?1:e,this.blocks+=e,this.blocks>0&&(this.state=ug[this.state].block)},cg.prototype.unblock=function(e){return e=void 0===e?1:e,this.blocks-=e,0===this.blocks&&"done"!==this.state&&(this.state=og,hg(this,0)),this.blocks},cg.prototype.sleep=function(e){e=void 0===e?0:e,this.state=ug[this.state].sleep;var t=this;this.timeoutId=setTimeout((function(){t.timeoutId=null,t.state=og,hg(t,0)}),e)},cg.prototype.wait=function(e){e.wait(this)},cg.prototype.wakeup=function(){this.state===sg&&(cancelTimeout(this.timeoutId),this.timeoutId=null,this.state=og,hg(this,0))},cg.prototype.cancel=function(){this.state=ug[this.state].cancel,this.permitsNeeded=0,null!==this.timeoutId&&(cancelTimeout(this.timeoutId),this.timeoutId=null),this.subtasks=[]},cg.prototype.fail=function(e){if(this.error=!0,dg(this,!0),e)e.error=this.error,e.swapTime=this.swapTime,e.userData=this.userData,hg(e,0);else{if(null!==this.parent){for(var t=this.parent;null!==t.parent;)t.error=this.error,t.swapTime=this.swapTime,t.userData=this.userData,t=t.parent;dg(t,!0)}this.failureCallback&&this.failureCallback(this)}};var hg=function e(t,n){var i=n>30||+new Date-t.swapTime>20,r=function(n){if(n++,t.state===og)if(i&&(t.swapTime=+new Date),t.subtasks.length>0){var r=t.subtasks.shift();r.error=t.error,r.swapTime=t.swapTime,r.userData=t.userData,r.run(r),r.error||e(r,n)}else dg(t),t.error||null!==t.parent&&(t.parent.error=t.error,t.parent.swapTime=t.swapTime,t.parent.userData=t.userData,e(t.parent,n))};i?setTimeout(r,0):r(n)},dg=function(e,t){e.state="done",delete tg[e.id],null===e.parent&&(e.type in ig?0===ig[e.type].length?qh.log.error(eg,"[%s][%s] task queue empty [%s]",e.id,e.name,e.type):ig[e.type][0]!==e?qh.log.error(eg,"[%s][%s] task not first in queue [%s]",e.id,e.name,e.type):(ig[e.type].shift(),0===ig[e.type].length?delete ig[e.type]:ig[e.type][0].start()):qh.log.error(eg,"[%s][%s] task queue missing [%s]",e.id,e.name,e.type),t||(e.error&&e.failureCallback?e.failureCallback(e):!e.error&&e.successCallback&&e.successCallback(e)))};qh.task=qh.task||{};qh.task.start=function(e){var t=new cg({run:e.run,name:e.name||"?"});t.type=e.type,t.successCallback=e.success||null,t.failureCallback=e.failure||null,t.type in ig?ig[e.type].push(t):(ig[t.type]=[t],function(e){e.error=!1,e.state=ug[e.state].start,setTimeout((function(){e.state===og&&(e.swapTime=+new Date,e.run(e),hg(e,0))}),0)}(t))},qh.task.cancel=function(e){e in ig&&(ig[e]=[ig[e][0]])},qh.task.createCondition=function(){var e={tasks:{},wait:function(t){t.id in e.tasks||(t.block(),e.tasks[t.id]=t)},notify:function(){var t=e.tasks;for(var n in e.tasks={},t)t[n].unblock()}};return e};var pg=qh;const fg={md:pg.md.sha256.create(),mgf:pg.mgf.mgf1.create(pg.md.sha1.create())};function gg(e,t){const n=t.encrypt(e,"RSA-OAEP",fg);return pg.util.encode64(n)}function mg(e){const t=pg.md.md5.create();return t.update(e),t.digest()}function vg(e,t,n){const i=pg.cipher.createCipher("AES-CFB",t),r=n.getIncrementedSeedByteString();i.mode.pad=pg.cipher.modes.cbc.prototype.pad.bind(i.mode),i.start({iv:r}),i.update(e);const o=i.finish(),a=i.output.getBytes();if(!o)throw new Error("Encryption failed.");const s=new ArrayBuffer(a.length),l=new Uint8Array(s);for(let e=0;e<a.length;e++)l[e]=a.charCodeAt(e);return new Blob([l])}function yg(e,t){const n=mg(e+t).getBytes().split("").map(e=>e.charCodeAt(0));let i=0;this.getIncrementedSeedByteString=()=>(++n[i%n.length],++i,n.map(e=>String.fromCharCode(e)).join(""))}function _g(e,t){const n="http://opendatakit.org/submissions",i=document.createElementNS(n,"data");function r(e){const t=document.createElementNS(n,"media"),r=document.createElementNS(n,"file");return r.setAttribute("type","file"),r.textContent=e.name,t.appendChild(r),i.appendChild(t),e}i.setAttribute("encrypted","yes"),i.setAttribute("id",e),t&&i.setAttribute("version",t),this.getXmlStr=()=>(new XMLSerializer).serializeToString(i),this.addElement=(e,t)=>{const r=document.createElementNS(n,e);r.textContent=t,i.appendChild(r)},this.addMetaElement=(e,t)=>{const n=i.querySelector("meta"),r=n||document.createElementNS("http://openrosa.org/xforms","meta"),o=document.createElementNS("http://openrosa.org/xforms",e);o.textContent=t,r.appendChild(o),n||i.appendChild(r)},this.addMediaFiles=e=>e.map(r),this.addXmlSubmissionFile=e=>{const t=document.createElementNS(n,"encryptedXmlFile");t.setAttribute("type","file"),t.textContent=e.name,i.appendChild(t)}}var bg={isSupported:function(){return"undefined"!=typeof ArrayBuffer&&8===new ArrayBuffer(8).byteLength&&"undefined"!=typeof Uint8Array&&8===new Uint8Array(8).length},encryptRecord:function(e,t){const n=pg.random.getBytesSync(32),i=`-----BEGIN PUBLIC KEY-----${e.encryptionKey}-----END PUBLIC KEY-----`,r=pg.pki.publicKeyFromPem(i),o=gg(n,r),a=new yg(t.instanceId,n),s=new _g(e.id,e.version);s.addElement("base64EncryptedKey",o),s.addMetaElement("instanceID",t.instanceId);let l=[e.id];return e.version&&l.push(e.version),l=l.concat([o,t.instanceId]),function(e,t,n){return(e=e||[]).map(e=>()=>C.blobToDataUri(e).then(i=>{const r=pg.util.decode64(i.split(",")[1]),o=vg(pg.util.createBuffer(r,"raw"),t,n);return o.name=e.name+".enc",o.md5=mg(r).toHex(),o})).reduce((e,t)=>e.then(e=>t().then(t=>(e.push(t),e))),Promise.resolve([]))}(t.files,n,a).then(s.addMediaFiles).then(e=>{const i=function(e,t,n){const i=vg(pg.util.createBuffer(e,"utf8"),t,n);return i.name="submission.xml.enc",i.md5=mg(e).toHex(),i}(t.xml,n,a);return s.addXmlSubmissionFile(i),e.push(i),e}).then(e=>{const n=e.map(e=>`${e.name.substring(0,e.name.length-4)}::${e.md5}`);return l=l.concat(n),s.addElement("base64EncryptedElementSignature",function(e,t){const n=e.join("\n")+"\n";return gg(mg(n).getBytes(),t)}(l,r)),t.xml=s.getXmlStr(),t.files=e,t})},Seed:yg};let wg,Eg,Cg;const Sg={printRelevantOnly:k.printRelevantOnly};function kg(){let e;return k.offline?Vh.getAutoSavedRecord().then(t=>{if(t)return e=t,Kt.confirm({heading:dt("confirm.autosaveload.heading"),msg:dt("confirm.autosaveload.msg")},{posButton:dt("confirm.autosaveload.posButton"),negButton:dt("confirm.autosaveload.negButton"),allowAlternativeClose:!1})}).then(t=>{if(t)return e;e&&Vh.removeAutoSavedRecord()}):Promise.resolve()}function Tg(e){let t;if(!e&&wg.editStatus)t=dt("confirm.save.msg"),Kt.confirm(t).then(e=>{e&&Tg(!0)});else{const e=wg.resetView();wg=new vo(e,{modelStr:Eg.modelStr,external:Eg.external},Sg);const t=wg.init();wg.view.html.dispatchEvent(yt.FormReset()),Vh&&Vh.setActive(null),t.length>0&&Kt.alertLoadErrors(t)}}function xg(e=!0,t,n,i){const r={irrelevant:e};return wg.view.html.dispatchEvent(yt.BeforeSave()),t?e&&!n?function(e,t){const n={msg:"",heading:dt("formfooter.savedraft.label"),errorMsg:t},i={posButton:dt("confirm.save.posButton"),negButton:dt("confirm.default.negButton")},r=`<label><span>${dt("confirm.save.name")}</span><span class="or-hint active">${dt("confirm.save.hint")}</span><input name="record-name" type="text" value="${e}"required /></label>`;return Kt.prompt(n,i,r).then(e=>{if(e)return e["record-name"];throw new Error("Cancelled by user")})}(t,i).then(t=>xg(e,t,!0)).catch(()=>{}):lr.getCurrentFiles().then(n=>{const i={draft:e,xml:wg.getDataStr(r),name:t,instanceId:wg.instanceID,deprecateId:wg.deprecatedID,enketoId:k.enketoId,files:n};if(wg.encryptionKey&&!e){const e={encryptionKey:wg.encryptionKey,id:wg.view.html.id,version:wg.version};return bg.encryptRecord(e,i)}return i}).then(e=>{e.files=e.files.map(e=>"string"==typeof e?{name:e}:{name:e.name,item:e});const t=wg.recordName?"update":"set";return Vh[t](e)}).then(()=>{Vh.removeAutoSavedRecord(),Tg(!0),e?Kt.alert(dt("alert.recordsavesuccess.draftmsg"),dt("alert.savedraftinfo.heading"),"info",5):(Kt.alert(""+dt("record-list.msg2"),dt("alert.recordsavesuccess.finalmsg"),"info",10),setTimeout(Vh.uploadQueue,1e4))}).catch(e=>{console.error("save error",e),!(i=e.message)&&e.target&&e.target.error&&e.target.error.name&&"constrainterror"===e.target.error.name.toLowerCase()?i=dt("confirm.save.existingerror"):i||(i=dt("confirm.save.unkownerror")),Kt.alert(i,"Save Error")}):Vh.getCounterValue(k.enketoId).then(e=>wg.instanceName||wg.recordName||`${wg.surveyName} - ${e}`).then(t=>xg(e,t,!1,i))}function Lg(){return wg.recordName||wg.encryptionKey?Promise.resolve():lr.getCurrentFiles().then(e=>{const t={xml:wg.getDataStr(),files:e.map(e=>"string"==typeof e?{name:e}:{name:e.name,item:e})};return Vh.updateAutoSavedRecord(t)}).then(()=>{console.log("autosave successful")}).catch(e=>{console.error("autosave error",e)})}function Ig(e,t){const n=URL.createObjectURL(t);e.textContent=t.name,ur.updateDownloadLink(e,n,t.name),e.click()}function Ag(){const e=document.cookie.split("; ").some(e=>-1!==e.indexOf("__enketo_logout="));T(".form-footer .logout").toggleClass("hide",!e)}function Dg(){try{return window.self!==window.top}catch(e){return!0}}function Ng(e){if(e&&e.type)try{window.parent.postMessage(JSON.stringify({enketoEvent:e.type}),k.parentWindowOrigin)}catch(e){console.error(e)}}var Pg={init:function(e,t){let n,i=[];return Eg=t,function(){if(!k.offline)return Promise.resolve();return Vh.init()}().then(kg).then(n=>{if(!t.instanceStr&&n&&n.xml&&(Vh.setActive(Vh.getAutoSavedKey()),t.instanceStr=n.xml),n&&n.draft&&(t.submitted=!1),t.instanceAttachments&&lr.setInstanceAttachments(t.instanceAttachments),ft()===gt()?Sg.language=ft():Sg.language=gt(),wg=new vo(e,t,Sg),i=wg.init(),T(".main-loader").remove(),k.goTo&&location.hash&&(i=i.concat(wg.goTo(decodeURIComponent(location.hash.substring(1)).split("#")[0]))),wg.encryptionKey){const e=document.querySelector(".form-footer#save-draft");e&&e.remove(),bg.isSupported()||i.unshift(dt("error.encryptionnotsupported"))}if(Cg=document.querySelector(".form-progress"),function(){const e=T(document);T("button#submit-form").click((function(){const e=T(this);return e.btnBusyState(!0),setTimeout(()=>{wg.validate().then(e=>{if(e)return k.offline?xg(!1):function(){const e="single"===k.type||"edit"===k.type||"view"===k.type;let t,n,i,r="";const o={irrelevant:!1};return wg.view.html.dispatchEvent(yt.BeforeSave()),t=e?dt("alert.submission.redirectmsg"):"",n=`<a href="${k.loginUrl}" target="_blank">${dt("here")}</a>`,Kt.alert(t+'<div class="loader-animation-small" style="margin: 40px auto 0 auto;"/>',dt("alert.submission.msg"),"bare"),lr.getCurrentFiles().then(e=>{const t={xml:wg.getDataStr(o),files:e,instanceId:wg.instanceID,deprecatedId:wg.deprecatedID};if(wg.encryptionKey){const e={encryptionKey:wg.encryptionKey,id:wg.view.html.id,version:wg.version};return bg.encryptRecord(e,t)}return t}).then(tn.uploadRecord).then(t=>{if(i="success",(t=t||{}).failedFiles&&t.failedFiles.length>0&&(r=dt("alert.submissionerror.fnfmsg",{failedFiles:t.failedFiles.join(", "),supportEmail:k.supportEmail})+"<br/>",i="warning"),document.dispatchEvent(yt.SubmissionSuccess()),e){if(!k.multipleAllowed){const e=new Date,t=31536e3,n=new Date;history.replaceState({},"",`${k.defaultReturnUrl}?taken=${e.getTime()}`),T("form.or").empty(),T("button#submit-form").remove(),n.setTime(n.getTime()+1e3*t),document.cookie=`${k.enketoId}=${e.getTime()};path=/single;max-age=${t};expires=${n.toGMTString()};`}r+=dt("alert.submissionsuccess.redirectmsg"),Kt.alert(r,dt("alert.submissionsuccess.heading"),i),setTimeout(()=>{location.href=decodeURIComponent(k.returnUrl||k.defaultReturnUrl)},1200)}else r=r.length>0?r:dt("alert.submissionsuccess.msg"),Kt.alert(r,dt("alert.submissionsuccess.heading"),i),Tg(!0)}).catch(e=>{let t;e=e||{},console.error("submission failed",e),t=401===e.status?dt("alert.submissionerror.authrequiredmsg",{here:n,interpolation:{escapeValue:!1}}):e.message||Kt.getErrorResponseMsg(e.status),Kt.alert(t,dt("alert.submissionerror.heading"))})}();Kt.alert(dt("alert.validationerror.msg"))}).catch(e=>{Kt.alert(e.message)}).then(()=>{e.btnBusyState(!1)})},100),!1}));const t=document.querySelector("button#save-draft");t&&t.addEventListener("click",e=>{if(!e.target.matches(".save-draft-info")){const e=T(t);e.btnBusyState(!0),setTimeout(()=>{xg(!0).then(()=>{e.btnBusyState(!1)}).catch(t=>{throw e.btnBusyState(!1),t})},100)}});T("button#validate-form:not(.disabled)").click((function(){if(void 0!==wg){const e=T(this);e.btnBusyState(!0),setTimeout(()=>{wg.validate().then(t=>{e.btnBusyState(!1),t?Kt.alert(dt("alert.validationsuccess.msg"),dt("alert.validationsuccess.heading"),"success"):Kt.alert(dt("alert.validationerror.msg"))}).catch(e=>{Kt.alert(e.message)}).then(()=>{e.btnBusyState(!1)})},100)}return!1})),T("button#close-form:not(.disabled)").click(()=>{const e=dt("alert.submissionsuccess.redirectmsg");return document.dispatchEvent(yt.Close()),Kt.alert(e,dt("alert.closing.heading"),"warning"),setTimeout(()=>{location.href=decodeURIComponent(k.returnUrl||k.defaultReturnUrl)},300),!1}),T(".record-list__button-bar__button.upload").on("click",()=>{Vh.uploadQueue()}),T(".record-list__button-bar__button.export").on("click",()=>{const e='<a class="vex-dialog-link" id="download-export" href="#">download</a>';Vh.exportToZip(wg.surveyName).then(t=>{Kt.alert(dt("alert.export.success.msg")+e,dt("alert.export.success.heading"),"normal"),Ig(document.querySelector("#download-export"),t)}).catch(t=>{let n=dt("alert.export.error.msg",{errors:t.message,interpolation:{escapeValue:!1}});t.exportFile&&(n+=`<p>${dt("alert.export.error.filecreatedmsg")}</p>${e}`),Kt.alert(n,dt("alert.export.error.heading")),t.exportFile&&Ig(document.querySelector("#download-export"),t.exportFile)})}),e.on("click",'.record-list__records__record[data-draft="true"]',(function(){!function e(t,n){let i,r,o;!n&&wg.editStatus?(i={msg:dt("confirm.discardcurrent.msg"),heading:dt("confirm.discardcurrent.heading")},r={posButton:dt("confirm.discardcurrent.posButton")},Kt.confirm(i,r).then(n=>{n&&e(t,!0)})):Vh.get(t).then(e=>{if(!e||!e.xml)return Kt.alert(dt("alert.recordnotfound.msg"));const t=wg.resetView();if(wg=new vo(t,{modelStr:Eg.modelStr,instanceStr:e.xml,external:Eg.external,submitted:!1},Sg),o=wg.init(),wg.view.html.dispatchEvent(yt.FormReset()),wg.recordName=e.name,Vh.setActive(e.instanceId),o.length>0)throw o;Kt.feedback(dt("alert.recordloadsuccess.msg",{recordName:e.name}),2),T(".side-slider__toggle.close").click()}).catch(e=>{console.error("load errors: ",e),Array.isArray(e)||(e=[e.message]),Kt.alertLoadErrors(e,dt("alert.loaderror.editadvice"))})}(T(this).attr("data-id"),!1)})),e.on("click",".record-list__records__record",(function(){T(this).next(".record-list__records__msg").toggle(100)})),document.addEventListener(yt.ProgressUpdate().type,e=>{e.target.classList.contains("or")&&Cg&&e.detail&&(Cg.style.width=e.detail+"%")}),Dg()&&k.parentWindowOrigin&&(document.addEventListener(yt.SubmissionSuccess().type,Ng),document.addEventListener(yt.Edited().type,Ng),document.addEventListener(yt.Close().type,Ng));document.addEventListener(yt.QueueSubmissionSuccess().type,e=>{const t=e.detail;Kt.feedback(dt("alert.queuesubmissionsuccess.msg",{count:t.length,recordNames:t.join(", ")}),7)});const n=document.querySelector("#form-languages");n&&n.addEventListener(yt.Change().type,e=>{e.preventDefault(),console.log("ready to set UI lang",wg.langs.currentLang),pt(document.querySelector("body"),wg.langs.currentLang).then(e=>document.querySelector("html").setAttribute("dir",e))});k.offline&&document.addEventListener(yt.XFormsValueChanged().type,()=>{setTimeout(Lg,500)})}(),Ag(),i.length>0)throw i;return wg}).catch(e=>{Array.isArray(e)?i=e:i.unshift(e.message||dt("error.unknown")),n=t.instanceStr?dt("alert.loaderror.editadvice"):dt("alert.loaderror.entryadvice"),Kt.alertLoadErrors(i,n)})},setLogoutLinkVisibility:Ag,inIframe:Dg,postEventAsMessageToParentWindow:Ng};const Bg=document.querySelector(".main-loader"),Rg=document.querySelector(".main > .paper > .form-header"),Mg={enketoId:k.enketoId,instanceId:k.instanceId},Og=document.createRange();po.update=()=>{console.log("Calculations disabled.")},si.prototype.setInstanceIdAndDeprecatedId=()=>{console.log("InstanceID and deprecatedID population disabled.")},co.init=()=>{console.log("Preloaders disabled.")},ct(Mg).then(e=>tn.getFormParts(e)).then(e=>Mg.instanceId?tn.getExistingInstance(Mg).then(t=>(e.instance=t.instance,e.instanceAttachments=t.instanceAttachments,e)):e).then(e=>{if(e.form&&e.model)return Kt.swapTheme(e);throw new Error(dt("error.unknown"))}).then((function(e){return e.formFragment=Og.createContextualFragment(e.form),e.formFragment.querySelectorAll("input:not([readonly]), textarea:not([readonly]), select:not(#form-languages):not([readonly])").forEach(e=>{e.setAttribute("readonly","readonly"),e.classList.add("readonly-forced")}),e.formFragment.querySelectorAll("select:not(#form-languages) option").forEach(e=>e.disabled=!0),e.formFragment.querySelectorAll(".or-repeat-info").forEach(e=>e.setAttribute("data-repeat-fixed","fixed")),e})).then((function(e){Rg.after(e.formFragment);const t=document.querySelector("form.or");pt(t),Pg.init(t,{modelStr:e.model,instanceStr:e.instance,external:e.externalData,instanceAttachments:e.instanceAttachments}).then(t=>{e.languages=t.languages,document.querySelector("head>title").textContent=document.querySelector("#form-title").textContent,k.print&&Kt.applyPrintStyle()})})).catch((function(e){Bg.classList.add("fail"),401===e.status?window.location.href=`${k.loginUrl}?return_url=${encodeURIComponent(window.location.href)}`:Kt.alert(e.message,dt("alert.loaderror.heading"))}))}();